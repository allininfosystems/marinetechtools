require.config({"config": {
        "jsbuild":{"Ess_M2ePro/js/Amazon/Account.js":"define([\r\n    'M2ePro/Common'\r\n], function(){\r\n\r\n    window.AmazonAccount = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-account-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Account. Account Title must be unique.'),\r\n                'Account', 'title', 'id',\r\n                M2ePro.formData.id,\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Amazon::NICK'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-marketplace-merchant', function(value, el) {\r\n\r\n                if (jQuery.validator.methods['M2ePro-required-when-visible'](null, el)) {\r\n                    return true;\r\n                }\r\n\r\n                // reset error message to the default\r\n                this.error = M2ePro.translator.translate('M2E Pro was not able to get access to the Amazon Account. Please, make sure, that you choose correct Option on MWS Authorization Page and enter correct Merchant ID.');\r\n\r\n                var merchant_id    = $('merchant_id').value;\r\n                var token          = $('token').value;\r\n                var marketplace_id = $('marketplace_id').value;\r\n\r\n                var pattern = /^[A-Z0-9]*$/;\r\n                if (!pattern.test(merchant_id)) {\r\n                    return false;\r\n                }\r\n\r\n                var checkResult = false;\r\n                var checkReason = null;\r\n\r\n                new Ajax.Request(M2ePro.url.get('amazon_account/checkAuth'), {\r\n                    method: 'post',\r\n                    asynchronous: false,\r\n                    parameters: {\r\n                        merchant_id    : merchant_id,\r\n                        token          : token,\r\n                        marketplace_id : marketplace_id\r\n                    },\r\n                    onSuccess: function(transport) {\r\n                        var response = transport.responseText.evalJSON();\r\n                        checkResult = response['result'];\r\n                        checkReason = response['reason'];\r\n                    }\r\n                });\r\n\r\n                if (checkReason != null) {\r\n                    this.error = M2ePro.translator.translate('M2E Pro was not able to get access to the Amazon Account. Reason: %error_message%').replace('%error_message%', checkReason);\r\n                }\r\n\r\n                return checkResult;\r\n\r\n            }, M2ePro.translator.translate('M2E Pro was not able to get access to the Amazon Account. Please, make sure, that you choose correct Option on MWS Authorization Page and enter correct Merchant ID.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-account-customer-id', function(value) {\r\n\r\n                var checkResult = false;\r\n\r\n                if ($('magento_orders_customer_id_container').getStyle('display') == 'none') {\r\n                    return true;\r\n                }\r\n\r\n                new Ajax.Request(M2ePro.url.get('general/checkCustomerId'), {\r\n                    method: 'post',\r\n                    asynchronous: false,\r\n                    parameters: {\r\n                        customer_id: value,\r\n                        id         : M2ePro.formData.id\r\n                    },\r\n                    onSuccess: function(transport) {\r\n                        checkResult = transport.responseText.evalJSON()['ok'];\r\n                    }\r\n                });\r\n\r\n                return checkResult;\r\n            }, M2ePro.translator.translate('No Customer entry is found for specified ID.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-account-order-number-prefix', function(value) {\r\n\r\n                if ($('magento_orders_number_prefix_mode').value == 0) {\r\n                    return true;\r\n                }\r\n\r\n                return value.length <= 5;\r\n            }, M2ePro.translator.translate('Prefix length should not be greater than 5 characters.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-require-select-attribute', function(value, el) {\r\n\r\n                if ($('other_listings_mapping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_MODE_NO')) {\r\n                    return true;\r\n                }\r\n\r\n                var isAttributeSelected = false;\r\n\r\n                $$('.attribute-mode-select').forEach(function(obj) {\r\n                    if (obj.value != 0) {\r\n                        isAttributeSelected = true;\r\n                    }\r\n                });\r\n\r\n                return isAttributeSelected;\r\n            }, M2ePro.translator.translate('If Yes is chosen, you must select at least one Attribute for Product Mapping.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-account-repricing-price-value', function(value, el) {\r\n\r\n                if (!el.up('div.admin__field.field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                if (!value.match(/^\\d+[.]?\\d*?$/g)) {\r\n                    return false;\r\n                }\r\n\r\n                if (value <= 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n\r\n            }, M2ePro.translator.translate('Invalid input data. Decimal value required. Example 12.05'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-account-repricing-price-percent', function(value, el) {\r\n\r\n                if (!el.up('div.admin__field.field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                if (!value.match(/^\\d+$/g)) {\r\n                    return false;\r\n                }\r\n\r\n                if (value <= 0 || value > 100) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n\r\n            }, M2ePro.translator.translate('Please enter correct value.'));\r\n\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            //tab listingOther\r\n            $('other_listings_synchronization')\r\n                .observe('change', AmazonAccountObj.other_listings_synchronization_change)\r\n                .simulate('change');\r\n            $('other_listings_mapping_mode')\r\n                .observe('change', AmazonAccountObj.other_listings_mapping_mode_change)\r\n                .simulate('change');\r\n\r\n            $('mapping_general_id_mode')\r\n                .observe('change', AmazonAccountObj.mapping_general_id_mode_change)\r\n                .simulate('change');\r\n            $('mapping_sku_mode')\r\n                .observe('change', AmazonAccountObj.mapping_sku_mode_change)\r\n                .simulate('change');\r\n            $('mapping_title_mode')\r\n                .observe('change', AmazonAccountObj.mapping_title_mode_change)\r\n                .simulate('change');\r\n            $('other_listings_move_mode')\r\n                .observe('change', AmazonAccountObj.move_mode_change)\r\n                .simulate('change');\r\n\r\n            //$('amazonAccountEditTabs_listingOther').removeClassName('changed');\r\n\r\n            if ($('is_vat_calculation_service_enabled')) {\r\n                $('is_vat_calculation_service_enabled')\r\n                    .observe('change', AmazonAccountObj.vatCalculationModeChange)\r\n                    .simulate('change');\r\n            }\r\n\r\n            //tab order\r\n            $('magento_orders_listings_mode').observe('change', AmazonAccountObj.magentoOrdersListingsModeChange).simulate('change');\r\n            $('magento_orders_listings_store_mode').observe('change', AmazonAccountObj.magentoOrdersListingsStoreModeChange).simulate('change');\r\n\r\n            $('magento_orders_listings_other_mode').observe('change', AmazonAccountObj.magentoOrdersListingsOtherModeChange).simulate('change');\r\n            $('magento_orders_listings_other_product_mode').observe('change', AmazonAccountObj.magentoOrdersListingsOtherProductModeChange);\r\n\r\n            $('magento_orders_number_source').observe('change', AmazonAccountObj.magentoOrdersNumberSourceChange).simulate('change');\r\n            $('magento_orders_number_prefix_mode').observe('change', AmazonAccountObj.magentoOrdersNumberPrefixModeChange).simulate('change');\r\n            $('magento_orders_number_prefix_prefix').observe('keyup', AmazonAccountObj.magentoOrdersNumberPrefixPrefixChange).simulate('change');\r\n            AmazonAccountObj.renderOrderNumberExample();\r\n\r\n            $('magento_orders_fba_mode').observe('change', AmazonAccountObj.magentoOrdersFbaModeChange).simulate('change');\r\n\r\n            $('magento_orders_customer_mode').observe('change', AmazonAccountObj.magentoOrdersCustomerModeChange).simulate('change');\r\n            $('magento_orders_status_mapping_mode').observe('change', AmazonAccountObj.magentoOrdersStatusMappingModeChange);\r\n\r\n            $('order_number_example-note').previous().remove();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        deleteClick: function()\r\n        {\r\n            this.confirm({\r\n                content: M2ePro.translator.translate('Be attentive! By Deleting Account you delete all information on it from M2E Pro Server. This will cause inappropriate work of all Accounts\\' copies.'),\r\n                actions: {\r\n                    confirm: function () {\r\n                        setLocation(M2ePro.url.get('deleteAction'));\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getToken: function(marketplaceId) {\r\n            var title = $('title');\r\n\r\n            title.removeClassName('required-entry M2ePro-account-title');\r\n            $('merchant_id').removeClassName('M2ePro-marketplace-merchant');\r\n            $('token').removeClassName('M2ePro-marketplace-merchant');\r\n            $('other_listings_mapping_mode').removeClassName('M2ePro-require-select-attribute');\r\n\r\n            this.submitForm(M2ePro.url.get(\r\n                'amazon_account/beforeGetToken',\r\n                {\r\n                    'id': M2ePro.formData.id,\r\n                    'title': title.value,\r\n                    'marketplace_id': marketplaceId\r\n                }\r\n            ));\r\n\r\n            return false;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        changeMarketplace: function(id)\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            $$('[id^=\"marketplaces_developer_key_container_\"],[id^=\"marketplaces_register_url_container_\"]').invoke('hide');\r\n\r\n            $('marketplaces_related_store_id_container').show();\r\n            $('marketplaces_merchant_id_container').show();\r\n            $('marketplaces_token_container').show();\r\n\r\n            self.showGetAccessData(id);\r\n        },\r\n\r\n        showGetAccessData: function(id)\r\n        {\r\n            $('marketplaces_application_name_container').show();\r\n\r\n            $('marketplaces_developer_key_container_'+id).show();\r\n            $('marketplaces_register_url_container_'+id).show();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        other_listings_synchronization_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_SYNCHRONIZATION_YES')) {\r\n                $('other_listings_mapping_mode_tr').show();\r\n                $('marketplaces_related_store_id_container').show();\r\n            } else {\r\n                $('other_listings_mapping_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_MODE_NO');\r\n                $('other_listings_mapping_mode').simulate('change');\r\n                $('other_listings_mapping_mode_tr').hide();\r\n                $('marketplaces_related_store_id_container').hide();\r\n            }\r\n        },\r\n\r\n        other_listings_mapping_mode_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_MODE_YES')) {\r\n                $('magento_block_amazon_accounts_other_listings_product_mapping').show();\r\n                $('magento_block_amazon_accounts_other_listings_move_mode').show();\r\n            } else {\r\n                $('magento_block_amazon_accounts_other_listings_product_mapping').hide();\r\n                $('magento_block_amazon_accounts_other_listings_move_mode').hide();\r\n\r\n                $('other_listings_move_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MOVE_TO_LISTINGS_DISABLED');\r\n                $('mapping_general_id_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_GENERAL_ID_MODE_NONE');\r\n                $('mapping_sku_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_SKU_MODE_NONE');\r\n                $('mapping_title_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_TITLE_MODE_NONE');\r\n            }\r\n\r\n            $('mapping_general_id_mode').simulate('change');\r\n            $('mapping_sku_mode').simulate('change');\r\n            $('mapping_title_mode').simulate('change');\r\n\r\n            $('other_listings_move_mode').simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mapping_general_id_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_GENERAL_ID_MODE_NONE')) {\r\n                $('mapping_general_id_priority_td').hide();\r\n            } else {\r\n                $('mapping_general_id_priority_td').show();\r\n            }\r\n\r\n            $('mapping_general_id_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_GENERAL_ID_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('mapping_general_id_attribute'));\r\n            }\r\n        },\r\n\r\n        mapping_sku_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_SKU_MODE_NONE')) {\r\n                $('mapping_sku_priority_td').hide();\r\n            } else {\r\n                $('mapping_sku_priority_td').show();\r\n            }\r\n\r\n            $('mapping_sku_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_SKU_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('mapping_sku_attribute'));\r\n            }\r\n        },\r\n\r\n        mapping_title_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_TITLE_MODE_NONE')) {\r\n                $('mapping_title_priority_td').hide();\r\n            } else {\r\n                $('mapping_title_priority_td').show();\r\n            }\r\n\r\n            $('mapping_title_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_TITLE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('mapping_title_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        move_mode_change: function()\r\n        {\r\n            if ($('other_listings_move_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MOVE_TO_LISTINGS_ENABLED')) {\r\n                $('other_listings_move_synch_tr').show();\r\n            } else {\r\n                $('other_listings_move_synch_tr').hide();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        magentoOrdersListingsModeChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if ($('magento_orders_listings_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_MODE_YES')) {\r\n                $('magento_orders_listings_store_mode_container').show();\r\n            } else {\r\n                $('magento_orders_listings_store_mode_container').hide();\r\n                $('magento_orders_listings_store_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_STORE_MODE_DEFAULT');\r\n            }\r\n\r\n            self.magentoOrdersListingsStoreModeChange();\r\n            self.changeVisibilityForOrdersModesRelatedBlocks();\r\n        },\r\n\r\n        magentoOrdersListingsStoreModeChange: function()\r\n        {\r\n            if ($('magento_orders_listings_store_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_STORE_MODE_CUSTOM')) {\r\n                $('magento_orders_listings_store_id_container').show();\r\n            } else {\r\n                $('magento_orders_listings_store_id_container').hide();\r\n                $('magento_orders_listings_store_id').value = '';\r\n            }\r\n        },\r\n\r\n        magentoOrdersListingsOtherModeChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if ($('magento_orders_listings_other_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_MODE_YES')) {\r\n                $('magento_orders_listings_other_product_mode_container').show();\r\n                $('magento_orders_listings_other_store_id_container').show();\r\n            } else {\r\n                $('magento_orders_listings_other_product_mode_container').hide();\r\n                $('magento_orders_listings_other_store_id_container').hide();\r\n                $('magento_orders_listings_other_product_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_PRODUCT_MODE_IGNORE');\r\n                $('magento_orders_listings_other_store_id').value = '';\r\n            }\r\n\r\n            self.magentoOrdersListingsOtherProductModeChange();\r\n            self.changeVisibilityForOrdersModesRelatedBlocks();\r\n        },\r\n\r\n        magentoOrdersListingsOtherProductModeChange: function()\r\n        {\r\n            if ($('magento_orders_listings_other_product_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_PRODUCT_MODE_IGNORE')) {\r\n                $('magento_orders_listings_other_product_mode_note').hide();\r\n                $('magento_orders_listings_other_product_tax_class_id_container').hide();\r\n            } else {\r\n                $('magento_orders_listings_other_product_mode_note').show();\r\n                $('magento_orders_listings_other_product_tax_class_id_container').show();\r\n            }\r\n        },\r\n\r\n        magentoOrdersNumberSourceChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n            self.renderOrderNumberExample();\r\n        },\r\n\r\n        magentoOrdersNumberPrefixModeChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if ($('magento_orders_number_prefix_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_PREFIX_MODE_YES')) {\r\n                $('magento_orders_number_prefix_container').show();\r\n            } else {\r\n                $('magento_orders_number_prefix_container').hide();\r\n                $('magento_orders_number_prefix_prefix').value = '';\r\n            }\r\n\r\n            self.renderOrderNumberExample();\r\n        },\r\n\r\n        magentoOrdersNumberPrefixPrefixChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n            self.renderOrderNumberExample();\r\n        },\r\n\r\n        renderOrderNumberExample: function()\r\n        {\r\n            var orderNumber = $('sample_magento_order_id').value;\r\n            if ($('magento_orders_number_source').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_SOURCE_CHANNEL')) {\r\n                orderNumber = $('sample_amazon_order_id').value;\r\n            }\r\n\r\n            if ($('magento_orders_number_prefix_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_PREFIX_MODE_YES')) {\r\n                orderNumber = $('magento_orders_number_prefix_prefix').value + orderNumber;\r\n            }\r\n\r\n            $('order_number_example_container').update(orderNumber);\r\n        },\r\n\r\n        magentoOrdersFbaModeChange: function()\r\n        {\r\n            if ($('magento_orders_fba_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_FBA_MODE_NO')) {\r\n                $('magento_orders_fba_stock_mode_container').hide();\r\n                $('magento_orders_fba_stock_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_FBA_STOCK_MODE_NO');\r\n            } else {\r\n                $('magento_orders_fba_stock_mode_container').show();\r\n            }\r\n        },\r\n\r\n        magentoOrdersCustomerModeChange: function()\r\n        {\r\n            var customerMode = $('magento_orders_customer_mode').value;\r\n\r\n            if (customerMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_CUSTOMER_MODE_PREDEFINED')) {\r\n                $('magento_orders_customer_id_container').show();\r\n                $('magento_orders_customer_id').addClassName('M2ePro-account-product-id');\r\n            } else {  // M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::ORDERS_CUSTOMER_MODE_GUEST') || M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::ORDERS_CUSTOMER_MODE_NEW')\r\n                $('magento_orders_customer_id_container').hide();\r\n                $('magento_orders_customer_id').value = '';\r\n                $('magento_orders_customer_id').removeClassName('M2ePro-account-product-id');\r\n            }\r\n\r\n            var action = (customerMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_CUSTOMER_MODE_NEW')) ? 'show' : 'hide';\r\n            $('magento_orders_customer_new_website_id_container')[action]();\r\n            $('magento_orders_customer_new_group_id_container')[action]();\r\n            $('magento_orders_customer_new_notifications_container')[action]();\r\n\r\n            if(action == 'hide') {\r\n                $('magento_orders_customer_new_website_id').value = '';\r\n                $('magento_orders_customer_new_group_id').value = '';\r\n                $('magento_orders_customer_new_notifications').value = '';\r\n            }\r\n        },\r\n\r\n        magentoOrdersStatusMappingModeChange: function()\r\n        {\r\n            // Reset dropdown selected values to default\r\n            $('magento_orders_status_mapping_processing').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_PROCESSING');\r\n            $('magento_orders_status_mapping_shipped').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_SHIPPED');\r\n            // Default auto create invoice & shipment\r\n            $('magento_orders_invoice_mode').checked = true;\r\n            $('magento_orders_shipment_mode').checked = true;\r\n            var disabled = $('magento_orders_status_mapping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_MODE_DEFAULT');\r\n            $('magento_orders_status_mapping_processing').disabled = disabled;\r\n            $('magento_orders_status_mapping_shipped').disabled = disabled;\r\n            $('magento_orders_invoice_mode').disabled = disabled;\r\n            $('magento_orders_shipment_mode').disabled = disabled;\r\n        },\r\n\r\n        changeVisibilityForOrdersModesRelatedBlocks: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if ($('magento_orders_listings_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_MODE_NO') &&\r\n                $('magento_orders_listings_other_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_MODE_NO')) {\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_number-wrapper').hide();\r\n                $('magento_orders_number_source').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_SOURCE_MAGENTO');\r\n                $('magento_orders_number_prefix_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_PREFIX_MODE_NO');\r\n                self.magentoOrdersNumberPrefixModeChange();\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_fba-wrapper').hide();\r\n                $('magento_orders_fba_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_FBA_MODE_YES');\r\n                $('magento_orders_fba_stock_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_FBA_STOCK_MODE_YES');\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_refund_and_cancellation-wrapper').hide();\r\n                $('magento_orders_refund').value = 1;\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_customer-wrapper').hide();\r\n                $('magento_orders_customer_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_CUSTOMER_MODE_GUEST');\r\n                self.magentoOrdersCustomerModeChange();\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_status_mapping-wrapper').hide();\r\n                $('magento_orders_status_mapping_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_MODE_DEFAULT');\r\n                self.magentoOrdersStatusMappingModeChange();\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_rules-wrapper').hide();\r\n                $('magento_orders_qty_reservation_days').value = 1;\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_tax-wrapper').hide();\r\n                $('magento_orders_tax_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_TAX_MODE_MIXED');\r\n\r\n                $('magento_orders_customer_billing_address_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_BILLING_ADDRESS_MODE_SHIPPING_IF_SAME_CUSTOMER_AND_RECIPIENT');\r\n            } else {\r\n                $('magento_block_amazon_accounts_magento_orders_number-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_fba-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_refund_and_cancellation-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_customer-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_status_mapping-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_tax-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_rules-wrapper').show();\r\n            }\r\n        },\r\n\r\n        vatCalculationModeChange: function()\r\n        {\r\n            $('is_magento_invoice_creation_disabled_tr').hide();\r\n\r\n            if ($('is_vat_calculation_service_enabled').value == 1) {\r\n                $('is_magento_invoice_creation_disabled_tr').show();\r\n            }\r\n        },\r\n\r\n        // Repricing Integration\r\n        // ---------------------------------------\r\n\r\n        linkOrRegisterRepricing: function()\r\n        {\r\n            return setLocation(M2ePro.url.get('amazon_account_repricing/linkOrRegister'));\r\n        },\r\n\r\n        unlinkRepricing: function()\r\n        {\r\n            this.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        AmazonAccountObj.openUnlinkPage();\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        openUnlinkPage: function()\r\n        {\r\n            return setLocation(M2ePro.url.get('amazon_account_repricing/openUnlinkPage'));\r\n        },\r\n\r\n        openManagement: function()\r\n        {\r\n            window.open(M2ePro.url.get('amazon_account_repricing/openManagement'));\r\n        },\r\n\r\n        regular_price_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj,\r\n                regularPriceAttr = $('regular_price_attribute'),\r\n                regularPriceCoeficient = $('regular_price_coefficient_td'),\r\n                variationRegularPrice = $('regular_price_variation_mode_tr');\r\n\r\n            regularPriceAttr.value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, regularPriceAttr);\r\n            }\r\n\r\n            regularPriceCoeficient.hide();\r\n            variationRegularPrice.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL') &&\r\n                this.value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::REGULAR_PRICE_MODE_PRODUCT_POLICY')) {\r\n\r\n                regularPriceCoeficient.show();\r\n                variationRegularPrice.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL')) {\r\n                $$('.repricing-min-price-mode-regular-depended').each(function (element) {\r\n                    if (element.selected) {\r\n                        element.up().selectedIndex = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL');\r\n                        element.simulate('change');\r\n                    }\r\n\r\n                    element.hide();\r\n                });\r\n\r\n                $$('.repricing-max-price-mode-regular-depended').each(function (element) {\r\n                    if (element.selected) {\r\n                        element.up().selectedIndex = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL');\r\n                        element.simulate('change');\r\n                    }\r\n\r\n                    element.hide();\r\n                });\r\n            } else {\r\n                $$('.repricing-min-price-mode-regular-depended').each(function (element) {\r\n                    element.show();\r\n                });\r\n\r\n                $$('.repricing-max-price-mode-regular-depended').each(function (element) {\r\n                    element.show();\r\n                });\r\n            }\r\n        },\r\n\r\n        min_price_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj,\r\n                minPriceValueTr = $('min_price_value_tr'),\r\n                minPricePercentTr = $('min_price_percent_tr'),\r\n                minPriceWarning = $('min_price_warning_tr'),\r\n                minPriceAttr = $('min_price_attribute'),\r\n                minPriceCoeficient = $('min_price_coefficient_td'),\r\n                variationMinPrice = $('min_price_variation_mode_tr');\r\n\r\n            minPriceWarning.hide();\r\n            if (this.value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL')) {\r\n                minPriceWarning.show();\r\n            }\r\n\r\n            minPriceCoeficient.hide();\r\n            variationMinPrice.hide();\r\n\r\n            minPriceAttr.value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, minPriceAttr);\r\n\r\n                minPriceCoeficient.show();\r\n                variationMinPrice.show();\r\n            }\r\n\r\n            minPriceValueTr.hide();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::MIN_PRICE_MODE_REGULAR_VALUE')) {\r\n                minPriceValueTr.show();\r\n            }\r\n\r\n            minPricePercentTr.hide();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::MIN_PRICE_MODE_REGULAR_PERCENT')) {\r\n                minPricePercentTr.show();\r\n            }\r\n        },\r\n\r\n        max_price_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj,\r\n                maxPriceValueTr = $('max_price_value_tr'),\r\n                maxPricePercentTr = $('max_price_percent_tr'),\r\n                maxPriceWarning = $('max_price_warning_tr'),\r\n                maxPriceAttr = $('max_price_attribute'),\r\n                maxPriceCoeficient = $('max_price_coefficient_td'),\r\n                variationMaxPrice = $('max_price_variation_mode_tr');\r\n\r\n            maxPriceWarning.hide();\r\n            if (this.value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL')) {\r\n                maxPriceWarning.show();\r\n            }\r\n\r\n            maxPriceCoeficient.hide();\r\n            variationMaxPrice.hide();\r\n\r\n            maxPriceAttr.value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, maxPriceAttr);\r\n\r\n                maxPriceCoeficient.show();\r\n                variationMaxPrice.show();\r\n            }\r\n\r\n            maxPriceValueTr.hide();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::MAX_PRICE_MODE_REGULAR_VALUE')) {\r\n                maxPriceValueTr.show();\r\n            }\r\n\r\n            maxPricePercentTr.hide();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::MAX_PRICE_MODE_REGULAR_PERCENT')) {\r\n                maxPricePercentTr.show();\r\n            }\r\n        },\r\n\r\n        disable_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj,\r\n                disableModeAttr = $('disable_mode_attribute');\r\n\r\n            disableModeAttr.value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::DISABLE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, disableModeAttr);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveAndClose: function()\r\n        {\r\n            var self = this,\r\n                url = typeof M2ePro.url.urls.formSubmit == 'undefined' ?\r\n                    M2ePro.url.formSubmit + 'back/'+base64_encode('list')+'/' :\r\n                    M2ePro.url.get('formSubmit', {'back': base64_encode('list')});\r\n\r\n            if (!self.isValidForm()) {\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(url, {\r\n                method: 'post',\r\n                parameters: Form.serialize($('edit_form')),\r\n                onSuccess: function(transport) {\r\n                    transport = transport.responseText.evalJSON();\r\n\r\n                    if (transport.success) {\r\n                        window.close();\r\n                    } else {\r\n                        self.alert(transport.message);\r\n                        return;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/AfnQty.js":"define([\r\n    'Magento_Ui/js/modal/alert'\r\n], function (alert) {\r\n    window.AmazonListingAfnQty = Class.create();\r\n    AmazonListingAfnQty.prototype = {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function(containerId) {},\r\n\r\n        // ---------------------------------------\r\n\r\n        showAfnQty: function(el, selectedSku, selectedProductId, accountId) {\r\n\r\n            var self = this,\r\n                skus = [];\r\n\r\n            var i = 50,\r\n                hasSelected = false;\r\n            el.up('table').select('.m2ePro-online-sku-value').each(function (skuEl) {\r\n                if (i === 0) {\r\n                    throw $break;\r\n                }\r\n\r\n                if (skuEl.innerHTML == '') {\r\n                    return;\r\n                }\r\n\r\n                if (selectedSku == skuEl.innerHTML) {\r\n                    hasSelected = true;\r\n                }\r\n\r\n                skus.push({\r\n                    sku: skuEl.innerHTML,\r\n                    productId: skuEl.getAttribute('productId')\r\n                });\r\n                i--;\r\n            });\r\n\r\n            if (!hasSelected) {\r\n                skus.pop();\r\n                skus.push({\r\n                    sku: selectedSku,\r\n                    productId: selectedProductId\r\n                });\r\n            }\r\n\r\n            var skusStr = '';\r\n            skus.each(function(item) {\r\n                skusStr += item.sku + ','\r\n            });\r\n\r\n            skusStr = rtrim(skusStr, ',');\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing/getAFNQtyBySku'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    skus: skusStr,\r\n                    account_id: accountId\r\n                },\r\n                onSuccess: function(transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert({\r\n                            content: transport.responseText\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    var data = {};\r\n                    skus.each(function (item) {\r\n                        if (response.items[item.sku]) {\r\n                            data[item.productId] = response.items[item.sku].qty;\r\n                        } else {\r\n                            data[item.productId] = 'empty';\r\n                        }\r\n                    });\r\n\r\n                    self.renderAfnQty(data);\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderAfnQty: function(data)\r\n        {\r\n            var self = this;\r\n\r\n            $H(data).each(function(item) {\r\n                var container = $('m2ePro_afn_qty_value_' + item.key);\r\n\r\n                container.down('a').hide();\r\n                container.down('.m2ePro-online-sku-value').remove();\r\n\r\n                if (item.value != 'empty') {\r\n                    container.down('.m2epro-afn-qty-data').show();\r\n\r\n                    container.down('.total span').update(item.value.total);\r\n                    container.down('.in-stock span').update(item.value.in_stock);\r\n                } else {\r\n                    container.down('.m2epro-empty-afn-qty-data').show();\r\n                }\r\n            });\r\n        }\r\n\r\n    };\r\n});","Ess_M2ePro/js/Amazon/Listing/AutoAction.js":"define([\r\n    'jquery',\r\n    'M2ePro/Listing/AutoAction',\r\n    'prototype'\r\n], function (jQuery) {\r\n\r\n    window.AmazonListingAutoAction = Class.create(ListingAutoAction, {\r\n\r\n        // ---------------------------------------\r\n\r\n        controller: 'amazon_listing_autoAction',\r\n\r\n        // ---------------------------------------\r\n\r\n        addingModeChange: function(el)\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Listing::ADDING_MODE_ADD') &&\r\n                ListingAutoActionObj.showCreateNewAsin) {\r\n\r\n                $('auto_action_amazon_add_and_create_asin').show();\r\n            } else {\r\n                $('auto_action_amazon_add_and_create_asin').hide();\r\n                $('auto_action_amazon_add_and_assign_description_template').hide();\r\n                $('auto_action_create_asin').value = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::ADDING_MODE_ADD_AND_CREATE_NEW_ASIN_NO');\r\n                $('adding_description_template_id').value = '';\r\n            }\r\n\r\n            if (el.target.value != M2ePro.php.constant('Ess_M2ePro_Model_Listing::ADDING_MODE_NONE')) {\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].show();\r\n            } else {\r\n                $$('[id$=\"adding_add_not_visible\"]')[0].value = M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_ADDING_ADD_NOT_VISIBLE_YES');\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].hide();\r\n            }\r\n        },\r\n\r\n        createAsinChange: function(el)\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::ADDING_MODE_ADD_AND_CREATE_NEW_ASIN_YES')) {\r\n                $('auto_action_amazon_add_and_assign_description_template').show();\r\n            } else {\r\n                $('auto_action_amazon_add_and_assign_description_template').hide();\r\n                $('adding_description_template_id').value = '';\r\n            }\r\n        },\r\n\r\n        categoryStepOne: function(groupId)\r\n        {\r\n            this.loadAutoCategoryForm(groupId, function() {\r\n                $('category_close_button').hide();\r\n            });\r\n        },\r\n\r\n        collectData: function()\r\n        {\r\n            if ($('auto_mode')) {\r\n                switch (parseInt($('auto_mode').value)) {\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_GLOBAL'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            auto_mode: $('auto_mode').value,\r\n                            auto_global_adding_mode: $('auto_global_adding_mode').value,\r\n                            auto_global_adding_add_not_visible: $('auto_global_adding_add_not_visible').value,\r\n                            adding_description_template_id: $('adding_description_template_id').value\r\n                        };\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_WEBSITE'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            auto_mode: $('auto_mode').value,\r\n                            auto_website_adding_mode: $('auto_website_adding_mode').value,\r\n                            auto_website_adding_add_not_visible: $('auto_website_adding_add_not_visible').value,\r\n                            auto_website_deleting_mode: $('auto_website_deleting_mode').value,\r\n                            adding_description_template_id: $('adding_description_template_id').value\r\n                        };\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_CATEGORY'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            id: $('group_id').value,\r\n                            title: $('group_title').value,\r\n                            auto_mode: $('auto_mode').value,\r\n                            adding_mode: $('adding_mode').value,\r\n                            adding_add_not_visible: $('adding_add_not_visible').value,\r\n                            deleting_mode: $('deleting_mode').value,\r\n                            categories: categories_selected_items,\r\n                            adding_description_template_id: $('adding_description_template_id').value\r\n                        };\r\n                        break;\r\n                }\r\n            }\r\n        },\r\n\r\n        reloadDescriptionTemplates: function()\r\n        {\r\n            var select = $('adding_description_template_id');\r\n\r\n            new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/getDescriptionTemplatesList'), {\r\n                onSuccess: function(transport) {\r\n\r\n                    var data = transport.responseText.evalJSON(true);\r\n\r\n                    var options = '<option></option>';\r\n\r\n                    var firstItem = null;\r\n                    var currentValue = select.value;\r\n\r\n                    data.each(function(item) {\r\n                        var key = item.id;\r\n                        var val = item.title;\r\n                        var disabled = item.is_new_asin_accepted == 0 ? ' disabled=\"disabled\"' : '';\r\n\r\n                        options += '<option value=\"' + key + '\"' + disabled + '>' + val + '</option>\\n';\r\n\r\n                        if (!firstItem) {\r\n                            firstItem = item;\r\n                        }\r\n                    });\r\n\r\n                    select.update();\r\n                    select.insert(options);\r\n\r\n                    if (currentValue != '') {\r\n                        $('adding_description_template_id').value = currentValue;\r\n                    } else if (typeof id !== 'undefined' && M2ePro.formData[id] > 0) {\r\n                        select.value = M2ePro.formData[id];\r\n                    } else if (firstItem.is_new_asin_accepted != 0) {\r\n                        select.value = firstItem.id;\r\n                    }\r\n\r\n                    select.simulate('change');\r\n                }\r\n            });\r\n        },\r\n\r\n        addNewTemplate: function(url, callback)\r\n        {\r\n            var win = window.open(url);\r\n\r\n            var intervalId = setInterval(function() {\r\n\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                callback && callback();\r\n\r\n            }, 1000);\r\n        }\r\n    });\r\n\r\n    // ---------------------------------------\r\n});","Ess_M2ePro/js/Amazon/Listing/Settings.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.AmazonListingSettings = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        storeId: null,\r\n        marketplaceId: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveClick: function (url, skipValidation) {\r\n\r\n            if (typeof skipValidation == 'undefined' && !this.isValidForm()) {\r\n                return;\r\n            }\r\n\r\n            if (typeof categories_selected_items != 'undefined') {\r\n                array_unique(categories_selected_items);\r\n\r\n                var selectedCategories = implode(',', categories_selected_items);\r\n\r\n                $('selected_categories').value = selectedCategories;\r\n            }\r\n\r\n            if (typeof url == 'undefined' || url == '') {\r\n                url = M2ePro.url.formSubmit + 'back/' + base64_encode('list') + '/';\r\n            }\r\n\r\n            Common.prototype.saveClick.call(this, url);\r\n        },\r\n\r\n        saveAndEditClick: function (url, lastActiveTab, skipValidation) {\r\n            if (typeof skipValidation == 'undefined' && !this.isValidForm()) {\r\n                return;\r\n            }\r\n\r\n            if (typeof categories_selected_items != 'undefined' && !this.isValidForm()) {\r\n                array_unique(categories_selected_items);\r\n\r\n                var selectedCategories = implode(',', categories_selected_items);\r\n\r\n                $('selected_categories').value = selectedCategories;\r\n            }\r\n\r\n            if (lastActiveTab && url) {\r\n                var tabsUrl = '|tab=' + jQuery('#amazonListingEditTabs').data().tabs.active.find('a')[0].id.split('_').pop();\r\n                url = url + 'back/' + base64_encode('edit' + tabsUrl) + '/';\r\n            }\r\n\r\n            this.submitForm(url);\r\n        },\r\n\r\n        reloadSellingFormatTemplates: function () {\r\n            AmazonListingSettingsObj.reload(M2ePro.url.get('getSellingFormatTemplates'), 'template_selling_format_id');\r\n        },\r\n\r\n        reloadSynchronizationTemplates: function () {\r\n            AmazonListingSettingsObj.reload(M2ePro.url.get('getSynchronizationTemplates'), 'template_synchronization_id');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        selling_format_template_id_simulate_change: function () {\r\n            var intervalRestartLimit = 20;\r\n            var intervalRestartCount = 0;\r\n\r\n            var intervalId = setInterval(function simulateSellingFormatTemplateChange() {\r\n                intervalRestartCount++;\r\n\r\n                if (intervalRestartCount >= intervalRestartLimit || Ajax.activeRequestCount == 0) {\r\n                    $('template_selling_format_id').value && $('template_selling_format_id').simulate('change');\r\n\r\n                    clearInterval(intervalId);\r\n                }\r\n            }, 250);\r\n        },\r\n\r\n        selling_format_template_id_change: function () {\r\n            AmazonListingSettingsObj.checkMessages();\r\n            AmazonListingSettingsObj.hideEmptyOption(this);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        checkMessages: function () {\r\n            if (AmazonListingSettingsObj.storeId === null || AmazonListingSettingsObj.marketplaceId === null) {\r\n                return;\r\n            }\r\n\r\n            var id = $('template_selling_format_id').value,\r\n                nick = 'selling_format',\r\n                storeId = AmazonListingSettingsObj.storeId,\r\n                marketplaceId = AmazonListingSettingsObj.marketplaceId,\r\n                checkAttributesAvailability = false,\r\n                container = 'template_selling_format_messages',\r\n                callback = function () {\r\n                    var refresh = $(container).down('a.refresh-messages');\r\n                    if (refresh) {\r\n                        refresh.observe('click', function () {\r\n                            this.checkMessages();\r\n                        }.bind(this))\r\n                    }\r\n                }.bind(this);\r\n\r\n            TemplateHandlerObj.checkMessages(\r\n                id,\r\n                nick,\r\n                '',\r\n                storeId,\r\n                marketplaceId,\r\n                checkAttributesAvailability,\r\n                container,\r\n                callback\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        synchronization_template_id_change: function () {\r\n            AmazonListingSettingsObj.hideEmptyOption(this);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reload: function (url, id) {\r\n            new Ajax.Request(url, {\r\n                asynchronous: false,\r\n                onSuccess: function (transport) {\r\n\r\n                    var data = transport.responseText.evalJSON(true);\r\n\r\n                    var options = '';\r\n\r\n                    var firstItemValue = '';\r\n                    var currentValue = $(id).value;\r\n\r\n                    data.each(function (paris) {\r\n                        var key = (typeof paris.key != 'undefined') ? paris.key : paris.id;\r\n                        var val = (typeof paris.value != 'undefined') ? paris.value : paris.title;\r\n                        options += '<option value=\"' + key + '\">' + val + '</option>\\n';\r\n\r\n                        if (firstItemValue == '') {\r\n                            firstItemValue = key;\r\n                        }\r\n                    });\r\n\r\n                    $(id).update();\r\n                    $(id).insert(options);\r\n\r\n                    if (currentValue != '') {\r\n                        $(id).value = currentValue;\r\n                    } else {\r\n                        if (M2ePro.formData[id] > 0) {\r\n                            $(id).value = M2ePro.formData[id];\r\n                        } else {\r\n                            $(id).value = firstItemValue;\r\n                        }\r\n                    }\r\n                    $(id).simulate('change');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addNewTemplate: function (url, callback) {\r\n            var win = window.open(url);\r\n\r\n            var intervalId = setInterval(function () {\r\n\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                callback && callback();\r\n\r\n            }, 1000);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        newSellingFormatTemplateCallback: function () {\r\n            var noteEl = $('template_selling_format_note');\r\n\r\n            AmazonListingSettingsObj.reloadSellingFormatTemplates();\r\n            if ($('template_selling_format_id').children.length > 0) {\r\n                $('template_selling_format_id').show();\r\n                noteEl && $('template_selling_format_note').show();\r\n                $('template_selling_format_label').hide();\r\n            } else {\r\n                $('template_selling_format_id').hide();\r\n                noteEl && $('template_selling_format_note').hide();\r\n                $('template_selling_format_label').show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        newSynchronizationTemplateCallback: function () {\r\n            var noteEl = $('template_synchronization_note');\r\n\r\n            AmazonListingSettingsObj.reloadSynchronizationTemplates();\r\n            if ($('template_synchronization_id').children.length > 0) {\r\n                $('template_synchronization_id').show();\r\n                noteEl && $('template_synchronization_note').show();\r\n                $('template_synchronization_label').hide();\r\n            } else {\r\n                $('template_synchronization_id').hide();\r\n                noteEl && $('template_synchronization_note').hide();\r\n                $('template_synchronization_label').show();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Create/General.js":"define([\r\n    'underscore',\r\n    'Magento_Ui/js/modal/alert',\r\n    'M2ePro/Amazon/Listing/Create/General/MarketplaceSynchProgress',\r\n    'M2ePro/Plugin/ProgressBar',\r\n    'M2ePro/Plugin/AreaWrapper'\r\n], function (_, alert) {\r\n\r\n    window.AmazonListingCreateGeneral = Class.create();\r\n    AmazonListingCreateGeneral.prototype = {\r\n\r\n        marketplaceSynchProgressObj: null,\r\n        accounts: null,\r\n        selectedAccountId: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n            var self = this;\r\n\r\n            self.marketplaceSynchProgressObj = new AmazonListingCreateGeneralMarketplaceSynchProgress(\r\n                new ProgressBar('progress_bar'),\r\n                new AreaWrapper('content_container')\r\n            );\r\n\r\n            CommonObj.setValidationCheckRepetitionValue(\r\n                'M2ePro-listing-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Listing. Listing Title must be unique.'),\r\n                'Listing', 'title', 'id', null, M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK')\r\n            );\r\n\r\n            self.initAccount();\r\n            self.initMarketplace();\r\n        },\r\n\r\n        initAccount: function () {\r\n            var self = this;\r\n\r\n            $('account_id').observe('change', function() {\r\n                self.selectedAccountId = this.value;\r\n\r\n                if (this.value == '') {\r\n                    $('marketplace_info').hide();\r\n                    return;\r\n                }\r\n\r\n                var account = _.findWhere(self.accounts, {id: this.value});\r\n                if (!_.isUndefined(account)) {\r\n                    $('marketplace_info').show();\r\n                    $('marketplace_id').value = account.marketplace_id;\r\n                    $('marketplace_title').innerHTML = account.marketplace_title;\r\n                    $('marketplace_url').innerHTML = account.marketplace_url;\r\n                }\r\n            });\r\n\r\n            self.renderAccounts();\r\n\r\n            $('add_account_button').observe('click', function() {\r\n                var win = window.open(M2ePro.url.get('amazon_account/newAction'));\r\n\r\n                var intervalId = setInterval(function() {\r\n\r\n                    if (!win.closed) {\r\n                        return;\r\n                    }\r\n\r\n                    clearInterval(intervalId);\r\n\r\n                    self.renderAccounts();\r\n\r\n                }, 1000);\r\n            });\r\n        },\r\n\r\n        initMarketplace: function () {\r\n            var self = this;\r\n\r\n            $('save_and_next').observe('click', function() {\r\n                if (self.marketplaceSynchProgressObj.runningNow) {\r\n                    alert({\r\n                        content: M2ePro.translator.translate('Please wait while Synchronization is finished.')\r\n                    });\r\n                    return;\r\n                }\r\n                jQuery('#edit_form').valid() && self.synchronizeMarketplace($('marketplace_id').value);\r\n            });\r\n        },\r\n\r\n        renderAccounts: function (callback) {\r\n            var self = this;\r\n\r\n            var account_add_btn = $('add_account_button');\r\n            var account_label_el = $('account_label');\r\n            var account_select_el = $('account_id');\r\n            var marketplace_info = $('marketplace_info');\r\n\r\n            //firefox can't simulate events for disabled elements\r\n            if (account_select_el.disabled) {\r\n                account_select_el.enable();\r\n                self.accountDisabled = true;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/getAccounts'), {\r\n                method: 'get',\r\n                onSuccess: function(transport) {\r\n                    var accounts = transport.responseText.evalJSON();\r\n\r\n                    if (_.isNull(self.accounts)) {\r\n                        self.accounts = accounts;\r\n                    }\r\n\r\n                    if (_.isNull(self.selectedAccountId)) {\r\n                        self.selectedAccountId = account_select_el.value;\r\n                    }\r\n\r\n                    var isAccountsChanged = !self.isAccountsEqual(accounts);\r\n\r\n                    if (isAccountsChanged) {\r\n                        self.accounts = accounts;\r\n                    }\r\n\r\n                    if (accounts.length == 0) {\r\n                        account_add_btn.down('span').update(M2ePro.translator.translate('Add'));\r\n                        account_label_el.update(M2ePro.translator.translate('Account not found, please create it.'));\r\n                        account_label_el.show();\r\n                        account_select_el.hide();\r\n                        marketplace_info.hide();\r\n                        return;\r\n                    }\r\n\r\n                    marketplace_info.show();\r\n\r\n                    account_select_el.update();\r\n                    account_select_el.appendChild(new Element('option', {style: 'display: none'}));\r\n                    accounts.each(function(account) {\r\n                        account_select_el.appendChild(new Element('option', {value: account.id})).insert(account.title);\r\n                    });\r\n\r\n                    account_add_btn.down('span').update(M2ePro.translator.translate('Add Another'));\r\n\r\n                    if (accounts.length === 1) {\r\n                        var account = _.first(accounts);\r\n\r\n                        self.selectedAccountId = account.id;\r\n\r\n                        var accountElement;\r\n\r\n                        if (M2ePro.formData.wizard) {\r\n                            accountElement = new Element('span').update(account.title);\r\n                        } else {\r\n                            var accountLink = M2ePro.url.get('amazon_account/edit', {'id': account.id, close_on_save: 1});\r\n                            accountElement = new Element('a', {\r\n                                'href': accountLink,\r\n                                'target': '_blank'\r\n                            }).update(account.title);\r\n                        }\r\n\r\n                        account_label_el.update(accountElement);\r\n\r\n                        account_label_el.show();\r\n                        account_select_el.hide();\r\n                    } else if (isAccountsChanged) {\r\n                        self.selectedAccountId = _.last(accounts).id;\r\n\r\n                        account_label_el.hide();\r\n                        account_select_el.show();\r\n                    }\r\n\r\n                    account_select_el.setValue(self.selectedAccountId);\r\n\r\n                    account_select_el.simulate('change');\r\n\r\n                    //firefox can't simulate events for disabled elements\r\n                    if (self.accountDisabled) {\r\n                        account_select_el.disable();\r\n                    }\r\n\r\n                    callback && callback();\r\n                }\r\n            });\r\n        },\r\n\r\n        synchronizeMarketplace: function (marketplaceId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/isMarketplaceEnabled'), {\r\n                method: 'get',\r\n                parameters: { marketplace_id: marketplaceId },\r\n                onSuccess: function(transport) {\r\n\r\n                    var result = transport.responseText.evalJSON();\r\n                    if (result.status) {\r\n                        return self.marketplaceSynchProgressObj.end();\r\n                    }\r\n\r\n                    var title = 'Amazon ' + $('marketplace_title').innerHTML;\r\n\r\n                    $('save_and_next').disable();\r\n\r\n                    self.marketplaceSynchProgressObj.runTask(\r\n                        title,\r\n                        M2ePro.url.get('amazon_marketplace/runSynchNow', {marketplace_id: marketplaceId})\r\n                    );\r\n                }\r\n            });\r\n        },\r\n\r\n        isAccountsEqual: function (newAccounts) {\r\n            if (!newAccounts.length && !this.accounts.length) {\r\n                return true;\r\n            }\r\n\r\n            if (newAccounts.length !== this.accounts.length) {\r\n                return false;\r\n            }\r\n\r\n            return _.every(this.accounts, function (account) {\r\n                return _.where(newAccounts, account).length > 0;\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    };\r\n});","Ess_M2ePro/js/Amazon/Listing/Create/Search.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.AmazonListingCreateSearch = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        general_id_mode_change: function () {\r\n            var self = AmazonListingCreateSearchObj;\r\n\r\n            $('general_id_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GENERAL_ID_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('general_id_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        worldwide_id_mode_change: function () {\r\n            var self = AmazonListingCreateSearchObj;\r\n\r\n            $('worldwide_id_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::WORLDWIDE_ID_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('worldwide_id_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Create/Selling.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.AmazonListingCreateSelling = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n            jQuery.validator.addMethod('M2ePro-validate-condition-note-length', function(value) {\r\n                if ($('condition_note_mode').value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_NOTE_MODE_CUSTOM_VALUE')) {\r\n                    return true;\r\n                }\r\n\r\n                return value.length <= 2000;\r\n            }, M2ePro.translator.translate('condition_note_length_error'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-sku-modification-custom-value', function(value) {\r\n                if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_NONE')) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_TEMPLATE')) {\r\n                    return value.match(/%value%/g);\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('sku_modification_custom_value_error'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-sku-modification-custom-value-max-length', function(value) {\r\n                if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_NONE')) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_TEMPLATE')) {\r\n                    value = value.replace('%value%', '');\r\n                }\r\n\r\n                return value.length < M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing_Product_Action_Type_ListAction_Validator_Sku_General::SKU_MAX_LENGTH');\r\n            }, M2ePro.translator.translate('sku_modification_custom_value_max_length_error'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getAvailableConstantsForImages: function () {\r\n            return [\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_USED_LIKE_NEW'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_USED_VERY_GOOD'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_USED_GOOD'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_USED_ACCEPTABLE'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_COLLECTIBLE_LIKE_NEW'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_COLLECTIBLE_VERY_GOOD'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_COLLECTIBLE_GOOD'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_COLLECTIBLE_ACCEPTABLE'),\r\n            ];\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        sku_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('sku_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('sku_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        sku_modification_mode_change: function () {\r\n            if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_TEMPLATE')) {\r\n                $('sku_modification_custom_value').value = '%value%';\r\n            } else {\r\n                $('sku_modification_custom_value').value = '';\r\n            }\r\n\r\n            if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_NONE')) {\r\n                $('sku_modification_custom_value_tr').hide();\r\n            } else {\r\n                $('sku_modification_custom_value_tr').show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        condition_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj,\r\n                attributeCode = this.options[this.selectedIndex].getAttribute('attribute_code'),\r\n                condition_note_mode = $('condition_note_mode'),\r\n                conditionValue = $('condition_value'),\r\n                conditionCustomAttribute = $('condition_custom_attribute');\r\n\r\n            $('magento_block_amazon_listing_add_images-wrapper').hide();\r\n            $('condition_note_mode_tr').show();\r\n            $('condition_note_value_tr').show();\r\n\r\n            conditionValue.value = '';\r\n            conditionCustomAttribute.value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_MODE_DEFAULT')) {\r\n                self.updateHiddenValue(this, conditionValue);\r\n\r\n                if (attributeCode == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_NEW')) {\r\n                    $('condition_note_mode_tr').hide();\r\n                    $('condition_note_value_tr').hide();\r\n                } else {\r\n                    self.condition_note_mode_change();\r\n                }\r\n\r\n                if (self.getAvailableConstantsForImages().indexOf(attributeCode) == -1) {\r\n                    $('image_main_attribute').value = '';\r\n                    $('image_main_mode').selectedIndex = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::IMAGE_MAIN_MODE_NONE');\r\n                    $('image_main_mode').simulate('change');\r\n                } else {\r\n                    $('magento_block_amazon_listing_add_images-wrapper').show();\r\n                }\r\n            } else {\r\n                self.updateHiddenValue(this, conditionCustomAttribute);\r\n                $('condition_note_mode_tr').show();\r\n                self.condition_note_mode_change();\r\n\r\n                $('magento_block_amazon_listing_add_images-wrapper').show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        image_main_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('gallery_images_mode_tr').show();\r\n\r\n            $('image_main_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::IMAGE_MAIN_MODE_NONE')) {\r\n                $('gallery_images_mode_tr').hide();\r\n                $('gallery_images_limit').value = '';\r\n                $('gallery_images_attribute').value = '';\r\n                $('gallery_images_mode').selectedIndex = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GALLERY_IMAGES_MODE_NONE');\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::IMAGE_MAIN_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('image_main_attribute'));\r\n            }\r\n        },\r\n\r\n        gallery_images_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('gallery_images_limit').value = '';\r\n            $('gallery_images_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GALLERY_IMAGES_MODE_PRODUCT')) {\r\n                self.updateHiddenValue(this, $('gallery_images_limit'));\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GALLERY_IMAGES_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('gallery_images_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        gift_wrap_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('gift_wrap_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GIFT_WRAP_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('gift_wrap_attribute'));\r\n            }\r\n        },\r\n\r\n        gift_message_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('gift_message_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GIFT_MESSAGE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('gift_message_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        condition_note_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            if ($('condition_note_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_NOTE_MODE_CUSTOM_VALUE')) {\r\n                $('condition_note_value_tr').show();\r\n            } else {\r\n                $('condition_note_value_tr').hide();\r\n            }\r\n        },\r\n\r\n        handling_time_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('handling_time_custom_attribute').value = '';\r\n            $('handling_time_value').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::HANDLING_TIME_MODE_RECOMMENDED')) {\r\n                self.updateHiddenValue(this, $('handling_time_value'));\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::HANDLING_TIME_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('handling_time_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        restock_date_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('restock_date_value_tr').hide();\r\n\r\n            $('restock_date_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::RESTOCK_DATE_MODE_CUSTOM_VALUE')) {\r\n                $('restock_date_value_tr').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::RESTOCK_DATE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('restock_date_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        appendToText: function (ddId, targetId) {\r\n            if ($(ddId).value == '') {\r\n                return;\r\n            }\r\n\r\n            var attributePlaceholder = '#' + $(ddId).value + '#',\r\n                element = $(targetId);\r\n\r\n            if (document.selection) {\r\n                /* IE */\r\n                element.focus();\r\n                document.selection.createRange().text = attributePlaceholder;\r\n                element.focus();\r\n            } else if (element.selectionStart || element.selectionStart == '0') {\r\n                /* Webkit */\r\n                var startPos = element.selectionStart,\r\n                    endPos = element.selectionEnd,\r\n                    scrollTop = element.scrollTop,\r\n                    tempValue;\r\n\r\n                tempValue = element.value.substring(0, startPos);\r\n                tempValue += attributePlaceholder;\r\n                tempValue += element.value.substring(endPos, element.value.length);\r\n                element.value = tempValue;\r\n\r\n                element.focus();\r\n                element.selectionStart = startPos + attributePlaceholder.length;\r\n                element.selectionEnd = startPos + attributePlaceholder.length;\r\n                element.scrollTop = scrollTop;\r\n            } else {\r\n                element.value += attributePlaceholder;\r\n                element.focus();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Create/General/MarketplaceSynchProgress.js":"define([\r\n    'M2ePro/SynchProgress'\r\n], function () {\r\n    AmazonListingCreateGeneralMarketplaceSynchProgress = Class.create(SynchProgress, {\r\n\r\n        // ---------------------------------------\r\n\r\n        runningNow: false,\r\n\r\n        // ---------------------------------------\r\n\r\n        start: function ($super, title, status) {\r\n            $super(title, status);\r\n            this.runningNow = true;\r\n        },\r\n\r\n        end: function ($super) {\r\n            $super();\r\n            this.runningNow = false;\r\n            this.saveClick(M2ePro.url.get('amazon_listing_create/index'), true)\r\n        },\r\n\r\n        runTask: function (title, url, callBackWhenEnd) {\r\n            title = title || '';\r\n            url = url || '';\r\n            callBackWhenEnd = callBackWhenEnd || '';\r\n\r\n            if (url == '') {\r\n                return;\r\n            }\r\n\r\n            var self = this;\r\n            new Ajax.Request(M2ePro.url.get('general/synchCheckState'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == self.stateExecuting) {\r\n\r\n                        self.start(\r\n                            M2ePro.translator.translate('Another Synchronization Is Already Running.'),\r\n                            M2ePro.translator.translate('Getting information. Please wait ...')\r\n                        );\r\n\r\n                        setTimeout(function () {\r\n                            self.startGetExecutingInfo('self.runTask(\\'' + title + '\\',\\'' + url + '\\',\"' + callBackWhenEnd + '\");');\r\n                        }, 2000);\r\n\r\n                    } else {\r\n\r\n                        self.start(title, M2ePro.translator.translate('Preparing to start. Please wait ...'));\r\n\r\n                        new Ajax.Request(url, {\r\n                            method: 'get', asynchronous: true\r\n                        });\r\n\r\n                        setTimeout(function () {\r\n                            self.startGetExecutingInfo(callBackWhenEnd);\r\n                        }, 2000);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        startGetExecutingInfo: function (callBackWhenEnd) {\r\n            callBackWhenEnd = callBackWhenEnd || '';\r\n\r\n            var self = this;\r\n            new Ajax.Request(M2ePro.url.get('general/synchGetExecutingInfo'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                onSuccess: function (transport) {\r\n\r\n                    var data = transport.responseText.evalJSON(true);\r\n\r\n                    if (data.mode == self.stateExecuting) {\r\n\r\n                        self.progressBarObj.setTitle(data.title);\r\n                        if (data.percents <= 0) {\r\n                            self.progressBarObj.setPercents(0, 0);\r\n                        } else if (data.percents >= 100) {\r\n                            self.progressBarObj.setPercents(100, 0);\r\n                        } else {\r\n                            self.progressBarObj.setPercents(data.percents, 1);\r\n                        }\r\n                        self.progressBarObj.setStatus(data.status);\r\n\r\n                        self.wrapperObj.lock();\r\n                        $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n\r\n                        setTimeout(function () {\r\n                            self.startGetExecutingInfo(callBackWhenEnd);\r\n                        }, 3000);\r\n\r\n                    } else {\r\n\r\n                        self.progressBarObj.setPercents(100, 0);\r\n\r\n                        // ---------------------------------------\r\n                        setTimeout(function () {\r\n\r\n                            if (callBackWhenEnd != '') {\r\n                                eval(callBackWhenEnd);\r\n                            } else {\r\n                                self.end();\r\n                            }\r\n\r\n                        }, 1500);\r\n                        // ---------------------------------------\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Other/Grid.js":"define([\r\n    'M2ePro/Listing/Other/Grid'\r\n], function () {\r\n    window.AmazonListingOtherGrid = Class.create(ListingOtherGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function(rowId)\r\n        {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Other\\\\AbstractGrid::LISTING_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('amazon_log_listing_other/index', params);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Add.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.AmazonListingProductAdd = Class.create();\r\n    AmazonListingProductAdd.prototype = Object.extend(new Common(), {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (ProgressBarObj, WrapperObj) {\r\n            this.categories = '';\r\n            this.products = '';\r\n            this.listing_id = null;\r\n            this.is_list = null;\r\n            this.back = '';\r\n            this.emptyListing = 0;\r\n\r\n            this.categoriesAddAction = null;\r\n            this.categoriesDeleteAction = null;\r\n\r\n            this.progressBarObj = ProgressBarObj;\r\n            this.wrapperObj = WrapperObj;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        add: function (items, back, isList) {\r\n            var self = this;\r\n            self.is_list = isList;\r\n            self.back = back;\r\n\r\n            self.getListingId(items);\r\n\r\n            if (self.emptyListing == 1) {\r\n                return;\r\n            }\r\n\r\n            self.products = items;\r\n\r\n            var parts = self.makeProductsParts();\r\n\r\n            self.progressBarObj.reset();\r\n            self.progressBarObj.setTitle('Adding Products to Listing');\r\n            self.progressBarObj.setStatus('Adding in process. Please wait...');\r\n            self.progressBarObj.show();\r\n            self.scrollPageToTop();\r\n\r\n            self.wrapperObj.lock();\r\n\r\n            self.sendPartsProducts(parts, parts.length);\r\n        },\r\n\r\n        setCategoriesActions: function (addAction, deleteAction) {\r\n            this.categoriesAddAction = addAction;\r\n            this.categoriesDeleteAction = deleteAction;\r\n        },\r\n\r\n        getListingId: function (items) {\r\n            var self = this;\r\n\r\n            if (self.listing_id) {\r\n                return;\r\n            }\r\n\r\n            var hrefParts = explode('/', window.location.href);\r\n\r\n            for (var i = 0; i < hrefParts.length; i++) {\r\n                if (hrefParts[i] == 'id') {\r\n                    self.listing_id = hrefParts[i + 1];\r\n                    break;\r\n                }\r\n            }\r\n        },\r\n\r\n        makeProductsParts: function () {\r\n            var self = this;\r\n\r\n            var productsInPart = 50;\r\n            var productsArray = explode(',', self.products);\r\n            var parts = new Array();\r\n\r\n            if (productsArray.length < productsInPart) {\r\n                return parts[0] = productsArray;\r\n            }\r\n\r\n            var result = new Array();\r\n            for (var i = 0; i < productsArray.length; i++) {\r\n                if (result.length == 0 || result[result.length - 1].length == productsInPart) {\r\n                    result[result.length] = new Array();\r\n                }\r\n                result[result.length - 1][result[result.length - 1].length] = productsArray[i];\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        sendPartsProducts: function (parts, partsCount) {\r\n            var self = this;\r\n\r\n            if (parts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            var part = parts.splice(0, 1);\r\n            part = part[0];\r\n            var partString = implode(',', part);\r\n\r\n            var isLastPart = '';\r\n            if (parts.length <= 0) {\r\n                isLastPart = 'yes';\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('add_products'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    listing_id: self.listing_id,\r\n                    is_last_part: isLastPart,\r\n                    do_list: self.is_list,\r\n                    back: self.back,\r\n                    products: partString\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var percents = (100 / partsCount) * (partsCount - parts.length);\r\n\r\n                    if (percents <= 0) {\r\n                        self.progressBarObj.setPercents(0, 0);\r\n                    } else if (percents >= 100) {\r\n                        self.progressBarObj.setPercents(100, 0);\r\n                        self.progressBarObj.setStatus('Adding has been completed.');\r\n\r\n                        return setLocation(transport.responseText.evalJSON()['redirect']);\r\n                    } else {\r\n                        self.progressBarObj.setPercents(percents, 1);\r\n                    }\r\n\r\n                    setTimeout(function () {\r\n                        self.sendPartsProducts(parts, partsCount);\r\n                    }, 500);\r\n                }\r\n            });\r\n\r\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setHideProductsPresentedInOtherListings: function (hideProductsOthersListings) {\r\n            this.hideProductsOthersListings = hideProductsOthersListings;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Repricing.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'Magento_Ui/js/modal/alert',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Action'\r\n], function (MessageObj, alert) {\r\n\r\n    window.AmazonListingProductRepricing = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            $super(gridHandler);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openManagement: function () {\r\n            window.open(M2ePro.url.get('amazon_listing_product_repricing/openManagement'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addToRepricing: function (productsIds) {\r\n            var self = this;\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_repricing/validateProductsBeforeAdd'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function(transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert({\r\n                            content: transport.responseText\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if(response.products_ids.length === 0) {\r\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n                        return;\r\n                    }\r\n\r\n                    if (response.products_ids.length === productsIds.split(',').length) {\r\n                        self.addToRepricingConfirm(productsIds);\r\n                        return;\r\n                    }\r\n\r\n                    var popupEl = $('regular_price_popup');\r\n\r\n                    if (popupEl) {\r\n                        popupEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: response});\r\n\r\n                    self.regularPricePopup = jQuery('#regular_price_popup');\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            click: function () {\r\n                                self.regularPricePopup.modal('closeModal');\r\n                            }\r\n                        }, {\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action primary',\r\n                            click: function () {\r\n                                self.addToRepricingConfirm(productsIds);\r\n                            }\r\n                        }]\r\n                    }, self.regularPricePopup);\r\n\r\n                    self.regularPricePopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        addToRepricingConfirm: function (productsIds) {\r\n            return this.postForm(M2ePro.url.get('amazon_listing_product_repricing/openAddProducts'), {'products_ids': productsIds});\r\n        },\r\n\r\n        showDetails: function (productsIds) {\r\n            return this.postForm(M2ePro.url.get('amazon_listing_product_repricing/openShowDetails'), {'products_ids': productsIds});\r\n        },\r\n\r\n        editRepricing: function (productsIds) {\r\n            return this.postForm(M2ePro.url.get('amazon_listing_product_repricing/openEditProducts'), {'products_ids': productsIds});\r\n        },\r\n\r\n        removeFromRepricing: function (productsIds) {\r\n            return this.postForm(M2ePro.url.get('amazon_listing_product_repricing/openRemoveProducts'), {'products_ids': productsIds});\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Search.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductSearch = Class.create(Action, {\r\n\r\n        MATCHING_TYPE_EQUAL: 1,\r\n        MATCHING_TYPE_VIRTUAL_AMAZON: 2,\r\n        MATCHING_TYPE_VIRTUAL_MAGENTO: 3,\r\n\r\n        searchData: {},\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n            self.searchBlock = $('productSearch_pop_up_content').outerHTML;\r\n            $('productSearch_pop_up_content').remove();\r\n        },\r\n\r\n        initSearchEvents: function () {\r\n            var self = this;\r\n\r\n            $('productSearch_submit_button').observe('click', function (event) {\r\n                self.searchGeneralIdManual(self.params.productId);\r\n            });\r\n\r\n            $('productSearch_reset_button').observe('click', function (event) {\r\n                $('query').value = '';\r\n                $('productSearch_grid').innerHTML = '';\r\n            });\r\n\r\n            $('query').observe('keypress', function (event) {\r\n                event.keyCode == Event.KEY_RETURN && self.searchGeneralIdManual(self.params.productId);\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            this.initValidators();\r\n            return this;\r\n        },\r\n\r\n        initValidators: function () {\r\n            var self = this;\r\n\r\n            jQuery.validator.addMethod('M2ePro-amazon-attribute-unique-value', function (value, el) {\r\n\r\n                var existedValues = [],\r\n                    isValid = true,\r\n                    form = el.parent('form');\r\n\r\n                form.select('select').each(function (index, el) {\r\n                    if (el.value != '') {\r\n                        if (existedValues.indexOf(el.value) === -1) {\r\n                            existedValues.push(el.value);\r\n                        } else {\r\n                            isValid = false;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                return isValid;\r\n\r\n            }, M2ePro.translator.translate('variation_manage_matched_attributes_error_duplicate'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        params: {autoMapErrorFlag: false},\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (mode, title, productId) {\r\n            MessageObj.clear();\r\n\r\n            var self = this;\r\n\r\n            this.gridHandler.unselectAll();\r\n\r\n            this.params = {\r\n                mode: mode,\r\n                title: title,\r\n                productId: productId,\r\n                autoMapErrorFlag: false\r\n            };\r\n\r\n            if (mode == 0) {\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/getSearchAsinMenu'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        product_id: productId\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        var containerEl = $('productSearchMenu_pop_up_content');\r\n\r\n                        if (containerEl) {\r\n                            containerEl.remove();\r\n                        }\r\n\r\n                        $('html-body').insert({bottom: transport.responseText});\r\n\r\n                        self.searchMenuPopup = jQuery('#productSearchMenu_pop_up_content');\r\n\r\n                        modal({\r\n                            title: title,\r\n                            modalClass: 'width-50',\r\n                            type: 'popup',\r\n                            buttons: [{\r\n                                text: M2ePro.translator.translate('Close'),\r\n                                class: 'action primary ',\r\n                                click: function () {\r\n                                    self.searchMenuPopup.modal('closeModal')\r\n                                }\r\n                            }]\r\n                        }, self.searchMenuPopup);\r\n\r\n                        self.searchMenuPopup.modal('openModal');\r\n                    }\r\n                });\r\n            } else {\r\n                if ($('productSearch_pop_up_content')) {\r\n                    $('productSearch_pop_up_content').remove();\r\n                }\r\n\r\n                $('html-body').insert({bottom: self.searchBlock});\r\n\r\n                self.popup = jQuery('#productSearch_pop_up_content');\r\n\r\n                modal({\r\n                    title: title,\r\n                    type: 'slide',\r\n                    buttons: [{\r\n                        text: M2ePro.translator.translate('Cancel'),\r\n                        class: 'action default',\r\n                        click: function () {\r\n                            self.popup.modal('closeModal');\r\n                        }\r\n                    }, {\r\n                        text: M2ePro.translator.translate('Clear Search Results'),\r\n                        class: 'action primary',\r\n                        click: function () {\r\n                            ListingGridHandlerObj.productSearchHandler.clearSearchResultsAndOpenSearchMenu();\r\n                        }\r\n                    }]\r\n                }, this.popup);\r\n\r\n                self.popup.modal('openModal');\r\n\r\n                $('productSearch_pop_up_content').show();\r\n                $('productSearch_form').hide();\r\n                $('suggested_asin_grid_help_block').show();\r\n\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/suggestedAsinGrid'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        product_id: productId\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        $('productSearch_grid').update(transport.responseText);\r\n                    }\r\n                });\r\n            }\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearSearchResultsAndOpenSearchMenu: function () {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.popup.modal('closeModal');\r\n                        self.unmapFromGeneralId(self.params.productId, function () {\r\n                            self.openPopUp(0, self.params.title, self.params.productId);\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearSearchResultsAndManualSearch: function () {\r\n            var self = this;\r\n\r\n            self.popup.modal('closeModal');\r\n            self.unmapFromGeneralId(self.params.productId, function () {\r\n                self.showSearchManualPrompt(self.params.title, self.params.productId);\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showSearchManualPrompt: function (title, listingProductId) {\r\n            var self = this,\r\n                title = title || self.params.title;\r\n\r\n            if (self.searchMenuPopup) {\r\n                self.searchMenuPopup.modal('closeModal');\r\n            }\r\n\r\n            if ($('productSearch_pop_up_content')) {\r\n                $('productSearch_pop_up_content').remove();\r\n            }\r\n\r\n            $('html-body').insert({bottom: self.searchBlock});\r\n\r\n            self.popup = jQuery('#productSearch_pop_up_content');\r\n\r\n            var buttons = [];\r\n            if (!listingProductId) {\r\n                buttons.push({\r\n                    text: M2ePro.translator.translate('Back'),\r\n                    class: 'back',\r\n                    click: function() {\r\n                        self.popup.modal('closeModal');\r\n                        self.openPopUp(0, self.params.title, self.params.productId);\r\n                    }\r\n                });\r\n            }\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                buttons: buttons\r\n            }, self.popup);\r\n\r\n            self.popup.modal('openModal');\r\n\r\n            if (listingProductId) {\r\n                self.params = {\r\n                    mode: 0,\r\n                    title: title,\r\n                    productId: listingProductId,\r\n                    autoMapErrorFlag: false\r\n                };\r\n            }\r\n\r\n            self.initSearchEvents();\r\n            // search manual\r\n            $('productSearch_form').show();\r\n            $('productSearch_error_block').hide();\r\n            $('suggested_asin_grid_help_block').hide();\r\n            $('query').value = '';\r\n\r\n            setTimeout(function () {\r\n                $('query').focus();\r\n            }, 500);\r\n        },\r\n\r\n        showSearchGeneralIdAutoPrompt: function () {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        if (self.searchMenuPopup) {\r\n                            self.searchMenuPopup.modal('closeModal');\r\n                        }\r\n                        self.searchGeneralIdAuto(self.params.productId);\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        showUnmapFromGeneralIdPrompt: function (productId) {\r\n            MessageObj.clear();\r\n\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.unmapFromGeneralId(productId);\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        addNewGeneralId: function (listingProductIds) {\r\n            var self = this;\r\n\r\n            if (!M2ePro.customData.isNewAsinAvailable) {\r\n                self.alert(M2ePro.translator.translate('new_asin_not_available').replace('%code%', M2ePro.customData.marketplace.code));\r\n                return;\r\n            }\r\n\r\n            listingProductIds = listingProductIds || self.params.productId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/mapToNewAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: listingProductIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (typeof self.searchMenuPopup != 'undefined') {\r\n                        self.searchMenuPopup.modal('closeModal')\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n                    self.flagSuccess = true;\r\n\r\n                    if (response.products_ids.length > 0) {\r\n                        ListingGridHandlerObj.templateDescriptionHandler.openPopUp(\r\n                            0, M2ePro.translator.translate('templateDescriptionPopupTitle'),\r\n                            response.products_ids, response.html, 1);\r\n                    } else {\r\n                        if (response.messages.length > 0) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        searchGeneralIdManual: function (productId) {\r\n            var self = this;\r\n            var query = $('query').value;\r\n\r\n            MessageObj.clear();\r\n\r\n            if (query == '') {\r\n                $('query').focus();\r\n                self.alert(M2ePro.translator.translate('enter_productSearch_query'));\r\n                return;\r\n            }\r\n\r\n            $('productSearch_error_block').hide();\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/searchAsinManual'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    query: query,\r\n                    product_id: productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    transport = transport.responseText.evalJSON();\r\n\r\n                    if (transport.result == 'success') {\r\n                        $('productSearch_grid').update(transport.html);\r\n                    } else {\r\n                        $('productSearch_error_message').update(transport.text);\r\n                        $('productSearch_error_block').show();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        searchGeneralIdAuto: function (productIds) {\r\n            MessageObj.clear();\r\n            var self = this;\r\n\r\n            var selectedProductsString = productIds.toString();\r\n            var selectedProductsArray = selectedProductsString.split(\",\");\r\n\r\n            if (selectedProductsString == '' || selectedProductsArray.length == 0) {\r\n                return;\r\n            }\r\n\r\n            var maxProductsInPart = 10;\r\n\r\n            var result = new Array();\r\n            for (var i = 0; i < selectedProductsArray.length; i++) {\r\n                if (result.length == 0 || result[result.length - 1].length == maxProductsInPart) {\r\n                    result[result.length] = new Array();\r\n                }\r\n                result[result.length - 1][result[result.length - 1].length] = selectedProductsArray[i];\r\n            }\r\n\r\n            var selectedProductsParts = result;\r\n\r\n            ListingGridHandlerObj.actionHandler.progressBarObj.reset();\r\n            ListingGridHandlerObj.actionHandler.progressBarObj.show(M2ePro.translator.translate('automap_asin_progress_title'));\r\n            ListingGridHandlerObj.actionHandler.gridWrapperObj.lock();\r\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n\r\n            self.params.autoMapErrorFlag = false;\r\n\r\n            self.sendPartsOfProducts(selectedProductsParts, selectedProductsParts.length, selectedProductsString);\r\n        },\r\n\r\n        sendPartsOfProducts: function (parts, totalPartsCount, selectedProductsString) {\r\n            var self = this;\r\n\r\n            if (parts.length == 0) {\r\n\r\n                ListingGridHandlerObj.actionHandler.progressBarObj.setStatus(M2ePro.translator.translate('task_completed_message'));\r\n\r\n                ListingGridHandlerObj.actionHandler.gridWrapperObj.unlock();\r\n                $$('.loading-mask').invoke('setStyle', {visibility: 'visible'});\r\n\r\n                self.gridHandler.unselectAllAndReload();\r\n\r\n                if (self.params.autoMapErrorFlag == true) {\r\n                    MessageObj.addErrorMessage(M2ePro.translator.translate('automap_error_message'));\r\n                }\r\n\r\n                setTimeout(function () {\r\n                    ListingGridHandlerObj.actionHandler.progressBarObj.hide();\r\n                    ListingGridHandlerObj.actionHandler.progressBarObj.reset();\r\n                }, 2000);\r\n\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/getProductsSearchStatus'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        products_ids: selectedProductsString\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        if (!transport.responseText.isJSON()) {\r\n                            self.alert(transport.responseText);\r\n                            return;\r\n                        }\r\n\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        if (response.messages) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n\r\n                return;\r\n            }\r\n\r\n            var part = parts.splice(0, 1);\r\n            part = part[0];\r\n            var partString = implode(',', part);\r\n\r\n            var partExecuteString = part.length;\r\n            partExecuteString += '';\r\n\r\n            ListingGridHandlerObj.actionHandler.progressBarObj.setStatus(str_replace('%product_title%', partExecuteString, M2ePro.translator.translate('automap_asin_search_products')));\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/searchAsinAuto'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: partString\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == 1) {\r\n                        self.params.autoMapErrorFlag = true;\r\n                    }\r\n\r\n                    var percents = (100 / totalPartsCount) * (totalPartsCount - parts.length);\r\n\r\n                    if (percents <= 0) {\r\n                        ListingGridHandlerObj.actionHandler.progressBarObj.setPercents(0, 0);\r\n                    } else if (percents >= 100) {\r\n                        ListingGridHandlerObj.actionHandler.progressBarObj.setPercents(100, 0);\r\n                    } else {\r\n                        ListingGridHandlerObj.actionHandler.progressBarObj.setPercents(percents, 1);\r\n                    }\r\n\r\n                    setTimeout(function () {\r\n                        self.sendPartsOfProducts(parts, totalPartsCount, selectedProductsString);\r\n                    }, 500);\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mapToGeneralId: function (productId, generalId, optionsData) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        if (optionsData === undefined) {\r\n                            optionsData = '';\r\n                        }\r\n\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing/mapToAsin'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                product_id: productId,\r\n                                general_id: generalId,\r\n                                options_data: decodeURIComponent(optionsData),\r\n                                search_type: $('amazon_asin_search_type').value,\r\n                                search_value: $('amazon_asin_search_value').value\r\n                            },\r\n                            onSuccess: function (transport) {\r\n                                if (transport.responseText.isJSON()) {\r\n                                    var response = transport.responseText.evalJSON();\r\n\r\n                                    if (response['vocabulary_attributes']) {\r\n                                        self.openVocabularyAttributesPopUp(response['vocabulary_attributes']);\r\n                                    }\r\n\r\n                                    if (response['vocabulary_attribute_options']) {\r\n                                        self.openVocabularyOptionsPopUp(response['vocabulary_attribute_options']);\r\n                                    }\r\n\r\n                                    self.gridHandler.unselectAllAndReload();\r\n                                    return;\r\n                                }\r\n\r\n                                if (transport.responseText == 0) {\r\n                                    self.gridHandler.unselectAllAndReload();\r\n                                } else {\r\n                                    self.alert(transport.responseText);\r\n                                }\r\n                            }\r\n                        });\r\n\r\n                        self.popup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        openVocabularyAttributesPopUp: function (attributes) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/getAttributesPopup'), {\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('vocabulary_attributes_pupup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.vocabularyAttributesPupup = jQuery('#vocabulary_attributes_pupup');\r\n\r\n                    modal({\r\n                        title: 'Remember Attributes Accordance',\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.addAttributesToVocabulary(false);\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.addAttributesToVocabulary(true);\r\n                            }\r\n                        }]\r\n                    }, self.vocabularyAttributesPupup);\r\n\r\n                    self.vocabularyAttributesPupup.modal('openModal');\r\n\r\n                    $('vocabulary_attributes_data').value = Object.toJSON(attributes);\r\n\r\n                    var attributesHtml = '';\r\n                    $H(attributes).each(function (element) {\r\n                        attributesHtml += '<li>' + element.key + ' > ' + element.value + '</li>';\r\n                    });\r\n\r\n                    attributesHtml = '<ul style=\"list-style-position: inside;\">' + attributesHtml + '</ul>';\r\n\r\n                    var bodyHtml = str_replace('%attributes%', attributesHtml, $('vocabulary_attributes_pupup').innerHTML);\r\n\r\n                    $('vocabulary_attributes_pupup').update(bodyHtml);\r\n                }\r\n            });\r\n        },\r\n\r\n        addAttributesToVocabulary: function (needAdd) {\r\n            var self = this;\r\n\r\n            var isRemember = $('vocabulary_attributes_remember_checkbox').checked;\r\n\r\n            if (!needAdd && !isRemember) {\r\n                self.vocabularyAttributesPupup.modal('closeModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/addAttributes'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    attributes: $('vocabulary_attributes_data').value,\r\n                    need_add: needAdd ? 1 : 0,\r\n                    is_remember: isRemember ? 1 : 0\r\n                },\r\n                onSuccess: function (transport) {\r\n                    self.vocabularyAttributesPupup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        openVocabularyOptionsPopUp: function (options) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/getOptionsPopup'), {\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('vocabulary_options_pupup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.vocabularyOptionsPopup = jQuery('#vocabulary_options_pupup');\r\n\r\n                    modal({\r\n                        title: 'Vocabulary',\r\n                        type: 'popup',\r\n                        closed: function() {\r\n                            self.reloadVariationsGrid();\r\n                        },\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.addOptionsToVocabulary(false);\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.addOptionsToVocabulary(true);\r\n                            }\r\n                        }]\r\n                    }, self.vocabularyOptionsPopup);\r\n\r\n                    self.vocabularyOptionsPopup.modal('openModal');\r\n\r\n                    $('vocabulary_options_data').value = Object.toJSON(options);\r\n\r\n                    var optionsHtml = '';\r\n                    $H(options).each(function (element) {\r\n\r\n                        var valuesHtml = '';\r\n                        $H(element.value).each(function (value) {\r\n                            valuesHtml += value.key + ' > ' + value.value;\r\n                        });\r\n\r\n                        optionsHtml += '<li>' + element.key + ': ' + valuesHtml + '</li>';\r\n                    });\r\n\r\n                    optionsHtml = '<ul style=\"list-style-position: inside\">' + optionsHtml + '</ul>';\r\n\r\n                    var bodyHtml = str_replace('%options%', optionsHtml, $('vocabulary_options_pupup').innerHTML);\r\n\r\n                    $('vocabulary_options_pupup').update(bodyHtml);\r\n                }\r\n            });\r\n        },\r\n\r\n        addOptionsToVocabulary: function (needAdd) {\r\n            var self = this;\r\n\r\n            var isRemember = $('vocabulary_options_remember_checkbox').checked;\r\n\r\n            if (!needAdd && !isRemember) {\r\n                self.vocabularyOptionsPopup.modal('closeModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/addOptions'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    options_data: $('vocabulary_options_data').value,\r\n                    need_add: needAdd ? 1 : 0,\r\n                    is_remember: isRemember ? 1 : 0\r\n                },\r\n                onSuccess: function (transport) {\r\n                    self.vocabularyOptionsPopup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        unmapFromGeneralId: function (productIds, afterDoneFunction) {\r\n            var self = this;\r\n\r\n            this.gridHandler.unselectAll();\r\n\r\n            self.flagSuccess = false;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/unmapFromAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n                    self.flagSuccess = true;\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n                },\r\n                onComplete: function () {\r\n                    if (self.flagSuccess == true && afterDoneFunction != undefined) {\r\n                        afterDoneFunction();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        specificsChange: function (select) {\r\n            var self = this;\r\n\r\n            var idParts = explode('_', select.id);\r\n            var id = idParts[2];\r\n            var specifics = [];\r\n            var selectedAsin = '';\r\n\r\n            $(select.id) && self.hideEmptyOption($(select.id));\r\n\r\n            self.validateSpecifics(id);\r\n\r\n            var asins = JSON.parse(decodeHtmlentities($('asins_' + id).innerHTML));\r\n\r\n            $('parent_asin_text_' + id).hide();\r\n            $('map_link_error_icon_' + id).hide();\r\n\r\n            $$('.specifics_' + id).each(function (el) {\r\n                var specificName = explode('_', el.id);\r\n                specificName = specificName[1];\r\n\r\n                specifics[specificName] = el.value;\r\n            });\r\n\r\n            for (var spec in asins) {\r\n                var productSpecifics = asins[spec].specifics;\r\n\r\n                var found = true;\r\n                for (var sName in productSpecifics) {\r\n\r\n                    if (productSpecifics[sName] != specifics[sName]) {\r\n                        found = false;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (found) {\r\n                    selectedAsin = spec;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            var asinLink = $('asin_link_' + id);\r\n\r\n            if (selectedAsin === '') {\r\n                $('map_link_error_icon_' + id).show();\r\n                asinLink.innerHTML = $('parent_asin_' + id).innerHTML;\r\n                asinLink.href = asinLink.href.slice(0, asinLink.href.lastIndexOf(\"/\")) + '/' + $('parent_asin_' + id).innerHTML;\r\n                $('parent_asin_text_' + id).show();\r\n                return $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n            }\r\n\r\n            asinLink.innerHTML = selectedAsin;\r\n            asinLink.href = asinLink.href.slice(0, asinLink.href.lastIndexOf(\"/\")) + '/' + selectedAsin;\r\n\r\n            var mapLinkTemplate = $('template_map_link_' + id).innerHTML;\r\n            mapLinkTemplate = mapLinkTemplate.replace('%general_id%', selectedAsin);\r\n\r\n            asins = addslashes(encodeURIComponent(JSON.stringify(asins)));\r\n\r\n            mapLinkTemplate = mapLinkTemplate.replace('%options_data%', asins);\r\n            $('map_link_' + id).innerHTML = mapLinkTemplate;\r\n        },\r\n\r\n        validateSpecifics: function (id, variations, i) {\r\n            var variation = $H(variations || decodeHtmlentities($('channel_variations_tree_' + id).innerHTML).evalJSON()),\r\n                attributes = $$('.specifics_name_' + id),\r\n                options = $$('.specifics_' + id),\r\n                index = i || 0;\r\n\r\n            if (index === 0) {\r\n                options.each(function (el) {\r\n                    el.disable();\r\n                });\r\n            }\r\n\r\n            if (!attributes[index] || !options[index]) {\r\n                return;\r\n            }\r\n\r\n            var attr = variation.keys()[0];\r\n\r\n            var oldValue = decodeHtmlentities(options[index].value);\r\n            options[index].update();\r\n            options[index].enable();\r\n            options[index].appendChild(new Element('option', {style: 'display: none'}));\r\n\r\n            $H(variation.get(attr)).each(function (option) {\r\n                options[index].appendChild(new Element('option', {value: option[0]})).insert(option[0]);\r\n\r\n                if (option[0] == oldValue) {\r\n                    options[index].value = oldValue;\r\n                }\r\n            });\r\n\r\n            if (oldValue) {\r\n                index++;\r\n                this.validateSpecifics(id, variation.get(attr)[oldValue], index);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        attributesChange: function (select) {\r\n            var self = this;\r\n\r\n            var idParts = explode('_', select.id);\r\n            var id = idParts[4];\r\n            var optionsData = {\r\n                matched_attributes: {},\r\n                variations: null\r\n            };\r\n\r\n            $(select.id) && self.hideEmptyOption($(select.id));\r\n\r\n            $('map_link_error_icon_' + id).hide();\r\n\r\n            var existedValues = [];\r\n            $$('.amazon_product_attribute_' + id).each(function (el) {\r\n                var attributeNumber = explode('_', el.id);\r\n                attributeNumber = attributeNumber[3];\r\n\r\n                if (el.value != '' && existedValues.indexOf(el.value) === -1) {\r\n                    var magentoAttribute = $('magento_product_attribute_' + attributeNumber + '_' + id);\r\n                    optionsData.matched_attributes[magentoAttribute.value] = el.value;\r\n                    existedValues.push(el.value);\r\n                } else {\r\n                    optionsData = '';\r\n                    throw $break;\r\n                }\r\n            });\r\n\r\n            if (optionsData === '') {\r\n                $('map_link_error_icon_' + id).show();\r\n                return $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n            }\r\n\r\n            optionsData.variations = JSON.parse(decodeHtmlentities($('variations_' + id).innerHTML));\r\n            optionsData = addslashes(encodeURIComponent(JSON.stringify(optionsData)));\r\n\r\n            var mapLinkTemplate = $('template_map_link_' + id).innerHTML;\r\n            mapLinkTemplate = mapLinkTemplate.replace('%options_data%', optionsData);\r\n            $('map_link_' + id).innerHTML = mapLinkTemplate;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showAsinCategories: function (link, rowId, asin, productId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/getCategoriesByAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    asin: asin,\r\n                    product_id: productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    link.hide();\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    var categoriesRow = $('asin_categories_' + rowId);\r\n\r\n                    if (response.data == '') {\r\n                        $('asin_categories_not_found_' + rowId).show();\r\n                    } else {\r\n                        var i = 3;\r\n                        response.data.each(function (item) {\r\n                            var str = item.title;\r\n                            if (item.path) {\r\n                                str = item.path + ' > ' + str;\r\n                            }\r\n\r\n                            str = str + ' (' + item.id + ')';\r\n\r\n                            var row = new Element('p');\r\n                            row.setStyle({\r\n                                'color': 'grey'\r\n                            });\r\n\r\n                            categoriesRow.appendChild(row).insert(str);\r\n\r\n                            i--;\r\n                            if (i <= 0) {\r\n                                throw $break;\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesVirtualView: function (id) {\r\n            if (this.searchData[id].matchingType === this.MATCHING_TYPE_VIRTUAL_AMAZON) {\r\n                this.renderMatchedAttributesVirtualAmazonView(id);\r\n            }\r\n\r\n            if (this.searchData[id].matchingType === this.MATCHING_TYPE_VIRTUAL_MAGENTO) {\r\n                this.renderMatchedAttributesVirtualMagentoView(id);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesVirtualAmazonView: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id),\r\n                tHeader = form.down('.matching-attributes-table-header'),\r\n                searchData = self.searchData[id];\r\n\r\n            form.select('.matching-attributes-table-attribute-row').each(function (el) {\r\n                el.remove();\r\n            });\r\n            searchData.selectedDestinationAttributes = [];\r\n\r\n            var prematchedAttributes = [];\r\n            var i = 0;\r\n            $H(searchData.matchedAttributes).each(function (attribute) {\r\n\r\n                var tr = new Element('div', {\r\n                        style: 'display: table-row',\r\n                        class: 'matching-attributes-table-attribute-row'\r\n                    }),\r\n                    tdLabel = new Element('div', {\r\n                        class: 'label',\r\n                        style: 'display: table-cell; padding-bottom: 5px;'\r\n                    }),\r\n                    spanMagentoAttr = new Element('span', {\r\n                        class: 'magento-attribute-name'\r\n                    }),\r\n                    inputVirtualAttribute = new Element('input', {\r\n                        style: 'display: none',\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        disabled: 'disabled',\r\n                        class: 'virtual-amazon-attribute-name-value',\r\n                        name: 'virtual_amazon_attributes_' + i\r\n                    }),\r\n                    selectVirtualAttributeOption = new Element('select', {\r\n                        style: 'margin-top: 5px; display: none; width: 200px; font-size: 10px; background-position: calc(100% - 12px) -38px, 100%, calc(100% - 3.2rem) 0;',\r\n                        disabled: 'disabled',\r\n                        class: 'admin__control-select required-entry virtual-amazon-option',\r\n                        name: 'virtual_amazon_option_' + i\r\n                    }),\r\n                    selectVirtualAttributeOptionGroup = new Element('optgroup', {\r\n                        label: attribute.key\r\n                    }),\r\n                    spanVirtualAttributeAndOption = new Element('span', {\r\n                        style: 'display: none; line-height: 29px;',\r\n                        class: 'virtual-amazon-attribute-and-option'\r\n                    }),\r\n                    spanLeftHelpIcon = new Element('span', {\r\n                        style: 'display: none',\r\n                        class: 'left-help-icon'\r\n                    }),\r\n                    tdValue = new Element('div', {\r\n                        class: 'value',\r\n                        style: 'display: table-cell; padding-bottom: 5px; padding-left: 10px;'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        class: 'magento-attribute-name-value',\r\n                        name: 'magento_attributes_' + i\r\n                    }),\r\n                    selectAmazonAttr = new Element('select', {\r\n                        class: 'admin__control-select required-entry M2ePro-amazon-attribute-unique-value amazon-attribute-name',\r\n                        name: 'amazon_attributes_' + i,\r\n                        style: 'width: 250px; font-size: 11px; background-position: calc(100% - 12px) -38px, 100%, calc(100% - 3.2rem) 0;'\r\n                    }),\r\n                    spanVirtualAttribute = new Element('span', {\r\n                        style: 'display: none; line-height: 33px;',\r\n                        class: 'virtual-amazon-attribute-name'\r\n                    }),\r\n                    spanRightHelpIcon = new Element('span', {\r\n                        style: 'display: none',\r\n                        class: 'right-help-icon'\r\n                    });\r\n\r\n                var helpIconTpl = $('product_search_help_icon_tpl');\r\n\r\n                spanLeftHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanLeftHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_magento_greater_left'));\r\n                spanRightHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanRightHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_magento_greater_right'));\r\n\r\n                var attributeStr = attribute.key;\r\n                if (attributeStr.length > 16) {\r\n                    attributeStr = attribute.key.substr(0, 15) + '...';\r\n                    spanVirtualAttributeAndOption.title = attribute.key;\r\n                    spanVirtualAttribute.title = attribute.key;\r\n                }\r\n\r\n                if (attribute.key.length < 31) {\r\n                    spanMagentoAttr.update(attribute.key);\r\n                } else {\r\n                    spanMagentoAttr.update(attribute.key.substr(0, 28) + '...');\r\n                    spanMagentoAttr.title = attribute.key;\r\n                }\r\n\r\n                spanVirtualAttribute.update(attributeStr + ' (<span>&ndash;</span>)');\r\n                spanVirtualAttributeAndOption.update(attributeStr + ' (<a href=\"javascript:void(0);\"></a>)');\r\n                spanVirtualAttributeAndOption.down('a').title = '';\r\n\r\n                spanVirtualAttributeAndOption.down('a').observe('click', function (event) {\r\n                    spanVirtualAttributeAndOption.hide();\r\n                    selectVirtualAttributeOption.show();\r\n                    selectVirtualAttributeOption.value = '';\r\n                    spanVirtualAttribute.down('span').update('&ndash;');\r\n                    spanVirtualAttribute.down('span').title = '';\r\n\r\n                    $('map_link_error_icon_' + id).show();\r\n                    $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectAmazonAttr.insert({bottom: option});\r\n\r\n                searchData.destinationAttributes.each(function (destinationAttribute) {\r\n                    var option = new Element('option', {\r\n                        value: destinationAttribute\r\n                    });\r\n                    option.update(destinationAttribute);\r\n                    selectAmazonAttr.insert({bottom: option});\r\n\r\n                    if (attribute.value == destinationAttribute) {\r\n                        selectAmazonAttr.value = destinationAttribute;\r\n                        prematchedAttributes.push(selectAmazonAttr);\r\n                    }\r\n                });\r\n                selectAmazonAttr.prevValue = '';\r\n\r\n                selectAmazonAttr.observe('change', function (event) {\r\n                    $('map_link_error_icon_' + id).show();\r\n                    $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n\r\n                    var result = true;\r\n                    if (selectAmazonAttr.value != '' && inputMagentoAttr.value != selectAmazonAttr.value &&\r\n                        searchData.productAttributes.indexOf(selectAmazonAttr.value) !== -1) {\r\n                        result = false;\r\n\r\n                        if (attribute.value == null) {\r\n                            self.alert(M2ePro.text.duplicate_amazon_attribute_error);\r\n                        }\r\n                        selectAmazonAttr.value = '';\r\n                    }\r\n                    attribute.value = null;\r\n\r\n                    var prevValueIndex = searchData.selectedDestinationAttributes.indexOf(selectAmazonAttr.prevValue);\r\n                    if (prevValueIndex > -1) {\r\n                        searchData.selectedDestinationAttributes.splice(prevValueIndex, 1);\r\n                    }\r\n\r\n                    if (selectAmazonAttr.value != '') {\r\n                        searchData.selectedDestinationAttributes.push(selectAmazonAttr.value);\r\n                    }\r\n                    selectAmazonAttr.prevValue = selectAmazonAttr.value;\r\n\r\n                    form.select('select').each(function (el) {\r\n                        result = Validation.get('M2ePro-amazon-attribute-unique-value').test($F(el), el) ? result : false;\r\n                    });\r\n\r\n                    if (result && searchData.selectedDestinationAttributes.length == searchData.destinationAttributes.length) {\r\n                        self.showVirtualAmazonAttributes(id);\r\n                    } else {\r\n                        self.hideVirtualAmazonAttributes(id);\r\n                    }\r\n                });\r\n\r\n                selectVirtualAttributeOption.observe('change', function (event) {\r\n                    var value = selectVirtualAttributeOption.value;\r\n\r\n                    spanVirtualAttributeAndOption.show();\r\n                    selectVirtualAttributeOption.hide();\r\n\r\n                    if (attributeStr.length + value.length < 28) {\r\n                        spanVirtualAttribute.down('span').update(value);\r\n                        spanVirtualAttribute.down('span').title = '';\r\n                        spanVirtualAttributeAndOption.down('a').update(value);\r\n                    } else {\r\n                        spanVirtualAttribute.down('span').update(value.substr(0, 22 - attributeStr.length) + '...');\r\n                        spanVirtualAttribute.down('span').title = value;\r\n                        spanVirtualAttributeAndOption.down('a').update(value.substr(0, 22 - attributeStr.length) + '...');\r\n                    }\r\n\r\n                    spanVirtualAttributeAndOption.down('a').title = M2ePro.text.change_option + ' \"' + value + '\"';\r\n\r\n                    var result = true;\r\n                    form.select('select').each(function (el) {\r\n                        if (Validation.isVisible(el)) {\r\n                            el.classNames().each(function (className) {\r\n                                var v = Validation.get(className),\r\n                                    validationResult = v.test($F(el), el);\r\n\r\n                                result = validationResult ? result : false;\r\n\r\n                                if (!validationResult) {\r\n                                    throw $break;\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n\r\n                    if (result) {\r\n                        $('map_link_error_icon_' + id).hide();\r\n\r\n                        var data = {};\r\n                        data.virtual_matched_attributes = form.serialize(true);\r\n                        data.variations = searchData.amazonVariation;\r\n                        data = addslashes(encodeURIComponent(JSON.stringify(data)));\r\n\r\n                        var mapLinkTemplate = $('template_map_link_' + id).innerHTML;\r\n                        mapLinkTemplate = mapLinkTemplate.replace('%options_data%', data);\r\n                        $('map_link_' + id).innerHTML = mapLinkTemplate;\r\n                    } else {\r\n                        $('map_link_error_icon_' + id).show();\r\n                        $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n                    }\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectVirtualAttributeOption.insert({bottom: option});\r\n\r\n                searchData.magentoVariationSet[attribute.key].each(function (optionValue) {\r\n                    var option = new Element('option', {\r\n                        value: optionValue\r\n                    });\r\n                    option.update(optionValue);\r\n                    selectVirtualAttributeOptionGroup.insert({bottom: option});\r\n                });\r\n                selectVirtualAttributeOption.insert({bottom: selectVirtualAttributeOptionGroup});\r\n\r\n                tdLabel.insert({bottom: spanMagentoAttr});\r\n                tdLabel.insert({bottom: inputVirtualAttribute});\r\n                tdLabel.insert({bottom: selectVirtualAttributeOption});\r\n                tdLabel.insert({bottom: spanVirtualAttributeAndOption});\r\n                tdLabel.insert({bottom: spanLeftHelpIcon});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: selectAmazonAttr});\r\n                tdValue.insert({bottom: spanVirtualAttribute});\r\n                tdValue.insert({bottom: spanRightHelpIcon});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tHeader.insert({after: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            // form.select('.tool-tip-image').each(function (element) {\r\n            //     element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n            //     element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            // });\r\n            //\r\n            // form.select('.tool-tip-message').each(function (element) {\r\n            //     element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n            //     element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            // });\r\n\r\n            prematchedAttributes.each(function (el) {\r\n                el.simulate('change');\r\n            });\r\n        },\r\n\r\n        showVirtualAmazonAttributes: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id);\r\n\r\n            var virtualAmazonAttr = form.select('select.amazon-attribute-name[value=\"\"]');\r\n            virtualAmazonAttr.each(function (el) {\r\n                el.disable().hide();\r\n\r\n                var tr = el.up('.matching-attributes-table-attribute-row');\r\n                tr.down('.magento-attribute-name-value').disable();\r\n                tr.down('.virtual-amazon-attribute-name').show();\r\n                tr.down('.magento-attribute-name').hide();\r\n                tr.down('.virtual-amazon-attribute-name-value').enable();\r\n                tr.down('.virtual-amazon-option').enable().show();\r\n                tr.down('.right-help-icon').show();\r\n                tr.down('.left-help-icon').show();\r\n            });\r\n        },\r\n\r\n        hideVirtualAmazonAttributes: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id);\r\n\r\n            var virtualAmazonAttr = form.select('select.amazon-attribute-name[value=\"\"]');\r\n            virtualAmazonAttr.each(function (el) {\r\n                el.enable().show();\r\n\r\n                var tr = el.up('.matching-attributes-table-attribute-row');\r\n                tr.down('.magento-attribute-name-value').enable();\r\n                tr.down('.virtual-amazon-attribute-name').hide();\r\n                tr.down('.magento-attribute-name').show();\r\n                tr.down('.virtual-amazon-attribute-name-value').disable();\r\n                tr.down('.virtual-amazon-option').disable().hide();\r\n                tr.down('.virtual-amazon-attribute-and-option').hide();\r\n                tr.down('.right-help-icon').hide();\r\n                tr.down('.left-help-icon').hide();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesVirtualMagentoView: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id),\r\n                tHeader = form.down('.matching-attributes-table-header'),\r\n                searchData = self.searchData[id];\r\n\r\n            form.select('.matching-attributes-table-attribute-row').each(function (el) {\r\n                el.remove();\r\n            });\r\n\r\n            var prematchedAttributes = [];\r\n            var i = 0;\r\n            $H(searchData.matchedAttributes).each(function (attribute) {\r\n\r\n                var tr = new Element('div', {\r\n                        style: 'display: table-row',\r\n                        class: 'matching-attributes-table-attribute-row'\r\n                    }),\r\n                    tdLabel = new Element('div', {\r\n                        class: 'label',\r\n                        style: 'display: table-cell; padding-bottom: 5px;'\r\n                    }),\r\n                    spanMagentoAttr = new Element('span'),\r\n                    tdValue = new Element('div', {\r\n                        class: 'value',\r\n                        style: 'display: table-cell; padding-bottom: 5px; padding-left: 10px;'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        name: 'magento_attributes_' + i\r\n                    }),\r\n                    selectAmazonAttr = new Element('select', {\r\n                        class: 'admin__control-select required-entry M2ePro-amazon-attribute-unique-value amazon-attribute-name',\r\n                        name: 'amazon_attributes_' + i,\r\n                        style: 'width: 250px; font-size: 11px; background-position: calc(100% - 12px) -38px, 100%, calc(100% - 3.2rem) 0;'\r\n                    });\r\n\r\n                if (attribute.key.length < 31) {\r\n                    spanMagentoAttr.update(attribute.key);\r\n                } else {\r\n                    spanMagentoAttr.update(attribute.key.substr(0, 28) + '...');\r\n                    spanMagentoAttr.title = attribute.key;\r\n                }\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectAmazonAttr.insert({bottom: option});\r\n\r\n                searchData.destinationAttributes.each(function (destinationAttribute) {\r\n                    var option = new Element('option', {\r\n                        value: destinationAttribute\r\n                    });\r\n                    option.update(destinationAttribute);\r\n                    selectAmazonAttr.insert({bottom: option});\r\n\r\n                    if (attribute.value == destinationAttribute) {\r\n                        selectAmazonAttr.value = destinationAttribute;\r\n                        prematchedAttributes.push(selectAmazonAttr);\r\n                    }\r\n                });\r\n                selectAmazonAttr.prevValue = '';\r\n\r\n                selectAmazonAttr.observe('change', function (event) {\r\n                    $('map_link_error_icon_' + id).show();\r\n                    $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n\r\n                    var result = true;\r\n                    if (selectAmazonAttr.value != '' && inputMagentoAttr.value != selectAmazonAttr.value &&\r\n                        searchData.destinationAttributes.indexOf(inputMagentoAttr.value) !== -1) {\r\n                        result = false;\r\n\r\n                        if (attribute.value == null) {\r\n                            self.alert(M2ePro.text.duplicate_magento_attribute_error);\r\n                        }\r\n                        selectAmazonAttr.value = '';\r\n                    }\r\n                    attribute.value = null;\r\n\r\n                    form.select('select.amazon-attribute-name').each(function (el) {\r\n                        el.classNames().each(function (className) {\r\n                            var v = Validation.get(className),\r\n                                validationResult = v.test($F(el), el);\r\n\r\n                            result = validationResult ? result : false;\r\n\r\n                            if (!validationResult) {\r\n                                throw $break;\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    if (result) {\r\n                        self.showVirtualMagentoAttributes(id, i);\r\n                    } else {\r\n                        self.hideVirtualMagentoAttributes(id);\r\n                    }\r\n                });\r\n\r\n                tdLabel.insert({bottom: spanMagentoAttr});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: selectAmazonAttr});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tHeader.insert({after: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            prematchedAttributes.each(function (el) {\r\n                el.simulate('change');\r\n            });\r\n        },\r\n\r\n        showVirtualMagentoAttributes: function (id, lastAttributeIndex) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id),\r\n                tBody = form.down('.matching-attributes-table'),\r\n                searchData = self.searchData[id];\r\n\r\n            form.select('div.virtual-attribute').each(function (el) {\r\n                el.remove();\r\n            });\r\n\r\n            var selectedValues = [];\r\n            form.select('select.amazon-attribute-name').each(function (el) {\r\n                selectedValues.push(el.value);\r\n            });\r\n\r\n            var i = lastAttributeIndex;\r\n            searchData.destinationAttributes.each(function (attribute) {\r\n                if (selectedValues.indexOf(attribute) !== -1) {\r\n                    return true;\r\n                }\r\n                var tr = new Element('div', {\r\n                        style: 'display: table-row',\r\n                        class: 'matching-attributes-table-attribute-row virtual-attribute'\r\n                    }),\r\n                    tdLabel = new Element('div', {\r\n                        class: 'label',\r\n                        style: 'display: table-cell; padding-bottom: 5px;'\r\n                    }),\r\n                    spanMagentoAttr = new Element('div', {\r\n                        style: 'float: left; padding-top: 9px;'\r\n                    }),\r\n                    spanLeftHelpIcon = new Element('span', {\r\n                        class: 'left-help-icon'\r\n                    }),\r\n                    tdValue = new Element('div', {\r\n                        class: 'value',\r\n                        style: 'display: table-cell; padding-bottom: 5px; padding-left: 10px;'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute,\r\n                        type: 'hidden',\r\n                        name: 'virtual_magento_attributes_' + i\r\n                    }),\r\n                    spanVirtualAttribute = new Element('div', {\r\n                        style: 'display: none; float: left; padding-top: 9px'\r\n                    }),\r\n                    selectVirtualAttrOption = new Element('select', {\r\n                        style: 'width: 200px; font-size: 11px; background-position: calc(100% - 12px) -38px, 100%, calc(100% - 3.2rem) 0; float: left; margin-top: 3px',\r\n                        class: 'admin__control-select required-entry virtual-magento-option',\r\n                        name: 'virtual_magento_option_' + i\r\n                    }),\r\n                    virtualAttrOptionGroup = new Element('optgroup', {\r\n                        label: attribute\r\n                    }),\r\n                    spanRightHelpIcon = new Element('span', {\r\n                        class: 'right-help-icon'\r\n                    });\r\n\r\n                var helpIconTpl = $('product_search_help_icon_tpl');\r\n\r\n                spanLeftHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanLeftHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_amazon_greater_left'));\r\n                spanRightHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanRightHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_amazon_greater_right'));\r\n\r\n                var attributeStr = attribute;\r\n                if (attributeStr.length > 13) {\r\n                    attributeStr = attribute.substr(0, 12) + '...';\r\n                    spanMagentoAttr.title = attribute;\r\n                    spanVirtualAttribute.title = attribute;\r\n                }\r\n\r\n                spanMagentoAttr.update(attributeStr + ' (<span>&ndash;</span>)');\r\n                spanVirtualAttribute.update(attributeStr + ' (<a href=\"javascript:void(0);\"></a>)');\r\n                spanVirtualAttribute.down('a').title = '';\r\n\r\n                spanVirtualAttribute.down('a').observe('click', function (event) {\r\n                    spanVirtualAttribute.hide();\r\n                    selectVirtualAttrOption.show();\r\n                    selectVirtualAttrOption.value = '';\r\n                    spanMagentoAttr.down('span').update('&ndash;');\r\n                    spanMagentoAttr.down('span').title = '';\r\n\r\n                    $('map_link_error_icon_' + id).show();\r\n                    $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectVirtualAttrOption.insert({bottom: option});\r\n\r\n                searchData.amazonVariation.set[attribute].each(function (optionValue) {\r\n                    var option = new Element('option', {\r\n                        value: optionValue\r\n                    });\r\n                    option.update(optionValue);\r\n                    virtualAttrOptionGroup.insert({bottom: option});\r\n                });\r\n                selectVirtualAttrOption.insert({bottom: virtualAttrOptionGroup});\r\n\r\n                selectVirtualAttrOption.observe('change', function (event) {\r\n                    var value = selectVirtualAttrOption.value;\r\n\r\n                    spanVirtualAttribute.show();\r\n                    selectVirtualAttrOption.hide();\r\n\r\n                    if (attributeStr.length + value.length < 28) {\r\n                        spanMagentoAttr.down('span').update(value);\r\n                        spanMagentoAttr.down('span').title = '';\r\n                        spanVirtualAttribute.down('a').update(value);\r\n                    } else {\r\n                        spanMagentoAttr.down('span').update(value.substr(0, 27 - attributeStr.length) + '...');\r\n                        spanMagentoAttr.down('span').title = value;\r\n                        spanVirtualAttribute.down('a').update(value.substr(0, 27 - attributeStr.length) + '...');\r\n                    }\r\n\r\n                    spanVirtualAttribute.down('a').title = M2ePro.text.change_option + ' \"' + value + '\"';\r\n\r\n                    var result = true;\r\n                    form.select('select').each(function (el) {\r\n                        el.classNames().each(function (className) {\r\n                            var v = Validation.get(className),\r\n                                validationResult = v.test($F(el), el);\r\n\r\n                            result = validationResult ? result : false;\r\n\r\n                            if (!validationResult) {\r\n                                throw $break;\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    if (result) {\r\n                        $('map_link_error_icon_' + id).hide();\r\n\r\n                        var data = {};\r\n                        data.virtual_matched_attributes = form.serialize(true);\r\n                        data.variations = searchData.amazonVariation;\r\n                        data = addslashes(encodeURIComponent(JSON.stringify(data)));\r\n\r\n                        var mapLinkTemplate = $('template_map_link_' + id).innerHTML;\r\n                        mapLinkTemplate = mapLinkTemplate.replace('%options_data%', data);\r\n                        $('map_link_' + id).innerHTML = mapLinkTemplate;\r\n                    } else {\r\n                        $('map_link_error_icon_' + id).show();\r\n                        $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n                    }\r\n                });\r\n\r\n                tdLabel.insert({bottom: spanMagentoAttr});\r\n                tdLabel.insert({bottom: spanLeftHelpIcon});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: spanVirtualAttribute});\r\n                tdValue.insert({bottom: selectVirtualAttrOption});\r\n                tdValue.insert({bottom: spanRightHelpIcon});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tBody.insert({bottom: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            // tBody.select('.tool-tip-image').each(function (element) {\r\n            //     element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n            //     element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            // });\r\n            //\r\n            // tBody.select('.tool-tip-message').each(function (element) {\r\n            //     element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n            //     element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            // });\r\n        },\r\n\r\n        hideVirtualMagentoAttributes: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id);\r\n\r\n            form.select('div.virtual-attribute').each(function (el) {\r\n                el.remove();\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Variation.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Common'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductVariation = Class.create();\r\n    AmazonListingProductVariation.prototype = Object.extend(new Common(), {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (gridHandler) {\r\n            this.gridHandler = gridHandler;\r\n        },\r\n\r\n        setListingProductId: function (listingProductId) {\r\n            this.listingProductId = listingProductId;\r\n            return this;\r\n        },\r\n\r\n        setNeededVariationData: function (variationAttributes, variationsTree) {\r\n            this.variationAttributes = variationAttributes;\r\n            this.variationsTree = variationsTree;\r\n\r\n            return this;\r\n        },\r\n\r\n        //########################################\r\n\r\n        showSwitchToIndividualModePopUp: function (title) {\r\n            var self = this;\r\n\r\n            if (self.switchToIndividualModePopUp) {\r\n                self.switchToIndividualModePopUp.modal('openModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation/getSwitchToIndividualModePopUp'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.switchToIndividualModePopUp = jQuery('#switch_to_individual_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('switch_to_individual_mode_popup_title'),\r\n                        type: 'popup',\r\n                        modalClass: 'width-50',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.switchToIndividualModePopUp.modal('closeModal');\r\n                            }\r\n                        }, {\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                if ($('switch_to_individual_remember_checkbox').checked) {\r\n                                    new Ajax.Request(M2ePro.url.get('saveListingAdditionalData'), {\r\n                                        method: 'post',\r\n                                        parameters: {\r\n                                            param_name: 'hide_switch_to_individual_confirm',\r\n                                            param_value: 1\r\n                                        },\r\n                                        onSuccess: function (transport) {\r\n                                            self.gridHandler.unselectAllAndReload();\r\n                                        }\r\n                                    });\r\n                                }\r\n\r\n                                self.switchToIndividualModePopUp.modal('closeModal');\r\n                                self.showManagePopup(title);\r\n                            }\r\n                        }]\r\n                    }, self.switchToIndividualModePopUp);\r\n\r\n                    self.switchToIndividualModePopUp.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        showSwitchToParentModePopUp: function () {\r\n            var self = this;\r\n\r\n            if (self.switchToParentModePopUp) {\r\n                self.switchToParentModePopUp.modal('openModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation/getSwitchToParentModePopUp'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.switchToParentModePopUp = jQuery('#switch_to_parent_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('switch_to_parent_mode_popup_title'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.switchToParentModePopUp.modal('closeModal');\r\n                            }\r\n                        }, {\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                if ($('switch_to_parent_remember_checkbox').checked) {\r\n                                    new Ajax.Request(M2ePro.url.get('saveListingAdditionalData'), {\r\n                                        method: 'post',\r\n                                        parameters: {\r\n                                            param_name: 'hide_switch_to_parent_confirm',\r\n                                            param_value: 1\r\n                                        }\r\n                                    });\r\n                                }\r\n\r\n                                self.switchToParentModePopUp.modal('closeModal');\r\n                                self.resetListingProductVariation();\r\n                            }\r\n                        }]\r\n                    }, self.switchToParentModePopUp);\r\n\r\n                    self.switchToParentModePopUp.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        //########################################\r\n\r\n        showEditPopup: function (popupTitle) {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/getEditPopup'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    listing_product_id: this.listingProductId\r\n                },\r\n                onSuccess: (function (transport) {\r\n\r\n                    try {\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        if (response.type == 'error') {\r\n                            MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n                            return;\r\n                        }\r\n\r\n                        var popupContent = $('variation_individual_edit_popup');\r\n\r\n                        if (popupContent) {\r\n                            popupContent.remove();\r\n                        }\r\n\r\n                        $('html-body').insert({bottom: response.html});\r\n\r\n                        var variationForm = jQuery('#variation_edit_form').form();\r\n\r\n                        self.editPopup = jQuery('#variation_individual_edit_popup');\r\n\r\n                        modal({\r\n                            title: popupTitle,\r\n                            type: 'slide',\r\n                            buttons: [{\r\n                                text: M2ePro.translator.translate('Cancel'),\r\n                                click: function () {\r\n                                    self.editPopup.modal('closeModal');\r\n                                }\r\n                            },{\r\n                                text: M2ePro.translator.translate('Confirm'),\r\n                                class: 'action primary',\r\n                                click: function () {\r\n                                    if (!variationForm.valid()) {\r\n                                        return;\r\n                                    }\r\n\r\n                                    var variationData = {};\r\n                                    Form.getElements('variation_edit_form').each(function (selectElement) {\r\n                                        var attribute = selectElement.readAttribute('name');\r\n                                        selectElement.value && (variationData[attribute] = selectElement.value);\r\n                                    });\r\n\r\n                                    self.editAction(variationData);\r\n\r\n                                    self.editPopup.modal('closeModal');\r\n                                }\r\n                            }]\r\n                        }, self.editPopup);\r\n\r\n                        self.editPopup.modal('openModal');\r\n\r\n                    } catch (e) {\r\n                        this.editPopup.modal('closeModal');\r\n                        MessageObj.addErrorMessage('Internal Error.');\r\n                    }\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editPopupInit: function (currentVariation) {\r\n            var container = $('variation_edit_container');\r\n\r\n            var filters = {};\r\n\r\n            this.variationAttributes.each((function (attribute, i) {\r\n\r\n                var tr = container.appendChild(new Element('tr'));\r\n                tr.appendChild(new Element('td', {class: 'label', style: 'width: 25%; vertical-align: inherit;'}))\r\n                    .insert(attribute + ': <span class=\"required\">*</span>');\r\n\r\n                var select = tr\r\n                    .appendChild(new Element('td', {class: 'value'}))\r\n                    .appendChild(new Element('select', {\r\n                        name: 'variation_data[' + attribute + ']',\r\n                        class: 'required-entry admin__control-select',\r\n                        index: i\r\n                    }));\r\n\r\n                select\r\n                    .appendChild(new Element('option', {value: currentVariation[attribute]}))\r\n                    .insert(currentVariation[attribute]);\r\n\r\n                this.eachAttributeHandler(\r\n                    select,\r\n                    i,\r\n                    function () {\r\n                        return container.select('select[index]').filter(function (select) {\r\n                            return select.readAttribute('index') > i;\r\n                        });\r\n                    },\r\n                    filters\r\n                );\r\n\r\n            }).bind(this));\r\n\r\n            container.select('select[index]').each(function (select) {\r\n                select.simulate('change');\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        resetListingProductVariation: function () {\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/variationReset'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    listing_product_id: this.listingProductId\r\n                },\r\n                onSuccess: (function (transport) {\r\n\r\n                    try {\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n\r\n                        this.gridHandler.unselectAllAndReload();\r\n                    } catch (e) {\r\n                        this.editPopup.modal('closeModal');\r\n                        MessageObj.addErrorMessage('Internal Error.');\r\n                    }\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        //########################################\r\n\r\n        showManagePopup: function (popupTitle) {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/getManagePopup'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    listing_product_id: this.listingProductId\r\n                },\r\n                onSuccess: (function (transport) {\r\n\r\n                    try {\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        if (response.type == 'error') {\r\n                            MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n                            return;\r\n                        }\r\n\r\n                        var popupContent = $('variation_individual_manage_popup');\r\n\r\n                        if (popupContent) {\r\n                            popupContent.remove();\r\n                        }\r\n\r\n                        $('html-body').insert({bottom: response.html});\r\n\r\n                        var variationForm = jQuery('#variation_manage_form');\r\n                        self.initFormValidation(variationForm);\r\n\r\n                        self.managePopup = jQuery('#variation_individual_manage_popup');\r\n\r\n                        modal({\r\n                            title: popupTitle,\r\n                            type: 'slide',\r\n                            buttons: [{\r\n                                text: M2ePro.translator.translate('Cancel'),\r\n                                click: function () {\r\n                                    self.managePopup.modal('closeModal');\r\n                                }\r\n                            },{\r\n                                text: M2ePro.translator.translate('Confirm'),\r\n                                class: 'action primary',\r\n                                click: function () {\r\n                                    if (!variationForm.valid()) {\r\n                                        return;\r\n                                    }\r\n\r\n                                    var variationData = {};\r\n                                    Form.getElements('variation_manage_form').each(function (selectElement) {\r\n                                        var attribute = selectElement.readAttribute('name');\r\n                                        selectElement.value && (variationData[attribute] = selectElement.value);\r\n                                    });\r\n\r\n                                    self.manageAction(variationData);\r\n\r\n                                    self.managePopup.modal('closeModal');\r\n                                }\r\n                            }]\r\n                        }, self.managePopup);\r\n\r\n                        self.managePopup.modal('openModal');\r\n\r\n                        $('add_more_variation_button').observe('click', (function () {\r\n                            if (!variationForm.valid()) {\r\n                                return;\r\n                            }\r\n                            self.manageAddRow();\r\n                        }));\r\n\r\n                    } catch (e) {\r\n                        self.managePopup.modal('closeModal');\r\n                        MessageObj.addErrorMessage('Internal Error.');\r\n                    }\r\n                })\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        managePopupInit: function()\r\n        {\r\n            $('add_more_variation_button').simulate('click');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        manageAddRow: function () {\r\n            var container = $('variation_manage_tbody');\r\n\r\n            var lastTr = container.select('tr').last();\r\n            var index = lastTr ? parseInt(lastTr.readAttribute('index')) + 1 : 1;\r\n\r\n            var tr = container.appendChild(new Element('tr', {index: index}));\r\n\r\n            var filters = {};\r\n\r\n            this.variationAttributes.each((function (attribute, i) {\r\n\r\n                var select = tr\r\n                    .appendChild(new Element('td', {style: 'vertical-align: top; padding: 5px 4px'}))\r\n                    .appendChild(new Element('select', {\r\n                        name: 'variation_data[' + index + '][' + attribute + ']',\r\n                        class: 'required-entry admin__control-select',\r\n                        style: 'width: 100%',\r\n                        index: i,\r\n                        disabled: true\r\n                    }));\r\n\r\n                this.eachAttributeHandler(\r\n                    select,\r\n                    i,\r\n                    function () {\r\n                        return tr.select('select[index]').filter(function (select) {\r\n                            return select.readAttribute('index') > i;\r\n                        });\r\n                    },\r\n                    filters\r\n                );\r\n\r\n            }).bind(this));\r\n\r\n            tr.appendChild(new Element('td', {style: 'vertical-align: top; padding: 10px 4px'}))\r\n                .appendChild(new Element('a', {class: 'remove-variation', href: 'javascript:void(0)'})).insert('<span></span>')\r\n                .observe('click', function () {\r\n                    if (container.select('tr').length > 1) {\r\n                        tr.remove();\r\n                    }\r\n\r\n                    if (container.select('tr').length == 1) {\r\n                        container.select('a.remove-variation').each(function (btn) {\r\n                            btn.hide();\r\n                        });\r\n                    }\r\n                });\r\n\r\n            container.select('a.remove-variation').each(function (btn) {\r\n                btn.hide();\r\n            });\r\n\r\n            if (container.select('tr').length > 1) {\r\n                container.select('a.remove-variation').each(function (btn) {\r\n                    btn.show();\r\n                });\r\n            }\r\n        },\r\n\r\n        //########################################\r\n\r\n        eachAttributeHandler: function (select, i, getNextSelects, filters) {\r\n            var attribute = this.variationAttributes[i];\r\n\r\n            if (!i) {\r\n                select.disabled = false;\r\n                this.renderAttributeValues(select, attribute);\r\n            }\r\n\r\n            select.observe('change', (function () {\r\n                filters[attribute] = select.value;\r\n\r\n                var nextSelects = getNextSelects.call(this);\r\n\r\n                if (nextSelects.length < 1) {\r\n                    return;\r\n                }\r\n\r\n                nextSelects.each(function (select) {\r\n                    select.disabled = true;\r\n                });\r\n\r\n                var nextSelect = nextSelects[0];\r\n\r\n                nextSelect.disabled = false;\r\n\r\n                this.renderAttributeValues(\r\n                    nextSelect, this.variationAttributes[i + 1], filters\r\n                );\r\n            }).bind(this));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderAttributeValues: function (container, attribute, filters) {\r\n            filters = filters || {};\r\n\r\n            var values = this.getAttributeValues(attribute, this.variationsTree, filters);\r\n\r\n            var oldValue = container.value;\r\n            container.update();\r\n\r\n            container.appendChild(new Element('option', {style: 'display: none'}));\r\n\r\n            if (typeof values != 'undefined') {\r\n\r\n                values.each(function (value) {\r\n                    container.appendChild(new Element('option', {value: value})).insert(value);\r\n\r\n                    if (value == oldValue) {\r\n                        container.value = oldValue;\r\n                        container.simulate('change');\r\n                    }\r\n                });\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getAttributeValues: function (attribute, attributesTree, filters) {\r\n            for (var treeAttribute in attributesTree) {\r\n\r\n                if (attribute == treeAttribute) {\r\n\r\n                    var values = [];\r\n                    for (var value in attributesTree[treeAttribute]) {\r\n                        value && values.push(value);\r\n                    }\r\n\r\n                    return values;\r\n                }\r\n\r\n                for (var filterAttribute in filters) {\r\n\r\n                    if (filterAttribute == treeAttribute) {\r\n                        return this.getAttributeValues(\r\n                            attribute,\r\n                            attributesTree[treeAttribute][filters[filterAttribute]],\r\n                            filters\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        //########################################\r\n\r\n        editAction: function (variationData) {\r\n            MessageObj.clear();\r\n\r\n            var parameters = Object.extend(\r\n                {\r\n                    listing_product_id: this.listingProductId\r\n                },\r\n                variationData\r\n            );\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/edit'), {\r\n                method: 'post',\r\n                parameters: parameters,\r\n                onSuccess: (function (transport) {\r\n\r\n                    try {\r\n                        this.editPopup.modal('closeModal');\r\n\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n\r\n                        if (response.type == 'error') {\r\n                            this.scrollPageToTop();\r\n                        } else {\r\n                            this.gridHandler.unselectAllAndReload();\r\n                        }\r\n\r\n                    } catch (e) {\r\n                        console.log(e.stack);\r\n                        this.scrollPageToTop();\r\n                        this.editPopup.modal('closeModal');\r\n                        MessageObj.addErrorMessage('Internal Error.');\r\n                    }\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        manageAction: function (variationData) {\r\n            MessageObj.clear();\r\n\r\n            var parameters = Object.extend(\r\n                {\r\n                    listing_product_id: this.listingProductId\r\n                },\r\n                variationData\r\n            );\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/manage'), {\r\n                method: 'post',\r\n                parameters: parameters,\r\n                onSuccess: (function (transport) {\r\n\r\n                    try {\r\n                        this.managePopup.modal('closeModal');\r\n\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n\r\n                        if (response.type == 'error') {\r\n                            this.scrollPageToTop();\r\n                        } else {\r\n                            this.gridHandler.unselectAllAndReload();\r\n                        }\r\n\r\n                    } catch (e) {\r\n                        this.scrollPageToTop();\r\n                        this.managePopup.modal('closeModal');\r\n                        MessageObj.addErrorMessage('Internal Error.');\r\n                    }\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        manageGenerateAction: function (unique) {\r\n            var self = this,\r\n                attributesIndexes = {};\r\n\r\n            $('variation_manage').select('th.data-grid-th').each(function (el, i) {\r\n                attributesIndexes[el.readAttribute('attribute').toLowerCase()] = i;\r\n            });\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/generate'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    listing_product_id: self.listingProductId,\r\n                    unique: +(unique)\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    try {\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        if (response.type == 'error') {\r\n                            MessageObj.addErrorMessage(response.message);\r\n                            self.managePopup.modal('closeModal');\r\n                            return self.scrollPageToTop();\r\n                        }\r\n\r\n                        if (response.text.length < 1 && Boolean(unique)) {\r\n                            self.alert(M2ePro.translator.translate('no_variations_left'));\r\n                            return;\r\n                        }\r\n\r\n                        $('variation_manage_tbody').select('tr').invoke('remove');\r\n\r\n                        response.text.each(function (attributes) {\r\n\r\n                            self.manageAddRow();\r\n\r\n                            var tr = $('variation_manage_tbody').select('tr').last();\r\n\r\n                            var temp = [];\r\n\r\n                            attributes.each(function (attribute) {\r\n                                var index = attributesIndexes[attribute.attribute.toLowerCase()];\r\n                                var select = tr.down('select[index=' + index + ']');\r\n                                temp[index] = {select: select, value: attribute.option};\r\n                            });\r\n\r\n                            temp.each(function (obj) {\r\n                                obj.select.value = obj.value;\r\n                                obj.select.simulate('change');\r\n                            });\r\n                        });\r\n                    } catch (e) {\r\n                        self.scrollPageToTop();\r\n                        self.managePopup.modal('closeModal');\r\n                        MessageObj.addErrorMessage('Internal Error.');\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Add/NewAsin/Template/Description/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Amazon/Listing/View/Action',\r\n    'M2ePro/Amazon/Listing/Product/Template/Description'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductAddNewAsinTemplateDescriptionGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function () {\r\n            return 'amazon';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function () {\r\n            return 1000;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function ($super) {\r\n            $super();\r\n            this.actionHandler = new AmazonListingViewAction(this);\r\n            this.templateDescriptionHandler = new AmazonListingProductTemplateDescription(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n\r\n                setDescriptionTemplateAction: (function () {\r\n                    this.mapToNewAsin(this.getSelectedProductsString())\r\n                }).bind(this),\r\n                resetDescriptionTemplateAction: (function () {\r\n                    this.unmapFromNewAsin(this.getSelectedProductsString())\r\n                }).bind(this),\r\n\r\n                setDescriptionTemplateByCategoryAction: (function () {\r\n                    this.mapToNewAsin(this.getSelectedProductsStringFromCategory())\r\n                }).bind(this),\r\n                resetDescriptionTemplateByCategoryAction: (function () {\r\n                    this.unmapFromNewAsin(this.getSelectedProductsStringFromCategory())\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function ($super) {\r\n            $super();\r\n        },\r\n\r\n        setDescriptionTemplateRowAction: function (id) {\r\n            this.mapToNewAsin(id);\r\n        },\r\n\r\n        resetDescriptionTemplateRowAction: function (id) {\r\n            this.unmapFromNewAsin(id);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setDescriptionTemplateByCategoryRowAction: function (id) {\r\n            this.mapToNewAsin(this.getSelectedProductsStringFromCategory(id));\r\n        },\r\n\r\n        resetDescriptionTemplateByCategoryRowAction: function (id) {\r\n            this.unmapFromNewAsin(this.getSelectedProductsStringFromCategory(id));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSelectedProductsStringFromCategory: function (categoryIds) {\r\n            var productsIdsStr = '';\r\n\r\n            categoryIds = categoryIds || this.getGridMassActionObj().checkedString;\r\n            categoryIds = explode(',', categoryIds);\r\n\r\n            categoryIds.each(function (categoryId) {\r\n\r\n                if (productsIdsStr != '') {\r\n                    productsIdsStr += ',';\r\n                }\r\n                productsIdsStr += $('products_ids_' + categoryId).value;\r\n            });\r\n\r\n            return productsIdsStr;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mapToNewAsin: function (listingProductIds) {\r\n            var self = this;\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/mapToNewAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: listingProductIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    self.templateDescriptionHandler.gridHandler.unselectAllAndReload();\r\n\r\n                    if (response.products_ids.length > 0) {\r\n                        ListingGridHandlerObj.templateDescriptionHandler.openPopUp(\r\n                            0, M2ePro.translator.translate('templateDescriptionPopupTitle'),\r\n                            response.products_ids, response.html, 1);\r\n                    } else {\r\n                        if (response.messages.length > 0) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        unmapFromNewAsin: function (productsIds) {\r\n            var self = this;\r\n\r\n            self.templateDescriptionHandler.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/unmapFromAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.type == 'success') {\r\n                        self.templateDescriptionHandler.unassignFromTemplateDescription(productsIds);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        mapToTemplateDescription: function (el, templateId, mapToGeneralId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/assign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: ListingGridHandlerObj.templateDescriptionHandler.templateDescriptionPopup.productsIds,\r\n                    template_id: templateId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n                    self.mapToNewAsin(response.products_ids);\r\n                }\r\n            });\r\n\r\n            ListingGridHandlerObj.templateDescriptionHandler.templateDescriptionPopup.modal('closeModal');\r\n        },\r\n\r\n        checkCategoryProducts: function (url) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/checkNewAsinCategoryProducts'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == 1) {\r\n                        setLocation(url);\r\n                    } else {\r\n                        if (!transport.responseText.isJSON()) {\r\n                            self.alert(transport.responseText);\r\n                            return;\r\n                        }\r\n\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        MessageObj.clear();\r\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.text);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        checkManualProducts: function (url) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/checkNewAsinManualProducts'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == 1) {\r\n                        setLocation(url);\r\n                    } else {\r\n                        if (!transport.responseText.isJSON()) {\r\n                            self.alert(transport.responseText);\r\n                            return;\r\n                        }\r\n\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        if ($('new_asin_skip_popup_content')) {\r\n                            $('new_asin_skip_popup_content').remove();\r\n                        }\r\n                        $('html-body').insert({bottom: response.html});\r\n\r\n                        $('total_count').innerHTML = response.total_count;\r\n                        $('failed_count').update(response.failed_count);\r\n\r\n                        self.skipPopup = jQuery('#new_asin_skip_popup_content');\r\n\r\n                        modal({\r\n                            title: M2ePro.translator.translate('setDescriptionPolicy'),\r\n                            type: 'popup',\r\n                            buttons: [ {\r\n                                text: M2ePro.translator.translate('Cancel'),\r\n                                class: 'action-secondary action-dismiss',\r\n                                click: function () {\r\n                                    self.skipPopup.modal('closeModal');\r\n                                }\r\n                            }, {\r\n                                text: M2ePro.translator.translate('Continue'),\r\n                                class: 'action-primary action-accept',\r\n                                click: function () {\r\n                                    setLocation(response.continueUrl);\r\n                                    self.skipPopup.modal('closeModal');\r\n                                }\r\n                            }]\r\n                        }, self.skipPopup);\r\n\r\n                        self.skipPopup.modal('openModal');\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Add/SearchAsin/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Amazon/Listing/View/Action',\r\n    'M2ePro/Amazon/Listing/Product/Search'\r\n], function (modal, MessageObj) {\r\n\r\n    AmazonListingProductAddSearchAsinGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function () {\r\n            return 'amazon';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function () {\r\n            return 1000;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function ($super) {\r\n            $super();\r\n            this.actionHandler = new AmazonListingViewAction(this);\r\n            this.productSearchHandler = new AmazonListingProductSearch(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n\r\n                assignGeneralIdAction: (function () {\r\n                    this.productSearchHandler.searchGeneralIdAuto(this.getSelectedProductsString())\r\n                }).bind(this),\r\n                unassignGeneralIdAction: (function () {\r\n                    this.productSearchHandler.unmapFromGeneralId(this.getSelectedProductsString())\r\n                }).bind(this)\r\n\r\n            });\r\n\r\n            this.productSearchHandler.clearSearchResultsAndOpenSearchMenu = function () {\r\n                var self = this;\r\n\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            self.popup.modal('closeModal');\r\n                            self.unmapFromGeneralId(self.params.productId);\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function ($super) {\r\n            $super();\r\n        },\r\n\r\n        editSearchSettings: function (title, listingId) {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/viewSearchSettings'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    id: listingId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!$('edit_search_settings_popup')) {\r\n                        $('html-body').insert({bottom: '<div id=\"edit_search_settings_popup\"></div>'});\r\n                    }\r\n\r\n                    $('edit_search_settings_popup').update(transport.responseText);\r\n\r\n                    $('breadcrumb_container').remove();\r\n\r\n                    self.searchSettnigsPopup = jQuery('#edit_search_settings_popup');\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            click: function () {\r\n                                self.searchSettnigsPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action primary',\r\n                            click: function () {\r\n                                ListingGridHandlerObj.saveSearchSettings();\r\n                                self.searchSettnigsPopup.modal('closeModal');\r\n                            }\r\n                        }]\r\n                    }, self.searchSettnigsPopup);\r\n\r\n                    self.searchSettnigsPopup.modal('openModal');\r\n                    self.searchSettnigsPopup.listingId = listingId;\r\n                }\r\n            });\r\n        },\r\n\r\n        saveSearchSettings: function () {\r\n            var self = this,\r\n                data;\r\n\r\n            if (self.searchSettingsForm && !self.searchSettingsForm.validate()) {\r\n                return;\r\n            }\r\n\r\n            data = $('edit_form').serialize(true);\r\n            data.id = self.searchSettnigsPopup.listingId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/saveSearchSettings'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function (transport) {\r\n                    self.actionHandler.gridHandler.unselectAllAndReload();\r\n                    self.searchSettnigsPopup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        checkSearchResults: function (listingId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/checkSearchResults'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    id: listingId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n\r\n                    if (response.redirect) {\r\n                        return setLocation(response.redirect);\r\n                    }\r\n\r\n                    if (!$('search_asin_new_asin_popup')) {\r\n                        $('html-body').insert({bottom: response.html});\r\n                    }\r\n\r\n                    self.newAsinPopup = jQuery('#search_asin_new_asin_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('new_asin_popup_title'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            class: 'action-secondary action-dismiss',\r\n                            text: M2ePro.translator.translate('No'),\r\n                            click: function () {\r\n                                self.showNewAsinPopup(0);\r\n                            }\r\n                        }, {\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.showNewAsinPopup(1);\r\n                            }\r\n                        }]\r\n                    }, self.newAsinPopup);\r\n\r\n                    var modalHeader = jQuery('#search_asin_new_asin_popup')\r\n                                        .closest('.modal-inner-wrap')\r\n                                        .find('h1.modal-title'),\r\n                        tips = jQuery('#new_asin_title_help_tips');\r\n\r\n                    tips.insertAfter(modalHeader);\r\n                    tips.show();\r\n\r\n                    self.newAsinPopup.modal('openModal');\r\n                    self.newAsinPopup.listingId = listingId;\r\n                }\r\n            });\r\n        },\r\n\r\n        showNewAsinPopup: function (showNewAsinStep) {\r\n            var self = this,\r\n                remember = $('asin_search_new_asin_remember_checkbox').checked;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/showNewAsinStep'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    show_new_asin_step: +showNewAsinStep,\r\n                    remember: +remember,\r\n                    id: self.newAsinPopup.listingId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n\r\n                    if (response.redirect) {\r\n                        return setLocation(response.redirect);\r\n                    }\r\n                }\r\n            });\r\n\r\n            self.newAsinPopup.modal('closeModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showNotCompletedPopup: function () {\r\n            var self = this;\r\n\r\n            if (!$('not_completed_popup')) {\r\n                $('html-body').insert({bottom: '<div id=\"not_completed_popup\">' + M2ePro.translator.translate('not_completed_popup_text') + '</div>'});\r\n            }\r\n\r\n            var popup = jQuery('#not_completed_popup');\r\n\r\n            modal({\r\n                title: M2ePro.translator.translate('not_completed_popup_title'),\r\n                type: 'popup',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Close'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function () {\r\n                        popup.modal('closeModal');\r\n                    }\r\n                }]\r\n            }, popup);\r\n\r\n            popup.modal('openModal');\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Add/SourceMode/Category/Summary/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.AmazonListingProductAddSourceModeCategorySummaryGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeAction: this.remove.bind(this)\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        remove: function () {\r\n            var self = this;\r\n\r\n            Grid.prototype.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var url = M2ePro.url.get('amazon_listing_product_add/removeSessionProductsByCategory');\r\n                        new Ajax.Request(url, {\r\n                            parameters: {\r\n                                ids: self.getSelectedProductsString()\r\n                            },\r\n                            onSuccess: self.unselectAllAndReload.bind(self)\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function (config) {\r\n            if (config.actions && config.actions.confirm) {\r\n                config.actions.confirm();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Repricing/Price.js":"define([\r\n], function () {\r\n\r\n    window.AmazonListingProductRepricingPrice = Class.create();\r\n    AmazonListingProductRepricingPrice.prototype = {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (containerId) {\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showRepricingPrice: function () {\r\n\r\n            var groupedSkus = {};\r\n\r\n            $$('.m2epro-repricing-price-value').each(function (el) {\r\n                var accountId = el.getAttribute('account_id');\r\n\r\n                if (typeof groupedSkus[accountId] == 'undefined') {\r\n                    groupedSkus[accountId] = []\r\n                }\r\n\r\n                groupedSkus[accountId][groupedSkus[accountId].length] = el.getAttribute('sku');\r\n            });\r\n\r\n            groupedSkus = JSON.stringify(groupedSkus);\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_repricing/getUpdatedPriceBySkus'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    grouped_skus: groupedSkus\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var resultData = transport.responseText.evalJSON();\r\n\r\n                    $H(resultData).each(function (item) {\r\n                        $H(item.value).each(function (priceItem) {\r\n                            $('m2epro_repricing_price_value_' + priceItem.key).update(priceItem.value)\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n    };\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Template/Description.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductTemplateDescription = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mapToTemplateDescription: function (el, templateId, mapToGeneralId) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/assign'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                products_ids: self.templateDescriptionPopup.productsIds,\r\n                                template_id: templateId\r\n                            },\r\n                            onSuccess: function (transport) {\r\n\r\n                                if (!transport.responseText.isJSON()) {\r\n                                    self.alert(transport.responseText);\r\n                                    return;\r\n                                }\r\n\r\n                                var response = transport.responseText.evalJSON();\r\n\r\n                                if (mapToGeneralId) {\r\n                                    ListingGridHandlerObj.productSearchHandler.addNewGeneralId(response.products_ids);\r\n                                } else {\r\n                                    self.gridHandler.unselectAllAndReload();\r\n\r\n                                    if (response.messages.length > 0) {\r\n                                        MessageObj.clear();\r\n                                        response.messages.each(function (msg) {\r\n                                            MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](msg);\r\n                                        });\r\n                                    }\r\n                                }\r\n                            }\r\n                        });\r\n\r\n                        self.templateDescriptionPopup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n        unassignFromTemplateDescription: function (productsIds) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/unassign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validateProductsForTemplateDescriptionAssign: function (productsIds) {\r\n            var self = this;\r\n            self.flagSuccess = false;\r\n\r\n            productsIds = productsIds || ListingGridHandlerObj.productSearchHandler.params.productId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/validateProductsForAssign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.messages.length > 0) {\r\n                        MessageObj.clear();\r\n                        response.messages.each(function (msg) {\r\n                            MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                        });\r\n                    }\r\n\r\n                    if (!response.html) {\r\n                        return;\r\n                    }\r\n\r\n                    if (typeof popUp != 'undefined') {\r\n                        self.templateDescriptionPopup.modal('closeModal');\r\n                    }\r\n\r\n                    self.openPopUp(0, M2ePro.translator.translate('templateDescriptionPopupTitle'), response.products_ids, response.html);\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (mode, title, productsIds, contentData, checkIsNewAsinAccepted) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            MessageObj.clear();\r\n\r\n            var popupEl = $('template_description_pop_up_content');\r\n\r\n            if (popupEl) {\r\n                popupEl.remove();\r\n            }\r\n\r\n            $('html-body').insert({bottom: contentData});\r\n\r\n            self.templateDescriptionPopup = jQuery('#template_description_pop_up_content');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    click: function () {\r\n                        self.templateDescriptionPopup.modal('closeModal');\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Add New Description Policy'),\r\n                    class: 'action primary ',\r\n                    click: function () {\r\n                        self.createTemplateDescriptionInNewTab(M2ePro.url.get('newTemplateDescriptionUrl'));\r\n                    }\r\n                }]\r\n            }, self.templateDescriptionPopup);\r\n\r\n            self.templateDescriptionPopup.modal('openModal');\r\n\r\n            self.templateDescriptionPopup.productsIds = productsIds;\r\n            self.templateDescriptionPopup.checkIsNewAsinAccepted = checkIsNewAsinAccepted || 0;\r\n\r\n            self.loadTemplateDescriptionGrid();\r\n        },\r\n\r\n        loadTemplateDescriptionGrid: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/viewGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.templateDescriptionPopup.productsIds,\r\n                    check_is_new_asin_accepted: self.templateDescriptionPopup.checkIsNewAsinAccepted\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('template_description_grid').update(transport.responseText);\r\n                    $('template_description_grid').show();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        createTemplateDescriptionInNewTab: function (stepWindowUrl) {\r\n            var self = this;\r\n            var win = window.open(stepWindowUrl);\r\n\r\n            var intervalId = setInterval(function () {\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                amazonTemplateDescriptionGridJsObject.reload();\r\n            }, 1000);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Template/ProductTaxCode.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductTemplateProductTaxCode = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridHandler)\r\n        {\r\n            var self = this;\r\n            $super(gridHandler);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function(options)\r\n        {\r\n            this.options = Object.extend(this.options,options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function(productsIds)\r\n        {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_productTaxCode/viewPopup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids:  productsIds\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (!response.html) {\r\n                        if (response.messages.length > 0) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n\r\n                        return;\r\n                    }\r\n\r\n                    var popupElId = '#template_productTaxCode_pop_up_content';\r\n\r\n                    var popupEl = jQuery(popupElId);\r\n\r\n                    if (popupEl.length) {\r\n                        popupEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: response.html});\r\n\r\n                    self.templateProductTaxCodePopup = jQuery(popupElId);\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('templateProductTaxCodePopupTitle'),\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            click: function () {\r\n                                self.templateProductTaxCodePopup.modal('closeModal');\r\n                            }\r\n                        }, {\r\n                            text: M2ePro.translator.translate('Add New Product Tax Code Policy'),\r\n                            class: 'action primary ',\r\n                            click: function () {\r\n                                self.createInNewTab(self.newTemplateUrl);\r\n                            }\r\n                        }]\r\n                    }, self.templateProductTaxCodePopup);\r\n\r\n                    self.templateProductTaxCodePopup.productsIds = response.products_ids;\r\n\r\n                    self.templateProductTaxCodePopup.modal('openModal');\r\n\r\n                    var grid = $('template_productTaxCode_grid');\r\n\r\n                    grid.observe('click', function(event) {\r\n                        if (!event.target.hasClassName('assign-productTaxCode-template')) {\r\n                            return;\r\n                        }\r\n\r\n                        self.assign(event.target.getAttribute('templateProductTaxCodeId'));\r\n                    });\r\n\r\n                    grid.on('click', '.new-productTaxCode-template', function() {\r\n                        self.createInNewTab(self.newTemplateUrl);\r\n                    });\r\n\r\n                    self.loadGrid();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        assign: function(templateId)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_productTaxCode/assign'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                products_ids:  self.templateProductTaxCodePopup.productsIds,\r\n                                template_id:   templateId\r\n                            },\r\n                            onSuccess: function (transport) {\r\n\r\n                                if (!transport.responseText.isJSON()) {\r\n                                    self.alert(transport.responseText);\r\n                                    return;\r\n                                }\r\n\r\n                                self.gridHandler.unselectAllAndReload();\r\n\r\n                                var response = transport.responseText.evalJSON();\r\n\r\n                                MessageObj.clear();\r\n                                response.messages.each(function (msg) {\r\n                                    MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                        self.templateProductTaxCodePopup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unassign: function(productsIds)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_productTaxCode/unassign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        loadGrid: function()\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_productTaxCode/viewGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.templateProductTaxCodePopup.productsIds\r\n                },\r\n                onSuccess: function(transport) {\r\n                    var grid = $('template_productTaxCode_grid');\r\n                    grid.update(transport.responseText);\r\n                    grid.show();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        createInNewTab: function(stepWindowUrl)\r\n        {\r\n            var self = this;\r\n            var win = window.open(stepWindowUrl);\r\n\r\n            var intervalId = setInterval(function() {\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                self.loadGrid();\r\n            }, 1000);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Template/Shipping.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductTemplateShipping = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n            $super(gridHandler);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (productsIds, shippingMode) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_shipping/viewPopup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids:  productsIds,\r\n                    shipping_mode: shippingMode\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (!response.html) {\r\n                        if (response.messages.length > 0) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n\r\n                        return;\r\n                    }\r\n\r\n                    var popupElId = (shippingMode == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE'))\r\n                        ? '#template_shippingOverride_pop_up_content'\r\n                        : '#template_shippingTemplate_pop_up_content';\r\n\r\n                    var popupEl = jQuery(popupElId);\r\n\r\n                    if (popupEl.length) {\r\n                        popupEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: response.html});\r\n\r\n                    self.templateShippingPopup = jQuery(popupElId);\r\n\r\n                    var title             = M2ePro.translator.translate('templateShippingTemplatePopupTitle');\r\n                    var addNewPolicyTitle = M2ePro.translator.translate('Add New Shipping Template Policy');\r\n\r\n                    if (shippingMode == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE')) {\r\n\r\n                        title             = M2ePro.translator.translate('templateShippingOverridePopupTitle');\r\n                        addNewPolicyTitle = M2ePro.translator.translate('Add New Shipping Override Policy');\r\n                    }\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            click: function () {\r\n                                self.templateShippingPopup.modal('closeModal');\r\n                            }\r\n                        }, {\r\n                            text: addNewPolicyTitle,\r\n                            class: 'action primary ',\r\n                            click: function () {\r\n                                self.createInNewTab(self.newTemplateUrl, shippingMode);\r\n                            }\r\n                        }]\r\n                    }, self.templateShippingPopup);\r\n\r\n                    self.templateShippingPopup.productsIds = response.products_ids;\r\n\r\n                    self.templateShippingPopup.modal('openModal');\r\n\r\n                    $('template_shipping_grid').observe('click', function (event) {\r\n                        if (!event.target.hasClassName('assign-shipping-template')) {\r\n                            return;\r\n                        }\r\n\r\n                        self.assign(event.target.getAttribute('templateShippingId'), shippingMode);\r\n                    });\r\n\r\n                    $('template_shipping_grid').on('click', '.new-shipping-template', function() {\r\n                        self.createInNewTab(self.newTemplateUrl, shippingMode);\r\n                    });\r\n\r\n                    self.loadGrid(shippingMode);\r\n                }\r\n            });\r\n        },\r\n\r\n        loadGrid: function (shippingMode) {\r\n\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_shipping/viewGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.templateShippingPopup.productsIds,\r\n                    shipping_mode: shippingMode\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('template_shipping_grid').update(transport.responseText);\r\n                    $('template_shipping_grid').show();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        assign: function (templateId, shippingMode) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_shipping/assign'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                products_ids:  self.templateShippingPopup.productsIds,\r\n                                shipping_mode: shippingMode,\r\n                                template_id:   templateId\r\n                            },\r\n                            onSuccess: function (transport) {\r\n\r\n                                if (!transport.responseText.isJSON()) {\r\n                                    self.alert(transport.responseText);\r\n                                    return;\r\n                                }\r\n\r\n                                self.gridHandler.unselectAllAndReload();\r\n\r\n                                var response = transport.responseText.evalJSON();\r\n\r\n                                MessageObj.clear();\r\n                                response.messages.each(function (msg) {\r\n                                    MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                        self.templateShippingPopup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unassign: function (productsIds, shippingMode) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_shipping/unassign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids:  productsIds,\r\n                    shipping_mode: shippingMode\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        createInNewTab: function (url, shippingMode) {\r\n            var self = this;\r\n            var win = window.open(url);\r\n\r\n            var intervalId = setInterval(function () {\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                self.loadGrid(shippingMode);\r\n            }, 1000);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Variation/Manage.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Action'\r\n], function (MessageObj, modal) {\r\n\r\n    window.AmazonListingProductVariationManage = Class.create(Action, {\r\n\r\n        MATCHING_TYPE_EQUAL: 1,\r\n        MATCHING_TYPE_VIRTUAL_AMAZON: 2,\r\n        MATCHING_TYPE_VIRTUAL_MAGENTO: 3,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n        matchingType: 1,\r\n        matchedAttributes: [],\r\n        productAttributes: [],\r\n        destinationAttributes: [],\r\n        selectedDestinationAttributes: [],\r\n        magentoVariationSet: [],\r\n        amazonVariationSet: false,\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            this.initValidators();\r\n            return this;\r\n        },\r\n\r\n        initValidators: function () {\r\n            var self = this;\r\n\r\n            jQuery.validator.addMethod('M2ePro-amazon-attribute-unique-value', function(value, el) {\r\n                var existedValues = [],\r\n                    isValid = true,\r\n                    form = el.up('form');\r\n\r\n                form.select('select').each(function (el) {\r\n                    if (el.value != '') {\r\n                        if (existedValues.indexOf(el.value) === -1) {\r\n                            existedValues.push(el.value);\r\n                        } else {\r\n                            isValid = false;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                return isValid;\r\n            }, M2ePro.translator.translate('variation_manage_matched_attributes_error_duplicate'));\r\n        },\r\n\r\n        initSettingsTab: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            if (form && self.matchingType == self.MATCHING_TYPE_EQUAL) {\r\n                form.observe('change', function (e) {\r\n                    if (e.target.tagName != 'SELECT') {\r\n                        return;\r\n                    }\r\n\r\n                    $(e.target).select('.empty') && $(e.target).select('.empty').length && $(e.target).select('.empty')[0].hide();\r\n                });\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (productId, title, filter) {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation/manage'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: productId,\r\n                    filter: filter\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('variation_manage_tabs_container');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.variationProductManagePopup = jQuery('#variation_manage_tabs_container');\r\n\r\n                    modal({\r\n                        title: title.escapeHTML(),\r\n                        type: 'slide',\r\n                        closed: function() {\r\n                            self.gridHandler.unselectAllAndReload();\r\n                        },\r\n                        buttons: [\r\n                        //     {\r\n                        //     text: M2ePro.translator.translate('Close'),\r\n                        //     class: 'action primary ',\r\n                        //     click: function () {\r\n                        //         self.searchMenuPopup.modal('closeModal')\r\n                        //     }\r\n                        // }\r\n                        ]\r\n                    }, self.variationProductManagePopup);\r\n\r\n                    self.variationProductManagePopup.modal('openModal');\r\n                    self.variationProductManagePopup.productId = productId;\r\n\r\n                    self.initSettingsTab();\r\n                }\r\n            });\r\n        },\r\n\r\n        closeManageVariationsPopup: function () {\r\n            this.variationProductManagePopup.modal('closeModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openVocabularyAttributesPopUp: function (attributes) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/getAttributesPopup'), {\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('vocabulary_attributes_pupup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.vocabularyAttributesPupup = jQuery('#vocabulary_attributes_pupup');\r\n\r\n                    modal({\r\n                        title: 'Vocabulary',\r\n                        type: 'popup',\r\n                        closed: function() {\r\n                            self.reloadVariationsGrid();\r\n                        },\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.addAttributesToVocabulary(false);\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.addAttributesToVocabulary(true);\r\n                            }\r\n                        }]\r\n                    }, self.vocabularyAttributesPupup);\r\n\r\n                    self.vocabularyAttributesPupup.modal('openModal');\r\n\r\n                    $('vocabulary_attributes_data').value = Object.toJSON(attributes);\r\n\r\n                    var attributesHtml = '';\r\n                    $H(attributes).each(function (element) {\r\n                        attributesHtml += '<li>' + element.key + ' > ' + element.value + '</li>';\r\n                    });\r\n\r\n                    attributesHtml = '<ul style=\"list-style-position: inside;\">' + attributesHtml + '</ul>';\r\n\r\n                    var bodyHtml = str_replace('%attributes%', attributesHtml, $('vocabulary_attributes_pupup').innerHTML);\r\n\r\n                    $('vocabulary_attributes_pupup').update(bodyHtml);\r\n                }\r\n            });\r\n        },\r\n\r\n        addAttributesToVocabulary: function (needAdd) {\r\n            var self = this;\r\n\r\n            var isRemember = $('vocabulary_attributes_remember_checkbox').checked;\r\n\r\n            if (!needAdd && !isRemember) {\r\n                self.vocabularyAttributesPupup.modal('closeModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/addAttributes'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    attributes: $('vocabulary_attributes_data').value,\r\n                    need_add: needAdd ? 1 : 0,\r\n                    is_remember: isRemember ? 1 : 0\r\n                },\r\n                onSuccess: function (transport) {\r\n                    self.vocabularyAttributesPupup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        openVocabularyOptionsPopUp: function (options) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/getOptionsPopup'), {\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('vocabulary_options_pupup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.vocabularyOptionsPopup = jQuery('#vocabulary_options_pupup');\r\n\r\n                    modal({\r\n                        title: 'Vocabulary',\r\n                        type: 'popup',\r\n                        closed: function() {\r\n                            self.reloadVariationsGrid();\r\n                        },\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.addOptionsToVocabulary(false);\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.addOptionsToVocabulary(true);\r\n                            }\r\n                        }]\r\n                    }, self.vocabularyOptionsPopup);\r\n\r\n                    self.vocabularyOptionsPopup.modal('openModal');\r\n\r\n                    $('vocabulary_options_data').value = Object.toJSON(options);\r\n\r\n                    var optionsHtml = '';\r\n                    $H(options).each(function (element) {\r\n\r\n                        var valuesHtml = '';\r\n                        $H(element.value).each(function (value) {\r\n                            valuesHtml += value.key + ' > ' + value.value;\r\n                        });\r\n\r\n                        optionsHtml += '<li>' + element.key + ': ' + valuesHtml + '</li>';\r\n                    });\r\n\r\n                    optionsHtml = '<ul style=\"list-style-position: inside;\">' + optionsHtml + '</ul>';\r\n\r\n                    var bodyHtml = str_replace('%options%', optionsHtml, $('vocabulary_options_pupup').innerHTML);\r\n\r\n                    $('vocabulary_options_pupup').update(bodyHtml);\r\n                }\r\n            });\r\n        },\r\n\r\n        addOptionsToVocabulary: function (needAdd) {\r\n            var self = this;\r\n\r\n            var isRemember = $('vocabulary_options_remember_checkbox').checked;\r\n\r\n            if (!needAdd && !isRemember) {\r\n                self.vocabularyOptionsPopup.modal('closeModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/addOptions'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    options_data: $('vocabulary_options_data').value,\r\n                    need_add: needAdd ? 1 : 0,\r\n                    is_remember: isRemember ? 1 : 0\r\n                },\r\n                onSuccess: function (transport) {\r\n                    self.vocabularyOptionsPopup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setGeneralIdOwner: function (value, hideConfirm) {\r\n            var self = this,\r\n                confirmAction;\r\n\r\n            confirmAction = function () {\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setGeneralIdOwner'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        product_id: self.variationProductManagePopup.productId,\r\n                        general_id_owner: value\r\n                    },\r\n                    onSuccess: function (transport) {\r\n\r\n                        var response = self.parseResponse(transport);\r\n                        if (response.success) {\r\n                            return self.reloadVariationsGrid();\r\n                        }\r\n\r\n                        if (response.empty_sku) {\r\n                            return self.openSkuPopUp();\r\n                        }\r\n                        self.openDescriptionTemplatePopUp(response.html);\r\n                    }\r\n                });\r\n            };\r\n\r\n            if (hideConfirm) {\r\n                confirmAction();\r\n            } else {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        },\r\n\r\n        openSkuPopUp: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/getSkuPopup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: self.variationProductManagePopup.productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('manage_variation_sku_popup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.skuPopup = jQuery('#manage_variation_sku_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('variation_manage_matched_sku_popup_title'),\r\n                        type: 'popup',\r\n                        modalClass: 'width-50',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.skuPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.setProductSku();\r\n                            }\r\n                        }]\r\n                    }, self.skuPopup);\r\n\r\n                    self.skuPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        setProductSku: function () {\r\n            var self = this,\r\n                data;\r\n\r\n            this.initFormValidation('#variation_manager_sku_form');\r\n\r\n            if (!jQuery('#variation_manager_sku_form').valid()) {\r\n                return;\r\n            }\r\n\r\n            data = $('variation_manager_sku_form').serialize(true);\r\n            data.product_id = self.variationProductManagePopup.productId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setListingProductSku'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function (transport) {\r\n\r\n                    var response = self.parseResponse(transport);\r\n                    if (response.success) {\r\n                        self.skuPopup.modal('closeModal');\r\n                        self.setGeneralIdOwner(1, true);\r\n                    } else {\r\n                        var skuError = $('sku-error');\r\n\r\n                        if (!skuError) {\r\n                            skuError = new Element('label', {\r\n                                id : 'sku-error',\r\n                                for : 'sku',\r\n                                class: 'error',\r\n                                generated: true\r\n                            });\r\n\r\n                            $('sku').insert({after: skuError})\r\n                        }\r\n\r\n                        skuError.update(response.msg);\r\n                        skuError.show();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        openDescriptionTemplatePopUp: function (contentData) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            MessageObj.clear();\r\n\r\n            if (!$('template_description_pop_up_content')) {\r\n                $('html-body').insert({bottom: contentData});\r\n            }\r\n\r\n            self.templateDescriptionPopup = jQuery('#template_description_pop_up_content');\r\n\r\n            modal({\r\n                title: M2ePro.translator.translate('templateDescriptionPopupTitle'),\r\n                type: 'slide',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Add New Description Policy'),\r\n                    class: 'action primary ',\r\n                    click: function () {\r\n                        ListingGridHandlerObj.templateDescriptionHandler.createTemplateDescriptionInNewTab(M2ePro.url.get('newTemplateDescriptionUrl'));\r\n                    }\r\n                }]\r\n            }, self.templateDescriptionPopup);\r\n\r\n            self.templateDescriptionPopup.modal('openModal');\r\n\r\n            self.templateDescriptionPopup.productsIds = self.variationProductManagePopup.productId;\r\n            self.templateDescriptionPopup.checkIsNewAsinAccepted = 1;\r\n\r\n            self.loadTemplateDescriptionGrid();\r\n        },\r\n\r\n        loadTemplateDescriptionGrid: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/viewGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.variationProductManagePopup.productId,\r\n                    check_is_new_asin_accepted: 1,\r\n                    map_to_template_js_fn: 'ListingGridHandlerObj.variationProductManageHandler.mapToTemplateDescription'\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('template_description_grid').update(transport.responseText);\r\n                    $('template_description_grid').show();\r\n                }\r\n            });\r\n        },\r\n\r\n        mapToTemplateDescription: function (el, templateId, mapToGeneralId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/assign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.variationProductManagePopup.productId,\r\n                    template_id: templateId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n                    if (response.type == 'success') {\r\n                        self.templateDescriptionPopup.modal('closeModal');\r\n                        self.setGeneralIdOwner(1, true);\r\n                    }\r\n                }\r\n            });\r\n\r\n            self.templateDescriptionPopup.modal('closeModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        changeVariationTheme: function (el) {\r\n            var attrs = $('variation_manager_theme_attributes');\r\n            attrs.hide();\r\n            attrs.next().show();\r\n\r\n            el.hide();\r\n            el.next().show();\r\n\r\n            var channelVariationThemeNote = $('channel_variation_theme_note');\r\n            channelVariationThemeNote && channelVariationThemeNote.hide();\r\n        },\r\n\r\n        setVariationTheme: function () {\r\n            var self = this,\r\n                value = $('variation_manager_theme').value;\r\n\r\n            if (value) {\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setVariationTheme'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        product_id: self.variationProductManagePopup.productId,\r\n                        variation_theme: value\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        var response = self.parseResponse(transport);\r\n                        if (response.success) {\r\n                            self.reloadSettings();\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        },\r\n\r\n        cancelVariationTheme: function (el) {\r\n            var attrs = $('variation_manager_theme_attributes');\r\n            attrs.show();\r\n            attrs.next().hide();\r\n\r\n            el.up().previous().show();\r\n            el.up().hide();\r\n\r\n            var channelVariationThemeNote = $('channel_variation_theme_note');\r\n            channelVariationThemeNote && channelVariationThemeNote.show();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        changeMatchedAttributes: function (el) {\r\n            $$('.variation_manager_attributes_amazon_value').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            $$('.variation_manager_attributes_amazon_select').each(function (el) {\r\n                el.show();\r\n            });\r\n\r\n            el.hide();\r\n            el.next().show();\r\n            el.next().next().show();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isValidAttributes: function () {\r\n            var self = this,\r\n                existedValues = [],\r\n                isValid = true,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            if (!form || (form && form.serialize() == '')) {\r\n                return true;\r\n            }\r\n            var data = form.serialize(true);\r\n\r\n            form.select('.validation-advice').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            if (typeof data['variation_attributes[amazon_attributes][]'] == 'string') {\r\n\r\n                if (data['variation_attributes[amazon_attributes][]'] != '') {\r\n                    return true;\r\n                }\r\n\r\n                var errorEl = form.select('.validation-advice')[0];\r\n                errorEl.show();\r\n                errorEl.update(M2ePro.translator.translate('variation_manage_matched_attributes_error'));\r\n\r\n                return false;\r\n            }\r\n\r\n            var i = 0;\r\n            data['variation_attributes[amazon_attributes][]'].each(function (attrVal) {\r\n                if (attrVal != '' && existedValues.indexOf(attrVal) === -1) {\r\n                    existedValues.push(attrVal);\r\n                } else {\r\n                    isValid = false;\r\n\r\n                    var errorEl = $('variation_manager_attributes_error_' + i);\r\n                    errorEl.show();\r\n                    if (attrVal == '') {\r\n                        errorEl.update(M2ePro.translator.translate('variation_manage_matched_attributes_error'));\r\n                    } else {\r\n                        errorEl.update(M2ePro.translator.translate('variation_manage_matched_attributes_error_duplicate'))\r\n                    }\r\n                }\r\n                i++;\r\n            });\r\n\r\n            return isValid;\r\n        },\r\n\r\n        setMatchedAttributes: function () {\r\n            var self = this,\r\n                data;\r\n\r\n            if (!self.isValidAttributes()) {\r\n                return;\r\n            }\r\n\r\n            $('variation_manager_attributes_form').select('.validation-advice').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            data = $('variation_manager_attributes_form').serialize(true);\r\n            data.product_id = self.variationProductManagePopup.productId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setMatchedAttributes'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n                    if (response.success) {\r\n                        self.reloadVariationsGrid();\r\n\r\n                        if (response['vocabulary_attributes']) {\r\n                            self.openVocabularyAttributesPopUp(response['vocabulary_attributes']);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        cancelMatchedAttributes: function (el) {\r\n            $$('.variation_manager_attributes_amazon_value').each(function (el) {\r\n                el.show();\r\n            });\r\n\r\n            $$('.variation_manager_attributes_amazon_select').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            $('variation_manager_attributes_form').select('.validation-advice').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            el.hide();\r\n            el.previous().show();\r\n            el.next().hide();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesNotSetView: function (type) {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form'),\r\n                tBody = form.down('tbody');\r\n\r\n            tBody.update();\r\n\r\n            $H(self.matchedAttributes).each(function (attribute) {\r\n                var tr = new Element('tr'),\r\n                    tdLabel = new Element('td', {\r\n                        class: 'label',\r\n                        style: 'border-right: 1px solid #D6D6D6 !important;'\r\n                    }),\r\n                    label = new Element('label'),\r\n                    tdValue = new Element('td', {\r\n                        class: 'value'\r\n                    }),\r\n                    valueSpan = new Element('span', {\r\n                        style: 'color: red;'\r\n                    });\r\n\r\n                label.innerHTML = attribute.key;\r\n                valueSpan.innerHTML = M2ePro.translator.translate('not_set');\r\n\r\n                tdLabel.insert({bottom: label});\r\n                tdValue.insert({bottom: valueSpan});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tBody.insert({bottom: tr});\r\n            });\r\n\r\n            var tr = new Element('tr'),\r\n                tdBtns = new Element('td', {\r\n                    class: 'label',\r\n                    colspan: '2',\r\n                    style: 'text-align: right; border: none'\r\n                }),\r\n                setBtn = new Element('button', {class: 'action primary'});\r\n\r\n            setBtn.update(M2ePro.translator.translate('set_attributes'));\r\n            setBtn.observe('click', function (event) {\r\n                if (self.matchingType === self.MATCHING_TYPE_VIRTUAL_AMAZON) {\r\n                    self.renderMatchedAttributesVirtualAmazonView();\r\n                }\r\n\r\n                if (self.matchingType === self.MATCHING_TYPE_VIRTUAL_MAGENTO) {\r\n                    self.renderMatchedAttributesVirtualMagentoView();\r\n                }\r\n            });\r\n\r\n            tdBtns.insert({bottom: setBtn});\r\n            tr.insert({bottom: tdBtns});\r\n            tBody.insert({bottom: tr});\r\n\r\n        },\r\n\r\n        renderMatchedAttributesVirtualAmazonView: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form'),\r\n                tBody = form.down('tbody');\r\n\r\n            tBody.update();\r\n            self.selectedDestinationAttributes = [];\r\n\r\n            var prematchedAttributes = [];\r\n            var i = 0;\r\n            $H(self.matchedAttributes).each(function (attribute) {\r\n\r\n                var tr = new Element('tr'),\r\n                    tdLabel = new Element('td', {\r\n                        class: 'label value',\r\n                        style: 'border-right: 1px solid #D6D6D6 !important; vertical-align: inherit;'\r\n                    }),\r\n                    labelMagentoAttr = new Element('label', {\r\n                        class: 'magento-attribute-name'\r\n                    }),\r\n                    inputVirtualAttribute = new Element('input', {\r\n                        style: 'display: none',\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        disabled: 'disabled',\r\n                        class: 'virtual-amazon-attribute-name-value',\r\n                        name: 'variation_attributes[virtual_amazon_attributes][' + i + ']'\r\n                    }),\r\n                    selectVirtualAttributeOption = new Element('select', {\r\n                        style: 'display: none; width: 200px; margin-top: -3px',\r\n                        disabled: 'disabled',\r\n                        class: 'admin__control-select required-entry virtual-amazon-option',\r\n                        name: 'variation_attributes[virtual_amazon_option][' + i + ']'\r\n                    }),\r\n                    selectVirtualAttributeOptionGroup = new Element('optgroup', {\r\n                        label: attribute.key\r\n                    }),\r\n                    labelVirtualAttributeAndOption = new Element('span', {\r\n                        style: 'display: none; line-height: 20px; vertical-align: baseline;',\r\n                        class: 'virtual-amazon-attribute-and-option'\r\n                    }),\r\n                    spanLeftHelpIcon = new Element('span', {\r\n                        style: 'display: none',\r\n                        class: 'left-help-icon'\r\n                    }),\r\n                    tdValue = new Element('td', {\r\n                        class: 'value'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        class: 'magento-attribute-name-value',\r\n                        name: 'variation_attributes[magento_attributes][' + i + ']'\r\n                    }),\r\n                    selectAmazonAttr = new Element('select', {\r\n                        class: 'admin__control-select required-entry M2ePro-amazon-attribute-unique-value amazon-attribute-name',\r\n                        name: 'variation_attributes[amazon_attributes][' + i + ']'\r\n                    }),\r\n                    spanVirtualAttribute = new Element('span', {\r\n                        style: 'display: none; line-height: 20px; vertical-align: baseline;',\r\n                        class: 'virtual-amazon-attribute-name'\r\n                    }),\r\n                    spanRightHelpIcon = new Element('span', {\r\n                        style: 'display: none',\r\n                        class: 'right-help-icon'\r\n                    });\r\n\r\n                var helpIconTpl = $('variation_settings_form_help_icon_tpl');\r\n\r\n                spanLeftHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanLeftHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_magento_greater_left'));\r\n                spanRightHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanRightHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_magento_greater_right'));\r\n\r\n                var attributeStr = attribute.key;\r\n                if (attribute.key.length > 13) {\r\n                    attributeStr = attribute.key.substr(0, 12) + '...';\r\n                    labelVirtualAttributeAndOption.title = attribute.key;\r\n                    spanVirtualAttribute.title = attribute.key;\r\n                }\r\n\r\n                if (attribute.key.length < 31) {\r\n                    labelMagentoAttr.update(attribute.key);\r\n                } else {\r\n                    labelMagentoAttr.update(attribute.key.substr(0, 28) + '...');\r\n                    labelMagentoAttr.title = attribute.key;\r\n                }\r\n\r\n                spanVirtualAttribute.update(attributeStr + ' (<span>&ndash;</span>)');\r\n                labelVirtualAttributeAndOption.update(attributeStr + ' (<a href=\"javascript:void(0);\"></a>)');\r\n                labelVirtualAttributeAndOption.down('a').title = '';\r\n\r\n                labelVirtualAttributeAndOption.down('a').observe('click', function (event) {\r\n                    labelVirtualAttributeAndOption.hide();\r\n                    selectVirtualAttributeOption.show();\r\n                    selectVirtualAttributeOption.value = '';\r\n                    spanVirtualAttribute.down('span').update('&ndash;');\r\n                    spanVirtualAttribute.down('span').title = '';\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectAmazonAttr.insert({bottom: option});\r\n\r\n                self.destinationAttributes.each(function (destinationAttribute) {\r\n                    var option = new Element('option', {\r\n                        value: destinationAttribute\r\n                    });\r\n                    option.update(destinationAttribute);\r\n                    selectAmazonAttr.insert({bottom: option});\r\n\r\n                    if (attribute.value == destinationAttribute) {\r\n                        selectAmazonAttr.value = destinationAttribute;\r\n                        prematchedAttributes.push(selectAmazonAttr);\r\n                    }\r\n                });\r\n                selectAmazonAttr.prevValue = '';\r\n\r\n                selectAmazonAttr.observe('change', function (event) {\r\n\r\n                    var result = true;\r\n                    if (selectAmazonAttr.value != '' && inputMagentoAttr.value != selectAmazonAttr.value &&\r\n                        self.productAttributes.indexOf(selectAmazonAttr.value) !== -1) {\r\n                        result = false;\r\n\r\n                        if (attribute.value == null) {\r\n                            self.alert(M2ePro.translator.translate('duplicate_amazon_attribute_error'));\r\n                        }\r\n                        selectAmazonAttr.value = '';\r\n                    }\r\n                    attribute.value = null;\r\n\r\n                    var prevValueIndex = self.selectedDestinationAttributes.indexOf(selectAmazonAttr.prevValue);\r\n                    if (prevValueIndex > -1) {\r\n                        self.selectedDestinationAttributes.splice(prevValueIndex, 1);\r\n                    }\r\n\r\n                    if (selectAmazonAttr.value != '') {\r\n                        self.selectedDestinationAttributes.push(selectAmazonAttr.value);\r\n                    }\r\n                    selectAmazonAttr.prevValue = selectAmazonAttr.value;\r\n\r\n                    form.select('select').each(function (el) {\r\n                        result = Validation.get('M2ePro-amazon-attribute-unique-value').test($F(el), el) ? result : false;\r\n                    });\r\n\r\n                    if (result && self.selectedDestinationAttributes.length == self.destinationAttributes.length) {\r\n                        self.showVirtualAmazonAttributes();\r\n                    } else {\r\n                        self.hideVirtualAmazonAttributes();\r\n                    }\r\n                });\r\n\r\n                selectVirtualAttributeOption.observe('change', function (event) {\r\n                    var value = selectVirtualAttributeOption.value;\r\n\r\n                    labelVirtualAttributeAndOption.show();\r\n                    selectVirtualAttributeOption.hide();\r\n\r\n                    if (attributeStr.length + value.length < 28) {\r\n                        spanVirtualAttribute.down('span').update(value);\r\n                        spanVirtualAttribute.down('span').title = '';\r\n                        labelVirtualAttributeAndOption.down('a').update(value);\r\n                    } else {\r\n                        spanVirtualAttribute.down('span').update(value.substr(0, 24 - attributeStr.length) + '...');\r\n                        spanVirtualAttribute.down('span').title = value;\r\n                        labelVirtualAttributeAndOption.down('a').update(value.substr(0, 24 - attributeStr.length) + '...');\r\n                    }\r\n\r\n                    labelVirtualAttributeAndOption.down('a').title = M2ePro.translator.translate('change_option') + ' \"' + value + '\"';\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectVirtualAttributeOption.insert({bottom: option});\r\n\r\n                self.magentoVariationSet[attribute.key].each(function (optionValue) {\r\n                    var option = new Element('option', {\r\n                        value: optionValue\r\n                    });\r\n                    option.update(optionValue);\r\n                    selectVirtualAttributeOptionGroup.insert({bottom: option});\r\n                });\r\n                selectVirtualAttributeOption.insert({bottom: selectVirtualAttributeOptionGroup});\r\n\r\n                tdLabel.insert({bottom: labelMagentoAttr});\r\n                tdLabel.insert({bottom: inputVirtualAttribute});\r\n                tdLabel.insert({bottom: labelVirtualAttributeAndOption});\r\n                tdLabel.insert({bottom: selectVirtualAttributeOption});\r\n                tdLabel.insert({bottom: spanLeftHelpIcon});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: selectAmazonAttr});\r\n                tdValue.insert({bottom: spanVirtualAttribute});\r\n                tdValue.insert({bottom: spanRightHelpIcon});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tBody.insert({bottom: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            var tr = new Element('tr'),\r\n                tdBtns = new Element('td', {\r\n                    class: 'label',\r\n                    colspan: '2',\r\n                    style: 'text-align: right; border: none'\r\n                }),\r\n                cancelBtn = new Element('a', {\r\n                    href: 'javascript:void(0);',\r\n                    style: 'margin-left: 9px;'\r\n                }),\r\n                confirmBtn = new Element('button', {\r\n                    style: 'margin-left: 9px;',\r\n                    class: 'action primary'\r\n                });\r\n\r\n            cancelBtn.update(M2ePro.translator.translate('Cancel'));\r\n            confirmBtn.update(M2ePro.translator.translate('Confirm'));\r\n\r\n            cancelBtn.observe('click', function (event) {\r\n                self.renderMatchedAttributesNotSetView();\r\n            });\r\n            confirmBtn.observe('click', function (event) {\r\n                form.select('.validation-advice').each(function (el) {\r\n                    el.hide();\r\n                });\r\n\r\n                var result = true;\r\n                form.select('select').each(function (el) {\r\n                    el.classNames().each(function (className) {\r\n                        var validationResult = Validation.test(className, el);\r\n                        result = validationResult ? result : false;\r\n\r\n                        if (!validationResult) {\r\n                            throw $break;\r\n                        }\r\n                    });\r\n                });\r\n\r\n                form.select('.validation-advice').each(function (el) {\r\n                    jQuery(el).wrapInner('<label class=\"mage-error\">');\r\n                });\r\n\r\n                if (result) {\r\n                    var data = form.serialize(true);\r\n                    data.product_id = self.variationProductManagePopup.productId;\r\n\r\n                    new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setMatchedAttributes'), {\r\n                        method: 'post',\r\n                        parameters: data,\r\n                        onSuccess: function (transport) {\r\n                            var response = self.parseResponse(transport);\r\n                            if (response.success) {\r\n                                self.reloadVariationsGrid();\r\n\r\n                                if (response['vocabulary_attributes']) {\r\n                                    self.openVocabularyAttributesPopUp(response['vocabulary_attributes']);\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            tdBtns.insert({bottom: cancelBtn});\r\n            tdBtns.insert({bottom: confirmBtn});\r\n            tr.insert({bottom: tdBtns});\r\n            tBody.insert({bottom: tr});\r\n\r\n            prematchedAttributes.each(function (el) {\r\n                el.simulate('change');\r\n            });\r\n\r\n            tBody.select('.tool-tip-image').each(function (element) {\r\n                element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n                element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            });\r\n\r\n            tBody.select('.tool-tip-message').each(function (element) {\r\n                element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n                element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            });\r\n        },\r\n\r\n        showVirtualAmazonAttributes: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            var virtualAmazonAttr = form.select('select.amazon-attribute-name[value=\"\"]');\r\n            virtualAmazonAttr.each(function (el) {\r\n                el.disable().hide();\r\n\r\n                var tr = el.up('tr');\r\n                tr.down('.magento-attribute-name-value').disable();\r\n                tr.down('.virtual-amazon-attribute-name').show();\r\n                tr.down('.magento-attribute-name').hide();\r\n                tr.down('.virtual-amazon-attribute-name-value').enable();\r\n                tr.down('.virtual-amazon-option').enable().show();\r\n                tr.down('.right-help-icon').show();\r\n                tr.down('.left-help-icon').show();\r\n            });\r\n        },\r\n\r\n        hideVirtualAmazonAttributes: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            var virtualAmazonAttr = form.select('select.amazon-attribute-name[value=\"\"]');\r\n            virtualAmazonAttr.each(function (el) {\r\n                el.enable().show();\r\n\r\n                var tr = el.up('tr');\r\n                tr.down('.magento-attribute-name-value').enable();\r\n                tr.down('.virtual-amazon-attribute-name').hide();\r\n                tr.down('.magento-attribute-name').show();\r\n                tr.down('.virtual-amazon-attribute-name-value').disable();\r\n                tr.down('.virtual-amazon-option').disable().hide();\r\n                tr.down('.virtual-amazon-attribute-and-option').hide();\r\n                tr.down('.right-help-icon').hide();\r\n                tr.down('.left-help-icon').hide();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesVirtualMagentoView: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form'),\r\n                tBody = form.down('tbody');\r\n\r\n            tBody.update();\r\n\r\n            var prematchedAttributes = [];\r\n            var i = 0;\r\n            $H(self.matchedAttributes).each(function (attribute) {\r\n\r\n                var tr = new Element('tr'),\r\n                    tdLabel = new Element('td', {\r\n                        class: 'label',\r\n                        style: 'border-right: 1px solid #D6D6D6 !important;'\r\n                    }),\r\n                    labelMagentoAttr = new Element('label'),\r\n                    tdValue = new Element('td', {\r\n                        class: 'value'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        name: 'variation_attributes[magento_attributes][' + i + ']'\r\n                    }),\r\n                    selectAmazonAttr = new Element('select', {\r\n                        class: 'admin__control-select required-entry M2ePro-amazon-attribute-unique-value amazon-attribute-name',\r\n                        name: 'variation_attributes[amazon_attributes][' + i + ']'\r\n                    });\r\n\r\n                if (attribute.key.length < 31) {\r\n                    labelMagentoAttr.update(attribute.key);\r\n                } else {\r\n                    labelMagentoAttr.update(attribute.key.substr(0, 28) + '...');\r\n                    labelMagentoAttr.title = attribute.key;\r\n                }\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectAmazonAttr.insert({bottom: option});\r\n\r\n                self.destinationAttributes.each(function (destinationAttribute) {\r\n                    var option = new Element('option', {\r\n                        value: destinationAttribute\r\n                    });\r\n                    option.update(destinationAttribute);\r\n                    selectAmazonAttr.insert({bottom: option});\r\n\r\n                    if (attribute.value == destinationAttribute) {\r\n                        selectAmazonAttr.value = destinationAttribute;\r\n                        prematchedAttributes.push(selectAmazonAttr);\r\n                    }\r\n                });\r\n                selectAmazonAttr.prevValue = '';\r\n\r\n                selectAmazonAttr.observe('change', function (event) {\r\n                    var result = true;\r\n                    if (selectAmazonAttr.value != '' && inputMagentoAttr.value != selectAmazonAttr.value &&\r\n                        self.destinationAttributes.indexOf(inputMagentoAttr.value) !== -1) {\r\n                        result = false;\r\n\r\n                        if (attribute.value == null) {\r\n                            self.alert(M2ePro.translator.translate('duplicate_magento_attribute_error'));\r\n                        }\r\n                        selectAmazonAttr.value = '';\r\n                    }\r\n                    attribute.value = null;\r\n\r\n                    form.select('select.amazon-attribute-name').each(function (el) {\r\n                        el.classNames().each(function (className) {\r\n                            var v = Validation.get(className),\r\n                                validationResult = v.test($F(el), el);\r\n\r\n                            result = validationResult ? result : false;\r\n\r\n                            if (!validationResult) {\r\n                                throw $break;\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    if (result) {\r\n                        self.showVirtualMagentoAttributes(i);\r\n                    } else {\r\n                        self.hideVirtualMagentoAttributes();\r\n                    }\r\n                });\r\n\r\n                tdLabel.insert({bottom: labelMagentoAttr});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: selectAmazonAttr});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tBody.insert({bottom: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            var tr = new Element('tr', {\r\n                    class: 'buttons-row'\r\n                }),\r\n                tdBtns = new Element('td', {\r\n                    class: 'label',\r\n                    colspan: '2',\r\n                    style: 'text-align: right; border: none'\r\n                }),\r\n                cancelBtn = new Element('a', {\r\n                    href: 'javascript:void(0);',\r\n                    style: 'margin-left: 9px;'\r\n                }),\r\n                confirmBtn = new Element('button', {\r\n                    style: 'margin-left: 9px;',\r\n                    class: 'action primary'\r\n                });\r\n\r\n            cancelBtn.update(M2ePro.translator.translate('Cancel'));\r\n            confirmBtn.update(M2ePro.translator.translate('Confirm'));\r\n\r\n            cancelBtn.observe('click', function (event) {\r\n                self.renderMatchedAttributesNotSetView();\r\n            });\r\n            confirmBtn.observe('click', function (event) {\r\n                form.select('.validation-advice').each(function (el) {\r\n                    el.hide();\r\n                });\r\n\r\n                var result = true;\r\n                form.select('select', 'input').each(function (el) {\r\n                    el.classNames().each(function (className) {\r\n                        var validationResult = Validation.test(className, el);\r\n                        result = validationResult ? result : false;\r\n\r\n                        if (!validationResult) {\r\n                            throw $break;\r\n                        }\r\n                    });\r\n                });\r\n\r\n                form.select('.validation-advice').each(function (el) {\r\n                    jQuery(el).wrapInner('<label class=\"mage-error\">');\r\n                });\r\n\r\n                if (result) {\r\n                    var data = form.serialize(true);\r\n                    data.product_id = self.variationProductManagePopup.productId;\r\n\r\n                    new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setMatchedAttributes'), {\r\n                        method: 'post',\r\n                        parameters: data,\r\n                        onSuccess: function (transport) {\r\n                            var response = self.parseResponse(transport);\r\n                            if (response.success) {\r\n                                self.reloadVariationsGrid();\r\n\r\n                                if (response['vocabulary_attributes']) {\r\n                                    self.openVocabularyAttributesPopUp(response['vocabulary_attributes']);\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            tdBtns.insert({bottom: cancelBtn});\r\n            tdBtns.insert({bottom: confirmBtn});\r\n            tr.insert({bottom: tdBtns});\r\n            tBody.insert({bottom: tr});\r\n\r\n            prematchedAttributes.each(function (el) {\r\n                el.simulate('change');\r\n            });\r\n        },\r\n\r\n        showVirtualMagentoAttributes: function (lastAttributeIndex) {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form'),\r\n                buttonsRow = form.down('.buttons-row');\r\n\r\n            form.select('tr.virtual-attribute').each(function (el) {\r\n                el.remove();\r\n            });\r\n\r\n            var selectedValues = [];\r\n            form.select('select.amazon-attribute-name').each(function (el) {\r\n                selectedValues.push(el.value);\r\n            });\r\n\r\n            var i = lastAttributeIndex;\r\n            self.destinationAttributes.each(function (attribute) {\r\n                if (selectedValues.indexOf(attribute) !== -1) {\r\n                    return true;\r\n                }\r\n                var tr = new Element('tr', {\r\n                        class: 'virtual-attribute'\r\n                    }),\r\n                    tdLabel = new Element('td', {\r\n                        class: 'label',\r\n                        style: 'line-height: 26px; border-right: 1px solid #D6D6D6 !important;'\r\n                    }),\r\n                    labelMagentoAttr = new Element('label'),\r\n                    spanLeftHelpIcon = new Element('span', {\r\n                        class: 'left-help-icon'\r\n                    }),\r\n                    tdValue = new Element('td', {\r\n                        class: 'value'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute,\r\n                        type: 'hidden',\r\n                        name: 'variation_attributes[virtual_magento_attributes][' + i + ']'\r\n                    }),\r\n                    spanVirtualAttribute = new Element('span', {\r\n                        style: 'display: none'\r\n                    }),\r\n                    spanRightHelpIcon = new Element('span', {\r\n                        class: 'right-help-icon'\r\n                    });\r\n\r\n                var helpIconTpl = $('variation_settings_form_help_icon_tpl');\r\n\r\n                spanLeftHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanLeftHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_amazon_greater_left'));\r\n                spanRightHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanRightHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_amazon_greater_right'));\r\n\r\n                var attributeStr = attribute;\r\n                if (attribute.length > 13) {\r\n                    attributeStr = attribute.substr(0, 12) + '...';\r\n                    labelMagentoAttr.title = attribute;\r\n                    spanVirtualAttribute.title = attribute;\r\n                }\r\n\r\n                labelMagentoAttr.update(attributeStr + ' (<span>&ndash;</span>)');\r\n\r\n                if (self.amazonVariationSet === false) {\r\n                    spanVirtualAttribute.update(attributeStr + ' (<span></span>)');\r\n                    spanVirtualAttribute.show();\r\n\r\n                    var virtualAttrOption = new Element('input', {\r\n                        type: 'text',\r\n                        style: 'width: 153px;',\r\n                        class: 'required-entry',\r\n                        name: 'variation_attributes[virtual_magento_option][' + i + ']'\r\n                    });\r\n\r\n                    virtualAttrOption.observe('keyup', function (event) {\r\n                        var value = virtualAttrOption.value;\r\n\r\n                        if (value == '') {\r\n                            labelMagentoAttr.down('span').update('&ndash;');\r\n                            labelMagentoAttr.down('span').title = '';\r\n                            return;\r\n                        }\r\n\r\n                        if (attributeStr.length + value.length < 21) {\r\n                            labelMagentoAttr.down('span').update(value);\r\n                            labelMagentoAttr.down('span').title = '';\r\n                        } else {\r\n                            labelMagentoAttr.down('span').update(value.substr(0, 20 - attributeStr.length) + '...');\r\n                            labelMagentoAttr.down('span').title = value;\r\n                        }\r\n                    });\r\n\r\n                    labelMagentoAttr.insert({bottom: spanLeftHelpIcon});\r\n                    spanVirtualAttribute.down('span').insert({bottom: virtualAttrOption});\r\n\r\n                    tdLabel.insert({bottom: labelMagentoAttr});\r\n                    tdValue.insert({bottom: inputMagentoAttr});\r\n                    tdValue.insert({bottom: spanVirtualAttribute});\r\n                    tdValue.insert({bottom: spanRightHelpIcon});\r\n                } else {\r\n                    var virtualAttrOption = new Element('select', {\r\n                            style: 'width: 255px;',\r\n                            class: 'admin__control-select required-entry virtual-magento-option',\r\n                            name: 'variation_attributes[virtual_magento_option][' + i + ']'\r\n                        }),\r\n                        virtualAttrOptionGroup = new Element('optgroup', {\r\n                            label: attribute\r\n                        });\r\n\r\n                    spanVirtualAttribute.update(attributeStr + ' (<a href=\"javascript:void(0);\"></a>)');\r\n                    spanVirtualAttribute.down('a').title = '';\r\n\r\n                    spanVirtualAttribute.down('a').observe('click', function (event) {\r\n                        spanVirtualAttribute.hide();\r\n                        virtualAttrOption.show();\r\n                        virtualAttrOption.value = '';\r\n                        labelMagentoAttr.down('span').update('&ndash;');\r\n                        labelMagentoAttr.down('span').title = '';\r\n                    });\r\n\r\n                    var option = new Element('option', {\r\n                        value: ''\r\n                    });\r\n                    virtualAttrOption.insert({bottom: option});\r\n\r\n                    self.amazonVariationSet[attribute].each(function (optionValue) {\r\n                        var option = new Element('option', {\r\n                            value: optionValue\r\n                        });\r\n                        option.update(optionValue);\r\n                        virtualAttrOptionGroup.insert({bottom: option});\r\n                    });\r\n                    virtualAttrOption.insert({bottom: virtualAttrOptionGroup});\r\n\r\n                    virtualAttrOption.observe('change', function (event) {\r\n                        var value = virtualAttrOption.value;\r\n\r\n                        spanVirtualAttribute.show();\r\n                        virtualAttrOption.hide();\r\n\r\n                        if (attributeStr.length + value.length < 28) {\r\n                            labelMagentoAttr.down('span').update(value);\r\n                            labelMagentoAttr.down('span').title = '';\r\n                        } else {\r\n                            labelMagentoAttr.down('span').update(value.substr(0, 22 - attributeStr.length) + '...');\r\n                            labelMagentoAttr.down('span').title = value;\r\n                        }\r\n\r\n                        if (attributeStr.length + value.length < 45) {\r\n                            spanVirtualAttribute.down('a').update(value);\r\n                        } else {\r\n                            spanVirtualAttribute.down('a').update(value.substr(0, 40 - attributeStr.length) + '...');\r\n                        }\r\n                        spanVirtualAttribute.down('a').title = M2ePro.translator.translate('change_option') + ' \"' + value + '\"';\r\n                    });\r\n\r\n                    labelMagentoAttr.insert({bottom: spanLeftHelpIcon});\r\n                    tdLabel.insert({bottom: labelMagentoAttr});\r\n                    tdValue.insert({bottom: inputMagentoAttr});\r\n                    tdValue.insert({bottom: spanVirtualAttribute});\r\n                    tdValue.insert({bottom: virtualAttrOption});\r\n                    tdValue.insert({bottom: spanRightHelpIcon});\r\n                }\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                buttonsRow.insert({before: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            form.select('.tool-tip-image').each(function (element) {\r\n                element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n                element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            });\r\n\r\n            form.select('.tool-tip-message').each(function (element) {\r\n                element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n                element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            });\r\n        },\r\n\r\n        hideVirtualMagentoAttributes: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            form.select('tr.virtual-attribute').each(function (el) {\r\n                el.remove();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reloadSettings: function (callback) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/viewVariationsSettingsAjax'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: self.variationProductManagePopup.productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var response = self.parseResponse(transport);\r\n\r\n                    $('amazonVariationProductManageTabs_settings_content').update(response.html);\r\n                    self.initSettingsTab();\r\n\r\n                    var img = $('amazonVariationProductManageTabs_settings').down('img');\r\n\r\n                    img.hide();\r\n                    if (response.error_icon != '') {\r\n                        img.src = M2ePro.url.get('m2epro_skin_url') + '/images/' + response.error_icon + '.png';\r\n                        img.show();\r\n                    }\r\n\r\n                    if (callback) {\r\n                        callback.call();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        reloadVariationsGrid: function () {\r\n            ListingProductVariationManageVariationsGridObj.actionHandler.gridHandler.unselectAllAndReload();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openVariationsTab: function (createNewAsin) {\r\n            jQuery('#amazonVariationProductManageTabs').tabs('option', 'active', 0);\r\n            ListingProductVariationManageVariationsGridObj.showNewChildForm(\r\n                createNewAsin,\r\n                ListingGridHandlerObj.variationProductManageHandler.variationProductManagePopup.productId\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reloadVocabulary: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/viewVocabularyAjax'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: self.variationProductManagePopup.productId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('amazonVariationProductManageTabs_vocabulary_content').update(transport.responseText);\r\n                }\r\n            });\r\n        },\r\n\r\n        saveAutoActionSettings: function () {\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/saveAutoActionSettings'), {\r\n                method: 'post',\r\n                parameters: $('auto_action_settings_form').serialize(true)\r\n            });\r\n        },\r\n\r\n        removeAttributeFromVocabulary: function (el) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/removeAttribute'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                magento_attr: decodeHtmlentities(el.up().down('.magento-attribute-name').innerHTML),\r\n                                channel_attr: decodeHtmlentities(el.up().down('.channel-attribute-name').innerHTML)\r\n                            },\r\n                            onSuccess: function (transport) {\r\n                                self.reloadVocabulary();\r\n                            }\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        removeOptionFromVocabulary: function (el) {\r\n            var self = this,\r\n                optionGroupRowEl = el.up('.channel-attribute-options-group');\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/removeOption'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                product_option: decodeHtmlentities(optionGroupRowEl.down('.product-option').innerHTML),\r\n                                product_options_group: decodeHtmlentities(optionGroupRowEl.down('.product-options-group').innerHTML),\r\n                                channel_attr: decodeHtmlentities(optionGroupRowEl.down('.channel-attribute-name').innerHTML)\r\n                            },\r\n                            onSuccess: function (transport) {\r\n                                self.reloadVocabulary();\r\n                            }\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Variation/Manage/Tabs/Variations/Grid.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Amazon/Listing/View/Action',\r\n    'M2ePro/Amazon/Listing/Product/Template/Description'\r\n], function (MessageObj, modal) {\r\n\r\n    window.AmazonListingProductVariationManageTabsVariationsGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridId,listingId)\r\n        {\r\n            this.messageObj = Object.create(MessageObj);\r\n            this.messageObj.setContainer('#listing_product_variation_action_messages_container');\r\n\r\n            $super(gridId,listingId);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function (rowId) {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Product\\\\AbstractGrid::LISTING_PRODUCT_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('amazon_log_listing_product/index', params);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function () {\r\n            return 'amazon';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function () {\r\n            return 1000;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function ($super) {\r\n            this.actionHandler = new AmazonListingViewAction(this);\r\n\r\n            this.actions = {\r\n                listAction: this.actionHandler.listAction.bind(this.actionHandler),\r\n                relistAction: this.actionHandler.relistAction.bind(this.actionHandler),\r\n                reviseAction: this.actionHandler.reviseAction.bind(this.actionHandler),\r\n                stopAction: this.actionHandler.stopAction.bind(this.actionHandler),\r\n                stopAndRemoveAction: this.actionHandler.stopAndRemoveAction.bind(this.actionHandler),\r\n                previewItemsAction: this.actionHandler.previewItemsAction.bind(this.actionHandler),\r\n                startTranslateAction: this.actionHandler.startTranslateAction.bind(this.actionHandler),\r\n                stopTranslateAction: this.actionHandler.stopTranslateAction.bind(this.actionHandler)\r\n            };\r\n\r\n            this.templateDescriptionHandler = new AmazonListingProductTemplateDescription(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n                deleteAndRemoveAction: this.actionHandler.deleteAndRemoveAction.bind(this.actionHandler)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function ($super) {\r\n            $super();\r\n\r\n            $$('.attributes-options-filter').each(this.initAttributesOptionsFilter, this);\r\n        },\r\n\r\n        initAttributesOptionsFilter: function (filterEl) {\r\n            var srcElement = Element.down(filterEl, 'select');\r\n\r\n            srcElement.observe('change', this.onAttributesOptionsFilterChange.bind(this));\r\n\r\n            var valuesDiv = Element.down(filterEl, '.attributes-options-filter-values');\r\n            valuesDiv.optionsCount = valuesDiv.childElementCount;\r\n\r\n            if (valuesDiv.optionsCount == srcElement.childElementCount - 1) {\r\n                srcElement.hide();\r\n            }\r\n\r\n            valuesDiv.optionsIterator = 0;\r\n            valuesDiv.childElements().each(function (attrValue) {\r\n\r\n                var removeImg = Element.down(attrValue, '.filter-param-remove'),\r\n                    attrName = Element.down(attrValue, 'input[type=\"hidden\"]'),\r\n                    selectedOption = Element.down(filterEl, 'select option[value=\"' + attrName.value + '\"]');\r\n\r\n                selectedOption.hide();\r\n\r\n                valuesDiv.optionsIterator++;\r\n\r\n                removeImg.show();\r\n                removeImg.observe('click', function () {\r\n                    valuesDiv.optionsCount--;\r\n                    selectedOption.show();\r\n                    srcElement.show();\r\n                    Element.remove(attrValue);\r\n                });\r\n            }, this);\r\n        },\r\n\r\n        onAttributesOptionsFilterChange: function (e) {\r\n            var srcElement = e.target || e.srcElement,\r\n                parentDiv = Element.up(srcElement, '.attributes-options-filter'),\r\n                valuesDiv = Element.down(parentDiv, '.attributes-options-filter-values'),\r\n                selectedOption = Element.down(srcElement, '[value=\"' + srcElement.value + '\"]');\r\n\r\n            selectedOption.hide();\r\n\r\n            valuesDiv.optionsCount++;\r\n            valuesDiv.optionsIterator++;\r\n\r\n            srcElement.enable();\r\n            if (valuesDiv.optionsCount == srcElement.childElementCount - 1) {\r\n                srcElement.hide();\r\n            }\r\n\r\n            var filterName = parentDiv.id.replace('attributes-options-filter_', '');\r\n\r\n            var newOptionContainer = new Element('div'),\r\n                newOptionLabel = new Element('div'),\r\n                newOptionValue = new Element('input', {\r\n                    type: 'text',\r\n                    style: 'width: 85%;',\r\n                    name: filterName + '[' + valuesDiv.optionsIterator + '][value]'\r\n                }),\r\n                newOptionAttr = new Element('input', {\r\n                    type: 'hidden',\r\n                    name: filterName + '[' + valuesDiv.optionsIterator + '][attr]',\r\n                    value: srcElement.value\r\n                }),\r\n                removeImg = Element.clone(Element.down(parentDiv, '.attributes-options-filter-selector .filter-param-remove'));\r\n\r\n            newOptionLabel.innerHTML = srcElement.value + ': ';\r\n            removeImg.show();\r\n\r\n            Event.observe(newOptionValue, 'keypress', this.getGridObj().filterKeyPress.bind(this.getGridObj()));\r\n\r\n            newOptionContainer.insert({bottom: newOptionLabel});\r\n            newOptionContainer.insert({bottom: newOptionValue});\r\n            newOptionContainer.insert({bottom: newOptionAttr});\r\n            newOptionContainer.insert({bottom: removeImg});\r\n\r\n            valuesDiv.insert({bottom: newOptionContainer});\r\n\r\n            removeImg.observe('click', function () {\r\n                valuesDiv.optionsCount--;\r\n                selectedOption.show();\r\n                srcElement.show();\r\n                newOptionContainer.remove();\r\n            }, this);\r\n\r\n            srcElement.value = '';\r\n        },\r\n\r\n        editProductOptions: function (el, attributes, variationsTree, listingProductId) {\r\n            this.renderProductOptionsForm(el, attributes, variationsTree, listingProductId);\r\n            this.validateAttributeOptions(el, variationsTree);\r\n\r\n            var mainContainer = Element.up(el, '.product-options-main'),\r\n                listContainer = Element.down(mainContainer, '.product-options-list'),\r\n                form = mainContainer.down('.product-options-edit'),\r\n                options = form.select('select.product-option');\r\n\r\n            var productOptions = [];\r\n            listContainer.select('.attribute-row').each(function (el) {\r\n                productOptions.push(el.down('.value').innerHTML);\r\n            });\r\n\r\n            var i = 0;\r\n            options.each(function (el) {\r\n                el.setValue(productOptions[i]).simulate('change');\r\n                i++;\r\n            });\r\n        },\r\n\r\n        renderProductOptionsForm: function (el, attributes, variationsTree, listingProductId) {\r\n            var mainContainer = Element.up(el, '.product-options-main'),\r\n                editContainer = Element.down(mainContainer, '.product-options-edit'),\r\n                listContainer = Element.down(mainContainer, '.product-options-list'),\r\n                self = this;\r\n\r\n            el.hide();\r\n            listContainer && listContainer.hide();\r\n\r\n            for (var i = 0; i < attributes.length; i++) {\r\n\r\n                var optionContainer = new Element('div'),\r\n                    optionLabel = new Element('div'),\r\n                    optionValue = new Element('select', {\r\n                        class: 'product-option admin__control-select',\r\n                        style: 'width: 100%',\r\n                        name: 'product_options[values][]'\r\n                    }),\r\n                    optionAttr = new Element('input', {\r\n                        class: 'product-attribute',\r\n                        type: 'hidden',\r\n                        name: 'product_options[attr][]',\r\n                        value: attributes[i]\r\n                    });\r\n\r\n                optionLabel.update(attributes[i] + ': ');\r\n                optionValue.observe('change', function () {\r\n                    self.validateAttributeOptions(el, variationsTree);\r\n                });\r\n\r\n                optionContainer.insert({bottom: optionLabel});\r\n                optionContainer.insert({bottom: optionValue});\r\n                optionContainer.insert({bottom: optionAttr});\r\n\r\n                editContainer.insert({bottom: optionContainer});\r\n            }\r\n\r\n            var confirmBtn = new Element('button', {\r\n                    class: 'action primary confirm-btn',\r\n                    style: 'font-size: 1.1rem; margin-top: 8px; margin-right: 9px;'\r\n                }),\r\n                cancelBtn = new Element('a', {\r\n                    href: 'javascript:void(0);',\r\n                    class: 'scalable',\r\n                    style: 'line-height: 27px; margin: 7px 8px;'\r\n                }),\r\n                listingProductIdEl = new Element('input', {\r\n                    type: 'hidden',\r\n                    name: 'product_id',\r\n                    value: listingProductId\r\n                }),\r\n                errorMsg = new Element('p', {\r\n                    class: 'error',\r\n                    style: 'display: none;'\r\n                });\r\n\r\n            confirmBtn.update(M2ePro.translator.translate('Confirm'));\r\n            confirmBtn.observe('click', function (event) {\r\n                event.stop();\r\n                var data = editContainer.serialize(true);\r\n\r\n                if (!self.validateAttributeOptions(el, variationsTree)) {\r\n                    var errorMsg = editContainer.down('p.error');\r\n                    errorMsg.show();\r\n                    errorMsg.innerHTML = M2ePro.translator.translate('error_changing_product_options');\r\n                    return;\r\n                }\r\n\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setChildListingProductOptions'), {\r\n                    method: 'post',\r\n                    parameters: data,\r\n                    onSuccess: function (transport) {\r\n\r\n                        var response = self.parseResponse(transport);\r\n\r\n                        if (response['vocabulary_attribute_options']) {\r\n                            ListingGridHandlerObj.variationProductManageHandler.openVocabularyOptionsPopUp(response['vocabulary_attribute_options']);\r\n                            return;\r\n                        }\r\n\r\n                        if (response.success) {\r\n                            self.actionHandler.gridHandler.unselectAllAndReload();\r\n                        }\r\n                    }\r\n                });\r\n\r\n                el.show();\r\n                listContainer && listContainer.show();\r\n                editContainer.childElements().each(Element.remove);\r\n            });\r\n\r\n            cancelBtn.update(M2ePro.translator.translate('Cancel'));\r\n            cancelBtn.observe('click', function (event) {\r\n                event.stop();\r\n                el.show();\r\n                listContainer && listContainer.show();\r\n                editContainer.childElements().each(Element.remove);\r\n            });\r\n\r\n            editContainer.insert({bottom: listingProductIdEl});\r\n            editContainer.insert({bottom: errorMsg});\r\n            editContainer.insert({bottom: cancelBtn});\r\n            editContainer.insert({bottom: confirmBtn});\r\n        },\r\n\r\n        validateAttributeOptions: function (el, variations, i) {\r\n            var variation = $H(variations),\r\n                mainContainer = Element.up(el, '.product-options-main'),\r\n                form = mainContainer.down('.product-options-edit'),\r\n                attributes = form.select('input.product-attribute'),\r\n                options = form.select('select.product-option'),\r\n\r\n                index = i || 0,\r\n                valid = false;\r\n\r\n            if (index === 0) {\r\n                options.each(function (el) {\r\n                    el.disable();\r\n                });\r\n            }\r\n\r\n            if (!attributes[index] || !options[index]) {\r\n                if (variation.size() === 0) {\r\n                    valid = true;\r\n                    options.each(function (el) {\r\n                        if (el.value == '') {\r\n                            valid = false;\r\n                            throw $break;\r\n                        }\r\n                    });\r\n\r\n                    return valid;\r\n                }\r\n            }\r\n\r\n            var attr = variation.keys()[0];\r\n            attributes[index].value = attr;\r\n\r\n            var oldValue = options[index].value;\r\n            options[index].update();\r\n            options[index].enable();\r\n            options[index].appendChild(new Element('option', {style: 'display: none'}));\r\n\r\n            $H(variation.get(attr)).each(function (option) {\r\n                options[index].appendChild(new Element('option', {value: option[0]})).insert(option[0]);\r\n\r\n                if (option[0] == oldValue) {\r\n                    options[index].value = oldValue;\r\n                }\r\n            });\r\n\r\n            if (oldValue && variation.get(attr)[oldValue]) {\r\n                index++;\r\n                valid = this.validateAttributeOptions(el, variation.get(attr)[oldValue], index);\r\n            }\r\n\r\n            return valid;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showNewChildForm: function (createNewAsin, productId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/getNewChildForm'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('variation_manager_product_options_form_container');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.newChildPopup = jQuery('#variation_manager_product_options_form_container');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Add New Child Product'),\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            click: function () {\r\n                                self.newChildPopup.modal('closeModal')\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action primary ',\r\n                            click: function () {\r\n                                self.addNewChildProduct();\r\n                                self.newChildPopup.modal('closeModal')\r\n                            }\r\n                        }]\r\n                    }, self.newChildPopup);\r\n\r\n                    self.newChildPopup.modal('openModal');\r\n\r\n                    $$('#manage_variations_new_child_product_variation select').each(function (el) {\r\n                        el.select('option').invoke('remove');\r\n                    });\r\n\r\n                    $$('#manage_variations_new_child_channel_variation select').each(function (el) {\r\n                        el.select('option').invoke('remove');\r\n                    });\r\n\r\n                    $('new_child_product_product_options_error').hide();\r\n                    $('new_child_product_channel_options_error').hide();\r\n\r\n                    self.validateNewChildAttributeOptions('product');\r\n                    self.validateNewChildAttributeOptions('channel');\r\n\r\n                    if (createNewAsin) {\r\n                        self.createNewAsinBtn();\r\n                    } else {\r\n                        self.selectOptionsBtn();\r\n                    }\r\n\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validateNewChildAttributeOptions: function (type, variations, i) {\r\n            if (!$('variation_manager_unused_' + type + '_variations_tree')) {\r\n                return true;\r\n            }\r\n\r\n            var variation = $H(variations || decodeHtmlentities($('variation_manager_unused_' + type + '_variations_tree').innerHTML).evalJSON()),\r\n                attributes = $$('.new-child-' + type + '-attribute'),\r\n                options = $$('.new-child-' + type + '-option'),\r\n                index = i || 0,\r\n                valid = false;\r\n\r\n            if (type == 'product') {\r\n                var channelOptions = $$('.new-child-channel-option'),\r\n                    formData = $('variation_manager_product_options_form').serialize(true);\r\n            }\r\n\r\n            if (index === 0) {\r\n                options.each(function (el) {\r\n                    el.disable();\r\n                });\r\n            }\r\n\r\n            if (!attributes[index] || !options[index]) {\r\n                if (variation.size() === 0) {\r\n                    valid = this.validateNewChild();\r\n                }\r\n                return valid;\r\n            }\r\n\r\n            var attr = variation.keys()[0];\r\n            attributes[index].value = attr;\r\n\r\n            var oldValue = options[index].value;\r\n            options[index].update();\r\n            options[index].enable();\r\n            options[index].appendChild(new Element('option', {style: 'display: none'}));\r\n\r\n            if (type == 'product' && formData.create_new_asin == 1) {\r\n                var channelEl = $('new_child_product_channel_option_' + index);\r\n\r\n                channelEl.update();\r\n                channelEl.appendChild(new Element('option', {value: oldValue})).insert(oldValue);\r\n                channelEl.value = oldValue;\r\n            }\r\n\r\n            $H(variation.get(attr)).each(function (option) {\r\n                options[index].appendChild(new Element('option', {value: option[0]})).insert(option[0]);\r\n\r\n                if (option[0] == oldValue) {\r\n                    options[index].value = oldValue;\r\n                }\r\n            });\r\n\r\n            if (oldValue) {\r\n                index++;\r\n                valid = this.validateNewChildAttributeOptions(type, variation.get(attr)[oldValue], index);\r\n            }\r\n\r\n            return valid;\r\n        },\r\n\r\n        validateNewChild: function (showErrors) {\r\n            var data = $('variation_manager_product_options_form').serialize(true),\r\n                valid = true;\r\n\r\n            $('new_child_product_product_options_error').hide();\r\n            $$('#manage_variations_new_child_product_variation select').each(function (el) {\r\n                if (el.value == '') {\r\n                    showErrors && $('new_child_product_product_options_error').show();\r\n                    valid = false;\r\n                    throw $break;\r\n                }\r\n            });\r\n\r\n            if (data.create_new_asin != 1) {\r\n                $('new_child_product_channel_options_error').hide();\r\n                $$('#manage_variations_new_child_channel_variation select').each(function (el) {\r\n                    if (el.value == '') {\r\n                        showErrors && $('new_child_product_channel_options_error').show();\r\n                        valid = false;\r\n                        throw $break;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return valid;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addNewChildProduct: function () {\r\n            var self = this,\r\n                data;\r\n\r\n            if (!self.validateNewChild(true)) {\r\n                return;\r\n            }\r\n\r\n            data = $('variation_manager_product_options_form').serialize(true);\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/createNewChild'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n                    if (response.msg) {\r\n                        self.messageObj.clear();\r\n                        self.messageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.msg);\r\n                    }\r\n\r\n                    if (response['vocabulary_attribute_options']) {\r\n                        ListingGridHandlerObj.variationProductManageHandler.openVocabularyOptionsPopUp(response['vocabulary_attribute_options']);\r\n                        return;\r\n                    }\r\n\r\n                    self.actionHandler.gridHandler.unselectAllAndReload();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        createNewAsinBtn: function () {\r\n            var optEl = $('manage_variations_select_options'),\r\n                newAsinLinkEl = $('manage_variations_create_new_asin');\r\n\r\n            optEl && optEl.show().down('input').enable();\r\n\r\n            $('new_child_product_channel_options_error_row').setStyle({visibility: 'hidden'});\r\n            newAsinLinkEl && newAsinLinkEl.hide();\r\n\r\n            $$('.new-child-channel-option').each(function (el) {\r\n                el.disable();\r\n            });\r\n\r\n            $('manage_variations_create_new_asin_title').show();\r\n\r\n            ListingProductVariationManageVariationsGridObj.validateNewChildAttributeOptions('product');\r\n        },\r\n\r\n        selectOptionsBtn: function () {\r\n            var optEl = $('manage_variations_select_options'),\r\n                newAsinEl = $('manage_variations_create_new_asin');\r\n\r\n            optEl && optEl.hide().down('input').disable();\r\n\r\n            $('new_child_product_channel_options_error_row').setStyle({visibility: 'visible'});\r\n            newAsinEl && newAsinEl.show();\r\n\r\n            $$('.new-child-channel-option').each(function (el) {\r\n                el.enable();\r\n                el.update();\r\n            });\r\n\r\n            $('manage_variations_create_new_asin_title').hide();\r\n\r\n            ListingProductVariationManageVariationsGridObj.validateNewChildAttributeOptions('channel');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unselectAllAndReload: function ($super) {\r\n            $super();\r\n\r\n            ListingGridHandlerObj.variationProductManageHandler.reloadSettings(null);\r\n            ListingGridHandlerObj.variationProductManageHandler.reloadVocabulary(null);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/View/Action.js":"define([\r\n    'M2ePro/Listing/View/Action'\r\n], function () {\r\n\r\n    window.AmazonListingViewAction = Class.create(ListingViewAction, {\r\n\r\n        // ---------------------------------------\r\n\r\n        deleteAndRemoveAction: function () {\r\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts();\r\n            if (selectedProductsParts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            this.startActions(\r\n                M2ePro.translator.translate('deleting_and_removing_selected_items_message'),\r\n                M2ePro.url.get('runDeleteAndRemoveProducts'),\r\n                selectedProductsParts\r\n            );\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/View/Fulfillment.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (MessageObj) {\r\n\r\n    window.AmazonListingViewFulfillment = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        switchToAFN: function (productsIds) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_fulfillment/switchToAFN'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        switchToMFN: function (productsIds) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_fulfillment/switchToMFN'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/View/Grid.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Listing/Moving',\r\n    'M2ePro/Amazon/Listing/View/Action',\r\n    'M2ePro/Amazon/Listing/View/Fulfillment',\r\n    'M2ePro/Amazon/Listing/Product/Repricing',\r\n    'M2ePro/Amazon/Listing/Product/Search',\r\n    'M2ePro/Amazon/Listing/Product/Template/Description',\r\n    'M2ePro/Amazon/Listing/Product/Template/Shipping',\r\n    'M2ePro/Amazon/Listing/Product/Template/ProductTaxCode',\r\n    'M2ePro/Amazon/Listing/Product/Variation/Manage'\r\n], function (MessageObj) {\r\n\r\n    window.AmazonListingViewGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function (rowId) {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Product\\\\AbstractGrid::LISTING_PRODUCT_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('amazon_log_listing_product/index', params);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function()\r\n        {\r\n            return 10;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function($super)\r\n        {\r\n            this.actionHandler = new AmazonListingViewAction(this);\r\n\r\n            this.actions = {\r\n                listAction: this.actionHandler.listAction.bind(this.actionHandler),\r\n                relistAction: this.actionHandler.relistAction.bind(this.actionHandler),\r\n                reviseAction: this.actionHandler.reviseAction.bind(this.actionHandler),\r\n                stopAction: this.actionHandler.stopAction.bind(this.actionHandler),\r\n                stopAndRemoveAction: this.actionHandler.stopAndRemoveAction.bind(this.actionHandler),\r\n                previewItemsAction: this.actionHandler.previewItemsAction.bind(this.actionHandler),\r\n                startTranslateAction: this.actionHandler.startTranslateAction.bind(this.actionHandler),\r\n                stopTranslateAction: this.actionHandler.stopTranslateAction.bind(this.actionHandler)\r\n            };\r\n\r\n            this.movingHandler = new ListingMoving(this);\r\n            this.productSearchHandler = new AmazonListingProductSearch(this);\r\n\r\n            this.templateDescriptionHandler    = new AmazonListingProductTemplateDescription(this);\r\n            this.templateShippingHandler       = new AmazonListingProductTemplateShipping(this);\r\n            this.templateProductTaxCodeHandler = new AmazonListingProductTemplateProductTaxCode(this);\r\n\r\n            this.variationProductManageHandler = new AmazonListingProductVariationManage(this);\r\n            this.fulfillmentHandler = new AmazonListingViewFulfillment(this);\r\n            this.repricingHandler = new AmazonListingProductRepricing(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n                duplicateAction: this.duplicateProducts.bind(this),\r\n                movingAction: this.movingHandler.run.bind(this.movingHandler),\r\n                deleteAndRemoveAction: this.actionHandler.deleteAndRemoveAction.bind(this.actionHandler),\r\n\r\n                assignTemplateDescriptionIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateDescriptionHandler.validateProductsForTemplateDescriptionAssign(id)\r\n                }).bind(this),\r\n                unassignTemplateDescriptionIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateDescriptionHandler.unassignFromTemplateDescription(id)\r\n                }).bind(this),\r\n\r\n                assignTemplateShippingTemplateIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateShippingHandler.openPopUp(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_TEMPLATE'))\r\n                }).bind(this),\r\n                unassignTemplateShippingTemplateIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateShippingHandler.unassign(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_TEMPLATE'))\r\n                }).bind(this),\r\n\r\n                assignTemplateShippingOverrideIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateShippingHandler.openPopUp(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE'))\r\n                }).bind(this),\r\n                unassignTemplateShippingOverrideIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateShippingHandler.unassign(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE'))\r\n                }).bind(this),\r\n\r\n                assignTemplateProductTaxCodeIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateProductTaxCodeHandler.openPopUp(id)\r\n                }).bind(this),\r\n                unassignTemplateProductTaxCodeIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateProductTaxCodeHandler.unassign(id)\r\n                }).bind(this),\r\n\r\n                switchToAfnAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.fulfillmentHandler.switchToAFN(id);\r\n                }).bind(this),\r\n                switchToMfnAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.fulfillmentHandler.switchToMFN(id);\r\n                }).bind(this),\r\n\r\n                addToRepricingAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.repricingHandler.addToRepricing(id);\r\n                }).bind(this),\r\n                showDetailsAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.repricingHandler.showDetails(id);\r\n                }).bind(this),\r\n                editRepricingAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.repricingHandler.editRepricing(id);\r\n                }).bind(this),\r\n                removeFromRepricingAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.repricingHandler.removeFromRepricing(id);\r\n                }).bind(this),\r\n\r\n                assignGeneralIdAction: (function() { this.productSearchHandler.searchGeneralIdAuto(this.getSelectedProductsString())}).bind(this),\r\n                newGeneralIdAction: (function() { this.productSearchHandler.addNewGeneralId(this.getSelectedProductsString())}).bind(this),\r\n                unassignGeneralIdAction: (function() { this.productSearchHandler.unmapFromGeneralId(this.getSelectedProductsString())}).bind(this)\r\n\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateProducts: function () {\r\n            this.scrollPageToTop();\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing/duplicateProducts'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    ids: this.getSelectedProductsString()\r\n                },\r\n                onSuccess: (function (transport) {\r\n\r\n                    try {\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n\r\n                        if (response.type != 'error') {\r\n                            this.unselectAllAndReload();\r\n                        }\r\n\r\n                    } catch (e) {\r\n                        MessageObj.addErrorMessage('Internal Error.');\r\n                    }\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unassignTemplateDescriptionIdActionConfrim: function (id)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.templateDescriptionHandler.unassignFromTemplateDescription(id);\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unassignTemplateShippingTemplateIdActionConfrim: function (id)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.templateShippingHandler.unassign(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_TEMPLATE'));\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        unassignTemplateShippingOverrideIdActionConfrim: function (id)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.templateShippingHandler.unassign(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE'));\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        unassignTemplateProductTaxCodeIdActionConfrim: function (id)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.templateProductTaxCodeHandler.unassign(id);\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Template/Edit.js":"define([\r\n    'M2ePro/Template/Edit'\r\n], function () {\r\n\r\n    window.AmazonTemplateEdit = Class.create(TemplateEdit, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function()\r\n        {\r\n            return 'amazon';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveAndCloseClick: function(confirmText, templateNick)\r\n        {\r\n            if (!this.isValidForm()) {\r\n                return;\r\n            }\r\n\r\n            if (confirmText && this.showConfirmMsg) {\r\n                this.confirm(templateNick, confirmText, this.saveFormUsingAjax);\r\n                return;\r\n            }\r\n\r\n            this.saveFormUsingAjax();\r\n        },\r\n\r\n        saveFormUsingAjax: function ()\r\n        {\r\n            new Ajax.Request(M2ePro.url.get('formSubmit'), {\r\n                method: 'post',\r\n                parameters: Form.serialize($('edit_form')),\r\n                onSuccess: function(transport) {\r\n                    var result = transport.responseText.evalJSON();\r\n\r\n                    if (result.status) {\r\n                        window.close();\r\n                    } else {\r\n                        console.error('Policy Saving Error');\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/ProductTaxCode.js":"define([\r\n    'M2ePro/Amazon/Template/Edit'\r\n], function () {\r\n\r\n    window.AmazonTemplateProductTaxCode = Class.create(AmazonTemplateEdit, {\r\n\r\n        rulesIndex: 0,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ProductTaxCode', 'title', 'id',\r\n                M2ePro.formData.id);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function($headId)\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ProductTaxCode', 'title', 'id', '');\r\n\r\n            CommonObj.duplicateClick($headId, M2ePro.translator.translate('Add Product Tax Code Policy'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initObservers: function()\r\n        {\r\n            $('product_tax_code_mode')\r\n                .observe('change', AmazonTemplateProductTaxCodeObj.productTaxCodeModeChange)\r\n                .simulate('change');\r\n        },\r\n\r\n        productTaxCodeModeChange: function()\r\n        {\r\n            $('product_tax_code_custom_value_tr').hide();\r\n            $('product_tax_code_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ProductTaxCode::PRODUCT_TAX_CODE_MODE_VALUE')) {\r\n                $('product_tax_code_custom_value_tr').show();\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ProductTaxCode::PRODUCT_TAX_CODE_MODE_ATTRIBUTE')) {\r\n                AmazonTemplateProductTaxCodeObj.updateHiddenValue(this, $('product_tax_code_attribute'));\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/SellingFormat.js":"define([\r\n    'jquery',\r\n    'M2ePro/Amazon/Template/Edit'\r\n], function (jQuery) {\r\n\r\n    window.AmazonTemplateSellingFormat = Class.create(AmazonTemplateEdit, {\r\n\r\n        discountRulesCount: 0,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            var self = this;\r\n            this.setValidationCheckRepetitionValue('M2ePro-price-tpl-title',\r\n                                                    M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                                                    'Template\\\\SellingFormat', 'title', 'id',\r\n                                                    M2ePro.formData.id,\r\n                                                    M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-price-coefficient', function(value) {\r\n\r\n                if (value == '') {\r\n                    return true;\r\n                }\r\n\r\n                if (value == '0' || value == '0%') {\r\n                    return false;\r\n                }\r\n\r\n                return value.match(/^[+-]?\\d+[.]?\\d*[%]?$/g);\r\n            }, M2ePro.translator.translate('Coefficient is not valid.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-qty', function(value, el) {\r\n\r\n                if (self.isElementHiddenFromPage(el)) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.match(/[^\\d]+/g)) {\r\n                    return false;\r\n                }\r\n\r\n                if (value <= 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Wrong value. Only integer numbers.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-vat-percent', function(value) {\r\n\r\n                if (value.length > 6) {\r\n                    return false;\r\n                }\r\n\r\n                if (value < 0) {\r\n                    return false;\r\n                }\r\n\r\n                value = Math.ceil(value);\r\n\r\n                return value > 0 && value <= 30;\r\n            }, M2ePro.translator.translate('Wrong value. Must be no more than 30. Max applicable length is 6 characters, including the decimal (e.g., 12.345).'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-date-range-to', function(value) {\r\n\r\n                var fromTime = $('regular_sale_price_start_date_value'),\r\n                    toTime = $('regular_sale_price_end_date_value');\r\n\r\n                if (fromTime.value == '' || toTime.value == '' ||\r\n                    !jQuery(fromTime).is(':visible') || !jQuery(toTime).is(':visible')) {\r\n                    return true;\r\n                }\r\n\r\n                fromTime = new Date(fromTime.value);\r\n                toTime = new Date(toTime.value);\r\n\r\n                if (!fromTime || !toTime) {\r\n                    return true;\r\n                }\r\n\r\n                return toTime.getTime() > fromTime.getTime();\r\n            }, M2ePro.translator.translate('Wrong date range.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-customer-allowed-types', function(value, element) {\r\n                return !(\r\n                    $('is_regular_customer_allowed').value == 0 &&\r\n                    $('is_business_customer_allowed').value == 0\r\n                );\r\n            }, M2ePro.translator.translate('At least one Selling Type should be enabled.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-business-discount-availability', function(value, element) {\r\n                if (!$('is_business_customer_allowed') || $('is_business_customer_allowed').value == 0 ||\r\n                    element.value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_SellingFormat::BUSINESS_DISCOUNTS_MODE_CUSTOM_VALUE')\r\n                ) {\r\n                    return true;\r\n                }\r\n\r\n                return $$('#business_discounts_custom_value_discount_table_tbody .business-discount-rule').length > 0;\r\n            }, M2ePro.translator.translate('You should add at least one Discount Rule.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-business-discount-qty-unique', function(value, element) {\r\n                return !(element.up('tbody').select('.M2ePro-business-discount-qty-unique[value=\"' + value + '\"]').length > 1);\r\n            }, M2ePro.translator.translate('The Quantity value should be unique.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-business-discount-attribute-coefficient-unique', function(value, element) {\r\n                if (Validation.get('IsEmpty').test(value)) {\r\n                    return true;\r\n                }\r\n\r\n                var similarValues;\r\n\r\n                if (value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                    var attribute = element.up('tr').down('.business-discount-attribute').value;\r\n                    similarValues = element.up('tbody').select('.business-discount-attribute[value=\"' + attribute + '\"]');\r\n                } else {\r\n                    similarValues = element.up('tbody').select('.M2ePro-business-discount-attribute-coefficient-unique[value=\"' + value + '\"]');\r\n                }\r\n\r\n                if (similarValues.length === 1) {\r\n                    return true;\r\n                }\r\n\r\n                var coefficientValue = element.up('tr').down('.business-discount-coefficient').value;\r\n                var similarValues = similarValues.filter(function(el) {\r\n                    return el.up('tr').down('.business-discount-coefficient').value == coefficientValue\r\n                });\r\n\r\n                return !(similarValues.length > 1);\r\n            }, M2ePro.translator.translate('You should specify a unique pair of Magento Attribute and Price Change value for each Discount Rule.'));\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            if ($('is_regular_customer_allowed')) {\r\n                $('is_regular_customer_allowed')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.is_regular_customer_allowed_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('is_business_customer_allowed')) {\r\n                $('is_business_customer_allowed')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.is_business_customer_allowed_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            $('qty_mode')\r\n                .observe('change', AmazonTemplateSellingFormatObj.qty_mode_change)\r\n                .simulate('change');\r\n\r\n            $('qty_modification_mode')\r\n                .observe('change', AmazonTemplateSellingFormatObj.qtyPostedMode_change)\r\n                .simulate('change');\r\n\r\n            if ($('regular_price_mode')) {\r\n                $('regular_price_mode')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.regular_price_mode_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('regular_map_price_mode')) {\r\n                $('regular_map_price_mode')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.regular_map_price_mode_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('regular_sale_price_start_date_mode')) {\r\n                $('regular_sale_price_start_date_mode')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.regular_sale_price_start_date_mode_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('regular_sale_price_end_date_mode')) {\r\n                $('regular_sale_price_end_date_mode')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.regular_sale_price_end_date_mode_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('regular_sale_price_mode')) {\r\n                $('regular_sale_price_mode')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.regular_sale_price_mode_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('regular_price_increase_vat_percent')) {\r\n                $('regular_price_increase_vat_percent')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.regular_price_increase_vat_percent_mode_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('business_price_mode')) {\r\n                $('business_price_mode')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.business_price_mode_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('business_price_increase_vat_percent')) {\r\n                $('business_price_increase_vat_percent')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.business_price_increase_vat_percent_mode_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('business_discounts_mode')) {\r\n                $('business_discounts_mode')\r\n                    .observe('change', AmazonTemplateSellingFormatObj.business_discounts_mode_change)\r\n                    .simulate('change');\r\n            }\r\n\r\n            if ($('business_discounts_custom_value_discount_table_tbody')) {\r\n                $('business_discounts_custom_value_discount_table_tbody').on(\r\n                    'change', 'select.business-discount-mode', AmazonTemplateSellingFormatObj.business_discount_price_mode_change\r\n                );\r\n            }\r\n\r\n            if ($('business_discounts_mode')) {\r\n                AmazonTemplateSellingFormatObj.renderDiscountRules(M2ePro.formData.discount_rules);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function($super, $headId)\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-price-tpl-title',\r\n                                                    M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                                                    'Template\\\\SellingFormat', 'title', '','',\r\n                                                    M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK'));\r\n\r\n            $super($headId, M2ePro.translator.translate('Add Price, Quantity and Format Policy'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        qty_mode_change: function()\r\n        {\r\n            $('qty_custom_value_tr', 'qty_percentage_tr', 'qty_modification_mode_tr').invoke('hide');\r\n\r\n            $('qty_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_NUMBER')) {\r\n                $('qty_custom_value_tr').show();\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_ATTRIBUTE')) {\r\n                AmazonTemplateSellingFormatObj.updateHiddenValue(this, $('qty_custom_attribute'));\r\n            }\r\n\r\n            $('qty_modification_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_SellingFormat::QTY_MODIFICATION_MODE_OFF');\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_PRODUCT') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_ATTRIBUTE') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_PRODUCT_FIXED')) {\r\n\r\n                $('qty_modification_mode_tr').show();\r\n\r\n                $('qty_modification_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_SellingFormat::QTY_MODIFICATION_MODE_ON');\r\n\r\n                if (M2ePro.formData.qty_mode == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_PRODUCT') ||\r\n                    M2ePro.formData.qty_mode == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_ATTRIBUTE') ||\r\n                    M2ePro.formData.qty_mode == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_PRODUCT_FIXED')) {\r\n                    $('qty_modification_mode').value = M2ePro.formData.qty_modification_mode;\r\n                }\r\n            }\r\n\r\n            $('qty_modification_mode').simulate('change');\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_PRODUCT') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_ATTRIBUTE') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::QTY_MODE_PRODUCT_FIXED')) {\r\n\r\n                $('qty_percentage_tr').show();\r\n            }\r\n        },\r\n\r\n        qtyPostedMode_change: function()\r\n        {\r\n            $('qty_min_posted_value_tr').hide();\r\n            $('qty_max_posted_value_tr').hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_SellingFormat::QTY_MODIFICATION_MODE_ON')) {\r\n                $('qty_min_posted_value_tr').show();\r\n                $('qty_max_posted_value_tr').show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        regular_price_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateSellingFormatObj;\r\n\r\n            $('regular_price_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('regular_price_custom_attribute'));\r\n            }\r\n\r\n            $('regular_price_note').innerHTML = M2ePro.translator.translate('Product Price for Amazon Listing(s).');\r\n        },\r\n\r\n        regular_map_price_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateSellingFormatObj;\r\n\r\n            $('regular_map_price_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('regular_map_price_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        regular_sale_price_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateSellingFormatObj;\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::PRICE_MODE_NONE')) {\r\n\r\n                $('regular_sale_price_start_date_mode_tr', 'regular_sale_price_end_date_mode_tr', 'regular_sale_price_coefficient_td').invoke('hide');\r\n                $('regular_sale_price_start_date_value_tr', 'regular_sale_price_end_date_value_tr').invoke('hide');\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::PRICE_MODE_SPECIAL')) {\r\n                $('regular_sale_price_coefficient_td').show();\r\n                $('regular_sale_price_start_date_mode_tr', 'regular_sale_price_end_date_mode_tr').invoke('hide');\r\n                $('regular_sale_price_start_date_value_tr', 'regular_sale_price_end_date_value_tr').invoke('hide');\r\n            } else {\r\n                $('regular_sale_price_start_date_mode_tr', 'regular_sale_price_end_date_mode_tr', 'regular_sale_price_coefficient_td').invoke('show');\r\n                $('regular_sale_price_start_date_mode').simulate('change');\r\n                $('regular_sale_price_end_date_mode').simulate('change');\r\n            }\r\n\r\n            $('regular_sale_price_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('regular_sale_price_custom_attribute'));\r\n            }\r\n\r\n            $('regular_sale_price_note').innerHTML = M2ePro.translator.translate('The Price, at which you want to sell your Product(s) at specific time.');\r\n        },\r\n\r\n        regular_sale_price_start_date_mode_change: function()\r\n        {\r\n            $('regular_sale_price_start_date_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_SellingFormat::DATE_VALUE')) {\r\n                $('regular_sale_price_start_date_value_tr').show();\r\n            } else {\r\n                $('regular_sale_price_start_date_value_tr').hide();\r\n                AmazonTemplateSellingFormatObj.updateHiddenValue(this, $('regular_sale_price_start_date_custom_attribute'));\r\n            }\r\n\r\n        },\r\n\r\n        regular_sale_price_end_date_mode_change: function()\r\n        {\r\n            $('regular_sale_price_end_date_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_SellingFormat::DATE_VALUE')) {\r\n                $('regular_sale_price_end_date_value_tr').show();\r\n            } else {\r\n                $('regular_sale_price_end_date_value_tr').hide();\r\n                AmazonTemplateSellingFormatObj.updateHiddenValue(this, $('regular_sale_price_end_date_custom_attribute'));\r\n            }\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        regular_price_increase_vat_percent_mode_change: function()\r\n        {\r\n            var vatPercentTr = $('regular_price_vat_percent_tr'),\r\n                vatPercent = $('regular_price_vat_percent');\r\n\r\n            vatPercentTr.hide();\r\n            vatPercent.removeClassName('M2ePro-validate-vat-percent');\r\n            vatPercent.removeClassName('required-entry');\r\n\r\n            if (+this.value) {\r\n                vatPercentTr.show();\r\n                vatPercent.addClassName('M2ePro-validate-vat-percent');\r\n                vatPercent.addClassName('required-entry');\r\n            } else {\r\n                vatPercent.value = '';\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        // Business ------------------------------\r\n        // ---------------------------------------\r\n\r\n        is_regular_customer_allowed_change: function ()\r\n        {\r\n            var regularCustomer = $('is_regular_customer_allowed'),\r\n                businessCustomer = $('is_regular_customer_allowed'),\r\n                regularBlock = $('magento_block_amazon_template_selling_format_prices');\r\n\r\n            regularBlock.hide();\r\n            if (regularCustomer.value == 1){\r\n                regularBlock.show();\r\n            }\r\n        },\r\n\r\n        is_business_customer_allowed_change: function ()\r\n        {\r\n            var businessCustomer = $('is_business_customer_allowed'),\r\n                businessBlock = $('magento_block_amazon_template_selling_format_business_prices');\r\n\r\n            businessBlock.hide();\r\n            if (businessCustomer.value == 1){\r\n                businessBlock.show();\r\n            }\r\n        },\r\n\r\n        business_price_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateSellingFormatObj;\r\n\r\n            $('business_price_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('business_price_custom_attribute'));\r\n            }\r\n\r\n            $('business_price_note').innerHTML = M2ePro.translator.translate('Business Product Price for Amazon Listing(s).');\r\n        },\r\n\r\n        business_price_increase_vat_percent_mode_change: function()\r\n        {\r\n            var vatPercentTr = $('business_price_vat_percent_tr'),\r\n                vatPercent = $('business_price_vat_percent');\r\n\r\n            vatPercentTr.hide();\r\n            vatPercent.removeClassName('M2ePro-validate-vat-percent');\r\n            vatPercent.removeClassName('required-entry');\r\n\r\n            if (+this.value) {\r\n                vatPercentTr.show();\r\n                vatPercent.addClassName('M2ePro-validate-vat-percent');\r\n                vatPercent.addClassName('required-entry');\r\n            } else {\r\n                vatPercent.value = '';\r\n            }\r\n        },\r\n\r\n        business_discounts_mode_change: function()\r\n        {\r\n            var qtyPriceMode = $('business_discounts_mode');\r\n\r\n            $(\r\n                'business_discounts_tier_customer_group_id_tr', 'business_discounts_tier_coefficient_td',\r\n                'business_discounts_custom_value_discount_table', 'business_discounts_not_set_table'\r\n            ).invoke('hide');\r\n\r\n            $('business_discounts_custom_value_discount_table_tbody').update();\r\n\r\n            AmazonTemplateSellingFormatObj.discountRulesCount = 0;\r\n\r\n            $$('.add_discount_rule_button').each(function (el) {\r\n                el.show();\r\n            });\r\n\r\n            if (qtyPriceMode.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_SellingFormat::BUSINESS_DISCOUNTS_MODE_TIER')) {\r\n                $('business_discounts_tier_customer_group_id_tr').show();\r\n                $('business_discounts_tier_coefficient_td').show();\r\n                return;\r\n            }\r\n\r\n            if (qtyPriceMode.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_SellingFormat::BUSINESS_DISCOUNTS_MODE_CUSTOM_VALUE')) {\r\n                $('business_discounts_not_set_table').show();\r\n                return;\r\n            }\r\n        },\r\n\r\n        addRow: function()\r\n        {\r\n            $('business_discounts_custom_value_discount_table').show();\r\n            $('business_discounts_not_set_table').hide();\r\n\r\n            var id = 'business_discounts_custom_value_discount_table_tbody';\r\n            var i = AmazonTemplateSellingFormatObj.discountRulesCount;\r\n\r\n            // ---------------------------------------\r\n            var tpl = $$('#business_discounts_custom_value_discount_table_row_template tbody')[0].innerHTML;\r\n            tpl = tpl.replace(/%i%/g, i);\r\n            $(id).insert(tpl);\r\n            // ---------------------------------------\r\n\r\n            AmazonTemplateSellingFormatObj.discountRulesCount++;\r\n\r\n            if (AmazonTemplateSellingFormatObj.discountRulesCount >= 5) {\r\n                $$('.add_discount_rule_button').each(function (el) {\r\n                    el.hide();\r\n                });\r\n            }\r\n\r\n            var handlerObj = new AttributeCreator('business_discount[mode][' + i + ']');\r\n            handlerObj.setSelectObj($(id).select('select[name=\"business_discount[mode][' + i + ']\"]').first());\r\n            handlerObj.injectAddOption();\r\n\r\n            return $('custom_value_discount_rule_' + i + '_tr');\r\n        },\r\n\r\n        removeRow: function(btnEl)\r\n        {\r\n            btnEl.up('tr').remove();\r\n\r\n            AmazonTemplateSellingFormatObj.discountRulesCount--;\r\n\r\n            if (AmazonTemplateSellingFormatObj.discountRulesCount < 5) {\r\n                $$('.add_discount_rule_button').each(function (el) {\r\n                    el.show();\r\n                });\r\n            }\r\n\r\n            if (AmazonTemplateSellingFormatObj.discountRulesCount == 0) {\r\n                $('business_discounts_custom_value_discount_table').hide();\r\n                $('business_discounts_not_set_table').show();\r\n            }\r\n        },\r\n\r\n        renderDiscountRules: function(discountRules)\r\n        {\r\n            if (discountRules.length === 0) {\r\n                return;\r\n            }\r\n\r\n            if ($('business_discounts_mode').value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_SellingFormat::BUSINESS_DISCOUNTS_MODE_CUSTOM_VALUE')) {\r\n                return;\r\n            }\r\n\r\n            discountRules.each(function(rule, i) {\r\n                var row = AmazonTemplateSellingFormatObj.addRow();\r\n\r\n                row.down('.business-discount-qty').value = rule.qty;\r\n\r\n                if (rule.mode == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                    var modeOption = row.down('.business-discount-mode option[attribute_code=\"' + rule.attribute + '\"]');\r\n                    if (modeOption) modeOption.selected = true;\r\n                    row.down('.business-discount-attribute').value = rule.attribute;\r\n                } else {\r\n                    row.down('.business-discount-mode').value = rule.mode;\r\n                }\r\n\r\n                row.down('.business-discount-coefficient').value = rule.coefficient;\r\n            });\r\n        },\r\n\r\n        business_discount_price_mode_change: function(event,target)\r\n        {\r\n            var self = AmazonTemplateSellingFormatObj;\r\n\r\n            target.previous().value = '';\r\n            if (target.value == M2ePro.php.constant('Ess_M2ePro_Model_Template_SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(target, target.previous());\r\n            }\r\n        }\r\n\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/ShippingOverride.js":"define([\r\n    'M2ePro/Amazon/Template/Edit'\r\n], function () {\r\n\r\n    window.AmazonTemplateShippingOverride = Class.create(AmazonTemplateEdit,  {\r\n\r\n        rulesIndex: 0,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n            this.setValidationCheckRepetitionValue('M2ePro-shipping-override-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ShippingOverride', 'title', 'id',\r\n                M2ePro.formData.id);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function ($super, $headId) {\r\n            this.setValidationCheckRepetitionValue('M2ePro-shipping-override-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ShippingOverride', 'title', 'id', '');\r\n\r\n            $super($headId, M2ePro.translator.translate('Add Shipping Override Policy'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addRow: function (ruleData) {\r\n            var self = this,\r\n                marketplaceId = $('marketplace_id').value;\r\n\r\n            ruleData = ruleData || {};\r\n            this.rulesIndex++;\r\n\r\n            var tpl = $('shipping_override_rule_table_row_template').down('tbody').innerHTML;\r\n            tpl = tpl.replace(/%i%/g, this.rulesIndex);\r\n            $('shipping_override_rules_table_tbody').insert(tpl);\r\n\r\n            var row = $('shipping_override_rule_' + this.rulesIndex + '_tr');\r\n            row.show();\r\n\r\n            var serviceEl = row.down('.shipping-override-service');\r\n\r\n            var option = new Element('option', {\r\n                class: 'empty',\r\n                value: ''\r\n            });\r\n            serviceEl.insert({bottom: option});\r\n\r\n            var services = [];\r\n            $H(self.overrideServicesData).each(function (data) {\r\n                if (data.value.marketplace_id == marketplaceId && services.indexOf(data.value.service) == -1) {\r\n                    services.push(data.value.service);\r\n                }\r\n            });\r\n\r\n            services.each(function (service) {\r\n                var option = new Element('option', {\r\n                    value: service\r\n                });\r\n                option.innerHTML = service;\r\n                serviceEl.insert(option);\r\n            });\r\n\r\n            if (ruleData.service) {\r\n                serviceEl.value = ruleData.service;\r\n                self.ruleServiceChange.call(self, serviceEl, ruleData);\r\n            }\r\n\r\n            var attributeEl = row.down('.shipping-override-cost-custom-attribute');\r\n            attributeEl.addClassName('M2ePro-custom-attribute-can-be-created');\r\n            attributeEl.id = 'shipping_override_cost_custom_attribute_' + this.rulesIndex;\r\n            attributeEl.setAttribute('allowed_attribute_types', 'text,price,select');\r\n\r\n            var handlerObj = new AttributeCreator('shipping_override_cost_custom_attribute_' + this.rulesIndex);\r\n            handlerObj.setSelectObj(attributeEl);\r\n            handlerObj.injectAddOption();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        removeRow: function (el) {\r\n            el.up('.shipping-override-rule').remove();\r\n\r\n            if ($('shipping_override_rules_table_tbody').select('tr').length == 0) {\r\n                AmazonTemplateShippingOverrideObj.addRow();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderRules: function (data) {\r\n            var self = this;\r\n\r\n            $('magento_block_amazon_template_shipping_override_rules').show();\r\n\r\n            data.each(function (rule) {\r\n                self.addRow(rule);\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        marketplaceChange: function () {\r\n            if (this.value != '') {\r\n                if (this.down('.empty-option')) {\r\n                    this.down('.empty-option').hide();\r\n                }\r\n                $('magento_block_amazon_template_shipping_override_rules').show();\r\n            }\r\n\r\n            $('shipping_override_rules_table_tbody').update();\r\n            if (this.type == 'select-one') {\r\n                $('shipping_override_rule_table_row_template').down('.shipping-override-rule-currency')\r\n                    .update(this[this.selectedIndex].getAttribute('currency'));\r\n            }\r\n            AmazonTemplateShippingOverrideObj.addRow();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        ruleServiceChange: function (el, ruleData) {\r\n            var self = this,\r\n                location = el.up('tr').down('.shipping-override-location'),\r\n                marketplaceId = $('marketplace_id').value;\r\n\r\n            ruleData = ruleData || {};\r\n\r\n            if (el.value == '') {\r\n                location.value = '';\r\n                location.simulate('change');\r\n                location.disable().hide();\r\n\r\n                return;\r\n            }\r\n            location.update().enable().show();\r\n\r\n            var option = new Element('option', {\r\n                class: 'empty',\r\n                value: ''\r\n            });\r\n            location.insert({bottom: option});\r\n\r\n            $H(self.overrideServicesData).each(function (data) {\r\n                if (data.value.marketplace_id == marketplaceId && data.value.service == el.value) {\r\n                    var option = new Element('option', {\r\n                        value: data.value.location\r\n                    });\r\n\r\n                    option.innerHTML = data.value.location;\r\n                    location.insert(option);\r\n                }\r\n            });\r\n\r\n            if (ruleData.location) {\r\n                location.value = ruleData.location;\r\n                self.ruleLocationChange.call(self, location, ruleData);\r\n            }\r\n        },\r\n\r\n        ruleLocationChange: function (el, ruleData) {\r\n            var self = this,\r\n                service = el.up('tr').down('.shipping-override-service'),\r\n                location = el.up('tr').down('.shipping-override-location'),\r\n                type = el.up('tr').down('.shipping-override-type'),\r\n                option = el.up('tr').down('.shipping-override-option');\r\n\r\n            ruleData = ruleData || {};\r\n\r\n            if (el.value == '') {\r\n                type.value = '';\r\n                type.simulate('change');\r\n                type.disable().hide();\r\n\r\n                option.value = '';\r\n\r\n                return;\r\n            }\r\n            type.enable().show();\r\n\r\n            $H(self.overrideServicesData).each(function (data) {\r\n                if (service.value == data.value.service && location.value == data.value.location) {\r\n                    option.value = data.value.option;\r\n                    throw $break;\r\n                }\r\n            });\r\n\r\n            if (ruleData.type) {\r\n                type.value = ruleData.type;\r\n                self.ruleTypeChange.call(self, type, ruleData);\r\n            }\r\n        },\r\n\r\n        ruleTypeChange: function (el, ruleData) {\r\n            var self = this,\r\n                costMode = el.up('tr').down('.shipping-override-cost-mode');\r\n\r\n            ruleData = ruleData || {};\r\n\r\n            if (el.value == '' || el.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ShippingOverride_Service::TYPE_RESTRICTIVE')) {\r\n                costMode.value = '';\r\n                costMode.simulate('change');\r\n                costMode.disable().hide();\r\n\r\n                return;\r\n            }\r\n            costMode.enable().show();\r\n\r\n            if (ruleData.cost_mode) {\r\n                costMode.value = ruleData.cost_mode;\r\n                self.ruleCostModeChange.call(self, costMode, ruleData);\r\n            }\r\n        },\r\n\r\n        ruleCostModeChange: function (el, ruleData) {\r\n            var self = this,\r\n                costCustomValue = el.up('tr').down('.shipping-override-cost-custom-value'),\r\n                costCustomAttribute = el.up('tr').down('.shipping-override-cost-custom-attribute');\r\n\r\n            ruleData = ruleData || {};\r\n\r\n            costCustomValue.removeAttribute('readonly');\r\n\r\n            if (el.value == '' || el.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ShippingOverride_Service::COST_MODE_FREE')) {\r\n                costCustomValue.disable().hide();\r\n                costCustomAttribute.disable().hide();\r\n\r\n                costCustomValue.value = '';\r\n                costCustomAttribute.value = '';\r\n\r\n                if (el.value != '' && el.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ShippingOverride_Service::COST_MODE_FREE')) {\r\n                    costCustomValue.enable().show();\r\n                    costCustomValue.value = 0;\r\n                    costCustomValue.setAttribute('readonly', 'readonly');\r\n                }\r\n\r\n                return;\r\n            }\r\n\r\n            if (el.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ShippingOverride_Service::COST_MODE_CUSTOM_VALUE')) {\r\n                costCustomValue.enable().show();\r\n                costCustomAttribute.disable().hide();\r\n\r\n                if (ruleData.cost_value) {\r\n                    costCustomValue.value = ruleData.cost_value;\r\n                }\r\n            } else if (el.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ShippingOverride_Service::COST_MODE_CUSTOM_ATTRIBUTE')) {\r\n                costCustomValue.disable().hide();\r\n                costCustomAttribute.enable().show();\r\n\r\n                if (ruleData.cost_value) {\r\n                    costCustomAttribute.value = ruleData.cost_value;\r\n                }\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/ShippingTemplate.js":"define([\r\n    'M2ePro/Amazon/Template/Edit'\r\n], function () {\r\n\r\n    window.AmazonTemplateShippingTemplate = Class.create(AmazonTemplateEdit,  {\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-shipping-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ShippingTemplate', 'title', 'id',\r\n                M2ePro.formData.id\r\n            );\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            $('template_name_mode')\r\n                .observe('change', this.templateNameModeChange)\r\n                .simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function($headId)\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-shipping-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ShippingTemplate', 'title', 'id', ''\r\n            );\r\n\r\n            CommonObj.duplicateClick($headId, M2ePro.translator.translate('Add Shipping Template Policy'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        templateNameModeChange: function()\r\n        {\r\n            $('template_name_custom_value_tr').hide();\r\n            $('template_name_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ShippingTemplate::TEMPLATE_NAME_VALUE')) {\r\n                $('template_name_custom_value_tr').show();\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ShippingTemplate::TEMPLATE_NAME_ATTRIBUTE')) {\r\n                CommonObj.updateHiddenValue(this, $('template_name_attribute'));\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Template/Synchronization.js":"define([\r\n    'M2ePro/Amazon/Template/Edit',\r\n    'Magento_Ui/js/modal/confirm'\r\n], function () {\r\n\r\n    window.AmazonTemplateSynchronization = Class.create(AmazonTemplateEdit, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-synchronization-tpl-title',\r\n                                                    M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                                                    'Template\\\\Synchronization', 'title', 'id',\r\n                                                    M2ePro.formData.id,\r\n                                                    M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-input-time', function(value) {\r\n                return value.match(/^\\d{2}:\\d{2}$/g);\r\n            }, M2ePro.translator.translate('Wrong time format string.'));\r\n\r\n            jQuery.validator.addMethod('validate-qty', function(value, el) {\r\n\r\n                if (!el.up('.admin__field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.match(/[^\\d]+/g)) {\r\n                    return false;\r\n                }\r\n\r\n                if (value <= 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Wrong value. Only integer numbers.'));\r\n\r\n            // ---------------------------------------\r\n            jQuery.validator.addMethod('M2ePro-validate-conditions-between', function(value, el) {\r\n\r\n                var minValue = $(el.id.replace('_max','')).value;\r\n\r\n                if (!el.up('.admin__field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                return parseInt(value) > parseInt(minValue);\r\n            }, M2ePro.translator.translate('Must be greater than \"Min\".'));\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            jQuery.validator.addMethod('M2ePro-validate-stop-relist-conditions-product-status', function(value, el) {\r\n\r\n                if (AmazonTemplateSynchronizationObj.isRelistModeDisabled()) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('stop_status_disabled').value == 1 && $('relist_status_enabled').value == 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Inconsistent Settings in Relist and Stop Rules.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-stop-relist-conditions-stock-availability', function(value, el) {\r\n\r\n                if (AmazonTemplateSynchronizationObj.isRelistModeDisabled()) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('stop_out_off_stock').value == 1 && $('relist_is_in_stock').value == 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Inconsistent Settings in Relist and Stop Rules.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-stop-relist-conditions-item-qty', function(value, el) {\r\n\r\n                if (AmazonTemplateSynchronizationObj.isRelistModeDisabled()) {\r\n                    return true;\r\n                }\r\n\r\n                var stopMaxQty = 0,\r\n                    relistMinQty = 0;\r\n\r\n                var qtyType = el.getAttribute('qty_type');\r\n\r\n                switch (parseInt($('stop_qty_' + qtyType).value)) {\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_NONE'):\r\n                        return true;\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_LESS'):\r\n                        stopMaxQty = parseInt($('stop_qty_' + qtyType + '_value').value);\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_BETWEEN'):\r\n                        stopMaxQty = parseInt($('stop_qty_' + qtyType + '_value_max').value);\r\n                        break;\r\n                }\r\n\r\n                switch (parseInt($('relist_qty_' + qtyType).value)) {\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_NONE'):\r\n                        return false;\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_MORE'):\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_BETWEEN'):\r\n                        relistMinQty = parseInt($('relist_qty_' + qtyType + '_value').value);\r\n                        break;\r\n                }\r\n\r\n                if (relistMinQty <= stopMaxQty) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Inconsistent Settings in Relist and Stop Rules.'));\r\n            // ---------------------------------------\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            //list\r\n            $('list_mode').observe('change', AmazonTemplateSynchronizationObj.listMode_change).simulate('change');\r\n            $('list_qty_magento').observe('change', AmazonTemplateSynchronizationObj.listQty_change).simulate('change');\r\n            $('list_qty_calculated').observe('change', AmazonTemplateSynchronizationObj.listQty_change).simulate('change');\r\n            $('list_advanced_rules_mode').observe('change', AmazonTemplateSynchronizationObj.listAdvancedRules_change).simulate('change');\r\n\r\n            //relist\r\n            $('relist_mode').observe('change', AmazonTemplateSynchronizationObj.relistMode_change).simulate('change');\r\n            $('relist_qty_magento').observe('change', AmazonTemplateSynchronizationObj.relistQty_change).simulate('change');\r\n            $('relist_qty_calculated').observe('change', AmazonTemplateSynchronizationObj.relistQty_change).simulate('change');\r\n            $('relist_advanced_rules_mode').observe('change', AmazonTemplateSynchronizationObj.relistAdvancedRules_change).simulate('change');\r\n\r\n            //revise\r\n            $('revise_update_qty')\r\n                .observe('change', AmazonTemplateSynchronizationObj.reviseQty_change)\r\n                .simulate('change');\r\n\r\n            $('revise_update_qty_max_applied_value_mode')\r\n                .observe('change', AmazonTemplateSynchronizationObj.reviseQtyMaxAppliedValueMode_change)\r\n                .simulate('change');\r\n\r\n            $('revise_update_price').observe('change', AmazonTemplateSynchronizationObj.revisePrice_change)\r\n                .simulate('change');\r\n\r\n            $('revise_update_price_max_allowed_deviation_mode').observe('change', AmazonTemplateSynchronizationObj.revisePriceMaxAllowedDeviationMode_change)\r\n                .simulate('change');\r\n\r\n            //stop\r\n            $('stop_qty_magento').observe('change', AmazonTemplateSynchronizationObj.stopQty_change).simulate('change');\r\n            $('stop_qty_calculated').observe('change', AmazonTemplateSynchronizationObj.stopQty_change).simulate('change');\r\n            $('stop_advanced_rules_mode').observe('change', AmazonTemplateSynchronizationObj.stopAdvancedRules_change).simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isRelistModeDisabled: function()\r\n        {\r\n            return $('relist_mode').value == 0;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function($super, $headId)\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-synchronization-tpl-title',\r\n                                                    M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                                                    'Template\\\\Synchronization', 'title', '','',\r\n                                                    M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK'));\r\n\r\n            $super($headId, M2ePro.translator.translate('Add Synchronization Policy'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        stopQty_change: function()\r\n        {\r\n            var qtyType = this.getAttribute('qty_type');\r\n\r\n            var valueContainer    = $('stop_qty_' + qtyType + '_value_container'),\r\n                valueMaxContainer = $('stop_qty_' + qtyType + '_value_max_container'),\r\n                item              = valueContainer.select('label span')[0];\r\n\r\n            valueContainer.hide();\r\n            valueMaxContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_LESS') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_MORE')) {\r\n                item.innerHTML = M2ePro.translator.translate('Quantity');\r\n                valueContainer.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_BETWEEN')) {\r\n                item.innerHTML = M2ePro.translator.translate('Min Quantity');\r\n                valueContainer.show();\r\n                valueMaxContainer.show();\r\n            }\r\n        },\r\n\r\n        stopAdvancedRules_change: function()\r\n        {\r\n            var rulesContainer = $('stop_advanced_rules_filters_container'),\r\n                warningContainer = $('stop_advanced_rules_filters_warning');\r\n\r\n            rulesContainer.hide();\r\n            warningContainer.hide();\r\n\r\n            if (this.value == 1) {\r\n                rulesContainer.show();\r\n                warningContainer.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        listMode_change: function()\r\n        {\r\n            var rulesContainer         = $('magento_block_amazon_template_synchronization_list_rules'),\r\n                advancedRulesContainer = $('magento_block_amazon_template_synchronization_list_advanced_filters');\r\n\r\n            if ($('list_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_MODE_NONE')) {\r\n                rulesContainer.hide();\r\n                advancedRulesContainer.hide();\r\n            } else if ($('list_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_MODE_YES')) {\r\n                rulesContainer.show();\r\n                advancedRulesContainer.show();\r\n            } else {\r\n                rulesContainer.hide();\r\n                advancedRulesContainer.hide();\r\n            }\r\n        },\r\n\r\n        listQty_change: function()\r\n        {\r\n            var qtyType = this.getAttribute('qty_type');\r\n\r\n            var valueContainer    = $('list_qty_' + qtyType + '_value_container'),\r\n                valueMaxContainer = $('list_qty_' + qtyType + '_value_max_container'),\r\n                item              = valueContainer.select('label span')[0];\r\n\r\n            valueContainer.hide();\r\n            valueMaxContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_QTY_LESS') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_QTY_MORE')) {\r\n                item.innerHTML = M2ePro.translator.translate('Quantity');\r\n                valueContainer.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_QTY_BETWEEN')) {\r\n                item.innerHTML = M2ePro.translator.translate('Min Quantity');\r\n                valueContainer.show();\r\n                valueMaxContainer.show();\r\n            }\r\n        },\r\n\r\n        listAdvancedRules_change: function()\r\n        {\r\n            var rulesContainer = $('list_advanced_rules_filters_container'),\r\n                warningContainer = $('list_advanced_rules_filters_warning');\r\n\r\n            rulesContainer.hide();\r\n            warningContainer.hide();\r\n\r\n            if (this.value == 1) {\r\n                rulesContainer.show();\r\n                warningContainer.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        relistMode_change: function()\r\n        {\r\n            var rulesContainer         = $('magento_block_amazon_template_synchronization_relist_rules'),\r\n                advancedRulesContainer = $('magento_block_amazon_template_synchronization_relist_advanced_filters'),\r\n                userLockContainer      = $('relist_filter_user_lock_tr_container'),\r\n                sendDataContainer      = $('relist_send_data_tr_container');\r\n\r\n            if ($('relist_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_MODE_NONE')) {\r\n                userLockContainer.hide();\r\n                sendDataContainer.hide();\r\n                rulesContainer.hide();\r\n                advancedRulesContainer.hide();\r\n            } else if ($('relist_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_MODE_YES')) {\r\n                userLockContainer.show();\r\n                sendDataContainer.show();\r\n                rulesContainer.show();\r\n                advancedRulesContainer.show();\r\n            } else {\r\n                userLockContainer.hide();\r\n                sendDataContainer.hide();\r\n                rulesContainer.hide();\r\n                advancedRulesContainer.hide();\r\n            }\r\n        },\r\n\r\n        relistQty_change: function()\r\n        {\r\n            var qtyType = this.getAttribute('qty_type');\r\n\r\n            var valueContainer    = $('relist_qty_' + qtyType + '_value_container'),\r\n                valueMaxContainer = $('relist_qty_' + qtyType + '_value_max_container'),\r\n                item              = valueContainer.select('label span')[0];\r\n\r\n            valueContainer.hide();\r\n            valueMaxContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_LESS') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_MORE')) {\r\n                item.innerHTML = M2ePro.translator.translate('Quantity');\r\n                valueContainer.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_BETWEEN')) {\r\n                item.innerHTML = M2ePro.translator.translate('Min Quantity');\r\n                valueContainer.show();\r\n                valueMaxContainer.show();\r\n            }\r\n        },\r\n\r\n        relistAdvancedRules_change: function()\r\n        {\r\n            var rulesContainer = $('relist_advanced_rules_filters_container'),\r\n                warningContainer = $('relist_advanced_rules_filters_warning');\r\n\r\n            rulesContainer.hide();\r\n            warningContainer.hide();\r\n\r\n            if (this.value == 1) {\r\n                rulesContainer.show();\r\n                warningContainer.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reviseQty_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_UPDATE_QTY_YES')) {\r\n                $('revise_update_qty_max_applied_value_mode_tr').show();\r\n                $('revise_update_qty_max_applied_value_line_tr').show();\r\n                $('revise_update_qty_max_applied_value_mode').simulate('change');\r\n            } else {\r\n                $('revise_update_qty_max_applied_value_mode_tr').hide();\r\n                $('revise_update_qty_max_applied_value_line_tr').hide();\r\n                $('revise_update_qty_max_applied_value_tr').hide();\r\n                $('revise_update_qty_max_applied_value_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_MAX_AFFECTED_QTY_MODE_OFF');\r\n            }\r\n        },\r\n\r\n        reviseQtyMaxAppliedValueMode_change: function(event)\r\n        {\r\n            var self = AmazonTemplateSynchronizationObj;\r\n\r\n            $('revise_update_qty_max_applied_value_tr').hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_MAX_AFFECTED_QTY_MODE_ON')) {\r\n                $('revise_update_qty_max_applied_value_tr').show();\r\n            } else if (!event.cancelable) {\r\n                self.openReviseMaxAppliedQtyDisableConfirmationPopUp();\r\n            }\r\n        },\r\n\r\n        openReviseMaxAppliedQtyDisableConfirmationPopUp: function()\r\n        {\r\n            var self = this;\r\n\r\n            var element = jQuery('#revise_qty_max_applied_value_confirmation_popup_template').clone();\r\n\r\n            element.confirm({\r\n                title: M2ePro.translator.translate('Are you sure?'),\r\n                actions: {\r\n                    confirm: self.reviseQtyMaxAppliedValueDisableConfirm,\r\n                    cancel: self.reviseQtyMaxAppliedValueDisableCancel\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event);\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    click: function (event) {\r\n                        this.closeModal(event, true);\r\n                    }\r\n                }]\r\n            });\r\n        },\r\n\r\n        reviseQtyMaxAppliedValueDisableCancel: function()\r\n        {\r\n            $('revise_update_qty_max_applied_value_mode').selectedIndex = 1;\r\n            $('revise_update_qty_max_applied_value_mode').simulate('change');\r\n        },\r\n\r\n        reviseQtyMaxAppliedValueDisableConfirm: function()\r\n        {\r\n            $('revise_update_qty_max_applied_value_mode').selectedIndex = 0;\r\n            $('revise_update_qty_max_applied_value_mode').simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        revisePrice_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_UPDATE_PRICE_YES')) {\r\n                $('revise_update_price_max_allowed_deviation_mode_tr').show();\r\n                $('revise_update_price_max_allowed_deviation_tr').show();\r\n                $('revise_update_price_line').show();\r\n                $('revise_update_price_max_allowed_deviation_mode').simulate('change');\r\n            } else {\r\n                $('revise_update_price_max_allowed_deviation_mode_tr').hide();\r\n                $('revise_update_price_max_allowed_deviation_tr').hide();\r\n                $('revise_update_price_line').hide();\r\n                $('revise_update_price_max_allowed_deviation_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_MAX_ALLOWED_PRICE_DEVIATION_MODE_OFF');\r\n            }\r\n        },\r\n\r\n        revisePriceMaxAllowedDeviationMode_change: function(event)\r\n        {\r\n            var self = AmazonTemplateSynchronizationObj;\r\n\r\n            $('revise_update_price_max_allowed_deviation_tr').hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_MAX_ALLOWED_PRICE_DEVIATION_MODE_ON')) {\r\n                $('revise_update_price_max_allowed_deviation_tr').show();\r\n            } else if (!event.cancelable) {\r\n                self.openReviseMaxAllowedDeviationPriceDisableConfirmationPopUp();\r\n            }\r\n        },\r\n\r\n        openReviseMaxAllowedDeviationPriceDisableConfirmationPopUp: function()\r\n        {\r\n            var self = this;\r\n\r\n            var element = jQuery('#revise_price_max_max_allowed_deviation_confirmation_popup_template').clone();\r\n\r\n            element.confirm({\r\n                title: M2ePro.translator.translate('Are you sure?'),\r\n                actions: {\r\n                    confirm: self.revisePriceMaxAllowedDeviationDisableConfirm,\r\n                    cancel: self.revisePriceMaxAllowedDeviationDisableCancel\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event);\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    click: function (event) {\r\n                        this.closeModal(event, true);\r\n                    }\r\n                }]\r\n            });\r\n        },\r\n\r\n        revisePriceMaxAllowedDeviationDisableCancel: function()\r\n        {\r\n            $('revise_update_price_max_allowed_deviation_mode').selectedIndex = 1;\r\n            $('revise_update_price_max_allowed_deviation_mode').simulate('change');\r\n        },\r\n\r\n        revisePriceMaxAllowedDeviationDisableConfirm: function()\r\n        {\r\n            $('revise_update_price_max_allowed_deviation_mode').selectedIndex = 0;\r\n            $('revise_update_price_max_allowed_deviation_mode').simulate('change');\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Definition.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.AmazonTemplateDescriptionDefinition = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function() { },\r\n\r\n        initObservers: function()\r\n        {\r\n            $('title_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.title_mode_change)\r\n                .simulate('change');\r\n\r\n            $('brand_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.brand_mode_change)\r\n                .simulate('change');\r\n\r\n            $('manufacturer_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.manufacturer_mode_change)\r\n                .simulate('change');\r\n\r\n            $('manufacturer_part_number_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.manufacturer_part_number_mode_change)\r\n                .simulate('change');\r\n\r\n            // ---\r\n\r\n            $('item_package_quantity_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.onChangeItemPackageQuantityMode)\r\n                .simulate('change');\r\n\r\n            $('number_of_items_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.onChangeNumberOfItemsMode)\r\n                .simulate('change');\r\n\r\n            // ---\r\n\r\n            $('item_dimensions_volume_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.item_dimensions_volume_mode_change)\r\n                .simulate('change');\r\n\r\n            $('item_dimensions_volume_unit_of_measure_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.item_dimensions_volume_unit_of_measure_mode_change)\r\n                .simulate('change');\r\n\r\n            $('item_dimensions_weight_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.item_dimensions_weight_mode_change)\r\n                .simulate('change');\r\n\r\n            $('item_dimensions_weight_unit_of_measure_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.item_dimensions_weight_unit_of_measure_mode_change)\r\n                .simulate('change');\r\n\r\n            // ---\r\n\r\n            $('package_dimensions_volume_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.package_dimensions_volume_mode_change)\r\n                .simulate('change');\r\n\r\n            $('package_dimensions_volume_unit_of_measure_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.package_dimensions_volume_unit_of_measure_mode_change)\r\n                .simulate('change');\r\n\r\n            // ---\r\n\r\n            $('package_weight_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.package_weight_mode_change)\r\n                .simulate('change');\r\n\r\n            $('package_weight_unit_of_measure_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.package_weight_unit_of_measure_mode_change)\r\n                .simulate('change');\r\n\r\n            $('shipping_weight_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.shipping_weight_mode_change)\r\n                .simulate('change');\r\n\r\n            $('shipping_weight_unit_of_measure_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.shipping_weight_unit_of_measure_mode_change)\r\n                .simulate('change');\r\n\r\n            // ---\r\n\r\n            $('target_audience_mode')\r\n                .observe('change', function () {\r\n                    AmazonTemplateDescriptionDefinitionObj.multi_element_mode_change.call(this,'target_audience',4);\r\n                })\r\n                .simulate('change');\r\n\r\n            $('bullet_points_mode')\r\n                .observe('change', function () {\r\n                    AmazonTemplateDescriptionDefinitionObj.multi_element_mode_change.call(this,'bullet_points',5);\r\n                })\r\n                .simulate('change');\r\n\r\n            $('search_terms_mode')\r\n                .observe('change', function () {\r\n                    AmazonTemplateDescriptionDefinitionObj.multi_element_mode_change.call(this,'search_terms',5);\r\n                })\r\n                .simulate('change');\r\n\r\n            $('description_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.description_mode_change)\r\n                .simulate('change');\r\n\r\n            $('image_main_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.image_main_mode_change)\r\n                .simulate('change');\r\n\r\n            $('image_variation_difference_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.image_variation_difference_mode_change)\r\n                .simulate('change');\r\n\r\n            $('gallery_images_mode')\r\n                .observe('change', AmazonTemplateDescriptionDefinitionObj.gallery_images_mode_change)\r\n                .simulate('change');\r\n\r\n            AmazonTemplateDescriptionObj.onChangeNewAsinAccepted.bind($('new_asin_accepted'))();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        title_mode_change: function()\r\n        {\r\n            var customTitle = $('custom_title_tr');\r\n            this.value == 1 ? customTitle.show() : customTitle.hide();\r\n        },\r\n\r\n        brand_mode_change: function()\r\n        {\r\n            var customAttribute = $('brand_custom_attribute'),\r\n                customValueTr   = $('brand_custom_value_tr');\r\n\r\n            customValueTr.hide();\r\n\r\n            customAttribute.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::BRAND_MODE_CUSTOM_VALUE')) {\r\n                customValueTr.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::BRAND_MODE_CUSTOM_ATTRIBUTE')) {\r\n                AmazonTemplateDescriptionDefinitionObj.updateHiddenValue(this, customAttribute);\r\n            }\r\n        },\r\n\r\n        manufacturer_mode_change: function()\r\n        {\r\n            var customAttribute = $('manufacturer_custom_attribute'),\r\n                customValueTr   = $('manufacturer_custom_value_tr');\r\n\r\n            customValueTr.hide();\r\n\r\n            customAttribute.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::MANUFACTURER_MODE_CUSTOM_VALUE')) {\r\n                customValueTr.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::MANUFACTURER_MODE_CUSTOM_ATTRIBUTE')) {\r\n                AmazonTemplateDescriptionDefinitionObj.updateHiddenValue(this, customAttribute);\r\n            }\r\n        },\r\n\r\n        manufacturer_part_number_mode_change: function()\r\n        {\r\n            var customAttribute = $('manufacturer_part_number_custom_attribute'),\r\n                customValueTr   = $('manufacturer_part_number_custom_value_tr');\r\n\r\n            customValueTr.hide();\r\n\r\n            customAttribute.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::MANUFACTURER_PART_NUMBER_MODE_CUSTOM_VALUE')) {\r\n                customValueTr.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::MANUFACTURER_PART_NUMBER_MODE_CUSTOM_ATTRIBUTE')) {\r\n                AmazonTemplateDescriptionDefinitionObj.updateHiddenValue(this, customAttribute);\r\n            }\r\n        },\r\n\r\n        onChangeItemPackageQuantityMode: function()\r\n        {\r\n            var targetCustomValue     = $('item_package_quantity_custom_value_tr'),\r\n                targetCustomAttribute = $('item_package_quantity_custom_attribute');\r\n\r\n            targetCustomValue.hide();\r\n\r\n            targetCustomAttribute.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::ITEM_PACKAGE_QUANTITY_MODE_CUSTOM_VALUE')) {\r\n                targetCustomValue.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::ITEM_PACKAGE_QUANTITY_MODE_CUSTOM_ATTRIBUTE')) {\r\n                AmazonTemplateDescriptionObj.updateHiddenValue(this, targetCustomAttribute);\r\n            }\r\n        },\r\n\r\n        onChangeNumberOfItemsMode: function()\r\n        {\r\n            var targetCustomValue     = $('number_of_items_custom_value_tr'),\r\n                targetCustomAttribute = $('number_of_items_custom_attribute');\r\n\r\n            targetCustomValue.hide();\r\n\r\n            targetCustomAttribute.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::NUMBER_OF_ITEMS_MODE_CUSTOM_VALUE')) {\r\n                targetCustomValue.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::NUMBER_OF_ITEMS_MODE_CUSTOM_ATTRIBUTE')) {\r\n                AmazonTemplateDescriptionObj.updateHiddenValue(this, targetCustomAttribute);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        volumeModeChange: function(customValueTr, customAttributeTr, weightUnitTr, weightUnitMode, value)\r\n        {\r\n            customValueTr.hide();\r\n            customAttributeTr.hide();\r\n            weightUnitTr.hide();\r\n\r\n            if (value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::DIMENSION_VOLUME_MODE_NONE')) {\r\n                weightUnitMode.value = '';\r\n            }\r\n\r\n            if (value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::DIMENSION_VOLUME_MODE_CUSTOM_VALUE')) {\r\n                customValueTr.show();\r\n                weightUnitTr.show();\r\n            }\r\n\r\n            if (value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::DIMENSION_VOLUME_MODE_CUSTOM_ATTRIBUTE')) {\r\n                customAttributeTr.show();\r\n                weightUnitTr.show();\r\n            }\r\n\r\n            weightUnitMode.simulate('change');\r\n        },\r\n\r\n        weightModeChange: function(customValueTr, customAttribute, weightUnitTr, weightUnitMode, value)\r\n        {\r\n            customValueTr.hide();\r\n            weightUnitTr.hide();\r\n\r\n            customAttribute.value = '';\r\n            if (value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::DIMENSION_VOLUME_MODE_NONE')) {\r\n                weightUnitMode.value = '';\r\n            }\r\n\r\n            if (value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::DIMENSION_VOLUME_MODE_CUSTOM_VALUE')) {\r\n                customValueTr.show();\r\n                weightUnitTr.show();\r\n            }\r\n\r\n            if (value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::DIMENSION_VOLUME_MODE_CUSTOM_ATTRIBUTE')) {\r\n                AmazonTemplateDescriptionDefinitionObj.updateHiddenValue(this, customAttribute);\r\n                weightUnitTr.show();\r\n            }\r\n\r\n            weightUnitMode.simulate('change');\r\n        },\r\n\r\n        weightUnitOfMeasureChangeAll: function(customValue, customAttribute, value)\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            customValue.value = '';\r\n            customAttribute.value = '';\r\n            if (value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::WEIGHT_UNIT_OF_MEASURE_MODE_CUSTOM_VALUE')) {\r\n                self.updateHiddenValue(this, customValue);\r\n            }\r\n\r\n            if (value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::WEIGHT_UNIT_OF_MEASURE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, customAttribute);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        item_dimensions_volume_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            self.volumeModeChange(\r\n                $('item_dimensions_volume_custom_value_tr'), $('item_dimensions_volume_custom_attribute_tr'),\r\n                $('item_dimensions_volume_unit_of_measure_mode_tr'), $('item_dimensions_volume_unit_of_measure_mode'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        item_dimensions_volume_unit_of_measure_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n            self.weightUnitOfMeasureChangeAll.call(\r\n                this,\r\n                $('item_dimensions_volume_unit_of_measure_custom_value'),\r\n                $('item_dimensions_volume_unit_of_measure_custom_attribute'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        item_dimensions_weight_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n            self.weightModeChange.call(\r\n                this,\r\n                $('item_dimensions_weight_custom_value_tr'),\r\n                $('item_dimensions_weight_custom_attribute'),\r\n                $('item_dimensions_weight_unit_of_measure_mode_tr'),\r\n                $('item_dimensions_weight_unit_of_measure_mode'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        item_dimensions_weight_unit_of_measure_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n            self.weightUnitOfMeasureChangeAll.call(\r\n                this,\r\n                $('item_dimensions_weight_unit_of_measure_custom_value'),\r\n                $('item_dimensions_weight_unit_of_measure_custom_attribute'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        package_dimensions_volume_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            self.volumeModeChange(\r\n                $('package_dimensions_volume_custom_value_tr'), $('package_dimensions_volume_custom_attribute_tr'),\r\n                $('package_dimensions_volume_unit_of_measure_mode_tr'), $('package_dimensions_volume_unit_of_measure_mode'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        package_dimensions_volume_unit_of_measure_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            self.weightUnitOfMeasureChangeAll.call(\r\n                this,\r\n                $('package_dimensions_volume_unit_of_measure_custom_value'),\r\n                $('package_dimensions_volume_unit_of_measure_custom_attribute'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        package_weight_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            self.weightModeChange.call(\r\n                this,\r\n                $('package_weight_custom_value_tr'),\r\n                $('package_weight_custom_attribute'),\r\n                $('package_weight_unit_of_measure_mode_tr'),\r\n                $('package_weight_unit_of_measure_mode'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        package_weight_unit_of_measure_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            self.weightUnitOfMeasureChangeAll.call(\r\n                this,\r\n                $('package_weight_unit_of_measure_custom_value'),\r\n                $('package_weight_unit_of_measure_custom_attribute'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        shipping_weight_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            self.weightModeChange.call(\r\n                this,\r\n                $('shipping_weight_custom_value_tr'),\r\n                $('shipping_weight_custom_attribute'),\r\n                $('shipping_weight_unit_of_measure_mode_tr'),\r\n                $('shipping_weight_unit_of_measure_mode'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        shipping_weight_unit_of_measure_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            self.weightUnitOfMeasureChangeAll.call(\r\n                this,\r\n                $('shipping_weight_unit_of_measure_custom_value'),\r\n                $('shipping_weight_unit_of_measure_custom_attribute'),\r\n                this.value\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        multi_element_mode_change: function(type, max)\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::' + type.toUpperCase() + '_MODE_NONE')) {\r\n\r\n                $$('.' + type + '_tr').invoke('hide');\r\n                $$('input[name^=\"definition[' + type + ']\"]').each(function(obj) {\r\n                    obj.value = '';\r\n                });\r\n                $(type + '_actions_tr').hide();\r\n\r\n            } else {\r\n\r\n                var visibleElementsCounter = 0,\r\n                    emptyVisibleElements   = 0;\r\n\r\n                $$('.' + type + '_tr').each(function(obj) {\r\n                    if (visibleElementsCounter == 0 || $(obj).select('input[name^=\"definition[' + type + ']\"]')[0].value != '') {\r\n                        $(obj).show();\r\n                        visibleElementsCounter++;\r\n                    }\r\n                });\r\n\r\n                $(type + '_actions_tr').show();\r\n\r\n                if (visibleElementsCounter > 1) {\r\n                    $('hide_' + type + '_action').removeClassName('action-disabled');\r\n                }\r\n\r\n                visibleElementsCounter < max ? $('show_' + type + '_action').removeClassName('action-disabled')\r\n                    : $('show_' + type + '_action').addClassName('action-disabled');\r\n\r\n                if (visibleElementsCounter == 1 && $(type + '_0').value == '') {\r\n                    $('show_' + type + '_action').addClassName('action-disabled');\r\n                }\r\n            }\r\n        },\r\n\r\n        multi_element_keyup: function(type,element)\r\n        {\r\n            if (!element.value) {\r\n                return $('show_' + type + '_action').addClassName('action-disabled');\r\n            }\r\n\r\n            var hiddenElements = $$('.' + type + '_tr').findAll(function(obj) {\r\n                return !$(obj).visible();\r\n            });\r\n\r\n            if (hiddenElements.size() != 0) {\r\n                $('show_' + type + '_action').removeClassName('action-disabled');\r\n            }\r\n        },\r\n\r\n        description_mode_change: function()\r\n        {\r\n            this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::DESCRIPTION_MODE_CUSTOM')\r\n                ? $$('.c-custom_description_tr').invoke('show')\r\n                : $$('.c-custom_description_tr').invoke('hide');\r\n        },\r\n\r\n        image_main_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::IMAGE_MAIN_MODE_NONE')) {\r\n                $('gallery_images_mode_tr').hide();\r\n                $('gallery_images_mode').value = 0;\r\n                $('gallery_images_mode').simulate('change');\r\n            } else {\r\n                $('gallery_images_mode_tr').show();\r\n            }\r\n\r\n            $('image_main_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::IMAGE_MAIN_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('image_main_attribute'));\r\n            }\r\n        },\r\n\r\n        image_variation_difference_mode_change: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionDefinitionObj;\r\n\r\n            $('image_variation_difference_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::IMAGE_VARIATION_DIFFERENCE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('image_variation_difference_attribute'));\r\n            }\r\n        },\r\n\r\n        gallery_images_mode_change: function()\r\n        {\r\n            $('gallery_images_limit').value = '';\r\n            $('gallery_images_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::GALLERY_IMAGES_MODE_PRODUCT')) {\r\n                AmazonTemplateDescriptionDefinitionObj.updateHiddenValue(this, $('gallery_images_limit'));\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::GALLERY_IMAGES_MODE_ATTRIBUTE')) {\r\n                AmazonTemplateDescriptionDefinitionObj.updateHiddenValue(this, $('gallery_images_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showElement: function(type)\r\n        {\r\n            var emptyVisibleElementsExist = $$('.' + type + '_tr').any(function(obj) {\r\n                return $(obj).visible() && $(obj).select('input[name^=\"definition[' + type + ']\"]')[0].value == '';\r\n            });\r\n\r\n            if (emptyVisibleElementsExist) {\r\n                return;\r\n            }\r\n\r\n            var hiddenElements = $$('.' + type + '_tr').findAll(function(obj) {\r\n                return !$(obj).visible();\r\n            });\r\n\r\n            if (hiddenElements.size() == 0) {\r\n                return;\r\n            }\r\n\r\n            hiddenElements.shift().show();\r\n\r\n            $('hide_' + type + '_action').removeClassName('action-disabled');\r\n            $('show_' + type + '_action').addClassName('action-disabled');\r\n        },\r\n\r\n        hideElement: function(type, force)\r\n        {\r\n            force = force || false;\r\n\r\n            var visibleElements = [];\r\n            $$('.' + type + '_tr').each(function(el) {\r\n                if(el.visible()) visibleElements.push(el);\r\n            });\r\n\r\n            if (visibleElements.length <= 0 || (!force && visibleElements[visibleElements.length - 1].getAttribute('undeletable'))) {\r\n                return;\r\n            }\r\n\r\n            if (visibleElements.length == 1) {\r\n                var elementMode = $(type + '_mode');\r\n                elementMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::' + type.toUpperCase() + '_MODE_NONE');\r\n                elementMode.simulate('change');\r\n            }\r\n\r\n            if (visibleElements.size() > 1) {\r\n\r\n                var lastVisibleElement = visibleElements.pop();\r\n                lastVisibleElement.select('input[name^=\"definition[' + type + ']\"]')[0].value = '';\r\n                lastVisibleElement.hide();\r\n\r\n                var nextVisibleElement = visibleElements.pop();\r\n                if(!force && nextVisibleElement.getAttribute('undeletable')) {\r\n                    $('hide_' + type + '_action').addClassName('action-disabled');\r\n                }\r\n            }\r\n\r\n            $('show_' + type + '_action').removeClassName('action-disabled');\r\n        },\r\n\r\n        forceFillUpElement: function(type, value)\r\n        {\r\n            // check if already rendered. render if need.\r\n            var neededTr = null;\r\n            $$('.' + type + '_tr').each(function(obj) {\r\n                if ($(obj).visible() && $(obj).select('input[name^=\"definition[' + type + ']\"]')[0].value == value) {\r\n                    neededTr = obj;\r\n                    return false;\r\n                }\r\n            });\r\n\r\n            if (!neededTr) {\r\n\r\n                this.showElement(type);\r\n\r\n                var emptyVisibleTrs = $$('.' + type + '_tr').findAll(function(obj) {\r\n                    return $(obj).visible() && $(obj).select('input[name^=\"definition[' + type + ']\"]')[0].value == '';\r\n                });\r\n\r\n                neededTr = emptyVisibleTrs.pop();\r\n            }\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            var input = neededTr.down('input[type=\"text\"]');\r\n\r\n            input.setAttribute('disabled', 'disabled');\r\n            input.value = value;\r\n\r\n            neededTr.down('.admin__field').appendChild(new Element('input', {\r\n                name  : input.name,\r\n                type  : 'hidden',\r\n                value : value\r\n            }));\r\n\r\n            neededTr.setAttribute('undeletable', '1');\r\n            neededTr.down('.attributes-container-td').hide();\r\n            // ---------------------------------------\r\n\r\n            $('hide_' + type + '_action').addClassName('action-disabled');\r\n            this.multi_element_keyup(type, {value:' '});\r\n        },\r\n\r\n        forceClearElements: function(type)\r\n        {\r\n            var self = this;\r\n\r\n            var visibleTrs = $$('.' + type + '_tr').findAll(function(obj) {\r\n                return $(obj).visible();\r\n            });\r\n\r\n            visibleTrs.each(function(el) {\r\n\r\n                el.removeAttribute('undeletable');\r\n                el.down('input[type=\"text\"]').removeAttribute('disabled');\r\n                el.down('.attributes-container-td').show();\r\n\r\n                var hiddenInput = el.down('input[type=\"hidden\"]');\r\n                hiddenInput && hiddenInput.remove();\r\n\r\n                self.hideElement(type, true);\r\n            });\r\n\r\n            $('hide_' + type + '_action').removeClassName('action-disabled');\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Description.js":"define([\r\n    'jquery',\r\n    'underscore',\r\n    'M2ePro/Amazon/Template/Edit'\r\n], function (jQuery, _) {\r\n\r\n    window.AmazonTemplateDescription = Class.create(AmazonTemplateEdit, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            var self = this;\r\n\r\n            self.specificHandler = null;\r\n\r\n            // ---------------------------------------\r\n            self.categoryInfo = {};\r\n\r\n            self.categoryPathHiddenInput            = $('category_path');\r\n            self.categoryNodeIdHiddenInput          = $('browsenode_id');\r\n\r\n            self.categoryProductDataNickHiddenInput = $('product_data_nick');\r\n            // ---------------------------------------\r\n\r\n            self.productDataNicksInfo = {};\r\n            self.variationThemes      = [];\r\n\r\n            // ---------------------------------------\r\n\r\n            self.initValidation();\r\n        },\r\n\r\n        initValidation: function()\r\n        {\r\n            var self = this;\r\n\r\n            self.setValidationCheckRepetitionValue('M2ePro-description-template-title',\r\n                M2ePro.translator.translate('The specified Title is already used for another Policy. Policy Title must be unique.'),\r\n                'Template\\\\Description', 'title', 'id',\r\n                M2ePro.formData.id,\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Amazon::NICK'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-greater-than', function(value, el) {\r\n\r\n                if (!el.up('div.admin__field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                value = str_replace(',', '.', value);\r\n\r\n                if (value.match(/[^\\d.]+/g) || value < 0) {\r\n                    return false;\r\n                }\r\n\r\n                return value >= el.getAttribute('min_value');\r\n            }, M2ePro.translator.translate('Please enter a valid number value in a specified range.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-category', function(value) {\r\n\r\n                if (!self.isNewAsinAccepted()) {\r\n                    return true;\r\n                }\r\n\r\n                return $('category_path').value != '';\r\n            }, M2ePro.translator.translate('You should select Category and Product Type first'));\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            $('marketplace_id').observe('change', AmazonTemplateDescriptionObj.onChangeMarketplace);\r\n\r\n            $('new_asin_accepted').observe('change', AmazonTemplateDescriptionObj.onChangeNewAsinAccepted);\r\n\r\n            $('edit_category_link').observe('click', AmazonTemplateDescriptionObj.onClickEditCategory);\r\n            $('product_data_nick_select').observe('change', AmazonTemplateDescriptionObj.onChangeProductDataNick);\r\n\r\n            $('worldwide_id_mode')\r\n                .observe('change', AmazonTemplateDescriptionObj.onChangeWorldwideId)\r\n                .simulate('change');\r\n\r\n            $('registered_parameter')\r\n                .observe('change', AmazonTemplateDescriptionObj.onChangeRegisteredParameter)\r\n                .simulate('change');\r\n\r\n            $('amazonTemplateDescriptionEditTabs_specifics').observe('click', AmazonTemplateDescriptionObj.checkSpecificsReady);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setSpecificHandler: function(object)\r\n        {\r\n            var self = this;\r\n            self.specificHandler = object;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isNewAsinAccepted: function()\r\n        {\r\n            return $('new_asin_accepted').value == 1;\r\n        },\r\n\r\n        checkMarketplaceSelection: function()\r\n        {\r\n            return $('marketplace_id').value != '';\r\n        },\r\n\r\n        checkSpecificsReady: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            if (!self.specificHandler.isReady()) {\r\n                alert(M2ePro.translator.translate('You should select Category and Product Type first'));\r\n                self.goToGeneralTab();\r\n            }\r\n        },\r\n\r\n        //########################################\r\n\r\n        duplicateClick: function($super, $headId)\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-description-template-title',\r\n                M2ePro.translator.translate('The specified Title is already used for another Policy. Policy Title must be unique.'),\r\n                'Template\\\\Description', 'title', '','',\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Amazon::NICK'));\r\n\r\n            if (M2ePro.customData.category_locked) {\r\n\r\n                M2ePro.customData.category_locked = false;\r\n                this.hideCategoryWarning('category_locked_warning_message');\r\n                $('edit_category_link').show();\r\n\r\n                $('product_data_nick_select').removeAttribute('disabled');\r\n            }\r\n\r\n            if (M2ePro.customData.marketplace_locked) {\r\n\r\n                M2ePro.customData.marketplace_locked = false;\r\n                $('marketplace_locked_warning_message').remove();\r\n\r\n                if (!M2ePro.customData.marketplace_force_set) {\r\n                    $('marketplace_hidden_input').remove();\r\n                    $('marketplace_id').removeAttribute('disabled');\r\n                }\r\n            }\r\n\r\n            if (M2ePro.customData.new_asin_switcher_locked) {\r\n\r\n                M2ePro.customData.new_asin_switcher_locked = false;\r\n                $('new_asin_locked_warning_message').remove();\r\n\r\n                if (!M2ePro.customData.new_asin_switcher_force_set) {\r\n                    $('new_asin_accepted_hidden_input').remove();\r\n                    $('new_asin_accepted').removeAttribute('disabled');\r\n                }\r\n            }\r\n\r\n            $super($headId, M2ePro.translator.translate('Add Description Policy'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveClick: function($super, url, confirmText, templateNick)\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            self.specificHandler.prepareSpecificsDataToPost();\r\n            $super(url, confirmText, templateNick);\r\n        },\r\n\r\n        saveAndEditClick: function($super, url, tabsId, confirmText, templateNick)\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            self.specificHandler.prepareSpecificsDataToPost();\r\n            $super(url, tabsId, confirmText, templateNick);\r\n        },\r\n\r\n        saveAndCloseClick: function($super, confirmText, templateNick)\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            self.specificHandler.prepareSpecificsDataToPost();\r\n            $super(confirmText, templateNick);\r\n        },\r\n\r\n        //########################################\r\n\r\n        onChangeMarketplace: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n            self.resetCategory();\r\n        },\r\n\r\n        onClickEditCategory: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            if (!self.checkMarketplaceSelection()) {\r\n                self.alert(M2ePro.translator.translate('You should select Marketplace first.'));\r\n                return;\r\n            }\r\n\r\n            AmazonTemplateDescriptionCategoryChooserObj.showEditCategoryPopUp();\r\n        },\r\n\r\n        onChangeProductDataNick: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            self.saveRecentProductDataNick(this.value);\r\n\r\n            self.resetRequiredAttributesForProductType();\r\n            self.setProductDataNick(this.value);\r\n        },\r\n\r\n        onChangeNewAsinAccepted: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            // ---------------------------------------\r\n            var onlyAsinBlocks = $$('.hide-when-asin-is-disabled');\r\n\r\n            onlyAsinBlocks.invoke('hide');\r\n            if (this.value == 1) {\r\n\r\n                onlyAsinBlocks.invoke('show');\r\n\r\n                var worldWideIdMode = $('worldwide_id_mode');\r\n                worldWideIdMode.simulate('change');\r\n\r\n                if ($('registered_parameter').value == '' &&\r\n                    $('worldwide_id_custom_attribute').value == '') {\r\n                    worldWideIdMode.value = -1;\r\n                }\r\n\r\n                $('item_package_quantity_mode').simulate('change');\r\n                $('number_of_items_mode').simulate('change');\r\n            }\r\n            // ---------------------------------------\r\n\r\n            // set is required\r\n            parseInt(this.value) ? $('category_path').addClassName('M2ePro-required-when-visible')\r\n                : $('category_path').removeClassName('M2ePro-required-when-visible');\r\n            self.updateSpanRequirements($('template_description_edit_category_container'), this.value);\r\n\r\n            self.updateFieldRequirements($('manufacturer_mode'), this.value);\r\n            self.updateFieldRequirements($('brand_mode'), this.value);\r\n            self.updateFieldRequirements($('image_main_mode'), this.value);\r\n\r\n            var chooser = $('number_of_items_mode');\r\n            if (chooser.getAttribute('required_attribute_for_new_asin')) {\r\n                if(this.value == 0) chooser.value = '';\r\n                self.updateFieldRequirements(chooser, this.value, 'M2ePro-required-when-visible');\r\n            }\r\n\r\n            chooser = $('item_package_quantity_mode');\r\n            if (chooser.getAttribute('required_attribute_for_new_asin')) {\r\n                if(this.value == 0) chooser.value = '';\r\n                self.updateFieldRequirements(chooser, this.value, 'M2ePro-required-when-visible');\r\n            }\r\n            // ---------------------------------------\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        onChangeWorldwideId: function()\r\n        {\r\n            var target = $('worldwide_id_custom_attribute');\r\n\r\n            target.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description::WORLDWIDE_ID_MODE_CUSTOM_ATTRIBUTE')) {\r\n                AmazonTemplateDescriptionObj.updateHiddenValue(this, target);\r\n            }\r\n        },\r\n\r\n        onChangeRegisteredParameter: function()\r\n        {\r\n            var worldwideIdMode = $('worldwide_id_mode'),\r\n                noneOption      = worldwideIdMode.down('option'),\r\n                currentValue    = worldwideIdMode.getAttribute('data-current-value');\r\n\r\n            if (!this.value) {\r\n                noneOption.hide();\r\n                worldwideIdMode.simulate('change');\r\n\r\n                if ($('worldwide_id_custom_attribute').value == '') {\r\n                    worldwideIdMode.selectedIndex = -1;\r\n                }\r\n            } else {\r\n                noneOption.show();\r\n                if (currentValue == '') {\r\n                    worldwideIdMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description::WORLDWIDE_ID_MODE_NONE');\r\n                }\r\n                $('worldwide_id_custom_attribute').value = ''\r\n            }\r\n            worldwideIdMode.setAttribute('data-current-value', '');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setCategory: function(categoryInfo, notSetProductTypeForceIfOnlyOne)\r\n        {\r\n            var self = this;\r\n            notSetProductTypeForceIfOnlyOne = notSetProductTypeForceIfOnlyOne || false;\r\n\r\n            this.categoryInfo = categoryInfo;\r\n\r\n            this.categoryPathHiddenInput.value   = this.getInterfaceCategoryPath(categoryInfo);\r\n            this.categoryNodeIdHiddenInput.value = categoryInfo.browsenode_id;\r\n\r\n            this.updateCategoryPathSpan(this.getInterfaceCategoryPath(categoryInfo, true));\r\n\r\n            this.updateAvailableProductTypes();\r\n\r\n            if (self.categoryInfo.product_data_nicks.length == 1 && !notSetProductTypeForceIfOnlyOne) {\r\n                self.setProductDataNickFromTree(self.categoryInfo.product_data_nicks[0]);\r\n            }\r\n\r\n            this.hideCategoryWarning('category_is_not_accessible_message');\r\n        },\r\n\r\n        setProductDataNickFromTree: function(productDataNick)\r\n        {\r\n            $$('#product_data_nick_select option').each(function(el) {\r\n\r\n                var optGroup = $(el).up('optgroup');\r\n\r\n                if (el.value == productDataNick && optGroup &&\r\n                    optGroup.getAttribute('is_recent') === null && optGroup.getAttribute('is_recommended') === null)\r\n                {\r\n                    el.setAttribute('selected', 'selected');\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            AmazonTemplateDescriptionObj.setProductDataNick(productDataNick);\r\n        },\r\n\r\n        setProductDataNick: function(productDataNick)\r\n        {\r\n            var self = this;\r\n\r\n            this.categoryProductDataNickHiddenInput.value = productDataNick;\r\n\r\n            self.categoryInfo['required_attributes'] = {};\r\n\r\n            $H(this.productDataNicksInfo).each(function(item){\r\n\r\n                if (item.key == productDataNick) {\r\n                    self.categoryInfo['required_attributes'] = item.value.required_attributes;\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            this.updateRequiredAttributesForProductType();\r\n            this.updateWarningMessagesVisibility();\r\n\r\n            this.specificHandler.reset();\r\n            this.specificHandler.run(this.categoryInfo, productDataNick);\r\n        },\r\n\r\n        saveRecentProductDataNick: function(productDataNick)\r\n        {\r\n            if (productDataNick == '') {\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/saveRecentProductDataNick'), {\r\n                method     : 'post',\r\n                parameters : {\r\n                    marketplace_id:    $('marketplace_id').value,\r\n                    product_data_nick: productDataNick\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        resetCategory: function()\r\n        {\r\n            this.categoryInfo = {};\r\n\r\n            this.categoryPathHiddenInput.value   = '';\r\n            this.categoryNodeIdHiddenInput.value = '';\r\n\r\n            this.resetCategoryPathSpan();\r\n            this.resetProductDataNick();\r\n\r\n            this.hideCategoryWarning('category_variation_warning_message');\r\n        },\r\n\r\n        resetProductDataNick: function()\r\n        {\r\n            this.categoryProductDataNickHiddenInput.value = '';\r\n\r\n            this.resetRequiredAttributesForProductType();\r\n\r\n            $('product_data_nick_tr').hide();\r\n            $('product_data_nick_select').update();\r\n\r\n            this.specificHandler.reset();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareEditMode: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            if (M2ePro.formData.product_data_nick == '' ||\r\n                M2ePro.formData.browsenode_id == '' ||\r\n                M2ePro.formData.category_path == '') {\r\n\r\n                return;\r\n            }\r\n\r\n            var callback = function(transport) {\r\n\r\n                if (!transport.responseText) {\r\n\r\n                    self.resetCategory();\r\n                    self.showCategoryWarning('category_is_not_accessible_message');\r\n\r\n                } else {\r\n\r\n                    var categoryInfo = transport.responseText.evalJSON();\r\n\r\n                    self.setCategory(categoryInfo, true);\r\n                    var isProductTypeAvailable = self.isProductTypeAvailable(M2ePro.formData.product_data_nick);\r\n\r\n                    if (isProductTypeAvailable) {\r\n                        self.setProductDataNickFromTree(M2ePro.formData.product_data_nick);\r\n                    } else {\r\n                        self.specificHandler.resetFormDataSpecifics();\r\n                    }\r\n\r\n                    if (M2ePro.customData.category_locked) {\r\n\r\n                        self.showCategoryWarning('category_locked_warning_message');\r\n                        $('edit_category_link').hide();\r\n\r\n                        $('product_data_nick_select').setAttribute('disabled', 'disabled');\r\n                    }\r\n\r\n                    if (!isProductTypeAvailable) {\r\n                        self.showCategoryWarning('category_is_not_accessible_message');\r\n                        $('product_data_nick_select').removeAttribute('disabled');\r\n                    }\r\n                }\r\n            };\r\n\r\n            AmazonTemplateDescriptionCategoryChooserObj.getCategoryInfoFromDictionaryBrowseNodeId(\r\n                M2ePro.formData.browsenode_id,\r\n                M2ePro.formData.category_path,\r\n                callback\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showCategoryWarning: function(item)\r\n        {\r\n            var me = $(item);\r\n\r\n            var atLeastOneWarningShown = $$('#category_warning_messages .category-warning-item').any(function(obj) {\r\n                return $(obj).id != me.id && $(obj).visible();\r\n            });\r\n\r\n            if (atLeastOneWarningShown && me.previous('span.additional-br')) {\r\n                me.previous('span.additional-br').show();\r\n            }\r\n\r\n            $(item).show();\r\n            $('category_warning_messages').show();\r\n        },\r\n\r\n        hideCategoryWarning: function(item)\r\n        {\r\n            var me = $(item);\r\n            $(item).hide();\r\n\r\n            var atLeastOneWarningShown = $$('#category_warning_messages .category-warning-item').any(function(obj) {\r\n                return $(obj).visible();\r\n            });\r\n\r\n            if (me.previous('span.additional-br')) {\r\n                me.previous('span.additional-br').hide();\r\n            }\r\n\r\n            !atLeastOneWarningShown && $('category_warning_messages').hide();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        updateCategoryPathSpan: function(path)\r\n        {\r\n            $('category_path_span').update(path);\r\n        },\r\n\r\n        resetCategoryPathSpan: function()\r\n        {\r\n            var span = $('category_path_span');\r\n            span.innerHTML = '<span style=\"color: grey; font-style: italic\">' + M2ePro.translator.translate('Not Selected') + '</span>';\r\n        },\r\n\r\n        resetRequiredAttributesForProductType: function()\r\n        {\r\n            this.resetManufacturerPartNumberRequired();\r\n            this.resetTargetAudienceRequired();\r\n            this.resetItemDimensionWeightRequired();\r\n            this.resetItemPackageQuantityRequired();\r\n            this.resetNumberOfItemsRequired();\r\n        },\r\n\r\n        updateRequiredAttributesForProductType: function()\r\n        {\r\n            this.updateManufacturerPartNumberRequired();\r\n            this.updateTargetAudienceRequired();\r\n            this.updateItemDimensionWeightRequired();\r\n            this.updateItemPackageQuantityRequired();\r\n            this.updateNumberOfItemsRequired();\r\n        },\r\n\r\n        updateWarningMessagesVisibility: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getVariationThemes'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    marketplace_id:     $('marketplace_id').value,\r\n                    product_data_nick: self.categoryProductDataNickHiddenInput.value\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    self.variationThemes = transport.responseText.evalJSON();\r\n\r\n                    _.isEmpty(self.variationThemes) ? self.showCategoryWarning('category_variation_warning_message')\r\n                        : self.hideCategoryWarning('category_variation_warning_message');\r\n                }\r\n            });\r\n        },\r\n\r\n        //########################################\r\n\r\n        resetManufacturerPartNumberRequired: function()\r\n        {\r\n            this.updateFieldRequirements($('manufacturer_part_number_mode'), 0);\r\n        },\r\n\r\n        resetItemDimensionWeightRequired: function()\r\n        {\r\n            var chooser = $('item_dimensions_weight_mode');\r\n            chooser.down('option').show(); // 'None' option\r\n        },\r\n\r\n        resetTargetAudienceRequired: function()\r\n        {\r\n            var targetAudienceChooser = $('target_audience_mode');\r\n            targetAudienceChooser.removeAttribute('disabled');\r\n\r\n            var hiddenInput = targetAudienceChooser.up('div.admin__field-control').down('input[type=\"hidden\"]');\r\n            hiddenInput && hiddenInput.remove();\r\n\r\n            AmazonTemplateDescriptionDefinitionObj.forceClearElements('target_audience');\r\n        },\r\n\r\n        resetItemPackageQuantityRequired: function()\r\n        {\r\n            var chooser = $('item_package_quantity_mode');\r\n\r\n            this.updateFieldRequirements(chooser, 0);\r\n            chooser.removeAttribute('required_attribute_for_new_asin');\r\n        },\r\n\r\n        resetNumberOfItemsRequired: function()\r\n        {\r\n            var chooser = $('number_of_items_mode');\r\n\r\n            this.updateFieldRequirements(chooser, 0);\r\n            chooser.removeAttribute('required_attribute_for_new_asin');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        updateManufacturerPartNumberRequired: function()\r\n        {\r\n            if (!this.categoryInfo.required_attributes.hasOwnProperty('/DescriptionData/MfrPartNumber')) {\r\n                return;\r\n            }\r\n\r\n            this.updateFieldRequirements($('manufacturer_part_number_mode'), 1);\r\n        },\r\n\r\n        updateTargetAudienceRequired: function()\r\n        {\r\n            if (!this.categoryInfo.required_attributes.hasOwnProperty('/DescriptionData/TargetAudience')) {\r\n                return;\r\n            }\r\n\r\n            var targetAudienceChooser = $('target_audience_mode');\r\n\r\n            targetAudienceChooser.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::TARGET_AUDIENCE_MODE_CUSTOM');\r\n            targetAudienceChooser.simulate('change');\r\n            targetAudienceChooser.setAttribute('disabled', 'disabled');\r\n\r\n            targetAudienceChooser.up('.admin__field').appendChild(new Element('input', {\r\n                name  : targetAudienceChooser.name,\r\n                type  : 'hidden',\r\n                value : M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::TARGET_AUDIENCE_MODE_CUSTOM')\r\n            }));\r\n\r\n            this.categoryInfo.required_attributes['/DescriptionData/TargetAudience'].each(function(value) {\r\n                AmazonTemplateDescriptionDefinitionObj.forceFillUpElement('target_audience', value);\r\n            });\r\n        },\r\n\r\n        updateItemDimensionWeightRequired: function()\r\n        {\r\n            if (!this.categoryInfo.required_attributes.hasOwnProperty('/DescriptionData/ItemDimensions/Weight')) {\r\n                return;\r\n            }\r\n\r\n            var chooser = $('item_dimensions_weight_mode');\r\n            chooser.down('option').hide(); // 'None' option\r\n            if (chooser.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::WEIGHT_MODE_NONE')) {\r\n                chooser.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Template\\\\Description\\\\Definition::WEIGHT_MODE_CUSTOM_VALUE');\r\n            }\r\n\r\n            chooser.simulate('change');\r\n        },\r\n\r\n        updateItemPackageQuantityRequired: function()\r\n        {\r\n            if (!this.categoryInfo.required_attributes.hasOwnProperty('/ItemPackageQuantity')) {\r\n                return;\r\n            }\r\n\r\n            var chooser = $('item_package_quantity_mode');\r\n\r\n            chooser.setAttribute('required_attribute_for_new_asin', 'true');\r\n\r\n            if (this.isNewAsinAccepted()) {\r\n                this.updateFieldRequirements(chooser, 1, 'M2ePro-required-when-visible');\r\n            }\r\n        },\r\n\r\n        updateNumberOfItemsRequired: function()\r\n        {\r\n            if (!this.categoryInfo.required_attributes.hasOwnProperty('/NumberOfItems')) {\r\n                return;\r\n            }\r\n\r\n            var chooser = $('number_of_items_mode');\r\n\r\n            chooser.setAttribute('required_attribute_for_new_asin', 'true');\r\n\r\n            if (this.isNewAsinAccepted()) {\r\n                this.updateFieldRequirements(chooser, 1, 'M2ePro-required-when-visible');\r\n            }\r\n        },\r\n\r\n        //########################################\r\n\r\n        updateAvailableProductTypes: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionObj;\r\n\r\n            $('product_data_nick_tr').show();\r\n\r\n            var renderingCallback = function(transport) {\r\n\r\n                var response = transport.responseText.evalJSON();\r\n\r\n                if (!response) {\r\n                    return;\r\n                }\r\n\r\n                var html = '';\r\n\r\n                $H(response['grouped_data']).each(function(data) {\r\n\r\n                    var group            = data.key,\r\n                        productDataNicks = data.value;\r\n\r\n                    html += '<optgroup label=\"' + group + '\">';\r\n\r\n                    $H(productDataNicks).each(function(el) {\r\n                        html += '<option value=\"' + el.value.product_data_nick + '\">' + el.value.title + '</option>';\r\n                    });\r\n\r\n                    html += '</optgroup>';\r\n                });\r\n\r\n                var recommendedHtml = '';\r\n\r\n                if (self.categoryInfo.product_data_nicks.length > 0) {\r\n\r\n                    recommendedHtml += '<optgroup is_recommended=\"1\" label=\"' + M2ePro.translator.translate('Recommended') + '\">';\r\n\r\n                    self.categoryInfo.product_data_nicks.each(function(el){\r\n\r\n                        var title = typeof response['product_data'][el] != 'undefined' ? response['product_data'][el]['group'] + ' > ' + response['product_data'][el]['title']\r\n                            : el;\r\n\r\n                        recommendedHtml += '<option value=\"' + el + '\">' + title + '</option>';\r\n                    });\r\n\r\n                    recommendedHtml += '</optgroup>';\r\n                }\r\n\r\n                var recentHtml = '';\r\n\r\n                if (Object.keys(response['recent_data']).length > 0) {\r\n\r\n                    recentHtml += '<optgroup is_recent=\"1\" label=\"' + M2ePro.translator.translate('Recent') + '\">';\r\n\r\n                    $H(response['recent_data']).each(function(data) {\r\n\r\n                        var title = data.value['group'] + ' > ' + data.value['title'];\r\n                        recentHtml += '<option value=\"' + data.key + '\">' + title + '</option>';\r\n                    });\r\n\r\n                    recentHtml += '</optgroup>';\r\n                }\r\n\r\n                html = '<option style=\"display: none;\"></option>' + recommendedHtml + recentHtml + html;\r\n                $('product_data_nick_select').update(html);\r\n            };\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getAvailableProductTypes'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: {\r\n                    marketplace_id: $('marketplace_id').value,\r\n                    browsenode_id:  self.categoryNodeIdHiddenInput.value\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    self.productDataNicksInfo = transport.responseText.evalJSON()['product_data'];\r\n                    renderingCallback.call(self, transport);\r\n                }\r\n            });\r\n        },\r\n\r\n        isProductTypeAvailable: function(productType)\r\n        {\r\n            var result = false;\r\n\r\n            $H(this.productDataNicksInfo).each(function(el){\r\n\r\n                if (productType == el.key) {\r\n                    result = true;\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            return result;\r\n        },\r\n\r\n        //########################################\r\n\r\n        updateSpanRequirements: function(element, dependence)\r\n        {\r\n            parseInt(dependence) ? element.up('.field').addClassName('_required')\r\n                : element.up('.field').removeClassName('_required');\r\n        },\r\n\r\n        updateFieldRequirements: function(element, dependence, className)\r\n        {\r\n            className = className || 'required-entry';\r\n\r\n            // ---------------------------------------\r\n            var firstOption = element.select('option').first();\r\n            if (firstOption.value == '0') {\r\n\r\n                firstOption.show();\r\n\r\n                var hiddenOpt = element.select('option.hidden-opt').first();\r\n                hiddenOpt && hiddenOpt.remove();\r\n\r\n                if (parseInt(dependence)) {\r\n\r\n                    firstOption.hide();\r\n\r\n                    element.appendChild(new Element('option', {\r\n                        style: 'display: none;',\r\n                        class: 'hidden-opt'\r\n                    }));\r\n                }\r\n            }\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            if (parseInt(dependence) && element.value == 0) {\r\n                element.value = '';\r\n            }\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            parseInt(dependence) ? element.addClassName(className)\r\n                : element.removeClassName(className);\r\n            // ---------------------------------------\r\n\r\n            element.simulate('change');\r\n            this.updateSpanRequirements(element, dependence);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getInterfaceCategoryPath: function(categoryInfo, withBrowseNodeId)\r\n        {\r\n            withBrowseNodeId = withBrowseNodeId || false;\r\n\r\n            var path = categoryInfo.path != null ? categoryInfo.path.replace(/>/g,' > ') + ' > ' + categoryInfo.title\r\n                : categoryInfo.title;\r\n\r\n            return !withBrowseNodeId ? path : path + ' ('+categoryInfo.browsenode_id+')';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        goToGeneralTab: function()\r\n        {\r\n            jQuery('#amazonTemplateDescriptionEditTabs').tabs('option', 'active', 0);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Category/Chooser.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function (jQuery, modal) {\r\n\r\n    window.AmazonTemplateDescriptionCategoryChooser = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        specificHandler: null,\r\n\r\n        selectedCategoryIdBefore     : null,\r\n        selectedCategoryId           : null,\r\n        preloadedSelectedCategoryObj : null,\r\n\r\n        variationThemes: {},\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            this.categoryNodeIdHiddenInput = $('browsenode_id');\r\n            this.categoryPathHiddenInput   = $('category_path');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setSpecificHandler: function(object)\r\n        {\r\n            this.specificHandler = object;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showEditCategoryPopUp: function()\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getCategoryChooserHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: $('marketplace_id').value,\r\n                    browsenode_id:  self.categoryNodeIdHiddenInput.value,\r\n                    category_path:  self.categoryPathHiddenInput.value\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (typeof self.popUp != 'undefined') {\r\n                        self.popUp.modal('closeModal');\r\n                    }\r\n\r\n                    var html = transport.responseText;\r\n                    var callback = function(transport) {\r\n\r\n                        var categoryInfo = transport.responseText.evalJSON();\r\n\r\n                        self.selectedCategoryId           = null;\r\n                        self.selectedCategoryIdBefore     = null;\r\n                        self.preloadedSelectedCategoryObj = null;\r\n\r\n                        if (typeof categoryInfo.category_id != 'undefined') {\r\n\r\n                            self.selectedCategoryId           = categoryInfo.category_id;\r\n                            self.selectedCategoryIdBefore     = categoryInfo.category_id;\r\n                            self.preloadedSelectedCategoryObj = categoryInfo;\r\n                        }\r\n                    };\r\n\r\n                    self.openPopUp(html);\r\n\r\n                    if (self.categoryNodeIdHiddenInput.value && self.categoryPathHiddenInput.value) {\r\n                        self.getCategoryInfoFromDictionaryBrowseNodeId(self.categoryNodeIdHiddenInput.value,\r\n                            self.categoryPathHiddenInput.value,\r\n                            callback);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        openPopUp: function(html)\r\n        {\r\n            var self = this,\r\n                modalDialogMessage = $('modal_dialog_message');\r\n\r\n            if (self.popUp) {\r\n                self.popUp.modal('openModal');\r\n                modalDialogMessage.innerHTML = '';\r\n                modalDialogMessage.insert(html);\r\n                modalDialogMessage.innerHTML.evalScripts();\r\n                AmazonTemplateDescriptionCategoryChooserObj.renderTopLevelCategories('chooser_browser');\r\n                return;\r\n            }\r\n\r\n            modalDialogMessage = new Element('div', {\r\n                id: 'modal_dialog_message'\r\n            });\r\n            modalDialogMessage.insert(html);\r\n            modalDialogMessage.innerHTML.evalScripts();\r\n\r\n            self.popUp = jQuery(modalDialogMessage).modal({\r\n                title: M2ePro.translator.translate('Change Category'),\r\n                type: 'slide',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    //class: 'action-primary',\r\n                    click: function () {\r\n                        this.closeModal();\r\n                    }\r\n                },{\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary',\r\n                    id: 'save_popup_button',\r\n                    click: function () {\r\n                        this.closeModal();\r\n                        AmazonTemplateDescriptionCategoryChooserObj.confirmCategory();\r\n                    }\r\n                }]\r\n            });\r\n            self.popUp.modal('openModal');\r\n        },\r\n\r\n        cancelPopUp: function()\r\n        {\r\n            var self = this;\r\n            self.popUp.modal('closeModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderTopLevelCategories: function(containerId)\r\n        {\r\n            this.prepareDomStructure(null, $(containerId));\r\n            this.renderChildCategories(null);\r\n        },\r\n\r\n        renderChildCategories: function(parentCategoryId)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getChildCategories'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id     : $('marketplace_id').value,\r\n                    parent_category_id : parentCategoryId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (transport.responseText.length <= 2) {\r\n                        return;\r\n                    }\r\n\r\n                    var categories = transport.responseText.evalJSON();\r\n                    self.tempCategories = categories;\r\n\r\n                    var selectEl = $(self.getCategoriesSelectElementId(parentCategoryId));\r\n\r\n                    categories.each(function(category) {\r\n\r\n                        var option = new Element('option', {value: category.category_id});\r\n                        option.observe('click', function() {\r\n                            self.browseClickCategory.call(self, selectEl, category.category_id);\r\n                        });\r\n\r\n                        var arrowString = category.is_leaf == 0 ? ' > ' : '';\r\n                        selectEl.appendChild(option).update(category.title + arrowString);\r\n                    });\r\n\r\n                    selectEl.style.display = 'inline-block';\r\n                    $('chooser_browser').scrollLeft = $('chooser_browser').scrollWidth;\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        browseClickCategory: function(selectObj, categoryId)\r\n        {\r\n            var callback = function(transport) {\r\n\r\n                var categoryInfo = transport.responseText.evalJSON();\r\n\r\n                if (categoryInfo.is_leaf == 1) {\r\n\r\n                    this.selectedCategoryId           = categoryInfo.category_id;\r\n                    this.preloadedSelectedCategoryObj = categoryInfo;\r\n\r\n                    this.updateCurrentlySelectedCategorySpan(categoryInfo);\r\n                }\r\n\r\n                var parentCategoryId = selectObj.id.replace(this.getCategoriesSelectElementId(''), '');\r\n                var parentDiv = $(this.getCategoryChildrenElementId(parentCategoryId));\r\n                parentDiv.innerHTML = '';\r\n\r\n                this.prepareDomStructure(categoryId, parentDiv);\r\n                this.renderChildCategories(categoryId);\r\n            };\r\n\r\n            this.getCategoryInfoFromDictionaryByCategoryId(categoryId, callback);\r\n        },\r\n\r\n        prepareDomStructure: function(categoryId, parentDiv)\r\n        {\r\n            var childrenSelect = new Element('select', {\r\n                id: this.getCategoriesSelectElementId(categoryId),\r\n                style: 'min-width: 200px; max-height: none; display: none;',\r\n                size: '10',\r\n                class: 'multiselect admin__control-multiselect'\r\n            });\r\n            parentDiv.appendChild(childrenSelect);\r\n\r\n            var childrenDiv = new Element('div', {\r\n                id    : this.getCategoryChildrenElementId(categoryId),\r\n                class : 'category-children-block'\r\n            });\r\n            parentDiv.appendChild(childrenDiv);\r\n        },\r\n\r\n        getCategoriesSelectElementId: function(categoryId)\r\n        {\r\n            if (categoryId === null) categoryId = 0;\r\n            return 'category_chooser_select_' + categoryId;\r\n        },\r\n\r\n        getCategoryChildrenElementId: function(categoryId)\r\n        {\r\n            if (categoryId === null) categoryId = 0;\r\n            return 'category_chooser_children_' + categoryId;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirmCategory: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionCategoryChooserObj;\r\n\r\n            if (self.selectedCategoryId == self.selectedCategoryIdBefore) {\r\n                return;\r\n            }\r\n\r\n            AmazonTemplateDescriptionObj.resetCategory();\r\n            self.specificHandler.resetFormDataSpecifics();\r\n\r\n            if (self.preloadedSelectedCategoryObj) {\r\n                AmazonTemplateDescriptionObj.setCategory(self.preloadedSelectedCategoryObj);\r\n                self.saveRecentCategory();\r\n            }\r\n        },\r\n\r\n        unSelectCategory: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionCategoryChooserObj;\r\n\r\n            self.selectedCategoryId           = null;\r\n            self.preloadedSelectedCategoryObj = null;\r\n\r\n            $('category_reset_link').hide();\r\n            $('selected_category_path').innerHTML = '<span style=\"color: grey; font-style: italic\">' + M2ePro.translator.translate('Not Selected') + '</span>';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        refreshAmazonCategories: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionCategoryChooserObj;\r\n            var win = window.open(M2ePro.url.get('amazon_marketplace/index'));\r\n\r\n            var intervalId = setInterval(function() {\r\n\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                self.renderTopLevelCategories('chooser_browser');\r\n\r\n                if ($('query').value.length != 0) {\r\n                    self.search();\r\n                }\r\n\r\n            }, 1000);\r\n        },\r\n\r\n        saveRecentCategory: function()\r\n        {\r\n            if (this.categoryNodeIdHiddenInput.value == '' || this.categoryPathHiddenInput.value == '') {\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/saveRecentCategory'), {\r\n                method     : 'post',\r\n                parameters : {\r\n                    marketplace_id : $('marketplace_id').value,\r\n                    browsenode_id  : this.categoryNodeIdHiddenInput.value,\r\n                    category_path  : this.categoryPathHiddenInput.value\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        search: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionCategoryChooserObj;\r\n\r\n            var query = $('query').value;\r\n            if (query.length < 3) {\r\n                return;\r\n            }\r\n\r\n            self.beforeSearch();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/searchCategory'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: $('marketplace_id').value,\r\n                    query:          query.trim()\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (transport.responseText.length <= 2) {\r\n\r\n                        $('search_results_no_results_tr').show();\r\n                        $('search_results_update_sites_data_tr').show();\r\n                        return;\r\n                    }\r\n\r\n                    var categories = transport.responseText.evalJSON();\r\n                    var resultsTable = $('search_results_table');\r\n\r\n                    categories.each(function(categoryInfo) {\r\n\r\n                        var tr = new Element('tr', { class: 'search_results_results_tr' });\r\n                        tr.appendChild(new Element('td').update(AmazonTemplateDescriptionObj.getInterfaceCategoryPath(categoryInfo, true)));\r\n\r\n                        var link = new Element('a', {href: '#'}).update(M2ePro.translator.translate('Select'));\r\n                        link.observe('click', function() {\r\n                            var categoryPath = AmazonTemplateDescriptionObj.getInterfaceCategoryPath(categoryInfo);\r\n                            self.searchClickCategory.call(self, categoryInfo.browsenode_id, categoryPath);\r\n                        });\r\n\r\n                        tr.appendChild(new Element('td')).appendChild(link);\r\n                        resultsTable.down('tbody').appendChild(tr);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        beforeSearch: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionCategoryChooserObj;\r\n\r\n            $('search_results_no_results_tr').hide();\r\n            $('search_results_update_sites_data_tr').hide();\r\n\r\n            $$('.search_results_results_tr').invoke('remove');\r\n        },\r\n\r\n        searchReset: function()\r\n        {\r\n            var self = AmazonTemplateDescriptionCategoryChooserObj;\r\n\r\n            self.beforeSearch();\r\n            $('query').value = '';\r\n            $('query').focus();\r\n        },\r\n\r\n        searchClickCategory: function(browseNodeId, categoryPath)\r\n        {\r\n            this.selectAndLoadCategory(browseNodeId, categoryPath);\r\n        },\r\n\r\n        keyPressQuery: function(event)\r\n        {\r\n            var self = AmazonTemplateDescriptionCategoryChooserObj;\r\n\r\n            if (event.keyCode == 13) {\r\n                self.search();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        recentClickCategory: function(browseNodeId, categoryPath)\r\n        {\r\n            this.selectAndLoadCategory(browseNodeId, categoryPath);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        selectAndLoadCategory: function(browseNodeId, categoryPath)\r\n        {\r\n            var callback = function(transport) {\r\n\r\n                var categoryInfo = transport.responseText.evalJSON();\r\n\r\n                this.selectedCategoryId           = categoryInfo.category_id;\r\n                this.preloadedSelectedCategoryObj = categoryInfo;\r\n\r\n                this.updateCurrentlySelectedCategorySpan(categoryInfo);\r\n            };\r\n\r\n            this.getCategoryInfoFromDictionaryBrowseNodeId(browseNodeId, categoryPath, callback);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getCategoryInfoFromDictionaryByCategoryId: function(categoryId, callback)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getCategoryInfoByCategoryId'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    marketplace_id : $('marketplace_id').value,\r\n                    category_id    : categoryId\r\n                },\r\n                onSuccess: function(transport) {\r\n                    callback.call(self, transport);\r\n                }\r\n            });\r\n        },\r\n\r\n        getCategoryInfoFromDictionaryBrowseNodeId: function(browsenodeId, categoryPath, callback)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getCategoryInfoByBrowseNodeId'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    marketplace_id     : $('marketplace_id').value,\r\n                    browsenode_id      : browsenodeId,\r\n                    category_path      : categoryPath\r\n                },\r\n                onSuccess: function(transport) {\r\n                    callback.call(self, transport);\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        updateCurrentlySelectedCategorySpan: function(categoryInfo)\r\n        {\r\n            var path = AmazonTemplateDescriptionObj.getInterfaceCategoryPath(categoryInfo, true);\r\n            $('selected_category_path').innerHTML = path;\r\n\r\n            $('category_reset_link').show();\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Category/Specific.js":"define([\r\n    'jquery',\r\n    'M2ePro/Common'\r\n], function (jQuery) {\r\n\r\n    window.AmazonTemplateDescriptionCategorySpecific = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            var self = this;\r\n\r\n            self.dictionaryHelper = new AmazonTemplateDescriptionCategorySpecificDictionary();\r\n\r\n            self.specificsContainer   = $('specifics_container');\r\n            self.specificsHiddenInput = $('encoded_specifics_data');\r\n\r\n            // ---------------------------------------\r\n\r\n            self.categoryInfo    = null;\r\n            self.productDataNick = null;\r\n\r\n            self.formDataSpecifics = [];\r\n            self.selectedSpecifics = {};\r\n            self.renderedSpecifics = [];\r\n\r\n            self.themeAttributes  = [];\r\n\r\n            // ---------------------------------------\r\n\r\n            self.initValidation();\r\n        },\r\n\r\n        initValidation: function()\r\n        {\r\n            var self = this;\r\n\r\n            jQuery.validator.addMethod('M2ePro-specifics-validation', function(value, element) {\r\n\r\n                if (!element.visible()) {\r\n                    return true;\r\n                }\r\n\r\n                var params = self.dictionaryHelper.dictionarySpecifics[element.getAttribute('specific_id')].params;\r\n\r\n                if (params.type == 'int') return self.intTypeValidator(value, params, element);\r\n                if (params.type == 'float') return self.floatTypeValidator(value, params, element);\r\n                if (params.type == 'string') return self.stringTypeValidator(value, params, element);\r\n                if (params.type == 'date_time') return self.dateTimeTypeValidator(value, params, element);\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('The value is incorrect.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-specificAttributes-validation', function(value, element) {\r\n\r\n                if (!element.visible()) {\r\n                    return true;\r\n                }\r\n\r\n                var specific = self.dictionaryHelper.dictionarySpecifics[element.getAttribute('specific_id')];\r\n                var params   = specific.params.attributes[element.getAttribute('attribute_index')];\r\n\r\n                if (params.type == 'int') return self.intTypeValidator(value, params, element);\r\n                if (params.type == 'float') return self.floatTypeValidator(value, params, element);\r\n                if (params.type == 'string') return self.stringTypeValidator(value, params, element);\r\n                if (params.type == 'date_time') return self.dateTimeTypeValidator(value, params, element);\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('The value is incorrect.'));\r\n        },\r\n\r\n        intTypeValidator: function(value, params, element) {\r\n\r\n            value = value.replace(',', '.');\r\n\r\n            if (isNaN(parseInt(value)) || substr_count(value, '.') > 0) {\r\n                return false;\r\n            }\r\n\r\n            var validators = {\r\n                'min_value': function(value, restriction) {\r\n                    return parseInt(value) >= parseInt(restriction);\r\n                },\r\n                'max_value': function(value, restriction) {\r\n                    return parseInt(value) <= parseInt(restriction);\r\n                },\r\n                'total_digits': function(value, restriction) {\r\n                    return value.length <= parseInt(restriction);\r\n                }\r\n            };\r\n\r\n            for (var paramName in params) {\r\n                if (params.hasOwnProperty(paramName) && validators[paramName]) {\r\n                    if (!validators[paramName](value, params[paramName])) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        floatTypeValidator: function(value, params, element) {\r\n\r\n            value = value.replace(',', '.');\r\n\r\n            if (isNaN(parseFloat(value)) || substr_count(value, '.') > 1 || value.substr(-1) == '.') {\r\n                return false;\r\n            }\r\n\r\n            var validators = {\r\n                'min_value': function(value, restriction) {\r\n                    return parseFloat(value) >= parseFloat(restriction);\r\n                },\r\n                'max_value': function(value, restriction) {\r\n                    return parseFloat(value) <= parseFloat(restriction);\r\n                },\r\n                'total_digits': function(value, restriction) {\r\n                    return value.replace('.', '').length <= restriction;\r\n                },\r\n                'decimal_places': function(value, restriction) {\r\n                    return value.indexOf('.') != -1 ? (value.replace(/\\d*\\./,'').length <= restriction.value) : true;\r\n                }\r\n            };\r\n\r\n            for (var paramName in params) {\r\n                if (params.hasOwnProperty(paramName) && validators[paramName]) {\r\n                    if (!validators[paramName](value, params[paramName])) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        dateTimeTypeValidator: function(value, params, element) {\r\n            return /^\\d{4}-\\d{2}-\\d{2}\\s\\d{2}:\\d{2}:\\d{2}$/g.test(value);\r\n        },\r\n\r\n        stringTypeValidator: function(value, params, element) {\r\n\r\n            var validators = {\r\n                'min_length': function(value, restriction) {\r\n                    return value.length >= parseInt(restriction);\r\n                },\r\n                'max_length': function(value, restriction) {\r\n                    return value.length <= parseInt(restriction);\r\n                },\r\n                'pattern': function(value, restriction) {\r\n                    return value.match(new RegExp('^' + restriction + '$'));\r\n                }\r\n            };\r\n\r\n            for (var paramName in params) {\r\n                if (params.hasOwnProperty(paramName) && validators[paramName]) {\r\n                    if (!validators[paramName](value, params[paramName])) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setFormDataSpecifics: function(values)\r\n        {\r\n            this.formDataSpecifics = values;\r\n        },\r\n\r\n        resetFormDataSpecifics: function()\r\n        {\r\n            this.formDataSpecifics = [];\r\n        },\r\n\r\n        //########################################\r\n\r\n        run: function(categoryInfo, productDataNick)\r\n        {\r\n            this.specificsContainer.update();\r\n\r\n            this.categoryInfo    = categoryInfo;\r\n            this.productDataNick = productDataNick;\r\n\r\n            this.initThemeAttributes();\r\n            this.initSpecifics();\r\n        },\r\n\r\n        reset: function()\r\n        {\r\n            this.categoryInfo    = null;\r\n            this.productDataNick = null;\r\n\r\n            this.selectedSpecifics = {};\r\n            this.renderedSpecifics = [];\r\n\r\n            this.themeAttributes = {};\r\n\r\n            this.specificsContainer.update();\r\n        },\r\n\r\n        isReady: function()\r\n        {\r\n            return this.categoryInfo != null && this.productDataNick != null;\r\n        },\r\n\r\n        //########################################\r\n\r\n        initThemeAttributes: function()\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getVariationThemeAttributes'), {\r\n                method: 'get',\r\n                asynchronous: false,\r\n                parameters: {\r\n                    marketplace_id:    $('marketplace_id').value,\r\n                    product_data_nick: self.productDataNick\r\n                },\r\n                onSuccess: function(transport) {\r\n                    self.themeAttributes = transport.responseText.evalJSON();\r\n                }\r\n            });\r\n        },\r\n\r\n        initSpecifics: function()\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getAllSpecifics'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    marketplace_id:     $('marketplace_id').value,\r\n                    product_data_nick:  self.productDataNick\r\n                },\r\n                onSuccess: function(transport) {\r\n                    try {\r\n                        self.dictionaryHelper.setDictionarySpecifics(transport.responseText.evalJSON());\r\n\r\n                        self.renderRootContainer();\r\n                        self.renderRequiredSpecifics();\r\n                        self.renderSpecifics(self.formDataSpecifics);\r\n\r\n                    } catch (e) {\r\n                        console.log(e.message);\r\n                        console.log(e.stack);\r\n                        self.alert(e.name + ': ' + e.message);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderRootContainer: function()\r\n        {\r\n            var specifics = this.dictionaryHelper.getChildSpecifics({'parent_specific_id': null});\r\n\r\n            if (specifics.length <= 0) {\r\n                return;\r\n            }\r\n\r\n            this.renderSpecific(specifics[0].xpath +'-1');\r\n        },\r\n\r\n        renderRequiredSpecifics: function()\r\n        {\r\n            var self      = this,\r\n                specifics = [];\r\n\r\n            if (this.categoryInfo.required_attributes.length <= 0) {\r\n                return;\r\n            }\r\n\r\n            $H(this.categoryInfo.required_attributes).each(function(spInfo) {\r\n\r\n                var xpath = spInfo.key;\r\n\r\n                if (!xpath.match('/ProductData')) {\r\n                    return false;\r\n                }\r\n\r\n                xpath = xpath.replace(/^\\/ProductData\\//, '').split('/');\r\n                xpath = '/' + xpath.join('-1/');\r\n\r\n                if (spInfo.value.length <= 0) {\r\n                    specifics.push({xpath: xpath + '-1', value: ''});\r\n                }\r\n\r\n                spInfo.value.each(function(spValue, index) {\r\n                    specifics.push({xpath: xpath + '-' + (index + 1), value: spValue});\r\n                });\r\n            });\r\n\r\n            specifics.each(function(sp) {\r\n                self.renderSpecific(sp.xpath, {force_value: sp.value});\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderSpecifics: function(specifics)\r\n        {\r\n            var self = this;\r\n\r\n            if (specifics <= 0) {\r\n                return '';\r\n            }\r\n\r\n            specifics.sort(function(spA, spB) {\r\n                return spA.xpath == spB.xpath ? 0 : (spA.xpath > spB.xpath) ? 1 : -1;\r\n            });\r\n\r\n            specifics.each(function(specific) {\r\n                self.renderSpecific(specific.xpath);\r\n            });\r\n        },\r\n\r\n        renderSpecific: function(indexedXpath, params)\r\n        {\r\n            params = params || {};\r\n            var renderer = null;\r\n\r\n            var dictionarySpecific = this.dictionaryHelper.getDictionarySpecific(indexedXpath);\r\n            if (!dictionarySpecific) {\r\n                console.log('Specific not found in dictionary. ' + indexedXpath);\r\n                return;\r\n            }\r\n\r\n            if (this.dictionaryHelper.isSpecificTypeContainer(dictionarySpecific)) {\r\n                renderer = new AmazonTemplateDescriptionCategorySpecificBlockRenderer();\r\n            }\r\n\r\n            if (this.dictionaryHelper.isSpecificTypeSelect(dictionarySpecific) ||\r\n                this.dictionaryHelper.isSpecificTypeText(dictionarySpecific)) {\r\n                renderer = new AmazonTemplateDescriptionCategorySpecificGridRowRenderer();\r\n            }\r\n\r\n            try {\r\n                renderer.setSpecificsHandler(this);\r\n                renderer.setIndexedXpath(indexedXpath);\r\n                renderer.setParams(params);\r\n\r\n                renderer.process();\r\n            } catch (e) {\r\n                console.log(e.message);\r\n                console.log(e.stack);\r\n                this.alert(e.name + ' ' + e.message);\r\n            }\r\n        },\r\n\r\n        //########################################\r\n\r\n        isSpecificRendered: function(xPathWithIndex)\r\n        {\r\n            return (this.renderedSpecifics.indexOf(xPathWithIndex) >= 0);\r\n        },\r\n\r\n        markSpecificAsRendered: function(xPathWithIndex)\r\n        {\r\n            this.renderedSpecifics.push(xPathWithIndex);\r\n        },\r\n\r\n        unMarkSpecificAsRendered: function(xPathWithIndex)\r\n        {\r\n            var regexpObj = new RegExp('^' + xPathWithIndex);\r\n\r\n            for (var i = 0; i < this.renderedSpecifics.length; i++) {\r\n\r\n                if (this.renderedSpecifics[i].match(regexpObj)) {\r\n                    this.renderedSpecifics.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n        },\r\n\r\n        getRealXpathesOfRenderedSpecifics: function()\r\n        {\r\n            var realRenderedXpathes = [];\r\n            this.renderedSpecifics.each(function(sp) {\r\n\r\n                var realPath = sp.replace(/\\-\\d*/g, '');\r\n                if (realRenderedXpathes.indexOf(realPath) >= 0) {\r\n                    return true;\r\n                }\r\n\r\n                realRenderedXpathes.push(realPath);\r\n            });\r\n\r\n            return realRenderedXpathes;\r\n        },\r\n\r\n        getXpathesOfTheSameRenderedSpecific: function(xPathWithIndex)\r\n        {\r\n            var xpathes = [];\r\n\r\n            var tempXpath = xPathWithIndex.replace(/-\\d+$/,'');\r\n            this.renderedSpecifics.each(function(xPath) {\r\n\r\n                if (tempXpath == xPath.replace(/-\\d+$/, '')) {\r\n                    xpathes.push(xPath);\r\n                }\r\n            });\r\n\r\n            return xpathes;\r\n        },\r\n\r\n        getLatestXpathFromTheSame: function(xPathWithIndex)\r\n        {\r\n            var latestIndex = 0;\r\n\r\n            this.getXpathesOfTheSameRenderedSpecific(xPathWithIndex).each(function(xpath) {\r\n                var index = parseInt(xpath.replace(/^.*-/, ''));\r\n                if (index > latestIndex) {\r\n                    latestIndex = index;\r\n                }\r\n            });\r\n\r\n            return xPathWithIndex.replace(/\\d+$/, '') + latestIndex;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        markSpecificAsSelected: function(xPathWithIndex, data)\r\n        {\r\n            var self = this;\r\n\r\n            if (!this.selectedSpecifics.hasOwnProperty(xPathWithIndex)) {\r\n                this.selectedSpecifics[xPathWithIndex] = data;\r\n                return '';\r\n            }\r\n\r\n            $H(data).each(function(dataItem) {\r\n                self.selectedSpecifics[xPathWithIndex][dataItem.key] = dataItem.value;\r\n            });\r\n        },\r\n\r\n        unMarkSpecificAsSelected: function(xPathWithIndex)\r\n        {\r\n            var self = this;\r\n            var regexpObj = new RegExp('^' + xPathWithIndex);\r\n\r\n            // for removing all child specifics\r\n            $H(this.selectedSpecifics).each(function(el) {\r\n\r\n                var specificKey = el.key;\r\n                if (specificKey.match(regexpObj)) delete self.selectedSpecifics[specificKey];\r\n            });\r\n        },\r\n\r\n        isMarkedAsSelected: function(xPathWithIndex)\r\n        {\r\n            return this.selectedSpecifics.hasOwnProperty(xPathWithIndex);\r\n        },\r\n\r\n        getSelectionInfo: function(xPathWithIndex)\r\n        {\r\n            if (this.isMarkedAsSelected(xPathWithIndex)) {\r\n                return this.selectedSpecifics[xPathWithIndex];\r\n            }\r\n\r\n            return this.isInFormData(xPathWithIndex);\r\n        },\r\n\r\n        isInFormData: function(xPathWithIndex)\r\n        {\r\n            var searchResult = false;\r\n            this.formDataSpecifics.each(function(el) {\r\n\r\n                if (el.xpath == xPathWithIndex) {\r\n                    searchResult = el;\r\n                    return false;\r\n                }\r\n            });\r\n\r\n            return searchResult;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareSpecificsDataToPost: function()\r\n        {\r\n            this.specificsHiddenInput.value = Object.toJSON(this.selectedSpecifics);\r\n        },\r\n\r\n        //########################################\r\n\r\n        canSpecificBeOverwrittenByVariationTheme: function(specific)\r\n        {\r\n            return typeof this.themeAttributes[specific.xml_tag] != 'undefined' &&\r\n                this.themeAttributes[specific.xml_tag].length > 0;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Category/Specific/BlockRenderer.js":"define([\r\n    'M2ePro/Amazon/Template/Description/Category/Specific/Renderer'\r\n], function () {\r\n\r\n    window.AmazonTemplateDescriptionCategorySpecificBlockRenderer = Class.create(AmazonTemplateDescriptionCategorySpecificRenderer, {\r\n\r\n        // ---------------------------------------\r\n\r\n        isRootBlock : false,\r\n        isFlatBlock : false,\r\n\r\n        withOneBlockOnly       : false,\r\n        parentWithOneBlockOnly : false,\r\n\r\n        childFilteredSpecifics: {\r\n            all        : [],\r\n            containers : [],\r\n            rows       : []\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        process: function()\r\n        {\r\n            if (this.specificHandler.isSpecificRendered(this.indexedXPath)) {\r\n                return '';\r\n            }\r\n\r\n            if (!this.load()) {\r\n                return '';\r\n            }\r\n\r\n            this.prepareFilteredChildSpecifics();\r\n\r\n            this.renderParentSpecific();\r\n            this.renderSelf();\r\n            this.renderChildRequiredBlocks();\r\n\r\n            this.tuneStyles();\r\n            this.throwEventsToParent();\r\n        },\r\n\r\n        load: function($super)\r\n        {\r\n            var loadResult = $super();\r\n\r\n            if (this.specific.parent_specific_id == null) {\r\n                this.isRootBlock = true;\r\n                return loadResult;\r\n            }\r\n\r\n            var specifics = this.dictionaryHelper.getChildSpecifics(this.specific);\r\n            if (specifics.length == 1 && this.dictionaryHelper.isSpecificTypeContainer(specifics[0])) {\r\n                this.withOneBlockOnly = true;\r\n                return loadResult;\r\n            }\r\n\r\n            // check nesting level\r\n            if (this.indexedXPath.split('/').length >= 4) {\r\n                this.isFlatBlock = true;\r\n            }\r\n\r\n            return loadResult;\r\n        },\r\n\r\n        //########################################\r\n\r\n        prepareFilteredChildSpecifics: function()\r\n        {\r\n            var self       = this,\r\n                all        = [],\r\n                containers = [],\r\n                rows       = [];\r\n\r\n            var specifics = self.dictionaryHelper.getChildSpecifics(this.specific);\r\n            specifics.each(function(specific) {\r\n\r\n                self.dictionaryHelper.isSpecificTypeContainer(specific) ? containers.push(specific)\r\n                    : rows.push(specific);\r\n                all.push(specific);\r\n            });\r\n\r\n            self.childFilteredSpecifics = {\r\n                all        : all,\r\n                containers : containers,\r\n                rows       : rows\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderParentSpecific: function()\r\n        {\r\n            if (this.specific.parent_specific_id == null) {\r\n                return '';\r\n            }\r\n\r\n            if (!this.dictionaryHelper.isSpecificTypeContainer(this.parentSpecific)) {\r\n                return '';\r\n            }\r\n\r\n            var parentBlockRenderer = new AmazonTemplateDescriptionCategorySpecificBlockRenderer();\r\n            parentBlockRenderer.setSpecificsHandler(this.specificHandler);\r\n            parentBlockRenderer.setIndexedXpath(this.getParentIndexedXpath());\r\n\r\n            parentBlockRenderer.process();\r\n        },\r\n\r\n        renderSelf: function()\r\n        {\r\n            this.prepareDomStructure();\r\n\r\n            // ---------------------------------------\r\n            $(this.indexedXPath).observe('my-duplicate-is-rendered', this.onMyDuplicateRendered.bind(this));\r\n            $(this.indexedXPath).observe('undeleteble-specific-appear', this.onWhenUndeletebleSpecificAppears.bind(this));\r\n            // ---------------------------------------\r\n\r\n            this.specificHandler.markSpecificAsRendered(this.indexedXPath);\r\n\r\n            var selectedObj = {};\r\n            selectedObj['mode'] = this.MODE_NONE;\r\n            selectedObj['is_required'] = this.dictionaryHelper.isSpecificRequired(this.specific) ? 1 : 0;\r\n\r\n            this.specificHandler.markSpecificAsSelected(this.indexedXPath, selectedObj);\r\n\r\n            this.renderButtons();\r\n\r\n            this.renderAddSpecificsRow();\r\n            this.renderGrid();\r\n        },\r\n\r\n        renderChildRequiredBlocks: function()\r\n        {\r\n            var self = this;\r\n\r\n            this.childFilteredSpecifics.containers.each(function(specific) {\r\n\r\n                if (!self.dictionaryHelper.isSpecificRequired(specific)) {\r\n                    return true;\r\n                }\r\n\r\n                var renderer = new AmazonTemplateDescriptionCategorySpecificBlockRenderer();\r\n                renderer.setSpecificsHandler(self.specificHandler);\r\n                renderer.setIndexedXpath(self.getChildIndexedPart(specific));\r\n\r\n                if(self.withOneBlockOnly) renderer.parentWithOneBlockOnly = true;\r\n                renderer.process();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        tuneStyles: function()\r\n        {\r\n            var block  = $(this.indexedXPath),\r\n                header = $$('fieldset[id=\"' + this.indexedXPath + '\"] legend').first();\r\n\r\n            var blockStyles = {},\r\n                headerStyles = {};\r\n\r\n            if (this.isRootBlock) {\r\n                headerStyles['display'] = 'none';\r\n                blockStyles = {};\r\n                blockStyles['width'] = '100%';\r\n            }\r\n\r\n            // container in container. like Product Type for example\r\n            if (this.withOneBlockOnly) {\r\n                headerStyles['display'] = 'none';\r\n                blockStyles = {};\r\n                blockStyles['width'] = '100%';\r\n            }\r\n\r\n            if (this.parentWithOneBlockOnly) {\r\n                header.down('span').innerHTML = this.parentSpecific.title + ' > ' + header.down('span').innerHTML;\r\n            }\r\n            // ---------------------------------------\r\n\r\n            // margin ParentGrid => Block\r\n            var parentGrid = $(this.getParentIndexedXpath() + '_grid');\r\n            if (parentGrid) {\r\n                blockStyles['margin-top'] = '20px';\r\n            }\r\n\r\n            if (this.isFlatBlock && !this.parentWithOneBlockOnly) {\r\n                delete(blockStyles['border-right']);\r\n                delete(blockStyles['border-left']);\r\n                delete(blockStyles['border-bottom']);\r\n                blockStyles['padding'] = '0 15px 0 15px';\r\n            }\r\n\r\n            var compuledHeaderStyle = '';\r\n            $H(headerStyles).each(function(el) { compuledHeaderStyle += el.key + ': ' + el.value + '; '; });\r\n            header.setAttribute('style', compuledHeaderStyle);\r\n\r\n            var compuledBlockStyle = '';\r\n            $H(blockStyles).each(function(el) { compuledBlockStyle += el.key + ': ' + el.value + '; '; });\r\n            block.setAttribute('style', compuledBlockStyle);\r\n        },\r\n\r\n        throwEventsToParent: function()\r\n        {\r\n            var parentXpath = this.getParentIndexedXpath();\r\n\r\n            var myEvent = new CustomEvent('child-specific-rendered');\r\n            parentXpath && $(parentXpath).dispatchEvent(myEvent);\r\n\r\n            // my duplicate is already rendered\r\n            this.touchMyNeighbors();\r\n            // ---------------------------------------\r\n        },\r\n\r\n        //########################################\r\n\r\n        prepareDomStructure: function()\r\n        {\r\n            var table = new Element('fieldset', {\r\n                'id':           this.indexedXPath,\r\n                'class':        'fieldset admin__fieldset m2epro-fieldset specifics-block',\r\n                'cellspacing':  0,\r\n                'cellpadding':  0\r\n            });\r\n            var td = table.appendChild(new Element('legend', {\r\n                class: 'admin__legend legend'\r\n            }));\r\n\r\n            td.appendChild(new Element('span', {}))\r\n                .insert(this.specific.title);\r\n\r\n            this.getContainer().appendChild(table);\r\n        },\r\n\r\n        renderAddSpecificsRow: function()\r\n        {\r\n            var renderer = new AmazonTemplateDescriptionCategorySpecificBlockGridAddSpecificRenderer();\r\n            renderer.setSpecificsHandler(this.specificHandler);\r\n            renderer.setIndexedXpath(this.indexedXPath);\r\n\r\n            renderer.childAllSpecifics  = this.childFilteredSpecifics.all;\r\n            renderer.childRowsSpecifics = this.childFilteredSpecifics.rows;\r\n\r\n            renderer.process();\r\n        },\r\n\r\n        renderGrid: function()\r\n        {\r\n            var renderer = new AmazonTemplateDescriptionCategorySpecificBlockGridRenderer();\r\n            renderer.setSpecificsHandler(this.specificHandler);\r\n            renderer.setIndexedXpath(this.indexedXPath);\r\n            renderer.childRowsSpecifics = this.childFilteredSpecifics.rows;\r\n\r\n            renderer.process();\r\n        },\r\n\r\n        renderButtons: function()\r\n        {\r\n            var buttonsBlock = new Element('div', {\r\n                'style': 'float: right; margin-top: 7px;'\r\n            });\r\n\r\n            buttonsBlock.appendChild(this.getAddSpecificButton());\r\n\r\n            var cloneButton = this.getCloneButton();\r\n            if(cloneButton !== null) buttonsBlock.appendChild(cloneButton);\r\n\r\n            var removeButton = this.getRemoveButton();\r\n            if(removeButton !== null) buttonsBlock.appendChild(removeButton);\r\n\r\n            var div = $$('fieldset[id=\"' + this.indexedXPath + '\"] legend').first();\r\n            div.appendChild(buttonsBlock);\r\n        },\r\n\r\n        getAddSpecificButton: function()\r\n        {\r\n            var button = new Element('a', {\r\n                'id'          : this.indexedXPath + '_add_button',\r\n                'indexedxpath': this.indexedXPath,\r\n                'href'        : 'javascript:void(0);',\r\n                'class'       : 'specific-add-button',\r\n                'style'       : 'vertical-align: middle;',\r\n                'title'       : M2ePro.translator.translate('Add Specific into current container')\r\n            });\r\n\r\n            return button;\r\n        },\r\n\r\n        //########################################\r\n\r\n        removeAction: function($super, event)\r\n        {\r\n            var deleteResult = $super(event);\r\n            this.throwEventsToParent();\r\n\r\n            return deleteResult;\r\n        },\r\n\r\n        //########################################\r\n\r\n        getContainer: function()\r\n        {\r\n            if (this.isRootBlock) {\r\n                return $('specifics_container');\r\n            }\r\n\r\n            return $(this.getParentIndexedXpath());\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Category/Specific/Dictionary.js":"define([], function () {\r\n\r\n    window.AmazonTemplateDescriptionCategorySpecificDictionary = Class.create();\r\n    AmazonTemplateDescriptionCategorySpecificDictionary.prototype = {\r\n\r\n        // ---------------------------------------\r\n\r\n        TYPE_TEXT      : 1,\r\n        TYPE_SELECT    : 2,\r\n        TYPE_CONTAINER : 3,\r\n\r\n        dictionarySpecifics: {},\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function() {},\r\n\r\n        // ---------------------------------------\r\n\r\n        setDictionarySpecifics: function(specifics)\r\n        {\r\n            this.dictionarySpecifics = specifics;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isSpecificRequired: function(specific)\r\n        {\r\n            return specific.min_occurs >= 1;\r\n        },\r\n\r\n        isSpecificDesired: function(specific)\r\n        {\r\n            return specific.data_definition.hasOwnProperty('is_desired') ? specific.data_definition.is_desired : false;\r\n        },\r\n\r\n        isSpecificTypeContainer: function(specific)\r\n        {\r\n            return parseInt(specific.type) == this.TYPE_CONTAINER;\r\n        },\r\n\r\n        isSpecificTypeText: function(specific)\r\n        {\r\n            return parseInt(specific.type) == this.TYPE_TEXT;\r\n        },\r\n\r\n        isSpecificTypeTextArea: function(specific)\r\n        {\r\n            return this.isSpecificTypeText(specific) &&\r\n                specific.params.max_length && specific.params.max_length >= 100;\r\n        },\r\n\r\n        isSpecificTypeSelect: function(specific)\r\n        {\r\n            return parseInt(specific.type) == this.TYPE_SELECT;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getParentSpecific: function(specific)\r\n        {\r\n            if (specific.parent_specific_id == null) {\r\n                return null;\r\n            }\r\n\r\n            return this.dictionarySpecifics[specific.parent_specific_id];\r\n        },\r\n\r\n        getChildSpecifics: function(parentSpecific)\r\n        {\r\n            var self = this,\r\n                specifics = [];\r\n\r\n            if (self.dictionarySpecifics.length <= 0) {\r\n                return specifics;\r\n            }\r\n\r\n            $H(self.dictionarySpecifics).each(function(specificData) {\r\n\r\n                var specific = specificData.value;\r\n                specific.parent_specific_id == parentSpecific.specific_id && specifics.push(specific);\r\n            });\r\n\r\n            if (specifics.length <= 0) {\r\n                return specifics;\r\n            }\r\n\r\n            specifics.sort(this.sortSpecific);\r\n            return specifics;\r\n        },\r\n\r\n        getAllChildSpecifics: function(parentSpecific)\r\n        {\r\n            var specifics = [],\r\n                regexpObj = new RegExp('^' + parentSpecific.xpath + '/');\r\n\r\n            $H(this.dictionarySpecifics).each(function(specificData) {\r\n\r\n                var specific = specificData.value;\r\n                specific.xpath.match(regexpObj) && specifics.push(specific);\r\n            });\r\n\r\n            return specifics;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        sortSpecific: function(spA, spB)\r\n        {\r\n            var aIsDesired = parseInt(spA.data_definition.is_desired);\r\n            var bIsDesired = parseInt(spB.data_definition.is_desired);\r\n\r\n            if (aIsDesired && !bIsDesired) {\r\n                return -1;\r\n            }\r\n\r\n            if (bIsDesired && !aIsDesired) {\r\n                return 1;\r\n            }\r\n\r\n            return spA.title == spB.title ? 0 : (spA.title > spB.title) ? 1 : -1;\r\n        },\r\n\r\n        getDictionarySpecific: function(xPathWithIndex)\r\n        {\r\n            var self = this;\r\n\r\n            var dictionarySpecific;\r\n\r\n            xPathWithIndex = xPathWithIndex.replace(/\\/\\-\\d{1,}\\//g,'/')\r\n                .replace(/\\-\\d*/g,'');\r\n\r\n            $H(self.dictionarySpecifics).each(function(specificData) {\r\n\r\n                var specific = specificData.pop();\r\n                if (specific.xpath == xPathWithIndex) {\r\n                    dictionarySpecific = specific;\r\n                    throw $break;\r\n                }\r\n            });\r\n\r\n            return dictionarySpecific;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    };\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Category/Specific/Renderer.js":"define([\r\n    'Magento_Ui/js/modal/alert'\r\n], function (alert) {\r\n\r\n    window.AmazonTemplateDescriptionCategorySpecificRenderer = Class.create();\r\n    AmazonTemplateDescriptionCategorySpecificRenderer.prototype = {\r\n\r\n        // ---------------------------------------\r\n\r\n        MODE_NONE              : 'none',\r\n        MODE_RECOMMENDED_VALUE : 'recommended_value',\r\n        MODE_CUSTOM_VALUE      : 'custom_value',\r\n        MODE_CUSTOM_ATTRIBUTE  : 'custom_attribute',\r\n\r\n        // ---------------------------------------\r\n\r\n        indexedXPath : null,\r\n        params       : {},\r\n\r\n        specific       : null,\r\n        parentSpecific : null,\r\n\r\n        specificHandler  : null,\r\n        dictionaryHelper : null,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function() {},\r\n\r\n        //########################################\r\n\r\n        load: function()\r\n        {\r\n            this.dictionaryHelper = this.specificHandler.dictionaryHelper;\r\n\r\n            this.specific = this.dictionaryHelper.getDictionarySpecific(this.indexedXPath);\r\n\r\n            if (this.specific === null) {\r\n                alert({\r\n                    content: 'Unable to load Dictionary Specific.'\r\n                });\r\n                return false;\r\n            }\r\n\r\n            this.parentSpecific = this.dictionaryHelper.getParentSpecific(this.specific);\r\n\r\n            return true;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setSpecificsHandler: function(handler)\r\n        {\r\n            this.specificHandler = handler;\r\n        },\r\n\r\n        setIndexedXpath: function(xPath)\r\n        {\r\n            this.indexedXPath = xPath;\r\n        },\r\n\r\n        setParams: function(params)\r\n        {\r\n            this.params = params;\r\n        },\r\n\r\n        //########################################\r\n\r\n        getRootIndexedXpath: function()\r\n        {\r\n            var splitedPath = this.indexedXPath.replace(/^\\//, '').split('/');\r\n            return '/' + splitedPath[0];\r\n        },\r\n\r\n        getParentIndexedXpath: function()\r\n        {\r\n            if (this.specific.parent_specific_id === null) {\r\n                return null;\r\n            }\r\n\r\n            var splitedPath = this.indexedXPath.replace(/^\\//, '').split('/');\r\n            splitedPath.pop();\r\n            return '/' + splitedPath.join('/');\r\n        },\r\n\r\n        getChildIndexedPart: function(childSpecific)\r\n        {\r\n            return this.indexedXPath + '/' + childSpecific.xml_tag + '-1'\r\n        },\r\n\r\n        //########################################\r\n\r\n        isValueForceSet: function()\r\n        {\r\n            return this.getForceSetValue() !== false;\r\n        },\r\n\r\n        getForceSetValue: function()\r\n        {\r\n            return this.params.hasOwnProperty('force_value') ? this.params['force_value'] : false;\r\n        },\r\n\r\n        //########################################\r\n\r\n        isRemoveActionAllowed: function()\r\n        {\r\n            if (!this.specificHandler.isSpecificRendered(this.indexedXPath)) {\r\n                return false;\r\n            }\r\n\r\n            return !this.isValueForceSet() &&\r\n                this.specificHandler.getXpathesOfTheSameRenderedSpecific(this.indexedXPath).length > this.specific.min_occurs;\r\n        },\r\n\r\n        getRemoveButton: function()\r\n        {\r\n            var button = new Element('a', {\r\n                'id'          : this.indexedXPath + '_remove_button',\r\n                'indexedxpath': this.indexedXPath,\r\n                'href'        : 'javascript:void(0);',\r\n                'class'       : 'specific-remove-button',\r\n                'style'       : 'vertical-align: middle;',\r\n                'title'       : M2ePro.translator.translate('Delete specific')\r\n            });\r\n            button.observe('click', this.removeAction.bind(this));\r\n\r\n            if (!this.isRemoveActionAllowed()) {\r\n                this.hideButton(button);\r\n            }\r\n\r\n            return button;\r\n        },\r\n\r\n        removeAction: function(event)\r\n        {\r\n            if (!this.isRemoveActionAllowed()) {\r\n                return null;\r\n            }\r\n\r\n            this.specificHandler.unMarkSpecificAsRendered(this.indexedXPath);\r\n            this.specificHandler.unMarkSpecificAsSelected(this.indexedXPath);\r\n\r\n            $(this.indexedXPath).remove();\r\n\r\n            // make the latest clone button visible again\r\n            var theSameSpecifics = this.specificHandler.getXpathesOfTheSameRenderedSpecific(this.indexedXPath);\r\n            if (theSameSpecifics.length < this.specific.max_occurs) {\r\n\r\n                var latestIndexedXpath = this.specificHandler.getLatestXpathFromTheSame(this.indexedXPath);\r\n\r\n                var previousCloneButton = $(latestIndexedXpath + '_clone_button');\r\n                previousCloneButton && this.showButton(previousCloneButton);\r\n            }\r\n\r\n            return this.indexedXPath;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isCloneActionAllowed: function()\r\n        {\r\n            return this.specificHandler.isSpecificRendered(this.indexedXPath) &&\r\n                this.specificHandler.getXpathesOfTheSameRenderedSpecific(this.indexedXPath).length < this.specific.max_occurs;\r\n        },\r\n\r\n        getCloneButton: function()\r\n        {\r\n            var button = new Element('a', {\r\n                'id'          : this.indexedXPath + '_clone_button',\r\n                'indexedxpath': this.indexedXPath,\r\n                'href'        : 'javascript:void(0);',\r\n                'class'       : 'specific-clone-button',\r\n                'style'       : 'vertical-align: middle;',\r\n                'title'       : M2ePro.translator.translate('Duplicate specific')\r\n            });\r\n            button.observe('click', this.cloneAction.bind(this));\r\n\r\n            if (!this.isCloneActionAllowed()) {\r\n                this.hideButton(button);\r\n            }\r\n\r\n            return button;\r\n        },\r\n\r\n        cloneAction: function(event)\r\n        {\r\n            if (!this.isCloneActionAllowed()) {\r\n                return null;\r\n            }\r\n\r\n            this.hideButton(event.target);\r\n\r\n            var newIndexedXpath = this.indexedXPath.replace(/\\d$/, '');\r\n            newIndexedXpath += parseInt(this.indexedXPath.match(/\\d$/)[0]) + 1;\r\n\r\n            this.specificHandler.renderSpecific(newIndexedXpath);\r\n            return newIndexedXpath;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        hideButton: function(button)\r\n        {\r\n            button = (typeof button == 'object') ? button : $(this.indexedXPath + '_' + button + '_button');\r\n            button.style.display = 'none';\r\n        },\r\n\r\n        showButton: function(button)\r\n        {\r\n            button = (typeof button == 'object') ? button : $(this.indexedXPath + '_' + button + '_button');\r\n            button.style.display = 'inline-block';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        touchMyNeighbors: function()\r\n        {\r\n            var theSameSpecifics = this.specificHandler.getXpathesOfTheSameRenderedSpecific(this.indexedXPath);\r\n            if (theSameSpecifics.length <= 0) {\r\n                return;\r\n            }\r\n\r\n            var latestIndexedXpath = this.specificHandler.getLatestXpathFromTheSame(this.indexedXPath),\r\n                myEvent = new CustomEvent('my-duplicate-is-rendered');\r\n\r\n            theSameSpecifics.each(function(xpath) {\r\n                latestIndexedXpath != xpath && $(xpath).dispatchEvent(myEvent);\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        onMyDuplicateRendered: function()\r\n        {\r\n            this.hideButton('clone');\r\n        },\r\n\r\n        onWhenUndeletebleSpecificAppears: function()\r\n        {\r\n            this.hideButton('remove');\r\n\r\n            if (this.getParentIndexedXpath() != null) {\r\n                var myEvent = new CustomEvent('undeleteble-specific-appear');\r\n                $(this.getParentIndexedXpath()).dispatchEvent(myEvent);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        // my awesome firefox... simulate('change') does not work is element has a 'disabled' attribute\r\n        simulateAction: function(obj, action)\r\n        {\r\n            if (obj.hasAttribute('disabled')) {\r\n                obj.removeAttribute('disabled');\r\n                obj.simulate(action);\r\n                obj.setAttribute('disabled', 'disabled');\r\n            } else {\r\n                obj.simulate(action);\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    };\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Category/Specific/Block/AddSpecificRenderer.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Amazon/Template/Description/Category/Specific/Renderer'\r\n], function (jQuery, modal) {\r\n\r\n    window.AmazonTemplateDescriptionCategorySpecificBlockGridAddSpecificRenderer = Class.create(AmazonTemplateDescriptionCategorySpecificRenderer, {\r\n\r\n        // ---------------------------------------\r\n\r\n        childAllSpecifics  : [],\r\n        childRowsSpecifics : [],\r\n\r\n        selectedSpecifics : [],\r\n\r\n        // ---------------------------------------\r\n\r\n        process: function()\r\n        {\r\n            if (!this.load()) {\r\n                return '';\r\n            }\r\n\r\n            this.prepareDomStructure();\r\n            this.tuneStyles();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareDomStructure: function()\r\n        {\r\n            this.getContainer().appendChild(this.getTemplate());\r\n\r\n            $(this.indexedXPath + '_add_row').observe('child-specific-rendered' , this.onChildSpecificRendered.bind(this));\r\n            $(this.indexedXPath).observe('child-specific-rendered', this.onChildSpecificRendered.bind(this));\r\n\r\n            var addSpecificBlockButtonObj = $(this.indexedXPath + '_add_button');\r\n            addSpecificBlockButtonObj.observe('click', this.addSpecificAction.bind(this));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        onChildSpecificRendered: function()\r\n        {\r\n            this.tuneStyles();\r\n\r\n            if (this.indexedXPath == this.getRootIndexedXpath()) {\r\n                return;\r\n            }\r\n\r\n            var myEvent = new CustomEvent('child-specific-rendered');\r\n\r\n            $(this.getParentIndexedXpath() + '_add_row') && $(this.getParentIndexedXpath() + '_add_row').dispatchEvent(myEvent);\r\n            $(this.getParentIndexedXpath()) && $(this.getParentIndexedXpath()).dispatchEvent(myEvent);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        tuneStyles: function()\r\n        {\r\n            var addSpecificsRowObj        = $(this.indexedXPath + '_add_row'),\r\n                addSpecificBlockButtonObj = $(this.indexedXPath + '_add_button');\r\n\r\n            // ---------------------------------------\r\n            addSpecificsRowObj && addSpecificsRowObj.show();\r\n\r\n            if ((this.getRootIndexedXpath() != this.indexedXPath && this.isAnyOfChildSpecificsRendered()) ||\r\n                this.isAllOfSpecificsRendered())\r\n            {\r\n                addSpecificsRowObj && addSpecificsRowObj.hide();\r\n            }\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            addSpecificBlockButtonObj && addSpecificBlockButtonObj.show();\r\n\r\n            if (this.getRootIndexedXpath() == this.indexedXPath || this.isAllOfSpecificsRendered() || !this.isAnyOfChildSpecificsRendered()) {\r\n                addSpecificBlockButtonObj && addSpecificBlockButtonObj.hide();\r\n            }\r\n            // ---------------------------------------\r\n        },\r\n\r\n        isAnyOfChildSpecificsRendered: function()\r\n        {\r\n            var countOfRenderedSpecifics = 0;\r\n            var realRenderedXpathes = this.specificHandler.getRealXpathesOfRenderedSpecifics();\r\n\r\n            this.childAllSpecifics.each(function(sp) {\r\n                if (realRenderedXpathes.indexOf(sp.xpath) >= 0) countOfRenderedSpecifics++;\r\n            });\r\n\r\n            return countOfRenderedSpecifics > 0;\r\n        },\r\n\r\n        isAllOfSpecificsRendered: function()\r\n        {\r\n            var countOfRenderedSpecifics = 0;\r\n\r\n            var realRenderedXpathes = this.specificHandler.getRealXpathesOfRenderedSpecifics(),\r\n                allChildSpecifics   = this.specificHandler.dictionaryHelper.getAllChildSpecifics(this.specific);\r\n\r\n            allChildSpecifics.each(function(sp) {\r\n                if (realRenderedXpathes.indexOf(sp.xpath) >= 0) countOfRenderedSpecifics++;\r\n            });\r\n\r\n            return countOfRenderedSpecifics == allChildSpecifics.length;\r\n        },\r\n\r\n        //########################################\r\n\r\n        isAlreadyRendered: function()\r\n        {\r\n            return $(this.indexedXPath + '_add_row') == null;\r\n        },\r\n\r\n        getTemplate: function()\r\n        {\r\n            var template = $('specifics_add_row_template').down('table').cloneNode(true);\r\n\r\n            template.down('button.add_custom_specific_button').observe('click', this.addSpecificAction.bind(this));\r\n            template.setAttribute('id', this.indexedXPath + '_add_row');\r\n\r\n            return template;\r\n        },\r\n\r\n        getContainer: function()\r\n        {\r\n            return $(this.indexedXPath);\r\n        },\r\n\r\n        // POPUP\r\n        //########################################\r\n\r\n        addSpecificAction: function(event)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getAddSpecificsHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id        : $('marketplace_id').value,\r\n                    product_data_nick     : $('product_data_nick').value,\r\n                    current_indexed_xpath : self.indexedXPath,\r\n                    rendered_specifics    : Object.toJSON(self.specificHandler.renderedSpecifics)\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    self.selectedSpecifics = [];\r\n                    self.openPopUp(transport.responseText);\r\n                }\r\n            });\r\n        },\r\n\r\n        openPopUp: function(html)\r\n        {\r\n            var self = this,\r\n                doneCallback = self.specificsDoneButton.bind(self);\r\n\r\n            if (!M2ePro.popUp) {\r\n                var modalDialogMessage = new Element('div', {\r\n                    id: 'modal_dialog_message_specifics'\r\n                });\r\n\r\n                modalDialogMessage.insert(html);\r\n                modalDialogMessage.innerHTML.evalScripts();\r\n\r\n                M2ePro.popUp = jQuery(modalDialogMessage).modal({\r\n                    title: modalDialogMessage.down('#specific_popup_title').value,\r\n                    type: 'slide',\r\n                    buttons: [{\r\n                        text: M2ePro.translator.translate('Cancel'),\r\n                        //class: 'action-primary',\r\n                        click: function () {\r\n                            this.closeModal();\r\n                        }\r\n                    },{\r\n                        text: M2ePro.translator.translate('Confirm'),\r\n                        class: 'action-primary',\r\n                        id: 'save_popup_button',\r\n                        click: function () {\r\n                            doneCallback();\r\n                            this.closeModal();\r\n                        }\r\n                    }]\r\n                });\r\n            } else {\r\n                modalDialogMessage = $('modal_dialog_message_specifics');\r\n                modalDialogMessage.innerHTML = '';\r\n\r\n                modalDialogMessage.insert(html);\r\n                modalDialogMessage.innerHTML.evalScripts();\r\n            }\r\n\r\n            M2ePro.popUp.modal('openModal');\r\n\r\n            self.observePopupButtonsActions();\r\n            self.observePopupGridRowsActions();\r\n            self.tunePopupStyles();\r\n        },\r\n\r\n        observePopupButtonsActions: function()\r\n        {\r\n            $$('#modal_dialog_message_specifics button.specifics_filter_button').first().observe('click', this.specificsFilterButton.bind(this));\r\n            $$('#modal_dialog_message_specifics button.specifics_reset_filter_button').first().observe('click', this.specificsResetFilterButton.bind(this));\r\n            $$('#modal_dialog_message_specifics a.specifics_reset_selected_button').first().observe('click', this.specificsResetSelectedButton.bind(this));\r\n\r\n            $$('#modal_dialog_message_specifics #query').first().observe('keypress', this.specificsKeyPressQuery.bind(this));\r\n        },\r\n\r\n        observePopupGridRowsActions: function()\r\n        {\r\n            var self = this;\r\n\r\n            $$('#specifics_grid_container a.specific_search_result_row').each(function(el) {\r\n                el.stopObserving('click');\r\n                el.observe('click', self.specificsSelectRow.bind(self));\r\n            });\r\n        },\r\n\r\n        tunePopupStyles: function()\r\n        {\r\n            $$('#amazonTemplateDescriptionCategorySpecificAddGrid div.grid th').each(function(el) {\r\n                el.style.padding = '1px 1px';\r\n            });\r\n\r\n            $$('#amazonTemplateDescriptionCategorySpecificAddGrid div.grid td').each(function(el) {\r\n                el.style['padding'] = '1px 1px';\r\n                el.style['vertical-align'] = 'middle';\r\n            });\r\n        },\r\n\r\n        //########################################\r\n\r\n        specificsDoneButton: function(event)\r\n        {\r\n            var self = this;\r\n\r\n            self.selectedSpecifics.each(function(indexedXpath) {\r\n                self.specificHandler.renderSpecific(indexedXpath);\r\n            });\r\n        },\r\n\r\n        specificsFilterButton: function(event)\r\n        {\r\n            this.reloadSearchingGrid(jQuery('#query', M2ePro.popUp).val(), +jQuery('#only_desired').prop('checked'));\r\n        },\r\n\r\n        specificsKeyPressQuery: function(event)\r\n        {\r\n            if (event.keyCode == 13) {\r\n                this.specificsFilterButton(event);\r\n            }\r\n        },\r\n\r\n        specificsResetFilterButton: function(event)\r\n        {\r\n            jQuery('#query', M2ePro.popUp).val('').focus();\r\n            jQuery('#only_desired').prop('checked', false);\r\n\r\n            this.reloadSearchingGrid('', '');\r\n        },\r\n\r\n        specificsResetSelectedButton: function(event)\r\n        {\r\n            var selectedSpecificsBox = $('selected_specifics_box');\r\n\r\n            selectedSpecificsBox.update('');\r\n            $('selected_specifics_container').hide();\r\n\r\n            $('specifics_grid_container').style.height = '370px';\r\n\r\n            this.selectedSpecifics = [];\r\n            this.specificsFilterButton(event);\r\n        },\r\n\r\n        specificsSelectRow: function(event)\r\n        {\r\n            var selectedSpecificsBox = $('selected_specifics_box'),\r\n                newIndexedXpath     = this.getNewSpecificXpath(event.target.getAttribute('xpath'));\r\n\r\n            selectedSpecificsBox.appendChild(new Element('span', {\r\n                    class   : 'selected-specific-box-item',\r\n                    xml_tag : event.target.getAttribute('xml_tag'),\r\n                    xpath   : newIndexedXpath\r\n                }))\r\n                .update('<div>'+event.target.getAttribute('xml_tag')+'</div>')\r\n                .appendChild(new Element('a', {\r\n                    href  : 'javascript:void(0);',\r\n                    class : 'remove-link-button',\r\n                    align : 'center',\r\n                    title : M2ePro.translator.translate('Remove this specific')\r\n                }))\r\n                .observe('click', this.specificsUnSelectRow.bind(this));\r\n\r\n            $('selected_specifics_container').show();\r\n            $('specifics_grid_container').style.height = (370 - $('selected_specifics_container').offsetHeight - 6) + 'px';\r\n\r\n            this.selectedSpecifics.push(newIndexedXpath);\r\n            this.specificsFilterButton(event);\r\n        },\r\n\r\n        specificsUnSelectRow: function(event)\r\n        {\r\n            var newPreparedXpath = event.target.up('span').getAttribute('xpath');\r\n\r\n            event.target.up('span').remove();\r\n\r\n            var index = this.selectedSpecifics.indexOf(newPreparedXpath);\r\n            index >= 0 && this.selectedSpecifics.splice(index, 1);\r\n\r\n            if (this.selectedSpecifics.length <= 0) {\r\n                return this.specificsResetSelectedButton(event);\r\n            }\r\n\r\n            this.specificsFilterButton(event);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reloadSearchingGrid: function(query, onlyDesired)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_template_description/getAddSpecificsGridHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id        : $('marketplace_id').value,\r\n                    product_data_nick     : $('product_data_nick').value,\r\n                    current_indexed_xpath : self.indexedXPath,\r\n                    rendered_specifics    : Object.toJSON(self.specificHandler.renderedSpecifics),\r\n                    selected_specifics    : Object.toJSON(self.selectedSpecifics),\r\n                    only_desired          : onlyDesired,\r\n                    query                 : query\r\n                },\r\n                onSuccess: function(transport) {\r\n                    $('specifics_grid_container').down('div.grid-wrapper').update(transport.responseText);\r\n                    self.tunePopupStyles();\r\n                    self.observePopupGridRowsActions();\r\n                }\r\n            });\r\n        },\r\n\r\n        //########################################\r\n\r\n        getNewSpecificXpath: function(dictionaryXpath)\r\n        {\r\n            var currentRealXpath = this.indexedXPath.replace(/-\\d+/g, '');\r\n            var newIndexedXpath  = '';\r\n\r\n            var temp = dictionaryXpath.replace(currentRealXpath + '/', '');\r\n\r\n            temp.split('/').each(function(pathPart) {\r\n                newIndexedXpath += '/' + pathPart + '-1';\r\n            });\r\n\r\n            return this.indexedXPath + newIndexedXpath;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Category/Specific/Block/GridRenderer.js":"define([\r\n    'M2ePro/Amazon/Template/Description/Category/Specific/Renderer'\r\n], function () {\r\n\r\n    window.AmazonTemplateDescriptionCategorySpecificBlockGridRenderer = Class.create(AmazonTemplateDescriptionCategorySpecificRenderer, {\r\n\r\n        // ---------------------------------------\r\n\r\n        childRowsSpecifics: [],\r\n\r\n        // ---------------------------------------\r\n\r\n        process: function()\r\n        {\r\n            if (this.childRowsSpecifics.length <= 0) {\r\n                return '';\r\n            }\r\n\r\n            if (!this.load()) {\r\n                return '';\r\n            }\r\n\r\n            this.prepareDomStructure();\r\n            this.renderRequiredRows();\r\n\r\n            this.tuneStyles();\r\n        },\r\n\r\n        //########################################\r\n\r\n        prepareDomStructure: function()\r\n        {\r\n            this.getContainer().appendChild(this.getTemplate());\r\n            $(this.indexedXPath + '_grid').observe('child-specific-rendered' , this.onChildSpecificRendered.bind(this));\r\n        },\r\n\r\n        renderRequiredRows: function()\r\n        {\r\n            var self = this;\r\n\r\n            this.childRowsSpecifics.each(function(specific) {\r\n\r\n                if (!self.dictionaryHelper.isSpecificRequired(specific)) {\r\n                    return true;\r\n                }\r\n\r\n                var renderer = new AmazonTemplateDescriptionCategorySpecificGridRowRenderer();\r\n                renderer.setSpecificsHandler(self.specificHandler);\r\n                renderer.setIndexedXpath(self.getChildIndexedPart(specific));\r\n\r\n                renderer.process();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        onChildSpecificRendered: function()\r\n        {\r\n            this.tuneStyles();\r\n\r\n            if (this.indexedXPath != this.getRootIndexedXpath() && $(this.getParentIndexedXpath() + '_grid')) {\r\n                var myEvent = new CustomEvent('child-specific-rendered');\r\n                $(this.getParentIndexedXpath() + '_grid').dispatchEvent(myEvent);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        tuneStyles: function()\r\n        {\r\n            if (this.childRowsSpecifics.length <= 0) {\r\n                return '';\r\n            }\r\n\r\n            var gridObj = $(this.indexedXPath + '_grid');\r\n            this.isAnyOfChildSpecificsRendered() ? gridObj.show() : gridObj.hide();\r\n        },\r\n\r\n        isAnyOfChildSpecificsRendered: function()\r\n        {\r\n            var countOfRenderedSpecifics = 0;\r\n            var realRenderedXpathes = this.specificHandler.getRealXpathesOfRenderedSpecifics();\r\n\r\n            this.childRowsSpecifics.each(function(sp) {\r\n                if (realRenderedXpathes.indexOf(sp.xpath) >= 0) countOfRenderedSpecifics++;\r\n            });\r\n\r\n            return countOfRenderedSpecifics > 0;\r\n        },\r\n\r\n        //########################################\r\n\r\n        isAlreadyRendered: function()\r\n        {\r\n            return $(this.indexedXPath + '_grid') == null;\r\n        },\r\n\r\n        getTemplate: function()\r\n        {\r\n            var template = $('specifics_list_grid_template').down('table').cloneNode(true);\r\n\r\n            template.setAttribute('id', this.indexedXPath + '_grid');\r\n            return template;\r\n        },\r\n\r\n        getContainer: function()\r\n        {\r\n            return $(this.indexedXPath);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Category/Specific/Grid/RowAttributeRenderer.js":"define([\r\n    'M2ePro/Amazon/Template/Description/Category/Specific/Grid/RowRenderer'\r\n], function () {\r\n\r\n    window.AmazonTemplateDescriptionCategorySpecificGridRowAttributeRenderer = Class.create(AmazonTemplateDescriptionCategorySpecificGridRowRenderer, {\r\n\r\n        // ---------------------------------------\r\n\r\n        attribute      : null,\r\n        attributeIndex : null,\r\n\r\n        // ---------------------------------------\r\n\r\n        process: function()\r\n        {\r\n            if (!this.load()) {\r\n                return '';\r\n            }\r\n\r\n            this.renderSelf();\r\n            this.observeToolTips(this.indexedXPath);\r\n\r\n            this.checkSelection();\r\n        },\r\n\r\n        load: function($super)\r\n        {\r\n            try {\r\n                var values = this.attribute.hasOwnProperty('values') ? this.attribute.values : '[]';\r\n                JSON.parse(values);\r\n                this.attribute.values = values.evalJSON();\r\n            } catch (e) {}\r\n\r\n            return $super();\r\n        },\r\n\r\n        //########################################\r\n\r\n        renderSelf: function()\r\n        {\r\n            this.renderLabel();\r\n            this.renderChooseMode();\r\n            this.renderValueInputs();\r\n            this.renderButtons();\r\n\r\n            $(this.indexedXPath).observe('parent-specific-row-is-cloned', this.onParentClonedAction.bind(this));\r\n            $(this.indexedXPath).observe('parent-specific-row-is-removed', this.onParentRemovedAction.bind(this));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderLabel: function()\r\n        {\r\n            var td = new Element('td');\r\n            var title = this.specific.title + ' (' + this.attribute.title + ')';\r\n\r\n            if (this.isAttributeRequired()) {\r\n                title += ' <span class=\"required\">*</span>';\r\n            }\r\n\r\n            td.appendChild((new Element('span').insert(title)));\r\n\r\n            var note = this.getDefinitionNote(this.attribute.data_definition);\r\n            if (note) {\r\n                var toolTip = this.getToolTipBlock(this.indexedXPath + '_attribute_' + this.attribute.title + '_definition_note', note);\r\n                toolTip.show();\r\n                td.appendChild(toolTip);\r\n            }\r\n\r\n            this.getRowContainer().appendChild(td);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderChooseMode: function()\r\n        {\r\n            var select = new Element('select', {\r\n                'id'          : this.indexedXPath + '_attribute_' + this.attribute.title + '_mode',\r\n                'indexedxpath': this.indexedXPath,\r\n                'class'       : 'select admin__control-select ' + (this.isAttributeRequired() ? 'M2ePro-required-when-visible' : ''),\r\n                'style'       : 'width: 85%;'\r\n            });\r\n\r\n            select.appendChild(new Element('option', {'style': 'display: none'}));\r\n            select.appendChild(new Element('option', {'value': this.MODE_CUSTOM_VALUE})).insert(M2ePro.translator.translate('Custom Value'));\r\n            select.appendChild(new Element('option', {'value': this.MODE_CUSTOM_ATTRIBUTE})).insert(M2ePro.translator.translate('Custom Attribute'));\r\n\r\n            select.observe('change', this.onChangeChooseMode.bind(this));\r\n\r\n            this.getRowContainer().appendChild(new Element('td')).appendChild(select);\r\n        },\r\n\r\n        onChangeChooseMode: function(event)\r\n        {\r\n            var customAttribute     = $(this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_ATTRIBUTE),\r\n                customAttributeNote = $(this.indexedXPath + '_attribute_' + this.attribute.title + '_custom_attribute_note');\r\n\r\n            var customValue      = $(this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_VALUE),\r\n                customValueNote  = $(this.indexedXPath + '_attribute_' + this.attribute.title + '_custom_value_note');\r\n\r\n            customAttribute     && customAttribute.hide();\r\n            customAttributeNote && customAttributeNote.hide();\r\n\r\n            customValue     && customValue.hide();\r\n            customValueNote && customValueNote.hide();\r\n\r\n            if (event.target.value == this.MODE_CUSTOM_VALUE) {\r\n                customValue     && customValue.show();\r\n                customValueNote && customValueNote.show();\r\n            }\r\n            if (event.target.value == this.MODE_CUSTOM_ATTRIBUTE) {\r\n                customAttribute     && customAttribute.show();\r\n                customAttributeNote && customAttributeNote.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderValueInputs: function()\r\n        {\r\n            var td = this.getRowContainer().appendChild(new Element('td'));\r\n\r\n            if (this.isAttributeTypeText()) {\r\n\r\n                var note = this.getCustomValueTypeNote();\r\n                if (note) td.appendChild(this.getToolTipBlock(this.indexedXPath + '_attribute_' + this.attribute.title + '_custom_value_note', note));\r\n\r\n                td.appendChild(this.getTextTypeInput());\r\n            }\r\n\r\n            if (this.isAttributeTypeSelect()) {\r\n                td.appendChild(this.getSelectTypeInput());\r\n            }\r\n\r\n            // ---------------------------------------\r\n            var note = this.getCustomAttributeTypeNote();\r\n            if (note) {\r\n                var tooltip = td.appendChild(this.getToolTipBlock(this.indexedXPath + '_attribute_' + this.attribute.title + '_custom_attribute_note', note));\r\n                tooltip.hide();\r\n            }\r\n\r\n            td.appendChild(this.getCustomAttributeSelect());\r\n            // ---------------------------------------\r\n        },\r\n\r\n        getTextTypeInput: function()\r\n        {\r\n            var input = new Element('input', {\r\n                'id'              : this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_VALUE,\r\n                'name'            : this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_VALUE,\r\n                'indexedxpath'    : this.indexedXPath,\r\n                'specific_id'     : this.specific.specific_id,\r\n                'attribute_index' : this.attributeIndex,\r\n                'mode'            : this.MODE_CUSTOM_VALUE,\r\n                'type'            : 'text',\r\n                'class'           : 'input-text admin__control-text M2ePro-specificAttributes-validation ' + (this.isAttributeRequired() ? ' M2ePro-required-when-visible' : ''),\r\n                'style'           : 'display: none; width: 85%;'\r\n            });\r\n\r\n            input.observe('change', this.onChangeValue.bind(this));\r\n            return input;\r\n        },\r\n\r\n        getSelectTypeInput: function()\r\n        {\r\n            var select = new Element('select', {\r\n                'id'              : this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_VALUE,\r\n                'name'            : this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_VALUE,\r\n                'indexedxpath'    : this.indexedXPath,\r\n                'specific_id'     : this.specific.specific_id,\r\n                'attribute_index' : this.attributeIndex,\r\n                'mode'            : this.MODE_CUSTOM_VALUE,\r\n                'class'           : 'select admin__control-select ' + (this.isAttributeRequired() ? 'M2ePro-required-when-visible' : ''),\r\n                'style'           : 'width: 85%; display: none;'\r\n            });\r\n\r\n            select.appendChild(new Element('option', {'style': 'display: none'}));\r\n\r\n            this.attribute.values.each(function(value) {\r\n                select.appendChild(new Element('option', {'value': value}).insert(value));\r\n            });\r\n\r\n            select.observe('change', this.onChangeValue.bind(this));\r\n            return select;\r\n        },\r\n\r\n        getCustomAttributeSelect: function()\r\n        {\r\n            var select = new Element('select', {\r\n                'id'              : this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_ATTRIBUTE,\r\n                'name'            : this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_ATTRIBUTE,\r\n                'indexedxpath'    : this.indexedXPath,\r\n                'specific_id'     : this.specific.specific_id,\r\n                'attribute_index' : this.attributeIndex,\r\n                'mode'            : this.MODE_CUSTOM_ATTRIBUTE,\r\n                'class'           : 'attributes M2ePro-required-when-visible select admin__control-select',\r\n                'style'           : 'display: none; width: 85%;',\r\n                'apply_to_all_attribute_sets' : '0'\r\n            });\r\n\r\n            select.appendChild(new Element('option', {'style': 'display: none', 'value': ''}));\r\n            this.attributeHandler.availableAttributes.each(function(el) {\r\n                select.appendChild(new Element('option', {'value': el.code})).insert(el.label);\r\n            });\r\n            select.value = '';\r\n\r\n            select.observe('change', this.onChangeValue.bind(this));\r\n\r\n            var handlerObj = new AttributeCreator(select.id);\r\n            handlerObj.setSelectObj(select);\r\n            handlerObj.injectAddOption();\r\n\r\n            return select;\r\n        },\r\n\r\n        onChangeValue: function(event)\r\n        {\r\n            var selectedObj = {};\r\n\r\n            selectedObj.attributes = [];\r\n            selectedObj.attributes[this.attributeIndex] = {};\r\n            selectedObj.attributes[this.attributeIndex][this.attribute.title] = {};\r\n\r\n            var mode = event.target.getAttribute('mode');\r\n\r\n            selectedObj.attributes[this.attributeIndex][this.attribute.title]['mode'] = mode;\r\n            selectedObj.attributes[this.attributeIndex][this.attribute.title][mode]   = event.target.value;\r\n\r\n            this.specificHandler.markSpecificAsSelected(this.indexedXPath, selectedObj);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderButtons: function()\r\n        {\r\n            this.getRowContainer().appendChild(new Element('td'));\r\n        },\r\n\r\n        //########################################\r\n\r\n        checkSelection: function()\r\n        {\r\n            var self = this;\r\n\r\n            // specific selection info\r\n            var selectionInfo = this.specificHandler.getSelectionInfo(this.indexedXPath);\r\n\r\n            // try to find in formdata\r\n            if (!selectionInfo.hasOwnProperty('attributes') || selectionInfo['attributes'].length <= 0) {\r\n                selectionInfo = this.specificHandler.isInFormData(this.indexedXPath);\r\n            }\r\n\r\n            if (!selectionInfo.hasOwnProperty('attributes') || selectionInfo['attributes'].length <= 0) {\r\n                return '';\r\n            }\r\n\r\n            // find attribute selection. brr.\r\n            var attributeSelectionInfo = null;\r\n            selectionInfo['attributes'].each(function(el) {\r\n\r\n                if (el.hasOwnProperty(self.attribute.title)) {\r\n                    attributeSelectionInfo = el[self.attribute.title];\r\n                    return false;\r\n                }\r\n            });\r\n\r\n            if (attributeSelectionInfo == null) {\r\n                return '';\r\n            }\r\n\r\n            var id = this.indexedXPath + '_attribute_' + this.attribute.title + '_mode';\r\n            $(id).value = attributeSelectionInfo.mode;\r\n            this.simulateAction($(id), 'change');\r\n\r\n            if (attributeSelectionInfo.mode == this.MODE_CUSTOM_VALUE) {\r\n                id = this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_VALUE;\r\n                $(id).value = attributeSelectionInfo['custom_value'];\r\n                this.simulateAction($(id), 'change');\r\n            }\r\n\r\n            if (attributeSelectionInfo.mode == this.MODE_CUSTOM_ATTRIBUTE) {\r\n                id = this.indexedXPath + '_attribute_' + this.attribute.title + '_' + this.MODE_CUSTOM_ATTRIBUTE;\r\n                $(id).value = attributeSelectionInfo['custom_attribute'];\r\n                this.simulateAction($(id), 'change');\r\n            }\r\n        },\r\n\r\n        //########################################\r\n\r\n        getCustomValueTypeNote: function()\r\n        {\r\n            if (this.attribute.data_definition.definition) {\r\n                return null;\r\n            }\r\n\r\n            if (this.attribute.type == 'int') return this.getIntTypeNote(this.attribute);\r\n            if (this.attribute.type == 'float') return this.getFloatTypeNote(this.attribute);\r\n            if (this.attribute.type == 'string') return this.getStringTypeNote(this.attribute);\r\n            if (this.attribute.type == 'date_time') return this.getDatTimeTypeNote(this.attribute);\r\n\r\n            return this.getAnyTypeNote(this.attribute);\r\n        },\r\n\r\n        getCustomAttributeTypeNote: function()\r\n        {\r\n            if (this.attribute.values.length <= 0) {\r\n                return null;\r\n            }\r\n\r\n            var span = new Element('span');\r\n\r\n            span.appendChild(new Element('span')).insert('<b>' + M2ePro.translator.translate('Allowed Values') + ': </b>');\r\n\r\n            var ul = span.appendChild(new Element('ul'));\r\n\r\n            this.attribute.values.each(function(value) {\r\n                ul.appendChild(new Element('li')).insert(value);\r\n            });\r\n\r\n            return span.outerHTML;\r\n        },\r\n\r\n        //########################################\r\n\r\n        isAttributeRequired: function()\r\n        {\r\n            return this.attribute.required;\r\n        },\r\n\r\n        isAttributeTypeText: function()\r\n        {\r\n            return !this.isAttributeTypeSelect();\r\n        },\r\n\r\n        isAttributeTypeSelect: function()\r\n        {\r\n            return this.attribute.values && this.attribute.values.length > 0;\r\n        },\r\n\r\n        //########################################\r\n\r\n        observeToolTips: function(indexedXpath)\r\n        {\r\n            //$$('tr[class=\"' + indexedXpath + '_attributes\"] .tool-tip-image').each(function(element) {\r\n            //    element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n            //    element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            //});\r\n            //\r\n            //$$('tr[class=\"' + indexedXpath + '_attributes\"] .tool-tip-message').each(function(element) {\r\n            //    element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n            //    element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            //});\r\n        },\r\n\r\n        //########################################\r\n\r\n        onParentClonedAction: function(event)\r\n        {\r\n            this.observeToolTips(event.new_indexed_xpath);\r\n        },\r\n\r\n        onParentRemovedAction: function(event)\r\n        {\r\n            var attributesRows = $$('tr[class=\"' + this.indexedXPath + '_attributes\"]');\r\n            attributesRows.invoke('remove');\r\n        },\r\n\r\n        //########################################\r\n\r\n        getRowContainer: function()\r\n        {\r\n            var id = this.indexedXPath + '_attribute_' + this.attribute.title;\r\n\r\n            if ($(id)) {\r\n                return $(id);\r\n            }\r\n\r\n            var grid = $$('table[id=\"'+ this.getParentIndexedXpath() +'_grid\"] table.border tbody').first();\r\n            return grid.appendChild(new Element('tr', {\r\n                id    : id,\r\n                class : this.indexedXPath + '_attributes'\r\n            }));\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/Description/Category/Specific/Grid/RowRenderer.js":"define([\r\n    'M2ePro/Amazon/Template/Description/Category/Specific/Renderer'\r\n], function () {\r\n\r\n    window.AmazonTemplateDescriptionCategorySpecificGridRowRenderer = Class.create(AmazonTemplateDescriptionCategorySpecificRenderer, {\r\n\r\n        // ---------------------------------------\r\n\r\n        attributeHandler: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        process: function()\r\n        {\r\n            if (this.specificHandler.isSpecificRendered(this.indexedXPath) && !this.isValueForceSet()) {\r\n                return '';\r\n            }\r\n\r\n            if (!this.load()) {\r\n                return '';\r\n            }\r\n\r\n            this.renderParentSpecific();\r\n\r\n            if (this.specificHandler.isSpecificRendered(this.indexedXPath) && !this.isValueForceSet()) {\r\n                return '';\r\n            }\r\n\r\n            if (this.specificHandler.isSpecificRendered(this.indexedXPath)) {\r\n\r\n                this.forceSelectAndDisable(this.getForceSetValue());\r\n\r\n                this.hideButton($(this.indexedXPath + '_remove_button'));\r\n\r\n                var myEvent = new CustomEvent('undeleteble-specific-appear');\r\n                $(this.getParentIndexedXpath()).dispatchEvent(myEvent);\r\n\r\n                return '';\r\n            }\r\n\r\n            this.renderSelf();\r\n\r\n            if (this.isValueForceSet()) {\r\n                this.forceSelectAndDisable(this.getForceSetValue());\r\n            }\r\n\r\n            this.observeToolTips(this.indexedXPath);\r\n\r\n            this.checkSelection();\r\n            this.renderSpecificAttributes();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        load: function($super)\r\n        {\r\n            this.attributeHandler = AttributeObj;\r\n            return $super();\r\n        },\r\n\r\n        //########################################\r\n\r\n        renderParentSpecific: function()\r\n        {\r\n            if (this.specific.parent_specific_id == null) {\r\n                return '';\r\n            }\r\n\r\n            if (!this.dictionaryHelper.isSpecificTypeContainer(this.parentSpecific)) {\r\n                return '';\r\n            }\r\n\r\n            var parentBlockRenderer = new AmazonTemplateDescriptionCategorySpecificBlockRenderer();\r\n            parentBlockRenderer.setSpecificsHandler(this.specificHandler);\r\n            parentBlockRenderer.setIndexedXpath(this.getParentIndexedXpath());\r\n\r\n            parentBlockRenderer.process();\r\n        },\r\n\r\n        renderSelf: function()\r\n        {\r\n            this.renderLabel();\r\n            this.renderChooseMode();\r\n            this.renderValueInputs();\r\n\r\n            // affects the appearance of the actions buttons\r\n            this.specificHandler.markSpecificAsRendered(this.indexedXPath);\r\n\r\n            this.renderButtons();\r\n\r\n            // ---------------------------------------\r\n            $(this.indexedXPath).observe('my-duplicate-is-rendered', this.onMyDuplicateRendered.bind(this));\r\n            // ---------------------------------------\r\n\r\n            // like grid visibility or view of 'Add Specific' container\r\n            this.throwEventsToParents();\r\n        },\r\n\r\n        renderSpecificAttributes: function()\r\n        {\r\n            var self = this;\r\n\r\n            if (!this.specific.params.hasOwnProperty('attributes')) {\r\n                return '';\r\n            }\r\n\r\n            this.specific.params.attributes.each(function(attribute, index) {\r\n\r\n                var renderer = new AmazonTemplateDescriptionCategorySpecificGridRowAttributeRenderer();\r\n                renderer.setSpecificsHandler(self.specificHandler);\r\n                renderer.setIndexedXpath(self.indexedXPath);\r\n\r\n                renderer.attribute      = attribute;\r\n                renderer.attributeIndex = index;\r\n\r\n                renderer.process();\r\n            });\r\n        },\r\n\r\n        //########################################\r\n\r\n        renderLabel: function()\r\n        {\r\n            var td = new Element('td');\r\n            var title = this.specific.title;\r\n\r\n            if (this.dictionaryHelper.isSpecificRequired(this.specific) || this.isValueForceSet()) {\r\n                title += ' <span class=\"required\">*</span>';\r\n            } else if (this.dictionaryHelper.isSpecificDesired(this.specific)) {\r\n                title += ' <span style=\"color: grey; font-style: italic;\">(' + M2ePro.translator.translate('Desired') + ')</span>';\r\n            }\r\n\r\n            td.appendChild((new Element('span').insert(title)));\r\n\r\n            var note = this.getDefinitionNote(this.specific.data_definition);\r\n            if (note) {\r\n                var toolTip = this.getToolTipBlock(this.indexedXPath + '_definition_note', note);\r\n                toolTip.show();\r\n                td.appendChild(toolTip);\r\n            }\r\n\r\n            var notice = this.getSpecificOverriddenNotice();\r\n            if (notice) td.appendChild(notice);\r\n\r\n            notice = this.getSpecificParentageNotice();\r\n            if (notice) td.appendChild(notice);\r\n\r\n            this.getRowContainer().appendChild(td);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderChooseMode: function()\r\n        {\r\n            var select = new Element('select', {\r\n                'id'          : this.indexedXPath +'_mode',\r\n                'name'        : this.indexedXPath +'_mode',\r\n                'indexedxpath': this.indexedXPath,\r\n                'class'       : 'M2ePro-required-when-visible select admin__control-select',\r\n                'style'       : 'width: 85%;'\r\n            });\r\n\r\n            select.appendChild(new Element('option', {'style': 'display: none'}));\r\n\r\n            if (this.specific.recommended_values.length > 0) {\r\n                select.appendChild(new Element('option', {'value': this.MODE_RECOMMENDED_VALUE}))\r\n                    .insert(M2ePro.translator.translate('Recommended Values'));\r\n            }\r\n\r\n            select.appendChild(new Element('option', {'value': this.MODE_CUSTOM_VALUE}))\r\n                .insert(M2ePro.translator.translate('Custom Value'));\r\n\r\n            select.appendChild(new Element('option', {'value': this.MODE_CUSTOM_ATTRIBUTE}))\r\n                .insert(M2ePro.translator.translate('Custom Attribute'));\r\n\r\n            select.observe('change', this.onChangeChooseMode.bind(this));\r\n            this.getRowContainer().appendChild(new Element('td')).appendChild(select);\r\n        },\r\n\r\n        onChangeChooseMode: function(event)\r\n        {\r\n            var customAttribute     = $(this.indexedXPath + '_' + this.MODE_CUSTOM_ATTRIBUTE),\r\n                customAttributeNote = $(this.indexedXPath + '_custom_attribute_note');\r\n\r\n            var customValue     = $(this.indexedXPath + '_' + this.MODE_CUSTOM_VALUE),\r\n                customValueNote = $(this.indexedXPath + '_custom_value_note');\r\n\r\n            var recommendedValue = $(this.indexedXPath + '_' + this.MODE_RECOMMENDED_VALUE);\r\n\r\n            customAttribute     && customAttribute.hide();\r\n            customAttributeNote && customAttributeNote.hide();\r\n\r\n            customValue     && customValue.hide();\r\n            customValueNote && customValueNote.hide();\r\n\r\n            recommendedValue && recommendedValue.hide();\r\n\r\n            if (event.target.value == this.MODE_CUSTOM_VALUE) {\r\n                customValue     && customValue.show();\r\n                customValueNote && customValueNote.show();\r\n            }\r\n            if (event.target.value == this.MODE_CUSTOM_ATTRIBUTE) {\r\n                customAttribute     && customAttribute.show();\r\n                customAttributeNote && customAttributeNote.show();\r\n            }\r\n            if (event.target.value == this.MODE_RECOMMENDED_VALUE) {\r\n                recommendedValue && recommendedValue.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderValueInputs: function()\r\n        {\r\n            var td = this.getRowContainer().appendChild(new Element('td'));\r\n\r\n            // ---------------------------------------\r\n            if (this.dictionaryHelper.isSpecificTypeText(this.specific)) {\r\n\r\n                var note = this.getCustomValueTypeNote();\r\n                if (note) td.appendChild(this.getToolTipBlock(this.indexedXPath + '_custom_value_note', note));\r\n\r\n                td.appendChild(this.getTextTypeInput());\r\n            }\r\n\r\n            if (this.dictionaryHelper.isSpecificTypeSelect(this.specific)) {\r\n                td.appendChild(this.getSelectTypeInput());\r\n            }\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            note = this.getCustomAttributeTypeNote();\r\n            if (note) {\r\n                var tooltip = td.appendChild(this.getToolTipBlock(this.indexedXPath + '_custom_attribute_note', note));\r\n                tooltip.hide();\r\n            }\r\n\r\n            td.appendChild(this.getCustomAttributeSelect());\r\n            // ---------------------------------------\r\n\r\n            td.appendChild(this.getRecommendedValuesSelect());\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getTextTypeInput: function()\r\n        {\r\n            if (this.dictionaryHelper.isSpecificTypeTextArea(this.specific)) {\r\n\r\n                var input = new Element('textarea', {\r\n                    'id'            : this.indexedXPath +'_'+ this.MODE_CUSTOM_VALUE,\r\n                    'name'          : this.indexedXPath +'_'+ this.MODE_CUSTOM_VALUE,\r\n                    'indexedxpath'  : this.indexedXPath,\r\n                    'specific_id'   : this.specific.specific_id,\r\n                    'specific_type' : this.specific.params.type,\r\n                    'mode'          : this.MODE_CUSTOM_VALUE,\r\n                    'class'         : 'textarea admin__control-textarea M2ePro-required-when-visible M2ePro-specifics-validation',\r\n                    'style'         : 'width: 85%; display: none;'\r\n                });\r\n\r\n            } else {\r\n\r\n                var input = new Element('input', {\r\n                    'id'            : this.indexedXPath +'_'+ this.MODE_CUSTOM_VALUE,\r\n                    'name'          : this.indexedXPath +'_'+ this.MODE_CUSTOM_VALUE,\r\n                    'indexedxpath'  : this.indexedXPath,\r\n                    'specific_id'   : this.specific.specific_id,\r\n                    'mode'          : this.MODE_CUSTOM_VALUE,\r\n                    'specific_type' : this.specific.params.type,\r\n                    'type'          : 'text',\r\n                    'class'         : 'input-text admin__control-text M2ePro-required-when-visible M2ePro-specifics-validation',\r\n                    'style'         : 'display: none; width: 85%;'\r\n                });\r\n\r\n                this.specific.params.type == 'date_time' && Calendar.setup({\r\n                    'inputField': input,\r\n                    'ifFormat': \"%Y-%m-%d %H:%M:%S\",\r\n                    'showsTime': true,\r\n                    'button': input,\r\n                    'align': 'Bl',\r\n                    'singleClick': true\r\n                });\r\n\r\n                this.specific.params.type == 'date' && Calendar.setup({\r\n                    'inputField': input,\r\n                    'ifFormat': \"%Y-%m-%d\",\r\n                    'showsTime': true,\r\n                    'button': input,\r\n                    'align': 'Bl',\r\n                    'singleClick': true\r\n                });\r\n            }\r\n\r\n            input.observe('change', this.onChangeValue.bind(this));\r\n            return input;\r\n        },\r\n\r\n        getSelectTypeInput: function()\r\n        {\r\n            var self = this;\r\n\r\n            var select = new Element('select', {\r\n                'id'          : this.indexedXPath +'_'+ this.MODE_CUSTOM_VALUE,\r\n                'name'        : this.indexedXPath +'_'+ this.MODE_CUSTOM_VALUE,\r\n                'indexedxpath': this.indexedXPath,\r\n                'specific_id' : this.specific.specific_id,\r\n                'mode'        : this.MODE_CUSTOM_VALUE,\r\n                'class'       : 'M2ePro-required-when-visible select admin__control-select',\r\n                'style'       : 'display: none; width: 85%;'\r\n            });\r\n\r\n            select.appendChild(new Element('option', {'style': 'display: none;'}));\r\n\r\n            var specificOptions = this.specific.values;\r\n            specificOptions.each(function(option) {\r\n\r\n                var label = option == 'true' ? 'Yes' : (option == 'false' ? 'No' : option),\r\n                    tempOption = new Element('option', {'value': option});\r\n\r\n                select.appendChild(tempOption).insert(label);\r\n            });\r\n\r\n            select.observe('change', this.onChangeValue.bind(this));\r\n            return select;\r\n        },\r\n\r\n        getCustomAttributeSelect: function()\r\n        {\r\n            var select = new Element('select', {\r\n                'id'          : this.indexedXPath +'_'+ this.MODE_CUSTOM_ATTRIBUTE,\r\n                'name'        : this.indexedXPath +'_'+ this.MODE_CUSTOM_ATTRIBUTE,\r\n                'indexedxpath': this.indexedXPath,\r\n                'specific_id' : this.specific.specific_id,\r\n                'mode'        : this.MODE_CUSTOM_ATTRIBUTE,\r\n                'class'       : 'attributes M2ePro-required-when-visible select admin__control-select',\r\n                'style'       : 'display: none; width: 85%;',\r\n                'apply_to_all_attribute_sets' : '0'\r\n            });\r\n\r\n            select.appendChild(new Element('option', {'style': 'display: none', 'value': ''}));\r\n            this.attributeHandler.availableAttributes.each(function(el) {\r\n                select.appendChild(new Element('option', {'value': el.code})).insert(el.label);\r\n            });\r\n            select.value = '';\r\n\r\n            select.observe('change', this.onChangeValue.bind(this));\r\n\r\n            var handlerObj = new AttributeCreator(select.id);\r\n            handlerObj.setSelectObj(select);\r\n            handlerObj.injectAddOption();\r\n\r\n            return select;\r\n        },\r\n\r\n        getRecommendedValuesSelect: function()\r\n        {\r\n            var select = new Element('select', {\r\n                'id'          : this.indexedXPath +'_'+ this.MODE_RECOMMENDED_VALUE,\r\n                'name'        : this.indexedXPath +'_'+ this.MODE_RECOMMENDED_VALUE,\r\n                'indexedxpath': this.indexedXPath,\r\n                'specific_id' : this.specific.specific_id,\r\n                'mode'        : this.MODE_RECOMMENDED_VALUE,\r\n                'class'       : 'M2ePro-required-when-visible select admin__control-select',\r\n                'style'       : 'display: none; width: 85%;'\r\n            });\r\n\r\n            select.appendChild(new Element('option', {'style': 'display: none', 'value': ''}));\r\n            this.specific.recommended_values.each(function(value) {\r\n                select.appendChild(new Element('option', {'value': value})).insert(value);\r\n            });\r\n            select.value = '';\r\n\r\n            select.observe('change', this.onChangeValue.bind(this));\r\n            return select;\r\n        },\r\n\r\n        onChangeValue: function(event)\r\n        {\r\n            var selectedObj = {};\r\n\r\n            selectedObj['mode'] = event.target.getAttribute('mode');\r\n            selectedObj['type'] = event.target.getAttribute('specific_type');\r\n            selectedObj['is_required'] = (this.dictionaryHelper.isSpecificRequired(this.specific) || this.isValueForceSet()) ? 1 : 0;\r\n            selectedObj[selectedObj.mode] = event.target.value;\r\n\r\n            this.specificHandler.markSpecificAsSelected(this.indexedXPath, selectedObj);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderButtons: function()\r\n        {\r\n            var td = this.getRowContainer().appendChild(new Element('td'));\r\n\r\n            var cloneButton = this.getCloneButton();\r\n            if(cloneButton !== null) td.appendChild(cloneButton);\r\n\r\n            var removeButton = this.getRemoveButton();\r\n            if(removeButton !== null) td.appendChild(removeButton);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        throwEventsToParents: function()\r\n        {\r\n            var myEvent,\r\n                parentXpath;\r\n\r\n            // ---------------------------------------\r\n            myEvent = new CustomEvent('child-specific-rendered');\r\n            parentXpath = this.getParentIndexedXpath();\r\n\r\n            $(parentXpath + '_grid').dispatchEvent(myEvent);\r\n            $(parentXpath + '_add_row').dispatchEvent(myEvent);\r\n            // ---------------------------------------\r\n\r\n            // my duplicate is already rendered\r\n            this.touchMyNeighbors();\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            if (this.isValueForceSet()) {\r\n\r\n                this.hideButton($(this.indexedXPath + '_remove_button'));\r\n\r\n                myEvent = new CustomEvent('undeleteble-specific-appear');\r\n                $(this.getParentIndexedXpath()).dispatchEvent(myEvent);\r\n            }\r\n            // ---------------------------------------\r\n        },\r\n\r\n        //########################################\r\n\r\n        checkSelection: function()\r\n        {\r\n            if (this.specific.values.length == 1) {\r\n                this.forceSelectAndDisable(this.specific.values[0]);\r\n                return '';\r\n            }\r\n\r\n            if (!this.specificHandler.isMarkedAsSelected(this.indexedXPath) &&\r\n                !this.specificHandler.isInFormData(this.indexedXPath)) {\r\n                return '';\r\n            }\r\n\r\n            var selectionInfo = this.specificHandler.getSelectionInfo(this.indexedXPath);\r\n\r\n            var id = this.indexedXPath + '_mode';\r\n            $(id).value = selectionInfo.mode;\r\n            this.simulateAction($(id), 'change');\r\n\r\n            if (selectionInfo.mode == this.MODE_CUSTOM_VALUE) {\r\n                id = this.indexedXPath +'_'+ this.MODE_CUSTOM_VALUE;\r\n                $(id).value = selectionInfo['custom_value'];\r\n                this.simulateAction($(id), 'change');\r\n            }\r\n\r\n            if (selectionInfo.mode == this.MODE_CUSTOM_ATTRIBUTE) {\r\n                id = this.indexedXPath +'_'+ this.MODE_CUSTOM_ATTRIBUTE;\r\n                $(id).value = selectionInfo['custom_attribute'];\r\n                this.simulateAction($(id), 'change');\r\n            }\r\n\r\n            if (selectionInfo.mode == this.MODE_RECOMMENDED_VALUE) {\r\n                id = this.indexedXPath +'_'+ this.MODE_RECOMMENDED_VALUE;\r\n                $(id).value = selectionInfo['recommended_value'];\r\n                this.simulateAction($(id), 'change');\r\n            }\r\n        },\r\n\r\n        forceSelectAndDisable: function(value)\r\n        {\r\n            if (!value) {\r\n                return;\r\n            }\r\n\r\n            var modeSelect = $(this.indexedXPath + '_mode');\r\n            modeSelect.value = this.MODE_CUSTOM_VALUE;\r\n            this.simulateAction(modeSelect, 'change');\r\n            modeSelect.setAttribute('disabled','disabled');\r\n\r\n            var valueObj = $(this.indexedXPath +'_'+ this.MODE_CUSTOM_VALUE);\r\n            valueObj.value = value;\r\n            this.simulateAction(valueObj, 'change');\r\n            valueObj.setAttribute('disabled', 'disabled');\r\n        },\r\n\r\n        //########################################\r\n\r\n        getToolTipBlock: function(id, messageHtml)\r\n        {\r\n            var container = new Element('div', {\r\n                'id'   : id,\r\n                'class': 'm2epro-field-tooltip admin__field-tooltip',\r\n            });\r\n\r\n            container.appendChild(new Element('a', {\r\n                'class' : 'admin__field-tooltip-action',\r\n                'style': 'margin-left: 0;'\r\n            }));\r\n\r\n            var htmlCont = container.appendChild(new Element('div', {\r\n                'class' : 'admin__field-tooltip-content',\r\n                'style' : 'max-width: 500px;'\r\n            }));\r\n\r\n            htmlCont.insert(messageHtml);\r\n\r\n            return container;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getCustomValueTypeNote: function()\r\n        {\r\n            if (this.specific.data_definition.definition) {\r\n                return null;\r\n            }\r\n\r\n            if (this.specific.params.type == 'int') return this.getIntTypeNote(this.specific.params);\r\n            if (this.specific.params.type == 'float') return this.getFloatTypeNote(this.specific.params);\r\n            if (this.specific.params.type == 'string') return this.getStringTypeNote(this.specific.params);\r\n            if (this.specific.params.type == 'date_time') return this.getDatTimeTypeNote(this.specific.params);\r\n\r\n            return this.getAnyTypeNote(this.specific.params);\r\n        },\r\n\r\n        getIntTypeNote: function(params)\r\n        {\r\n            var notes = [];\r\n\r\n            var handler = {\r\n                'type': function() {\r\n                    notes[0] = M2ePro.translator.translate('Type: Numeric.') + ' ';\r\n                },\r\n                'min_value': function(restriction) {\r\n                    notes[1] = M2ePro.translator.translate('Min:') + ' ' + restriction + '. ';\r\n                },\r\n                'max_value': function(restriction) {\r\n                    notes[2] = M2ePro.translator.translate('Max:') + ' ' + restriction + '. ';\r\n                },\r\n                'total_digits': function(restriction) {\r\n                    notes[3] = M2ePro.translator.translate('Total digits (not more):') + ' ' + restriction + '. ';\r\n                }\r\n            };\r\n\r\n            for (var paramName in params) {\r\n                params.hasOwnProperty(paramName) && handler[paramName] && handler[paramName](params[paramName]);\r\n            }\r\n\r\n            return notes.join('');\r\n        },\r\n\r\n        getFloatTypeNote: function(params)\r\n        {\r\n            var notes = [];\r\n\r\n            var handler = {\r\n                'type': function() {\r\n                    notes[0] = M2ePro.translator.translate('Type: Numeric floating point.') + ' ';\r\n                },\r\n                'min_value': function(restriction) {\r\n                    notes[1] = M2ePro.translator.translate('Min:') + ' ' + restriction + '. ';\r\n                },\r\n                'max_value': function(restriction) {\r\n                    notes[2] = M2ePro.translator.translate('Max:') + ' ' + restriction + '. ';\r\n                },\r\n                'decimal_places': function(restriction) {\r\n                    notes[3] = M2ePro.translator.translate('Decimal places (not more):') + ' ' + restriction.value + '. ';\r\n                },\r\n                'total_digits': function(restriction) {\r\n                    notes[4] = M2ePro.translator.translate('Total digits (not more):') + ' ' + restriction + '. ';\r\n                }\r\n            };\r\n\r\n            for (var paramName in params) {\r\n                params.hasOwnProperty(paramName) && handler[paramName] && handler[paramName](params[paramName]);\r\n            }\r\n\r\n            return notes.join('');\r\n        },\r\n\r\n        getStringTypeNote: function(params)\r\n        {\r\n            var notes = [];\r\n\r\n            var handler = {\r\n                'type': function() {\r\n                    notes[0] = M2ePro.translator.translate('Type: String.') + ' ';\r\n                },\r\n                'min_length': function(restriction) {\r\n                    notes[1] = restriction != 1 ? M2ePro.translator.translate('Min length:') + ' ' + restriction : '';\r\n                },\r\n                'max_length': function(restriction) {\r\n                    notes[2] = M2ePro.translator.translate('Max length:') + ' ' + restriction;\r\n                },\r\n                'pattern': function(restriction) {\r\n                    if (restriction == '[a-zA-Z][a-zA-Z]|unknown') {\r\n                        notes[3] = M2ePro.translator.translate('Two uppercase letters or \"unknown\".');\r\n                    }\r\n                }\r\n            };\r\n\r\n            for (var paramName in params) {\r\n                params.hasOwnProperty(paramName) && handler[paramName] && handler[paramName](params[paramName]);\r\n            }\r\n\r\n            return notes.join('');\r\n        },\r\n\r\n        getDatTimeTypeNote: function(params)\r\n        {\r\n            var notes = [];\r\n\r\n            var handler = {\r\n                'type': function(restriction) {\r\n                    notes.push(M2ePro.translator.translate('Type: Date time. Format: YYYY-MM-DD hh:mm:ss'));\r\n                }\r\n            };\r\n\r\n            for (var paramName in params) {\r\n                params.hasOwnProperty(paramName) && handler[paramName] && handler[paramName](params[paramName]);\r\n            }\r\n\r\n            return notes.join('');\r\n        },\r\n\r\n        getAnyTypeNote: function(params)\r\n        {\r\n            return M2ePro.translator.translate('Can take any value.');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getCustomAttributeTypeNote: function()\r\n        {\r\n            if (this.specific.values.length <= 0 && this.specific.recommended_values.length <= 0) {\r\n                return null;\r\n            }\r\n\r\n            var span = new Element('span');\r\n            var title = this.specific.values.length > 0 ? M2ePro.translator.translate('Allowed Values') : M2ePro.translator.translate('Recommended Values');\r\n\r\n            span.appendChild(new Element('span')).insert('<b>' + title + ': </b>');\r\n\r\n            var ul = span.appendChild(new Element('ul'));\r\n            var noteValues = this.specific.values.length > 0 ? this.specific.values : this.specific.recommended_values;\r\n\r\n            noteValues.each(function(value) {\r\n                ul.appendChild(new Element('li')).insert(value);\r\n            });\r\n\r\n            return span.outerHTML;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getDefinitionNote: function(definitionPart)\r\n        {\r\n            if (!definitionPart.definition) {\r\n                return;\r\n            }\r\n\r\n            var div = new Element('div');\r\n\r\n            div.appendChild(new Element('div', {style: 'padding: 2px 0; margin-top: 5px;'}))\r\n                .insert('<b>' + M2ePro.translator.translate('Definition:') + '</b>');\r\n            div.appendChild(new Element('div'))\r\n                .insert(definitionPart.definition);\r\n\r\n            if (definitionPart.tips && definitionPart.tips.match(/[a-z0-9]/i)) {\r\n\r\n                div.appendChild(new Element('div', {style: 'padding: 2px 0; margin-top: 5px;'}))\r\n                    .insert('<b>' + M2ePro.translator.translate('Tips:') + '</b>');\r\n                div.appendChild(new Element('div'))\r\n                    .insert(definitionPart.tips);\r\n            }\r\n\r\n            if (definitionPart.example && definitionPart.example.match(/[a-z0-9]/i)) {\r\n\r\n                div.appendChild(new Element('div', {style: 'padding: 2px 0; margin-top: 5px;'}))\r\n                    .insert('<b>' + M2ePro.translator.translate('Examples:') + '</b>');\r\n                div.appendChild(new Element('div'))\r\n                    .insert(definitionPart.example);\r\n            }\r\n\r\n            return div.outerHTML;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSpecificOverriddenNotice: function()\r\n        {\r\n            if (!this.specificHandler.canSpecificBeOverwrittenByVariationTheme(this.specific)) {\r\n                return null;\r\n            }\r\n\r\n            var variationThemesList = this.specificHandler.themeAttributes[this.specific.xml_tag];\r\n\r\n            var message = '<b>' + M2ePro.translator.translate('Value of this Specific can be automatically overwritten by M2E Pro.') + '</b>';\r\n            message += '<br/><br/>' + variationThemesList.join(', ');\r\n\r\n            return this.constructNotice(message);\r\n        },\r\n\r\n        getSpecificParentageNotice: function()\r\n        {\r\n            if (this.specific.xml_tag != 'Parentage') {\r\n                return null;\r\n            }\r\n\r\n            return this.constructNotice(M2ePro.translator.translate('Amazon Parentage Specific will be overridden notice.'));\r\n        },\r\n\r\n        constructNotice: function(message)\r\n        {\r\n            var container = new Element('div', {\r\n                'class': 'm2epro-field-tooltip admin__field-tooltip',\r\n            });\r\n\r\n            container.appendChild(new Element('a', {\r\n                'class' : 'admin__field-tooltip-action tool-tip-image-warning',\r\n                'style': 'margin-left: 0;'\r\n            }));\r\n\r\n            var htmlCont = container.appendChild(new Element('div', {\r\n                'class' : 'admin__field-tooltip-content',\r\n                'style' : 'max-width: 500px;'\r\n            }));\r\n\r\n            //...\r\n\r\n            htmlCont.insert(message);\r\n\r\n            return container;\r\n        },\r\n\r\n        //########################################\r\n\r\n        observeToolTips: function(indexedXpath)\r\n        {\r\n            //$$('tr[id=\"' + indexedXpath + '\"] .tool-tip-image').each(function(element) {\r\n            //    element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n            //    element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            //});\r\n            //\r\n            //$$('tr[id=\"' + indexedXpath + '\"] .tool-tip-message').each(function(element) {\r\n            //    element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n            //    element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            //});\r\n        },\r\n\r\n        //########################################\r\n\r\n        removeAction: function($super, event)\r\n        {\r\n            // for attributes removing\r\n            var myEvent = new CustomEvent('parent-specific-row-is-removed');\r\n            $(this.indexedXPath).dispatchEvent(myEvent);\r\n            // ---------------------------------------\r\n\r\n            var deleteResult = $super(event);\r\n            this.throwEventsToParents();\r\n\r\n            return deleteResult;\r\n        },\r\n\r\n        cloneAction: function($super, event)\r\n        {\r\n            var newIndexedXpath = $super(event);\r\n            this.observeToolTips(newIndexedXpath);\r\n\r\n            var myEvent = new CustomEvent('parent-specific-row-is-cloned', { 'new_indexed_xpath': newIndexedXpath });\r\n            $(this.indexedXPath).dispatchEvent(myEvent);\r\n\r\n            return newIndexedXpath;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getRowContainer: function()\r\n        {\r\n            if ($(this.indexedXPath)) {\r\n                return $(this.indexedXPath);\r\n            }\r\n\r\n            var grid = $$('table[id=\"'+ this.getParentIndexedXpath() +'_grid\"] table.border tbody').first();\r\n            return grid.appendChild(new Element('tr', {id: this.indexedXPath}));\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Configuration/Components.js":"define(function () {\r\n\r\n    window.ConfigurationComponents = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        componentsTitles: [],\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-check-default-component', function(value) {\r\n\r\n                var componentDefault        = $('view_common_component_default').value.toLowerCase(),\r\n                    componentsEnabledNumber = 0;\r\n\r\n                $$('.M2ePro-component-other').each(function(el) {\r\n                    if ($(el).value == 1) {\r\n                        componentsEnabledNumber++;\r\n                    }\r\n                });\r\n\r\n                if (componentsEnabledNumber <= 1) {\r\n                    return true;\r\n                }\r\n\r\n                return $('component_' + componentDefault + '_mode') &&\r\n                    $('component_' + componentDefault + '_mode').value == 1;\r\n            }, M2ePro.translator.translate('Default Component should be enabled.'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        component_mode_change: function()\r\n        {\r\n            var enabledComponents = 0;\r\n\r\n            $$('.M2ePro-component-other').each(function(el) {\r\n                if ($(el).value == 1) {\r\n                    enabledComponents++;\r\n                }\r\n            });\r\n\r\n            ComponentsObj.updateDefaultComponentSelect();\r\n\r\n            if (enabledComponents >= 2) {\r\n                $('view_common_component_default_tr').show();\r\n            } else {\r\n\r\n                var defaultComponent = M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK');\r\n                if ($('component_amazon_mode').value == 1) {\r\n                    defaultComponent = M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK');\r\n                } else if ($('component_buy_mode').value == 1) {\r\n                    defaultComponent = M2ePro.php.constant('Ess_M2ePro_Helper_Component_Buy::NICK');\r\n                }\r\n\r\n                $('view_common_component_default').value = defaultComponent;\r\n                $('view_common_component_default_tr').hide();\r\n            }\r\n        },\r\n\r\n        updateDefaultComponentSelect: function()\r\n        {\r\n            var self = this;\r\n\r\n            var html       = '',\r\n                selected   = '',\r\n\r\n                components = [\r\n                    M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK'),\r\n                    M2ePro.php.constant('Ess_M2ePro_Helper_Component_Buy::NICK')\r\n                ];\r\n\r\n            components.each(function(nick) {\r\n\r\n                if ($('component_' + nick + '_mode').value == 1) {\r\n\r\n                    $('view_common_component_default').value == nick\r\n                        ? selected = ' selected=\"selected\"'\r\n                        : selected = '';\r\n\r\n                    html += '<option value=\"' + nick + '\"' + selected + '>' +\r\n                        self.componentsTitles[nick] +\r\n                        '</option>';\r\n                }\r\n            });\r\n\r\n            $('view_common_component_default').innerHTML = html;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/ControlPanel/Database/Grid.js":"define([\r\n    'jquery',\r\n    'M2ePro/Grid',\r\n    'Magento_Ui/js/modal/modal'\r\n], function (jquery, grid, modal) {\r\n\r\n    window.ControlPanelDatabaseGrid = Class.create(Grid, {\r\n\r\n        mergeModeCookieKey: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        setMergeModeCookieKey: function (key)\r\n        {\r\n            this.mergeModeCookieKey = key;\r\n        },\r\n\r\n        prepareActions: function()\r\n        {\r\n            this.actions = {\r\n                deleteTableRowsAction: function(id) { this.deleteTableRows(id); }.bind(this),\r\n                updateTableCellsAction: function() { this.openTableCellsPopup('update'); }.bind(this)\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        switchMergeMode: function()\r\n        {\r\n            this.isMergeModeEnabled() ? this.setMergeMode('0') : this.setMergeMode('1');\r\n            window.location = M2ePro.url.get('controlPanel/manageTable');\r\n        },\r\n\r\n        isMergeModeEnabled: function()\r\n        {\r\n            var cookieValue = getCookie(this.mergeModeCookieKey);\r\n            return cookieValue != null && cookieValue != ''  && cookieValue != '0';\r\n        },\r\n\r\n        setMergeMode: function(value)\r\n        {\r\n            setCookie(this.mergeModeCookieKey, value, 3*365, '/');\r\n        },\r\n\r\n        mergeParentTable: function(component)\r\n        {\r\n            this.setMergeMode('1');\r\n            window.location = M2ePro.url.get('controlPanel/manageTable', {component: component});\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        deleteTableRows: function(id)\r\n        {\r\n            var self = this,\r\n                confirmAction,\r\n                selectedIds = id ? id : self.getSelectedProductsString();\r\n\r\n            confirmAction = function() {\r\n                new Ajax.Request(M2ePro.url.get('controlPanel/deleteTableRows'), {\r\n                    method:'post',\r\n                    parameters: {\r\n                        ids: selectedIds\r\n                    },\r\n                    onSuccess: function(transport) {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                });\r\n            };\r\n\r\n            if (id) {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                confirmAction();\r\n            }\r\n        },\r\n\r\n        openTableCellsPopup: function(mode)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('controlPanel/getTableCellsPopupHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    ids:  self.getSelectedProductsString(),\r\n                    mode: mode\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var containerEl = jQuery('#controlPanel_manage_row_popup_content').get(0);\r\n                    if (!containerEl) {\r\n                        containerEl = document.createElement('div');\r\n                        containerEl.id = 'controlPanel_manage_row_popup_content';\r\n                    }\r\n\r\n                    containerEl.update(transport.responseText);\r\n\r\n                    self.popup = jQuery(containerEl);\r\n\r\n                    modal({\r\n                        title: mode == 'update' ? 'Edit Table Records' : 'Add Table Row',\r\n                        modalClass: 'width-50',\r\n                        type: 'popup',\r\n                        buttons: [\r\n                            {\r\n                                text: 'Close',\r\n                                class: 'action',\r\n                                click: function () {\r\n                                    self.popup.modal('closeModal');\r\n                                }\r\n                            },\r\n                            {\r\n                                text: 'Confirm',\r\n                                class: 'action primary',\r\n                                click: function () {\r\n                                    mode == 'update' ? self.confirmUpdateCells()\r\n                                                     : self.confirmAddRow();\r\n                                }\r\n                            }\r\n                        ]\r\n                    }, self.popup);\r\n\r\n                    self.popup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        confirmUpdateCells: function()\r\n        {\r\n            var self = this;\r\n\r\n            if (!this.isAnySwitcherEnabled()) {\r\n\r\n                self.alert('You should select columns.');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('controlPanel/updateTableCells'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: Form.serialize($('controlPanel_tabs_database_table_cells_popup_form')),\r\n                onSuccess: function(transport) {\r\n                    self.unselectAllAndReload();\r\n                    self.popup && self.popup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        confirmAddRow: function()\r\n        {\r\n            var self = this;\r\n\r\n            if (!this.isAnySwitcherEnabled()) {\r\n\r\n                self.alert('You should select columns.');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('controlPanel/addTableRow'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: Form.serialize($('controlPanel_tabs_database_table_cells_popup_form')),\r\n                onSuccess: function(transport) {\r\n                    self.getGridObj().reload();\r\n                    self.popup && self.popup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mouseOverCell: function()\r\n        {\r\n            var cellId = this.id;\r\n\r\n            if ($(cellId + '_save_link').getStyle('display') != 'none') {\r\n                return;\r\n            }\r\n\r\n            $(cellId + '_edit_link').show();\r\n            $(cellId + '_view_link').hide();\r\n            $(cellId + '_save_link').hide();\r\n        },\r\n\r\n        mouseOutCell: function()\r\n        {\r\n            var cellId = this.id;\r\n\r\n            if ($(cellId + '_save_link').getStyle('display') != 'none') {\r\n                return;\r\n            }\r\n\r\n            $(cellId + '_edit_link').hide();\r\n            $(cellId + '_view_link').hide();\r\n            $(cellId + '_save_link').hide();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        switchCellToView: function(cellId)\r\n        {\r\n            $(cellId + '_edit_link').show();\r\n            $(cellId + '_view_link').hide();\r\n            $(cellId + '_save_link').hide();\r\n\r\n            $(cellId + '_edit_container').hide();\r\n            $(cellId + '_view_container').show();\r\n        },\r\n\r\n        switchCellToEdit: function(cellId)\r\n        {\r\n            $(cellId + '_edit_link').hide();\r\n            $(cellId + '_view_link').show();\r\n            $(cellId + '_save_link').show();\r\n\r\n            $(cellId + '_edit_container').show();\r\n            $(cellId + '_view_container').hide();\r\n        },\r\n\r\n        saveTableCell: function(rowId, columnName)\r\n        {\r\n            var self = this;\r\n            var params = {\r\n                ids:   rowId,\r\n                cells: columnName\r\n            };\r\n\r\n            var cellId = 'table_row_cell_' + columnName + '_' + rowId;\r\n            params['value_'+ columnName] = $(cellId + '_edit_input').value;\r\n\r\n            new Ajax.Request(M2ePro.url.get('controlPanel/updateTableCells'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: params,\r\n                onSuccess: function(transport) {\r\n                    self.switchCellToView(cellId);\r\n                    self.getGridObj().reload();\r\n                }\r\n            });\r\n        },\r\n\r\n        onKeyDownEdit: function(rowId, columnName, event)\r\n        {\r\n            if (event.keyCode != 13) {\r\n                return false;\r\n            }\r\n\r\n            this.saveTableCell(rowId, columnName);\r\n            return false;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        switcherStateChange: function()\r\n        {\r\n            var inputElement = $(this.id.replace('switcher','input'));\r\n\r\n            inputElement.removeAttribute('disabled');\r\n\r\n            if (!this.checked) {\r\n                inputElement.value = '';\r\n                inputElement.setAttribute('disabled', 'disabled');\r\n            }\r\n        },\r\n\r\n        isAnySwitcherEnabled: function()\r\n        {\r\n            var result = false;\r\n\r\n            $$('#controlPanel_tabs_database_table_cells_popup .input_switcher').each(function(el) {\r\n                if (el.checked) {\r\n                    result = true;\r\n                    return true;\r\n                }\r\n            });\r\n\r\n            return result;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Account.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common',\r\n    'extjs/ext-tree-checkbox',\r\n    'mage/adminhtml/form'\r\n], function(modal){\r\n\r\n    window.EbayAccount = Class.create(Common, {\r\n\r\n    // ---------------------------------------\r\n\r\n    initialize: function()\r\n    {\r\n        this.setValidationCheckRepetitionValue('M2ePro-account-title',\r\n            M2ePro.translator.translate('The specified Title is already used for other Account. Account Title must be unique.'),\r\n            'Account', 'title', 'id',\r\n            M2ePro.formData.id,\r\n            M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay::NICK')\r\n        );\r\n\r\n        jQuery.validator.addMethod('M2ePro-account-token-session', function(value) {\r\n            return value != '';\r\n        }, M2ePro.translator.translate('You must get token.'));\r\n\r\n        jQuery.validator.addMethod('M2ePro-account-customer-id', function(value) {\r\n\r\n            var checkResult = false;\r\n\r\n            if ($('magento_orders_customer_id_container').getStyle('display') == 'none') {\r\n                return true;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/checkCustomerId'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: {\r\n                    customer_id : value,\r\n                    id          : M2ePro.formData.id\r\n                },\r\n                onSuccess: function(transport) {\r\n                    checkResult = transport.responseText.evalJSON()['ok'];\r\n                }\r\n            });\r\n\r\n            return checkResult;\r\n        }, M2ePro.translator.translate('No Customer entry is found for specified ID.'));\r\n\r\n        jQuery.validator.addMethod('M2ePro-account-order-number-prefix', function(value) {\r\n\r\n            if ($('magento_orders_number_prefix_mode').value == 0) {\r\n                return true;\r\n            }\r\n\r\n            return value.length <= 5;\r\n        }, M2ePro.translator.translate('Prefix length should not be greater than 5 characters.'));\r\n\r\n        jQuery.validator.addMethod('M2ePro-account-feedback-templates', function(value) {\r\n\r\n            if (value == 0) {\r\n                return true;\r\n            }\r\n\r\n            var checkResult = false;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_account_feedback/templateCheck'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: {\r\n                    id: M2ePro.formData.id\r\n                },\r\n                onSuccess: function(transport) {\r\n                    checkResult = transport.responseText.evalJSON()['ok'];\r\n                }\r\n            });\r\n\r\n            return checkResult;\r\n        }, M2ePro.translator.translate('You should create at least one Response Template.'));\r\n\r\n        jQuery.validator.addMethod('M2ePro-require-select-attribute', function(value, el) {\r\n\r\n            if ($('other_listings_mapping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_MAPPING_MODE_NO')) {\r\n                return true;\r\n            }\r\n\r\n            var isAttributeSelected = false;\r\n\r\n            $$('.attribute-mode-select').each(function(obj) {\r\n                if (obj.value != 0) {\r\n                    isAttributeSelected = true;\r\n                }\r\n            });\r\n\r\n            return isAttributeSelected;\r\n        }, M2ePro.translator.translate('If Yes is chosen, you must select at least one Attribute for Product Mapping.'));\r\n    },\r\n\r\n    initObservers: function()\r\n    {\r\n        if (!M2ePro.formData.id) {\r\n            return;\r\n        }\r\n\r\n        //tab listingOther\r\n        $('other_listings_synchronization')\r\n            .observe('change', this.other_listings_synchronization_change)\r\n            .simulate('change');\r\n        $('other_listings_mapping_mode')\r\n            .observe('change', this.other_listings_mapping_mode_change)\r\n            .simulate('change');\r\n        $('mapping_sku_mode')\r\n            .observe('change', this.mapping_sku_mode_change)\r\n            .simulate('change');\r\n        $('mapping_title_mode')\r\n            .observe('change', this.mapping_title_mode_change)\r\n            .simulate('change');\r\n\r\n        //$('ebayAccountEditTabs_listingOther').removeClassName('changed');\r\n\r\n        //tab orders\r\n        $('magento_orders_listings_mode').observe('change', this.magentoOrdersListingsModeChange).simulate('change');\r\n        $('magento_orders_listings_store_mode').observe('change', this.magentoOrdersListingsStoreModeChange).simulate('change');\r\n\r\n        $('magento_orders_listings_other_mode').observe('change', this.magentoOrdersListingsOtherModeChange).simulate('change');\r\n        $('magento_orders_listings_other_product_mode').observe('change', this.magentoOrdersListingsOtherProductModeChange);\r\n\r\n        $('magento_orders_number_source').observe('change', this.magentoOrdersNumberSourceChange);\r\n        $('magento_orders_number_prefix_mode').observe('change', this.magentoOrdersNumberPrefixModeChange).simulate('change');\r\n        $('magento_orders_number_prefix_prefix').observe('keyup', this.magentoOrdersNumberPrefixPrefixChange).simulate('change');\r\n        EbayAccountObj.renderOrderNumberExample();\r\n\r\n        $('magento_orders_customer_mode').observe('change', this.magentoOrdersCustomerModeChange).simulate('change');\r\n\r\n        $('magento_orders_status_mapping_mode').observe('change', this.magentoOrdersStatusMappingModeChange);\r\n\r\n        $('magento_orders_creation_mode').observe('change', this.magentoOrdersCreationModeChange).simulate('change');\r\n\r\n        $('order_number_example-note').previous().remove();\r\n    },\r\n\r\n    // ---------------------------------------\r\n\r\n    saveAndClose: function()\r\n    {\r\n        var self = this,\r\n            url = typeof M2ePro.url.urls.formSubmit == 'undefined' ?\r\n                M2ePro.url.formSubmit + 'back/'+Base64.encode('list')+'/' :\r\n                M2ePro.url.get('formSubmit', {'back': Base64.encode('list')});\r\n\r\n        if (!this.isValidForm()) {\r\n            return;\r\n        }\r\n\r\n        new Ajax.Request(url, {\r\n            method: 'post',\r\n            parameters: Form.serialize($('edit_form')),\r\n            onSuccess: function(transport) {\r\n                transport = transport.responseText.evalJSON();\r\n\r\n                if (transport.success) {\r\n                    window.close();\r\n                } else {\r\n                    self.alert(transport.message);\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    // ---------------------------------------\r\n\r\n    deleteClick: function()\r\n    {\r\n        this.confirm({\r\n            content: M2ePro.translator.translate('Be attentive! By Deleting Account you delete all information on it from M2E Pro Server. This will cause inappropriate work of all Accounts\\' copies.'),\r\n            actions: {\r\n                confirm: function () {\r\n                    setLocation(M2ePro.url.get('deleteAction'));\r\n                },\r\n                cancel: function () {\r\n                    return false;\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    // ---------------------------------------\r\n\r\n    get_token: function()\r\n    {\r\n        if ($('token_session').value == '') {\r\n            $('token_session').value = '0';\r\n        }\r\n        if ($('token_expired_date').value == '') {\r\n            $('token_expired_date').value = '0';\r\n        }\r\n\r\n        if (!jQuery('#edit_form').valid()) {\r\n            return;\r\n        }\r\n\r\n        this.submitForm(M2ePro.url.get('ebay_account/beforeGetToken', {'id': M2ePro.formData.id}));\r\n    },\r\n\r\n    // ---------------------------------------\r\n\r\n    feedbacksReceiveChange: function()\r\n    {\r\n        var self = EbayAccountObj ;\r\n\r\n        if ($('feedbacks_receive').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::FEEDBACKS_RECEIVE_YES')) {\r\n            $('feedbacks_auto_response_container').show();\r\n        } else {\r\n            $('feedbacks_auto_response_container').hide();\r\n\r\n        }\r\n        $('feedbacks_auto_response').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::FEEDBACKS_AUTO_RESPONSE_NONE');\r\n        self.feedbacksAutoResponseChange();\r\n    },\r\n\r\n    feedbacksAutoResponseChange: function()\r\n    {\r\n        if ($('feedbacks_auto_response').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::FEEDBACKS_AUTO_RESPONSE_NONE')) {\r\n            $('feedbacks_auto_response_only_positive_container').hide();\r\n            $('feedback_templates_grid_container').hide();\r\n        } else {\r\n            $('feedbacks_auto_response_only_positive_container').show();\r\n            $('feedback_templates_grid_container').show();\r\n        }\r\n    },\r\n\r\n    // ---------------------------------------\r\n\r\n    openFeedbackTemplatePopup: function(templateId)\r\n    {\r\n        var self = this;\r\n\r\n        new Ajax.Request(M2ePro.url.get('ebay_account_feedback_template/getForm'), {\r\n            method: 'GET',\r\n            parameters: {\r\n                id: templateId\r\n            },\r\n            onSuccess: function(transport) {\r\n\r\n                var response = transport.responseText.evalJSON();\r\n\r\n                var container = $('edit_feedback_template_form_container');\r\n\r\n                if (container) {\r\n                    container.remove();\r\n                }\r\n\r\n                $('html-body').insert({\r\n                    bottom: '<div id=\"edit_feedback_template_form_container\">' + response.html + '</div>'\r\n                });\r\n\r\n                self.initFormValidation('#edit_feedback_template_form');\r\n\r\n                self.feedbackTemplatePopup = jQuery('#edit_feedback_template_form_container');\r\n\r\n                modal({\r\n                    title: response.title,\r\n                    type: 'popup',\r\n                    modalClass: 'width-50',\r\n                    buttons: [{\r\n                        text: M2ePro.translator.translate('Cancel'),\r\n                        class: 'action-secondary action-dismiss',\r\n                        click: function () {\r\n                            self.feedbackTemplatePopup.modal('closeModal');\r\n                        }\r\n                    },{\r\n                        text: M2ePro.translator.translate('Save'),\r\n                        class: 'action-primary',\r\n                        click: function () {\r\n                            if (!jQuery('#edit_feedback_template_form').valid()) {\r\n                                return false;\r\n                            }\r\n\r\n                            new Ajax.Request(M2ePro.url.get('ebay_account_feedback_template/save'), {\r\n                                parameters: $('edit_feedback_template_form').serialize(true),\r\n                                onSuccess: function() {\r\n                                    self.feedbackTemplatePopup.modal('closeModal');\r\n                                    $('add_feedback_template_button_container').hide();\r\n                                    $('feedback_templates_grid').show();\r\n                                    window['ebayAccountEditTabsFeedbackGridJsObject'].reload();\r\n                                }\r\n                            });\r\n                        }\r\n                    }]\r\n                }, self.feedbackTemplatePopup);\r\n\r\n                self.feedbackTemplatePopup.modal('openModal');\r\n            }\r\n        });\r\n    },\r\n\r\n    // ---------------------------------------\r\n\r\n    feedbacksDeleteAction: function(id)\r\n    {\r\n        this.confirm({\r\n            actions: {\r\n                confirm: function () {\r\n                    new Ajax.Request(M2ePro.url.get('ebay_account_feedback_template/delete'), {\r\n                        method: 'post',\r\n                        parameters: {\r\n                            id: id\r\n                        },\r\n                        onSuccess: function() {\r\n                            if ($('ebayAccountEditTabsFeedbackGrid').select('tbody tr').length == 1) {\r\n                                $('add_feedback_template_button_container').show();\r\n                                $('feedback_templates_grid').hide();\r\n                            }\r\n\r\n                            window['ebayAccountEditTabsFeedbackGridJsObject'].reload();\r\n                        }\r\n                    });\r\n                },\r\n                cancel: function () {\r\n                    return false;\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    // ---------------------------------------\r\n\r\n    ebayStoreUpdate: function()\r\n    {\r\n        var self = EbayAccountObj ;\r\n        self.submitForm(M2ePro.url.get('formSubmit', {'update_ebay_store': 1, 'back': Base64.encode('edit')}));\r\n    },\r\n\r\n    ebayStoreSelectCategory: function(id)\r\n    {\r\n        $('ebay_store_categories_selected_container').show();\r\n        $('ebay_store_categories_selected').value = id;\r\n    },\r\n\r\n    ebayStoreSelectCategoryHide: function()\r\n    {\r\n        $('ebay_store_categories_selected_container').hide();\r\n        $('ebay_store_categories_selected').value = '';\r\n    },\r\n\r\n    ebayStoreInitExtTree: function(categoriesTreeArray)\r\n    {\r\n        var tree = new Ext.tree.TreePanel('tree-div', {\r\n            animate: true,\r\n            enableDD: false,\r\n            containerScroll: true,\r\n            rootUIProvider: Ext.tree.CheckboxNodeUI,\r\n            rootVisible: false\r\n        });\r\n\r\n        tree.on('check', function(node, checked) {\r\n            varienElementMethods.setHasChanges(node.getUI().checkbox);\r\n            tree.getRootNode().cascade(function(n) {\r\n                var ui = n.getUI();\r\n                if(node !== n && ui.checkbox !== undefined) {\r\n                    ui.checkbox.checked = false;\r\n                }\r\n            });\r\n            EbayAccountObj.ebayStoreSelectCategory(node.attributes.id);\r\n        }, tree);\r\n\r\n        var root = new Ext.tree.TreeNode({\r\n            text: 'root',\r\n            draggable: false,\r\n            checked: 'false',\r\n            id: '__root__',\r\n            uiProvider: Ext.tree.CheckboxNodeUI\r\n        });\r\n\r\n        tree.setRootNode(root);\r\n\r\n        var buildCategoryTree = function (parent, config) {\r\n            if (!config) return null;\r\n\r\n            if (parent && config && config.length){\r\n\r\n                for (var i = 0; i < config.length; i++) {\r\n                    config[i].uiProvider = Ext.tree.CheckboxNodeUI;\r\n                    var node = new Ext.tree.TreeNode(config[i]);\r\n                    parent.appendChild(node);\r\n                    if(config[i].children) {\r\n                        buildCategoryTree(node, config[i].children);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        buildCategoryTree(root, categoriesTreeArray);\r\n\r\n        tree.addListener('click', function(node){\r\n            node.getUI().check(!node.getUI().checked());\r\n        });\r\n\r\n        tree.render();\r\n        root.expand();\r\n    },\r\n\r\n    // ---------------------------------------\r\n\r\n    magentoOrdersListingsModeChange: function()\r\n    {\r\n        var self = EbayAccountObj ;\r\n\r\n        if ($('magento_orders_listings_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_LISTINGS_MODE_YES')) {\r\n            $('magento_orders_listings_store_mode_container').show();\r\n        } else {\r\n            $('magento_orders_listings_store_mode_container').hide();\r\n            $('magento_orders_listings_store_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_LISTINGS_STORE_MODE_DEFAULT');\r\n        }\r\n\r\n        self.magentoOrdersListingsStoreModeChange();\r\n        self.changeVisibilityForOrdersModesRelatedBlocks();\r\n    },\r\n\r\n    magentoOrdersListingsStoreModeChange: function()\r\n    {\r\n        if ($('magento_orders_listings_store_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_LISTINGS_STORE_MODE_CUSTOM')) {\r\n            $('magento_orders_listings_store_id_container').show();\r\n        } else {\r\n            $('magento_orders_listings_store_id_container').hide();\r\n            $('magento_orders_listings_store_id').value = '';\r\n        }\r\n    },\r\n\r\n    magentoOrdersListingsOtherModeChange: function()\r\n    {\r\n        var self = EbayAccountObj ;\r\n\r\n        if ($('magento_orders_listings_other_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_MODE_YES')) {\r\n            $('magento_orders_listings_other_product_mode_container').show();\r\n            $('magento_orders_listings_other_store_id_container').show();\r\n        } else {\r\n            $('magento_orders_listings_other_product_mode_container').hide();\r\n            $('magento_orders_listings_other_store_id_container').hide();\r\n            $('magento_orders_listings_other_product_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_PRODUCT_MODE_IGNORE');\r\n            $('magento_orders_listings_other_store_id').value = '';\r\n        }\r\n\r\n        self.magentoOrdersListingsOtherProductModeChange();\r\n        self.changeVisibilityForOrdersModesRelatedBlocks();\r\n    },\r\n\r\n    magentoOrdersListingsOtherProductModeChange: function()\r\n    {\r\n        if ($('magento_orders_listings_other_product_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_PRODUCT_MODE_IGNORE')) {\r\n            $('magento_orders_listings_other_product_mode_note').hide();\r\n            $('magento_orders_listings_other_product_tax_class_id_container').hide();\r\n        } else {\r\n            $('magento_orders_listings_other_product_mode_note').show();\r\n            $('magento_orders_listings_other_product_tax_class_id_container').show();\r\n        }\r\n    },\r\n\r\n    magentoOrdersNumberSourceChange: function()\r\n    {\r\n        var self = EbayAccountObj ;\r\n        self.renderOrderNumberExample();\r\n    },\r\n\r\n    magentoOrdersNumberPrefixModeChange: function()\r\n    {\r\n        var self = EbayAccountObj ;\r\n\r\n        if ($('magento_orders_number_prefix_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_NUMBER_PREFIX_MODE_YES')) {\r\n            $('magento_orders_number_prefix_container').show();\r\n        } else {\r\n            $('magento_orders_number_prefix_container').hide();\r\n            $('magento_orders_number_prefix_prefix').value = '';\r\n        }\r\n\r\n        self.renderOrderNumberExample();\r\n    },\r\n\r\n    magentoOrdersNumberPrefixPrefixChange: function()\r\n    {\r\n        var self = EbayAccountObj ;\r\n        self.renderOrderNumberExample();\r\n    },\r\n\r\n    renderOrderNumberExample: function()\r\n    {\r\n        var orderNumber = $('sample_magento_order_id').value;\r\n        if ($('magento_orders_number_source').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_NUMBER_SOURCE_CHANNEL')) {\r\n            orderNumber = $('sample_ebay_order_id').value;\r\n        }\r\n\r\n        if ($('magento_orders_number_prefix_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_NUMBER_PREFIX_MODE_YES')) {\r\n            orderNumber = $('magento_orders_number_prefix_prefix').value + orderNumber;\r\n        }\r\n\r\n        $('order_number_example_container').update(orderNumber);\r\n    },\r\n\r\n    magentoOrdersCustomerModeChange: function()\r\n    {\r\n        var customerMode = $('magento_orders_customer_mode').value;\r\n\r\n        if (customerMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_CUSTOMER_MODE_PREDEFINED')) {\r\n            $('magento_orders_customer_id_container').show();\r\n            $('magento_orders_customer_id').addClassName('M2ePro-account-product-id');\r\n        } else {  // M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::ORDERS_CUSTOMER_MODE_GUEST') || M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::ORDERS_CUSTOMER_MODE_NEW')\r\n            $('magento_orders_customer_id_container').hide();\r\n            $('magento_orders_customer_id').value = '';\r\n            $('magento_orders_customer_id').removeClassName('M2ePro-account-product-id');\r\n        }\r\n\r\n        var action = (customerMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_CUSTOMER_MODE_NEW')) ? 'show' : 'hide';\r\n        $('magento_orders_customer_new_website_id_container')[action]();\r\n        $('magento_orders_customer_new_group_id_container')[action]();\r\n        $('magento_orders_customer_new_notifications_container')[action]();\r\n\r\n        if(action == 'hide') {\r\n            $('magento_orders_customer_new_website_id').value = '';\r\n            $('magento_orders_customer_new_group_id').value = '';\r\n            $('magento_orders_customer_new_notifications').value = '';\r\n        }\r\n    },\r\n\r\n    magentoOrdersInStorePickupStatusesModeChange: function()\r\n    {\r\n        if ($('magento_orders_in_store_pickup_statuses_mode').value == 1) {\r\n            $('magento_orders_in_store_pickup_statuses_ready_for_pickup_tr').show();\r\n            $('magento_orders_in_store_pickup_statuses_picked_up_tr').show();\r\n        } else {\r\n            $('magento_orders_in_store_pickup_statuses_ready_for_pickup_tr').hide();\r\n            $('magento_orders_in_store_pickup_statuses_picked_up_tr').hide();\r\n        }\r\n    },\r\n\r\n    magentoOrdersStatusMappingModeChange: function()\r\n    {\r\n        // Reset dropdown selected values to default\r\n        $('magento_orders_status_mapping_new').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_NEW');\r\n        $('magento_orders_status_mapping_paid').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_PAID');\r\n        $('magento_orders_status_mapping_shipped').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_SHIPPED');\r\n        // Default auto create invoice & shipping\r\n        $('magento_orders_invoice_mode').checked = true;\r\n        $('magento_orders_shipment_mode').checked = true;\r\n        var disabled = $('magento_orders_status_mapping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_MODE_DEFAULT');\r\n        $('magento_orders_status_mapping_new').disabled = disabled;\r\n        $('magento_orders_status_mapping_paid').disabled = disabled;\r\n        $('magento_orders_status_mapping_shipped').disabled = disabled;\r\n        $('magento_orders_invoice_mode').disabled = disabled;\r\n        $('magento_orders_shipment_mode').disabled = disabled;\r\n    },\r\n\r\n    magentoOrdersCreationModeChange: function()\r\n    {\r\n        var creationMode = $('magento_orders_creation_mode').value;\r\n\r\n        if (creationMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_CREATE_IMMEDIATELY')) {\r\n            $('magento_orders_creation_mode_immediately_warning').show();\r\n            $('magento_orders_creation_reservation_days_container').show();\r\n            $('magento_orders_qty_reservation_days').value = 1;\r\n            $('magento_orders_qty_reservation_days_container').hide();\r\n        } else {\r\n            $('magento_orders_creation_mode_immediately_warning').hide();\r\n            $('magento_orders_creation_reservation_days').value = 0;\r\n            $('magento_orders_creation_reservation_days_container').hide();\r\n            $('magento_orders_qty_reservation_days_container').show();\r\n        }\r\n    },\r\n\r\n    changeVisibilityForOrdersModesRelatedBlocks: function()\r\n    {\r\n        var self = EbayAccountObj ;\r\n\r\n        if ($('magento_orders_listings_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_LISTINGS_MODE_NO') &&\r\n            $('magento_orders_listings_other_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_MODE_NO')) {\r\n\r\n            $('magento_block_ebay_accounts_magento_orders_number-wrapper').hide();\r\n            $('magento_orders_number_source').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_NUMBER_SOURCE_MAGENTO');\r\n            $('magento_orders_number_prefix_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_NUMBER_PREFIX_MODE_NO');\r\n            self.magentoOrdersNumberPrefixModeChange();\r\n\r\n            $('magento_block_ebay_accounts_magento_orders_customer-wrapper').hide();\r\n            $('magento_orders_customer_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_CUSTOMER_MODE_GUEST');\r\n            self.magentoOrdersCustomerModeChange();\r\n\r\n            $('magento_block_ebay_accounts_magento_orders_status_mapping-wrapper').hide();\r\n            $('magento_orders_status_mapping_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_MODE_DEFAULT');\r\n            self.magentoOrdersStatusMappingModeChange();\r\n\r\n            $('magento_block_ebay_accounts_magento_orders_rules-wrapper').hide();\r\n            $('magento_orders_creation_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_CREATE_CHECKOUT_AND_PAID');\r\n            $('magento_orders_creation_reservation_days').value = 0;\r\n            $('magento_orders_qty_reservation_days').value = 1;\r\n\r\n            $('magento_block_ebay_accounts_magento_orders_tax-wrapper').hide();\r\n            $('magento_orders_tax_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::MAGENTO_ORDERS_TAX_MODE_MIXED');\r\n        } else {\r\n            $('magento_block_ebay_accounts_magento_orders_number-wrapper').show();\r\n            $('magento_block_ebay_accounts_magento_orders_customer-wrapper').show();\r\n            $('magento_block_ebay_accounts_magento_orders_status_mapping-wrapper').show();\r\n            $('magento_block_ebay_accounts_magento_orders_rules-wrapper').show();\r\n            $('magento_block_ebay_accounts_magento_orders_tax-wrapper').show();\r\n        }\r\n    },\r\n\r\n    // ---------------------------------------\r\n\r\n    other_listings_synchronization_change: function()\r\n    {\r\n        var relatedStoreViews = $('magento_block_ebay_accounts_other_listings_related_store_views-wrapper');\r\n\r\n        if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_SYNCHRONIZATION_YES')) {\r\n            $('other_listings_mapping_mode_tr').show();\r\n            $('other_listings_mapping_mode').simulate('change');\r\n            if (relatedStoreViews) {\r\n                relatedStoreViews.show();\r\n            }\r\n        } else {\r\n            $('other_listings_mapping_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_MAPPING_MODE_NO');\r\n            $('other_listings_mapping_mode').simulate('change');\r\n            $('other_listings_mapping_mode_tr').hide();\r\n            if (relatedStoreViews) {\r\n                relatedStoreViews.hide();\r\n            }\r\n        }\r\n    },\r\n\r\n    other_listings_mapping_mode_change: function()\r\n    {\r\n        if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_MAPPING_MODE_YES')) {\r\n            $('magento_block_ebay_accounts_other_listings_product_mapping-wrapper').show();\r\n        } else {\r\n            $('magento_block_ebay_accounts_other_listings_product_mapping-wrapper').hide();\r\n\r\n            $('mapping_sku_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_MAPPING_SKU_MODE_NONE');\r\n            $('mapping_title_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_MAPPING_TITLE_MODE_NONE');\r\n        }\r\n\r\n        $('mapping_sku_mode').simulate('change');\r\n        $('mapping_title_mode').simulate('change');\r\n    },\r\n\r\n    synchronization_mapped_change: function()\r\n    {\r\n       if (this.value == 0) {\r\n           $('settings_button').hide();\r\n       } else {\r\n           $('settings_button').show();\r\n       }\r\n    },\r\n\r\n    mapping_sku_mode_change: function()\r\n    {\r\n        var self        = EbayAccountObj ,\r\n            attributeEl = $('mapping_sku_attribute');\r\n\r\n        $('mapping_sku_priority').hide();\r\n        if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_MAPPING_SKU_MODE_NONE')) {\r\n            $('mapping_sku_priority').show();\r\n        }\r\n\r\n        attributeEl.value = '';\r\n        if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_MAPPING_SKU_MODE_CUSTOM_ATTRIBUTE')) {\r\n            self.updateHiddenValue(this, attributeEl);\r\n        }\r\n    },\r\n\r\n    mapping_title_mode_change: function()\r\n    {\r\n        var self        = EbayAccountObj ,\r\n            attributeEl = $('mapping_title_attribute');\r\n\r\n        $('mapping_title_priority').hide();\r\n        if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_MAPPING_TITLE_MODE_NONE')) {\r\n            $('mapping_title_priority').show();\r\n        }\r\n\r\n        attributeEl.value = '';\r\n        if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Account::OTHER_LISTINGS_MAPPING_TITLE_MODE_CUSTOM_ATTRIBUTE')) {\r\n            self.updateHiddenValue(this, attributeEl);\r\n        }\r\n    }\r\n\r\n    // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/MarketplaceSynchProgress.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/SynchProgress'\r\n], function(MessageObj) {\r\n\r\n    window.EbayMarketplaceSynchProgress = Class.create(SynchProgress, {\r\n\r\n        // ---------------------------------------\r\n\r\n        printFinalMessage: function (resultType) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_marketplace/isExistDeletedCategories'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == 1) {\r\n                        MessageObj.addWarningMessage(str_replace(\r\n                            '%url%',\r\n                            M2ePro.url.get('ebay_category/index', {filter: base64_encode('state=0')}),\r\n                            M2ePro.translator.translate('Some eBay Categories were deleted from eBay. Click <a target=\"_blank\" href=\"%url%\">here</a> to check.')\r\n                        ));\r\n                    }\r\n\r\n                    if (resultType == self.resultTypeError) {\r\n                        MessageObj.addErrorMessage(str_replace(\r\n                            '%url%',\r\n                            M2ePro.url.get('logViewUrl'),\r\n                            M2ePro.translator.translate('Synchronization ended with errors. <a target=\"_blank\" href=\"%url%\">View Log</a> for details.')\r\n                        ));\r\n                    } else if (resultType == self.resultTypeWarning) {\r\n                        MessageObj.addWarningMessage(str_replace(\r\n                            '%url%',\r\n                            M2ePro.url.get('logViewUrl'),\r\n                            M2ePro.translator.translate('Synchronization ended with warnings. <a target=\"_blank\" href=\"%url%\">View Log</a> for details.')\r\n                        ));\r\n                    } else {\r\n                        MessageObj.addSuccessMessage(M2ePro.translator.translate('Synchronization has successfully ended.'));\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Account/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Grid'\r\n], function (modal, MessageObj) {\r\n\r\n    window.EbayAccountGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridId) {\r\n            this.messageObj = Object.create(MessageObj);\r\n            this.messageObj.setContainer('#account_feedback_action_messages_container');\r\n\r\n            $super(gridId);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function()\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-validate-feedback-response-max-length', function(value, el) {\r\n\r\n                if (jQuery.validator.methods['M2ePro-required-when-visible'](null, el)) {\r\n                    return true;\r\n                }\r\n\r\n                return value.length >= 2 && value.length <= 80;\r\n\r\n            }, M2ePro.translator.translate('Should be between 2 and 80 characters long.'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openAccountFeedbackPopup: function(id)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_account_feedback/getPopup'), {\r\n                method: 'GET',\r\n                parameters: {\r\n                    id: id\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    var container = $('edit_feedback_popup_container');\r\n\r\n                    if (container) {\r\n                        container.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({\r\n                        bottom: '<div id=\"edit_feedback_popup_container\">' + response.html + '</div>'\r\n                    });\r\n\r\n                    self.feedbackPopup = jQuery('#edit_feedback_popup_container');\r\n\r\n                    modal({\r\n                        title: response.title,\r\n                        type: 'slide',\r\n                        buttons: []\r\n                    }, self.feedbackPopup);\r\n\r\n                    self.feedbackPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openSendResponsePopup: function(el, feedbackId, transactionId, itemId)\r\n        {\r\n            var self = this;\r\n\r\n            self.messageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_account_feedback/getSendResponseForm'), {\r\n                method: 'GET',\r\n                parameters: {\r\n                    feedback_Id: feedbackId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    var container = $('send_response_popup_container');\r\n\r\n                    if (container) {\r\n                        container.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({\r\n                        bottom: '<div id=\"send_response_popup_container\"></div>'\r\n                    });\r\n\r\n                    $('send_response_popup_container').update(response.html);\r\n\r\n                    self.initFormValidation('#send_response_form');\r\n\r\n                    self.sendResponsePopup = jQuery('#send_response_popup_container');\r\n\r\n                    modal({\r\n                        title: response.title,\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.sendResponsePopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Send'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!jQuery('#send_response_form').valid()) {\r\n                                    return false;\r\n                                }\r\n\r\n                                var data = $('send_response_form').serialize(true);\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_account_feedback/sendResponse'), {\r\n                                    parameters: {\r\n                                        feedback_id: data.feedback_id,\r\n                                        feedback_text: (data.feedback_template_type == 'custom') ?\r\n                                            data.feedback_text :\r\n                                            data.feedback_template\r\n                                    },\r\n                                    onSuccess: function(transport) {\r\n                                        var response = transport.responseText.evalJSON();\r\n\r\n                                        self.messageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.text);\r\n\r\n                                        self.sendResponsePopup.modal('closeModal');\r\n                                        window['ebayFeedbackGridJsObject'].reload();\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.sendResponsePopup);\r\n\r\n                    self.sendResponsePopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Account/PickupStore.js":"define([\r\n    'jquery',\r\n    'mage/apply/main',\r\n    'M2ePro/Common'\r\n], function (jQuery, mage) {\r\n\r\n    window.EbayPickupStore = Class.create(Common, {\r\n\r\n        autogenerate: false,\r\n        geocodeObject: {},\r\n\r\n        defaultBusinessHours: {},\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-pickup-store-location-id',\r\n                M2ePro.translator.translate('The specified Title is already used for another In-Store Pickup. In-Store Pickup Title must be unique.'),\r\n                'Ebay\\\\Account\\\\PickupStore', 'location_id', 'id',\r\n                M2ePro.formData.id\r\n            );\r\n\r\n            jQuery.validator.addMethod('M2ePro-pickup-store-location-id-length', function(value) {\r\n                return value.length <= 32;\r\n            }, M2ePro.translator.translate('Max length 32 character.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-must-arrive-date', function(value, el) {\r\n                if (el.up('#special_hours_grid') && !el.up('#special_hours_grid').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                return value.match('^[0-9]{4}-[0-9]{2}-[0-9]{1,2}$');\r\n            }, M2ePro.translator.translate('Please enter a valid date.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-pickup-store-dropdown', function(value) {\r\n                return value != '';\r\n            }, M2ePro.translator.translate('Select value.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-schedule-week-days', function(value, el) {\r\n\r\n                var countOfCheckedDays = 0;\r\n\r\n                $$('.week_day_mode').each(function(el) {\r\n                    el.checked && countOfCheckedDays++;\r\n                });\r\n\r\n                return countOfCheckedDays > 0;\r\n            }, M2ePro.translator.translate('You need to choose at set at least one time.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-selected-schedule-time', function(value, el) {\r\n\r\n                var countUnselectedControls = 0;\r\n\r\n                if (el.up('#special_hours_grid')) {\r\n                    if (!el.up('#special_hours_grid').visible()) {\r\n                        return true;\r\n                    }\r\n                } else {\r\n                    if (!el.up('tr').select('.week_day_mode').shift().checked) {\r\n                        return true;\r\n                    }\r\n                }\r\n\r\n                el.up('td').select('select').each(function(el) {\r\n                    el.value == '' && countUnselectedControls++;\r\n                });\r\n\r\n                return countUnselectedControls == 0;\r\n            }, M2ePro.translator.translate('You should specify time.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-schedule-wrong-interval-time', function(value, el) {\r\n\r\n                if (el.up('#special_hours_grid')) {\r\n                    if (!el.up('#special_hours_grid').visible()) {\r\n                        return true;\r\n                    }\r\n                } else {\r\n                    if (!el.up('tr').select('.week_day_mode').shift().checked) {\r\n                        return true;\r\n                    }\r\n                }\r\n\r\n                var now      = new Date(),\r\n                    fromTime = new Date(now.toDateString() + ' ' + $(el.id.replace('validator_to','from')).value),\r\n                    toTime   = new Date(now.toDateString() + ' ' + $(el.id.replace('validator_to','to')).value);\r\n\r\n                return (toTime - fromTime) > 0;\r\n            }, M2ePro.translator.translate('Must be greater than \"Open Time\".'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-max-length-128', function(value) {\r\n                return value.length <= 128;\r\n            }, M2ePro.translator.translate('Max length 128 character.'));\r\n\r\n            this.validateLocation();\r\n        },\r\n\r\n        init: function()\r\n        {\r\n            this.observeFields();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        observeFields: function()\r\n        {\r\n            var self = this;\r\n\r\n            if ($('google_map').href.indexOf('#empty') != -1) {\r\n                $('google_map').hide();\r\n            }\r\n\r\n            if ($('auto_generate_field').visible()) {\r\n                var autoGenerate = $('auto_generate');\r\n                autoGenerate.observe('click', function() {\r\n                    self.generateLocationId();\r\n                });\r\n                autoGenerate.observe('change', self.switchAutoGeneration)\r\n                    .simulate('change');\r\n            }\r\n\r\n            $('country').observe('change', self.countryChange)\r\n                .simulate('change');\r\n\r\n            $$('.get_geocord').shift().observe('click', self.calculateLatitudeLongitude);\r\n\r\n            $('utc_offset').observe('change', function(event) {\r\n                if (event.target.value != '' && this.down('option').value == '') {\r\n                    this.down('option').remove();\r\n                }\r\n            });\r\n\r\n            $$('.week_day_mode').each(function(el){\r\n                el.observe('change', self.scheduleDayModeChange)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $$('.week_time_select').each(function(el){\r\n                el.observe('change', self.scheduleTimeSelectChange)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $$('.date_time_select').each(function(el){\r\n                el.observe('change', self.scheduleTimeSelectChange)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $$('.add_date').shift().observe('click', self.addDateColumn);\r\n            $$('.remove_date').each(function(el) {\r\n                el.observe('click', self.removeDateColumn);\r\n            });\r\n\r\n            self.hideSpecialHoursGrid();\r\n\r\n            $('default_mode')\r\n                .observe('change', self.changeDefaultMode)\r\n                .simulate('change');\r\n\r\n            $('qty_mode')\r\n                .observe('change', self.qtyModeChange)\r\n                .simulate('change');\r\n\r\n            $('qty_modification_mode')\r\n                .observe('change', self.qtyPostedModeChange)\r\n                .simulate('change');\r\n\r\n            setTimeout(function() {\r\n                self.initGeocodeAPI();\r\n            }, 0);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        switchAutoGeneration: function(event)\r\n        {\r\n            var self = EbayPickupStoreObj,\r\n                nameField = $('name');\r\n\r\n            self.autogenerate = !self.autogenerate;\r\n\r\n            if (!self.autogenerate) {\r\n                nameField.stopObserving('keyup', self.generateLocationId);\r\n            } else {\r\n                nameField.observe('keyup', self.generateLocationId);\r\n            }\r\n        },\r\n\r\n        generateLocationId: function()\r\n        {\r\n            var nameField = $('name'),\r\n                locationIdFiled = $('location_id');\r\n\r\n            if (nameField.value) {\r\n                locationIdFiled.value = nameField.value.toLowerCase()\r\n                    .replace(/[^a-z0-9 _]+/g, '')\r\n                    .replace(/\\s/g, '_').slice(0, 32);\r\n            } else {\r\n                locationIdFiled.value = '';\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        countryChange: function(event) {\r\n            var self = EbayPickupStoreObj,\r\n                countryCode = '';\r\n\r\n            if (event.target.value != '' && this.down('option').value == '') {\r\n                this.down('option').remove();\r\n            }\r\n\r\n            if (event.target.selectedOptions.length) {\r\n                countryCode = event.target.value;\r\n            }\r\n\r\n            self.updateHiddenValue(this, $('marketplace_id'));\r\n\r\n            new Ajax.Request(M2ePro.url.get('getRegions'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    country_code : countryCode\r\n                },\r\n                onSuccess: function(transport) {\r\n                    var regions = transport.responseText.evalJSON(),\r\n                        insertData,\r\n                        defaultValue = $('region_hidden').value;\r\n\r\n                    $('region') && $('region').remove();\r\n\r\n                    if (!regions.length) {\r\n                        insertData = {\r\n                            top: new Element('input', {\r\n                                type: 'text',\r\n                                id: 'region',\r\n                                name: 'region',\r\n                                class: 'input-text M2ePro-required-when-visible',\r\n                                value: defaultValue\r\n                            })\r\n                        };\r\n                    } else {\r\n                        insertData = {\r\n                            top: self.renderRegions(regions, defaultValue)\r\n                        };\r\n                    }\r\n\r\n                    $('region_container').up().insert(insertData)\r\n                }\r\n            });\r\n        },\r\n\r\n        renderRegions: function(regionsData, defaultValue)\r\n        {\r\n            var select = new Element('select', {\r\n                id: 'region',\r\n                name: 'region',\r\n                class: 'M2ePro-pickup-store-dropdown'\r\n            });\r\n\r\n            select.observe('change', function(event) {\r\n                if (event.target.value != '' && this.down('option').value == '') {\r\n                    this.down('option').remove();\r\n                }\r\n            });\r\n\r\n            var emptyOption = new Element('option', {value: ''});\r\n            select.appendChild(emptyOption);\r\n\r\n            regionsData.each(function(region) {\r\n                var option = new Element('option', {\r\n                    value: region.name\r\n                });\r\n\r\n                if (defaultValue == region.name) {\r\n                    option.selected = true;\r\n                }\r\n\r\n                option.innerHTML = region.name;\r\n                select.appendChild(option);\r\n            });\r\n\r\n            return select;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initGeocodeAPI: function()\r\n        {\r\n            var src = '//maps.googleapis.com/maps/api/js?' +\r\n                      'key=AIzaSyC2t7txYJJe10PryITwaIL8FmjdjxR9xeQ&signed_in=true&' +\r\n                      'callback=EbayPickupStoreObj.getGeocodeObject';\r\n\r\n            require([src]);\r\n        },\r\n\r\n        getGeocodeObject: function()\r\n        {\r\n            EbayPickupStoreObj.geocodeObject = new google.maps.Geocoder();\r\n        },\r\n\r\n        calculateLatitudeLongitude: function(event)\r\n        {\r\n            event.preventDefault();\r\n\r\n            var self = EbayPickupStoreObj,\r\n                address = '';\r\n\r\n            if ($('country').selectedOptions.length) {\r\n                address += $('country').selectedOptions[0].innerHTML;\r\n            }\r\n\r\n            var region = $('region').value;\r\n            region && (address += ', ' + region);\r\n\r\n            var city = $('city').value;\r\n            city && (address += ', ' + city);\r\n\r\n            var address1 = $('address_1').value;\r\n            address1 && (address += ', ' + address1);\r\n\r\n            self.geocodeObject.geocode({'address': address}, function(results, status) {\r\n                if (status === google.maps.GeocoderStatus.OK) {\r\n                    if (results.length) {\r\n                        var geometry = results[0].geometry;\r\n                        window.test_geo = geometry;\r\n\r\n                        var lat = +geometry.location.lat().toFixed(3),\r\n                            lng = +geometry.location.lng().toFixed(3);\r\n\r\n                        $('latitude').value = lat;\r\n                        $('longitude').value = lng;\r\n\r\n                        $('google_map').href = 'https://www.google.com/maps/place/'+lat+','+lng;\r\n                        $('google_map').show();\r\n                    }\r\n                } else {\r\n                    self.alert('Location not found.');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        scheduleDayModeChange: function(event)\r\n        {\r\n            var self = EbayPickupStoreObj,\r\n                topElement = event.target.up('tr'),\r\n                containerFrom = topElement.down('#' + this.id.replace('mode','') + 'container_from'),\r\n                containerTo   = topElement.down('#' + this.id.replace('mode','') + 'container_to');\r\n\r\n            containerFrom.hide();\r\n            containerTo.hide();\r\n\r\n            if (this.checked) {\r\n                if (self.defaultBusinessHours.from && self.defaultBusinessHours.to) {\r\n                    var timeFrom = self.defaultBusinessHours.from || [],\r\n                        timeTo = self.defaultBusinessHours.to || [];\r\n\r\n                    topElement.down('#' + this.id.replace('mode','') + 'from_hours').value = timeFrom[0] || '';\r\n                    topElement.down('#' + this.id.replace('mode','') + 'from_minutes').value = timeFrom[1] || '';\r\n                    topElement.down('#' + this.id.replace('mode','') + 'from')\r\n                        .value = (timeFrom[0] || '00')+':'+(timeFrom[1] || '00')+':00';\r\n\r\n                    topElement.down('#' + this.id.replace('mode','') + 'to_hours').value = timeTo[0] || '';\r\n                    topElement.down('#' + this.id.replace('mode','') + 'to_minutes').value = timeTo[1] || '';\r\n                    topElement.down('#' + this.id.replace('mode','') + 'to')\r\n                        .value = (timeTo[0] || '00')+':'+(timeTo[1] || '00')+':00';\r\n                }\r\n\r\n                containerFrom.show();\r\n                containerTo.show();\r\n            }\r\n        },\r\n\r\n        scheduleTimeSelectChange: function(event)\r\n        {\r\n            var topElement = event.target.up('td'),\r\n                inputId = this.id.match('(.)*(?=_)')[0];\r\n\r\n            var hours   = topElement.down('#' + inputId + '_hours').value,\r\n                minutes = topElement.down('#' + inputId + '_minutes').value;\r\n\r\n            if (hours == '' || minutes == '') {\r\n                return;\r\n            }\r\n\r\n            if ((event.target.id.indexOf('week_day') != -1) && (event.target.id.indexOf('from') != -1)) {\r\n                EbayPickupStoreObj.defaultBusinessHours.from = [hours, minutes];\r\n            } else if((event.target.id.indexOf('week_day') != -1) && (event.target.id.indexOf('to') != -1)) {\r\n                EbayPickupStoreObj.defaultBusinessHours.to = [hours, minutes];\r\n            }\r\n\r\n            topElement.up('tr').down('#'+inputId).value =  hours + ':' + minutes + ':00';\r\n        },\r\n\r\n        addDateColumn: function(event)\r\n        {\r\n            event.preventDefault();\r\n\r\n            var self = EbayPickupStoreObj,\r\n                template = $('special_hours_template'),\r\n                specialHoursFieldsCount = ++($$('.date-field').length);\r\n\r\n            if (!$('special_hours_grid').visible()) {\r\n                self.showSpecialHoursGrid();\r\n            }\r\n\r\n            var newColumn = jQuery('<div>').html(template.innerHTML)[0];\r\n            newColumn = newColumn.down('tr');\r\n\r\n            newColumn.down('input[name^=\"date_validator_to_\"]').name = 'date_validator_to_'\r\n                                                                        +specialHoursFieldsCount;\r\n            newColumn.down('input[name^=\"date_validator_from_\"]').name = 'date_validator_from_'\r\n                                                                         +specialHoursFieldsCount;\r\n\r\n            $('special_hours_grid_rows').down('tbody').appendChild(newColumn);\r\n\r\n            newColumn.down('.remove_date').observe('click', self.removeDateColumn);\r\n            newColumn.getElementsBySelector('.date_time_select').each(function(el) {\r\n                el.observe('change', self.scheduleTimeSelectChange)\r\n                .simulate('change');\r\n            });\r\n\r\n            var parent = newColumn.down('#date').up();\r\n            parent.innerHTML = '';\r\n            var newElementKey = 'date-' + specialHoursFieldsCount;\r\n\r\n            parent.insert({\r\n                top: new Element('input', {\r\n                    type: 'text',\r\n                    id: newElementKey,\r\n                    value: '',\r\n                    name: newElementKey,\r\n                    class: 'input-text date-field M2ePro-required-when-visible M2ePro-validate-must-arrive-date',\r\n                    'data-mage-init': '{\"calendar\": ' +\r\n                                        '{\"showTime\": false, \"dateFormat\": \"yy-mm-dd\", \"showButtonPanel\": false}' +\r\n                                      '}',\r\n                    onchange: 'EbayPickupStoreObj.dateOnChange(this)'\r\n                })\r\n            });\r\n\r\n            mage.apply();\r\n        },\r\n\r\n        dateOnChange: function(el) {\r\n            var dateContainer = el,\r\n                dateStr = dateContainer.value,\r\n                dateFrom = dateContainer.up('tr').down('#date_from'),\r\n                dateTo = dateContainer.up('tr').down('#date_to');\r\n\r\n            dateFrom.name = 'special_hours[date_settings][' + dateStr + '][open]';\r\n            dateTo.name = 'special_hours[date_settings][' + dateStr + '][close]';\r\n        },\r\n\r\n        removeDateColumn: function(event)\r\n        {\r\n            var self = EbayPickupStoreObj;\r\n\r\n            event.preventDefault();\r\n            event.target.up('tr').remove();\r\n            self.hideSpecialHoursGrid();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        changeDefaultMode: function()\r\n        {\r\n            var self = EbayPickupStoreObj;\r\n\r\n            if (+this.value) {\r\n                $('magento_block_ebay_account_pickup_store_form_data_quantity_custom_settings').show();\r\n\r\n                var mode = M2ePro.formData.qty_mode;\r\n                if (mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_SELLING_FORMAT_TEMPLATE')) {\r\n                    M2ePro.formData.qty_mode = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_PRODUCT');\r\n                }\r\n            } else {\r\n                $('magento_block_ebay_account_pickup_store_form_data_quantity_custom_settings').hide();\r\n            }\r\n        },\r\n\r\n        qtyModeChange: function()\r\n        {\r\n            var self               = EbayPickupStoreObj,\r\n\r\n                customValueTr      = $('qty_mode_cv_tr'),\r\n                attributeElement   = $('qty_custom_attribute'),\r\n\r\n                maxPostedValueTr   = $('qty_modification_mode_tr'),\r\n                maxPostedValueMode = $('qty_modification_mode');\r\n\r\n            customValueTr.hide();\r\n            attributeElement.value = '';\r\n\r\n            if (isNaN(+this.value) || $('default_mode').value == '0') {\r\n                return;\r\n            }\r\n\r\n             if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_NUMBER')) {\r\n                customValueTr.show();\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, attributeElement);\r\n            }\r\n\r\n            maxPostedValueTr.hide();\r\n            maxPostedValueMode.value = 0;\r\n\r\n            if (self.isMaxPostedQtyAvailable(this.value)) {\r\n\r\n                maxPostedValueTr.show();\r\n                maxPostedValueMode.value = 1;\r\n\r\n                if (self.isMaxPostedQtyAvailable(M2ePro.formData.qty_mode)) {\r\n                    maxPostedValueMode.value = M2ePro.formData.qty_modification_mode;\r\n                }\r\n            }\r\n\r\n            maxPostedValueMode.simulate('change');\r\n\r\n            self.updateQtyPercentage();\r\n        },\r\n\r\n        isMaxPostedQtyAvailable: function(qtyMode)\r\n        {\r\n            return qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_PRODUCT') ||\r\n                   qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_ATTRIBUTE') ||\r\n                   qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_PRODUCT_FIXED');\r\n        },\r\n\r\n        qtyPostedModeChange: function()\r\n        {\r\n            var minPosterValueTr = $('qty_min_posted_value_tr'),\r\n                maxPosterValueTr = $('qty_max_posted_value_tr');\r\n\r\n            minPosterValueTr.hide();\r\n            maxPosterValueTr.hide();\r\n\r\n            if (this.value == 1) {\r\n                minPosterValueTr.show();\r\n                maxPosterValueTr.show();\r\n            }\r\n        },\r\n\r\n        updateQtyPercentage: function()\r\n        {\r\n            var qtyPercentageTr = $('qty_percentage_tr');\r\n\r\n            qtyPercentageTr.hide();\r\n\r\n            var qtyMode = $('qty_mode').value;\r\n\r\n            if (qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_SINGLE') ||\r\n                qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_NUMBER')) {\r\n                return;\r\n            }\r\n\r\n            qtyPercentageTr.show();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        hideSpecialHoursGrid: function()\r\n        {\r\n            if ($$('.date-field').length > 0) {\r\n                return;\r\n            }\r\n\r\n            $('special_hours_grid').hide();\r\n\r\n            var addDateBtn = $$('.add_date').shift();\r\n            addDateBtn.removeClassName('right');\r\n            addDateBtn.style.width = '';\r\n            addDateBtn.up('div')\r\n                      .removeClassName('add_btn_wrapper')\r\n                      .addClassName('add_btn_wrapper_center');\r\n        },\r\n\r\n        showSpecialHoursGrid: function()\r\n        {\r\n            $('special_hours_grid').show();\r\n\r\n            var addDateBtn = $$('.add_date').shift();\r\n            addDateBtn.addClassName('right');\r\n            addDateBtn.style.width = '12.5%';\r\n            addDateBtn.up('div')\r\n                      .removeClassName('add_btn_wrapper_center')\r\n                      .addClassName('add_btn_wrapper');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function($headId, chapter_when_duplicate_text)\r\n        {\r\n            $$('.loading-mask').invoke('show');\r\n\r\n            this.setValidationCheckRepetitionValue('M2ePro-pickup-store-location-id',\r\n                M2ePro.translator.translate('The specified Title is already used for another In-Store Pickup. In-Store Pickup Title must be unique.'),\r\n                'Ebay\\\\Account\\\\PickupStore', 'location_id', 'id',0\r\n            );\r\n\r\n            M2ePro.formData.id = 0;\r\n\r\n            $('name').value = $('location_id').value = $('pickup_store_id').value =  '';\r\n            $('location_id').disabled = false;\r\n\r\n            if (!$('auto_generate_field').visible()) {\r\n                $('auto_generate_field').show();\r\n                $('auto_generate').observe('change', EbayPickupStoreObj.switchAutoGeneration)\r\n                    .simulate('change');\r\n            }\r\n\r\n            $$('.page-title').each(function(o) { o.innerHTML = chapter_when_duplicate_text; });\r\n            $$('.M2ePro_duplicate_button').each(function(o) { o.hide(); });\r\n            $$('.M2ePro_delete_button').each(function(o) { o.hide(); });\r\n\r\n            window.setTimeout(function() {\r\n                $$('.loading-mask').invoke('hide')\r\n            }, 1200);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isValidForm: function()\r\n        {\r\n            var result = jQuery('#edit_form').valid();\r\n\r\n            if (result) {\r\n                $('location_id').disabled = false;\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        validateLocation: function()\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-check-location', function(value) {\r\n                var preValidation = true;\r\n                ['country', 'region', 'city', 'address_1',\r\n                'postal_code', 'latitude', 'longitude'].each(function(el) {\r\n                    if (!$(el) || $(el).value == '') {\r\n                        preValidation = false;\r\n                    }\r\n                });\r\n\r\n                if (!preValidation) {\r\n                    return true;\r\n                }\r\n\r\n                var checkResult = false;\r\n                new Ajax.Request(M2ePro.url.get('validateLocation'), {\r\n                    method: 'post',\r\n                    asynchronous: false,\r\n                    parameters: {\r\n                        id: M2ePro.formData.id,\r\n                        country: $('country').value,\r\n                        region: $('region').value,\r\n                        city: $('city').value,\r\n                        address_1: $('address_1').value,\r\n                        address_2: $('address_2').value,\r\n                        postal_code: $('postal_code').value,\r\n                        latitude: $('latitude').value,\r\n                        longitude: $('longitude').value,\r\n                        utc_offset: $('utc_offset').value\r\n                    },\r\n                    onSuccess: function(transport) {\r\n                        checkResult = transport.responseText.evalJSON()['result'];\r\n                    }\r\n                });\r\n\r\n                return checkResult;\r\n            }, M2ePro.translator.translate('Same Location is already exists.'));\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Configuration/General.js":"define(['knockout'], function(ko){\r\n    return {\r\n        mode: ko.observable()\r\n    }\r\n});","Ess_M2ePro/js/Ebay/Configuration/Account/ListingOther.js":"define(['knockout'], function(ko){\r\n    return {\r\n        synchronization: ko.observable(),\r\n        mappingMode: ko.observable(),\r\n        mappingSkuMode: ko.observable(),\r\n        mappingTitleMode: ko.observable(),\r\n    }\r\n});","Ess_M2ePro/js/Ebay/Listing/AutoAction.js":"define([\r\n    'jquery',\r\n    'M2ePro/Listing/AutoAction',\r\n    'prototype'\r\n], function (jQuery) {\r\n\r\n    window.EbayListingAutoAction = Class.create(ListingAutoAction, {\r\n\r\n        // ---------------------------------------\r\n\r\n        controller: 'ebay_listing_autoAction',\r\n\r\n        // ---------------------------------------\r\n\r\n        addingModeChange: function()\r\n        {\r\n            var mode = ListingAutoActionObj.getPopupMode();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Listing::ADDING_MODE_ADD_AND_ASSIGN_CATEGORY')) {\r\n                $(mode+'confirm_button').hide();\r\n                $(mode+'continue_button').show();\r\n                $(mode+'breadcrumb_container').show();\r\n            } else {\r\n                $(mode+'continue_button').hide();\r\n                $(mode+'breadcrumb_container').hide();\r\n                $(mode+'confirm_button').show();\r\n            }\r\n\r\n            if (this.value != M2ePro.php.constant('Ess_M2ePro_Model_Listing::ADDING_MODE_NONE')) {\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].show();\r\n            } else {\r\n                $$('[id$=\"adding_add_not_visible\"]')[0].value = M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_ADDING_ADD_NOT_VISIBLE_YES');\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].hide();\r\n            }\r\n        },\r\n\r\n        categoryAddingMode: function ()\r\n        {\r\n            var popupMode = ListingAutoActionObj.getPopupMode();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Listing::ADDING_MODE_ADD_AND_ASSIGN_CATEGORY')) {\r\n                $(popupMode+'confirm_button').hide();\r\n                $(popupMode+'continue_button').show();\r\n                $(popupMode+'breadcrumb_container').show();\r\n            } else {\r\n                $(popupMode+'continue_button').hide();\r\n                $(popupMode+'breadcrumb_container').hide();\r\n                $(popupMode+'confirm_button').show();\r\n            }\r\n\r\n            if (this.value != M2ePro.php.constant('Ess_M2ePro_Model_Listing::ADDING_MODE_NONE')) {\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].show();\r\n            } else {\r\n                $$('[id$=\"adding_add_not_visible\"]')[0].value = M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_ADDING_ADD_NOT_VISIBLE_YES');\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].hide();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        loadCategoryChooser: function(callback)\r\n        {\r\n            var mode = $('auto_mode').value;\r\n            new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/getCategoryChooserHtml'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    auto_mode: mode,\r\n                    group_id: this.internalData.id,\r\n                    // this parameter only for auto_mode=category\r\n                    magento_category_id: typeof categories_selected_items != 'undefined' ? categories_selected_items[0] : null\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Listing::AUTO_MODE_CATEGORY')) {\r\n                        $('category_child_data_container').update(transport.responseText);\r\n                    } else {\r\n                        $('data_container').update(transport.responseText);\r\n                    }\r\n\r\n                    if (typeof callback == 'function') {\r\n                        callback();\r\n                    }\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        loadSpecific: function(callback)\r\n        {\r\n            var category = EbayListingProductCategorySettingsChooserObj.getSelectedCategory(0);\r\n\r\n            if (!category.mode) {\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/getCategorySpecificHtml'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    auto_mode: this.internalData.auto_mode,\r\n                    category_mode: category.mode,\r\n                    category_value: category.value,\r\n                    group_id: this.internalData.id,\r\n                    // this parameter only for auto_mode=category\r\n                    magento_category_id: typeof categories_selected_items != 'undefined' ? categories_selected_items[0] : null\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var dataContainer;\r\n                    if (this.internalData.auto_mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Listing::AUTO_MODE_CATEGORY')) {\r\n                        dataContainer = $('category_child_data_container');\r\n                    } else {\r\n                        dataContainer = $('data_container');\r\n                    }\r\n\r\n                    jQuery(dataContainer).parent().parent().find('[id^=\"block_notice\"]').eq(0).remove();\r\n\r\n                    dataContainer.innerHTML = transport.responseText;\r\n                    try {\r\n                        dataContainer.innerHTML.evalScripts();\r\n                    } catch (ignored) {}\r\n\r\n                    if (typeof callback == 'function') {\r\n                        callback();\r\n                    }\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        globalStepTwo: function()\r\n        {\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var callback = function() {\r\n                jQuery('#'+ListingAutoActionObj.getPopupMode() + 'modal_auto_action > .block_notices:first')\r\n                    .remove();\r\n\r\n                jQuery('#'+ListingAutoActionObj.getPopupMode() + 'continue_button')\r\n                    .off('click')\r\n                    .on('click', ListingAutoActionObj.globalStepThree);\r\n\r\n                ListingAutoActionObj.highlightBreadcrumbStep(2);\r\n            };\r\n\r\n            ListingAutoActionObj.loadCategoryChooser(callback);\r\n        },\r\n\r\n        globalStepThree: function()\r\n        {\r\n            if (!EbayListingProductCategorySettingsChooserObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var callback = function() {\r\n                ListingAutoActionObj.highlightBreadcrumbStep(3);\r\n\r\n                $(ListingAutoActionObj.getPopupMode() + 'confirm_button').show();\r\n                $(ListingAutoActionObj.getPopupMode() + 'reset_button').show();\r\n                $(ListingAutoActionObj.getPopupMode() + 'continue_button').hide();\r\n            };\r\n\r\n            ListingAutoActionObj.loadSpecific(callback);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        websiteStepTwo: function()\r\n        {\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var callback = function() {\r\n\r\n                jQuery('#'+ListingAutoActionObj.getPopupMode() + 'modal_auto_action > .block_notices:first')\r\n                    .remove();\r\n\r\n                jQuery('#'+ListingAutoActionObj.getPopupMode() + 'continue_button')\r\n                    .off('click')\r\n                    .on('click', ListingAutoActionObj.websiteStepThree);\r\n\r\n                ListingAutoActionObj.highlightBreadcrumbStep(2);\r\n            };\r\n\r\n            ListingAutoActionObj.loadCategoryChooser(callback);\r\n        },\r\n\r\n        websiteStepThree: function()\r\n        {\r\n            if (!EbayListingProductCategorySettingsChooserObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var callback = function() {\r\n                ListingAutoActionObj.highlightBreadcrumbStep(3);\r\n\r\n                $(ListingAutoActionObj.getPopupMode() + 'confirm_button').show();\r\n                $(ListingAutoActionObj.getPopupMode() + 'reset_button').show();\r\n                $(ListingAutoActionObj.getPopupMode() + 'continue_button').hide();\r\n            };\r\n\r\n            ListingAutoActionObj.loadSpecific(callback);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        categoryStepOne: function(groupId)\r\n        {\r\n            var mode = ListingAutoActionObj.getPopupMode();\r\n            this.loadAutoCategoryForm(groupId, function() {\r\n                $(mode+'close_button').hide();\r\n            });\r\n        },\r\n\r\n        categoryStepTwo: function()\r\n        {\r\n            if (!ListingAutoActionObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var mode = ListingAutoActionObj.getPopupMode();\r\n            var callback = function() {\r\n                jQuery('#' + mode + 'continue_button')\r\n                    .off('click')\r\n                    .on('click', ListingAutoActionObj.categoryStepThree);\r\n\r\n                ListingAutoActionObj.highlightBreadcrumbStep(2);\r\n            };\r\n\r\n            ListingAutoActionObj.loadCategoryChooser(callback);\r\n        },\r\n\r\n        categoryStepThree: function()\r\n        {\r\n            if (!EbayListingProductCategorySettingsChooserObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var mode = ListingAutoActionObj.getPopupMode();\r\n            var callback = function() {\r\n                ListingAutoActionObj.highlightBreadcrumbStep(3);\r\n\r\n                $(mode+'confirm_button').show();\r\n                $(mode+'reset_button').show();\r\n                $(mode+'continue_button').hide();\r\n            };\r\n\r\n            ListingAutoActionObj.loadSpecific(callback);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        collectData: function()\r\n        {\r\n            if ($('auto_mode')) {\r\n                switch (parseInt($('auto_mode').value)) {\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_GLOBAL'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            auto_mode: $('auto_mode').value,\r\n                            auto_global_adding_mode: $('auto_global_adding_mode').value,\r\n                            auto_global_adding_add_not_visible: $('auto_global_adding_add_not_visible').value,\r\n                            auto_global_adding_template_category_id: null\r\n                        };\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_WEBSITE'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            auto_mode: $('auto_mode').value,\r\n                            auto_website_adding_mode: $('auto_website_adding_mode').value,\r\n                            auto_website_adding_add_not_visible: $('auto_website_adding_add_not_visible').value,\r\n                            auto_website_adding_template_category_id: null,\r\n                            auto_website_deleting_mode: $('auto_website_deleting_mode').value\r\n                        };\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_CATEGORY'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            id: $('group_id').value,\r\n                            title: $('group_title').value,\r\n                            auto_mode: $('auto_mode').value,\r\n                            adding_mode: $('adding_mode').value,\r\n                            adding_add_not_visible: $('adding_add_not_visible').value,\r\n                            deleting_mode: $('deleting_mode').value,\r\n                            categories: categories_selected_items\r\n                        };\r\n                        break;\r\n                }\r\n            }\r\n\r\n            if ($('ebay_category_chooser')) {\r\n                ListingAutoActionObj.internalData.template_category_data = EbayListingProductCategorySettingsChooserObj.getInternalData();\r\n            }\r\n\r\n            if ($('category_specific_form')) {\r\n                ListingAutoActionObj.internalData.template_category_specifics_data = EbayListingProductCategorySettingsSpecificObj.getInternalData();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/EditCompatibilityMode.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Confirm',\r\n    'M2ePro/Common'\r\n], function (jQuery, modal, confirm) {\r\n\r\n    window.EditCompatibilityMode = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (gridId) {\r\n            this.gridId = gridId;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopup: function(listingId)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getChangePartsCompatibilityModePopupHtml'), {\r\n                method: 'GET',\r\n                parameters: {\r\n                    listing_id: listingId\r\n                },\r\n                onSuccess: (function(transport) {\r\n\r\n                    if ($('edit_mode_form')) {\r\n                        $('edit_mode_form').remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    var form = jQuery('#edit_mode_form');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Edit Parts Compatibility Mode'),\r\n                        type: 'popup',\r\n                        modalClass: 'width-50',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.closePopup();\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.saveListingMode();\r\n                            }\r\n                        }]\r\n                    }, form);\r\n\r\n                    this.oldMode = trim($('listing_compatibility_mode_' + listingId).innerHTML);\r\n                    this.listingId = listingId;\r\n\r\n                    jQuery('#edit_mode_form').modal('openModal');\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        saveListingMode: function()\r\n        {\r\n            var self = this,\r\n                newMode = $('edit_mode_form').select('#parts_compatibility_mode')[0].value;\r\n\r\n            if (self.oldMode == newMode) {\r\n\r\n                this.closePopup();\r\n                return;\r\n            }\r\n\r\n            if (!jQuery('#edit_mode_form').valid()) {\r\n                return false;\r\n            }\r\n\r\n            confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('ebay_listing/savePartsCompatibilityMode'), {\r\n                            method: 'post',\r\n                            asynchronous: true,\r\n                            parameters: {\r\n                                listing_id: self.listingId,\r\n                                mode:       newMode\r\n                            },\r\n                            onSuccess: function(transport) {\r\n                                self.closePopup();\r\n                            }.bind(this)\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        closePopup: function()\r\n        {\r\n            jQuery('#edit_mode_form').modal('closeModal');\r\n            window[this.gridId + 'JsObject'].reload();\r\n\r\n            return true;\r\n        }\r\n\r\n    })\r\n        // ---------------------------------------\r\n});","Ess_M2ePro/js/Ebay/Listing/Grid.js":"define([\r\n    'M2ePro/Grid',\r\n    'prototype'\r\n], function () {\r\n\r\n    window.EbayListingGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        backParam: base64_encode('*/ebay_listing/index'),\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function()\r\n        {\r\n            return false;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addProductsSourceProductsAction: function(id)\r\n        {\r\n            setLocation(M2ePro.url.get('ebay_listing_product_add/index', {\r\n                id: id,\r\n                source: 'product',\r\n                clear: true,\r\n                back: this.backParam\r\n            }));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addProductsSourceCategoriesAction: function(id)\r\n        {\r\n            setLocation(M2ePro.url.get('ebay_listing_product_add/index', {\r\n                id: id,\r\n                source: 'category',\r\n                clear: true,\r\n                back: this.backParam\r\n            }));\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});\r\n","Ess_M2ePro/js/Ebay/Listing/Preview.js":"define(function () {\r\n\r\n    window.EbayListingPreviewItems = Class.create(Common, {\r\n\r\n        initialize: function () {\r\n            var self = this;\r\n\r\n            jQuery('.price_container button').click(function () {\r\n                self.alert(M2ePro.translator.translate('This is Item Preview Mode'));\r\n            });\r\n\r\n            self.onTabClick(jQuery('.tabs-horiz li:first'));\r\n        },\r\n\r\n        getVariation: function(chosenOptions) {\r\n            var returnVariation = {};\r\n\r\n            M2ePro.formData.variations.variations.forEach(function (variation) {\r\n\r\n                var countOfOptions = 0;\r\n\r\n                for (var variationSpecific in variation.specifics) {\r\n                    chosenOptions.forEach(function (option) {\r\n                        if (variationSpecific === option.attribute) {\r\n                            if (variation.specifics[variationSpecific] === option.value) {\r\n                                countOfOptions++;\r\n                            } else {\r\n                                return false;\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n\r\n                if (countOfOptions === chosenOptions.length) {\r\n                    returnVariation = variation;\r\n                    return false;\r\n                }\r\n\r\n            });\r\n\r\n            return returnVariation;\r\n        },\r\n\r\n        onChangeVariationSelect: function (currentSelect) {\r\n            $$('option').each(function (option) {\r\n                option.show();\r\n            });\r\n\r\n            choseSelects = $$(\"select[value!=]\").length;\r\n\r\n            if (choseSelects < $$('select').length - 1) {\r\n                return;\r\n            }\r\n\r\n            if (choseSelects === $$('select').length - 1) {\r\n                var otherSelectsValues = [];\r\n\r\n                $$('select[value!=]').each(function (select) {\r\n                    otherSelectsValues.push({\r\n                        attribute: select.name,\r\n                        value: select.value\r\n                    });\r\n                });\r\n\r\n                $$(\"select[value=]\")[0].select('option[value!=]').each(function (option) {\r\n                    otherSelectsValues.push({\r\n                        attribute: option.up().name,\r\n                        value: option.value\r\n                    });\r\n\r\n                    variation = EbayListingPreviewItemsObj.getVariation(otherSelectsValues);\r\n\r\n                    if (variation.data === undefined) {\r\n                        option.hide();\r\n                    }\r\n\r\n                    otherSelectsValues.pop();\r\n                });\r\n            } else {\r\n                $$('select').each(function (select) {\r\n                    var otherSelectsValues = [];\r\n\r\n                    $$('select').each(function (otherSelects) {\r\n                        if (otherSelects !== select) {\r\n                            otherSelectsValues.push({\r\n                                attribute: otherSelects.name,\r\n                                value: otherSelects.value\r\n                            });\r\n                        }\r\n                    });\r\n\r\n                    select.select('option[value!=]').each(function (option) {\r\n\r\n                        otherSelectsValues.push({\r\n                            attribute: option.up().name,\r\n                            value: option.value\r\n                        });\r\n\r\n                        variation = EbayListingPreviewItemsObj.getVariation(otherSelectsValues);\r\n\r\n                        if (variation.data === undefined) {\r\n                            if (select.value === option.value) {\r\n                                select.value = \"\";\r\n                            }\r\n                            option.hide();\r\n\r\n                        }\r\n\r\n                        otherSelectsValues.pop();\r\n                    });\r\n                });\r\n\r\n                var otherSelectsValues = [];\r\n\r\n                $$('select').each(function (otherSelects) {\r\n                    otherSelectsValues.push({\r\n                        attribute: otherSelects.name,\r\n                        value: otherSelects.value\r\n                    });\r\n                });\r\n\r\n                variation = EbayListingPreviewItemsObj.getVariation(otherSelectsValues);\r\n\r\n                if($('product_discount_stp')) {\r\n                    $('product_discount_stp').hide();\r\n                    $('product_price_stp').hide();\r\n                }\r\n                if($('product_discount_map')) {\r\n                    $('product_discount_map').hide();\r\n                    $('product_price_map').hide();\r\n                }\r\n\r\n                if (variation.data.price_stp !== null) {\r\n                    $('product_discount_stp').show();\r\n                    $('product_price_stp').show().update(variation.data.price_stp);\r\n                } else {\r\n                    if (variation.data.price_map !== null) {\r\n                        $('product_discount_map').show();\r\n                        $('product_price_map').show().update(variation.data.price_map);\r\n                    }\r\n                }\r\n\r\n                $('product_price').update(variation.data.price);\r\n                $('product_qty').update(variation.data.qty);\r\n\r\n            }\r\n\r\n            if (M2ePro.formData.images.variations &&\r\n                M2ePro.formData.images.variations.specific === currentSelect.name && currentSelect.value) {\r\n                $('product_image').src = M2ePro.formData.images.variations.images[currentSelect.value][0];\r\n            }\r\n        },\r\n\r\n        onClickGalleryImage: function (image) {\r\n            $('product_image').src = image.src;\r\n        },\r\n\r\n        onTabClick: function (tab){\r\n            jQuery('.' + jQuery('li.active').attr('data-tab') + '_container').hide();\r\n            jQuery('li.active').removeClass('active');\r\n\r\n            jQuery(tab).addClass('active');\r\n            jQuery('.' + jQuery(tab).attr('data-tab') + '_container').show();\r\n        },\r\n\r\n        initVariations: function () {\r\n            $$('select').each(function(currentSelect){\r\n                if(currentSelect.select('option[value!=]').length === 1){\r\n                    currentSelect.select('option[value!=]')[0].selected = true;\r\n                    EbayListingPreviewItemsObj.onChangeVariationSelect(currentSelect);\r\n                }\r\n            });\r\n        }\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/VariationProductManage.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (jQuery, modal, messageObj) {\r\n    window.EbayListingVariationProductManage = Class.create(Action,{\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridHandler)\r\n        {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function(options)\r\n        {\r\n            this.options = Object.extend(this.options,options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function(response)\r\n        {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function(productId, title, filter)\r\n        {\r\n            var self = this;\r\n\r\n            messageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('variationProductManage'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id : productId,\r\n                    filter: filter\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var modalDialog = $('modal_variation_product_manage');\r\n                    if (!modalDialog) {\r\n                        modalDialog = new Element('div', {\r\n                            id: 'modal_variation_product_manage'\r\n                        });\r\n                    } else {\r\n                        modalDialog.innerHTML = '';\r\n                    }\r\n\r\n                    window.variationProductManagePopup = jQuery(modalDialog).modal({\r\n                        title: title.escapeHTML(),\r\n                        type: 'slide',\r\n                        buttons: []\r\n                    });\r\n                    variationProductManagePopup.modal('openModal');\r\n\r\n                    modalDialog.insert(transport.responseText);\r\n                    modalDialog.innerHTML.evalScripts();\r\n\r\n                    variationProductManagePopup.productId = productId;\r\n                }\r\n            });\r\n        },\r\n\r\n        closeManageVariationsPopup: function()\r\n        {\r\n            variationProductManagePopup.modal('closeModal');\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/VariationProductManageVariationsGrid.js":"define([\r\n    'jquery',\r\n    'M2ePro/Grid'\r\n], function (jQuery) {\r\n    window.EbayListingVariationProductManageVariationsGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super, gridId)\r\n        {\r\n            $super(gridId);\r\n\r\n            jQuery.validator.addMethod('M2ePro-upc', function(value, el) {\r\n\r\n                if (value.length == 0) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.length != 12) {\r\n                    return false;\r\n                }\r\n\r\n                var barcode = value.substr(0, value.length-1);\r\n\r\n                var sum = 0;\r\n                var length  = barcode.length-1;\r\n\r\n                for (var i = 0; i <= length; i++) {\r\n                    if ((i % 2) === 0) {\r\n                        sum += parseInt(barcode.charAt(length - i) * 3);\r\n                    } else {\r\n                        sum += parseInt(barcode.charAt(length - i));\r\n                    }\r\n                }\r\n\r\n                var calc  = sum % 10;\r\n                var checksum = (calc === 0) ? 0 : (10 - calc);\r\n\r\n                return value.charAt(length+1) == checksum;\r\n            }, M2ePro.translator.translate('Please enter valid UPC'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-ean', function(value, el) {\r\n\r\n                if (value.length == 0) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.length != 13) {\r\n                    return false;\r\n                }\r\n\r\n                var barcode = value.substr(0, value.length-1);\r\n\r\n                var sum = 0;\r\n                var length  = barcode.length-1;\r\n\r\n                for (var i = 0; i <= length; i++) {\r\n                    if ((i % 2) === 0) {\r\n                        sum += parseInt(barcode.charAt(length - i) * 3);\r\n                    } else {\r\n                        sum += parseInt(barcode.charAt(length - i));\r\n                    }\r\n                }\r\n\r\n                var calc  = sum % 10;\r\n                var checksum = (calc === 0) ? 0 : (10 - calc);\r\n\r\n                return value.charAt(length+1) == checksum;\r\n\r\n            }, M2ePro.translator.translate('Please enter valid EAN'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-isbn', function(value, el) {\r\n\r\n                if (value.length == 0) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.length == 10) {\r\n\r\n                    var a = 0;\r\n                    for (var i = 0; i < 10; i++) {\r\n                        if (value.charAt(i) == \"X\" || value.charAt(i) == \"x\") {\r\n                            a += 10 * parseInt(10 - i);\r\n                        } else {\r\n                            a += parseInt(value.charAt(i)) * parseInt(10 - i);\r\n                        }\r\n                    }\r\n                    return (a % 11 == 0);\r\n\r\n                } else if (value.length == 13) {\r\n\r\n                    if (value.substr(0,3) != '978') {\r\n                        return false;\r\n                    }\r\n\r\n                    var check = 0;\r\n                    for (var i = 0; i < 13; i += 2) {\r\n                        check += parseInt(value.substr(i,1));\r\n                    }\r\n                    for (var i = 1; i < 12; i += 2) {\r\n                        check += 3 * parseInt(value.substr(i,1));\r\n                    }\r\n\r\n                    return check % 10 == 0;\r\n                }\r\n\r\n                return false;\r\n            }, M2ePro.translator.translate('Please enter valid ISBN'));\r\n\r\n            this.initFormValidation('form[id^=\"variation_identifiers_edit_\"]');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function()\r\n        {\r\n            return 'ebay';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function()\r\n        {\r\n            return 1000;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function()\r\n        {\r\n            return false;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function($super)\r\n        {\r\n            $super();\r\n\r\n            $$('.attributes-options-filter').each(this.initAttributesOptionsFilter, this);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function(response)\r\n        {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initAttributesOptionsFilter: function(filterEl)\r\n        {\r\n            var srcElement = Element.down(filterEl, 'select');\r\n\r\n            srcElement.observe('change', this.onAttributesOptionsFilterChange.bind(this));\r\n\r\n            var valuesDiv = Element.down(filterEl, '.attributes-options-filter-values');\r\n            valuesDiv.optionsCount = valuesDiv.childElementCount;\r\n\r\n            if(valuesDiv.optionsCount == srcElement.childElementCount - 1) {\r\n                srcElement.hide();\r\n            }\r\n\r\n            valuesDiv.optionsIterator = 0;\r\n            valuesDiv.childElements().each(function(attrValue) {\r\n\r\n                var removeImg = Element.down(attrValue, '.filter-param-remove'),\r\n                    attrName = Element.down(attrValue, 'input[type=\"hidden\"]'),\r\n                    selectedOption = Element.down(filterEl, 'select option[value=\"' + attrName.value + '\"]');\r\n\r\n                selectedOption.hide();\r\n\r\n                valuesDiv.optionsIterator++;\r\n\r\n                removeImg.show();\r\n                removeImg.observe('click', function() {\r\n                    valuesDiv.optionsCount--;\r\n                    selectedOption.show();\r\n                    srcElement.show();\r\n                    Element.remove(attrValue);\r\n                });\r\n            }, this);\r\n        },\r\n\r\n        onAttributesOptionsFilterChange: function(e)\r\n        {\r\n            var srcElement = e.target || e.srcElement,\r\n                parentDiv = Element.up(srcElement, '.attributes-options-filter'),\r\n                valuesDiv = Element.down(parentDiv, '.attributes-options-filter-values'),\r\n                selectedOption = Element.down(srcElement, '[value=\"' + srcElement.value + '\"]');\r\n\r\n            selectedOption.hide();\r\n\r\n            valuesDiv.optionsCount++;\r\n            valuesDiv.optionsIterator++;\r\n\r\n            srcElement.enable();\r\n            if(valuesDiv.optionsCount == srcElement.childElementCount - 1) {\r\n                srcElement.hide();\r\n            }\r\n\r\n            var filterName = parentDiv.id.replace('attributes-options-filter_', '');\r\n\r\n            var newOptionContainer = new Element('div'),\r\n                newOptionLabel = new Element('div'),\r\n                newOptionValue = new Element('input', {\r\n                    type: 'text',\r\n                    class: 'input-text admin__control-text',\r\n                    name: filterName + '[' + valuesDiv.optionsIterator + '][value]'\r\n                }),\r\n                newOptionAttr = new Element('input', {\r\n                    type: 'hidden',\r\n                    name: filterName + '[' + valuesDiv.optionsIterator + '][attr]',\r\n                    value: srcElement.value\r\n                }),\r\n                removeImg = Element.clone(Element.down(parentDiv, '.attributes-options-filter-selector .filter-param-remove'));\r\n\r\n            newOptionLabel.innerHTML = srcElement.value + ': ';\r\n            removeImg.show();\r\n\r\n            Event.observe(newOptionValue, 'keypress', this.getGridObj().filterKeyPress.bind(this.getGridObj()));\r\n\r\n            newOptionContainer.insert({ bottom: newOptionLabel });\r\n            newOptionContainer.insert({ bottom: newOptionValue });\r\n            newOptionContainer.insert({ bottom: newOptionAttr });\r\n            newOptionContainer.insert({ bottom: removeImg });\r\n\r\n            valuesDiv.insert({ bottom: newOptionContainer });\r\n\r\n            removeImg.observe('click', function() {\r\n                valuesDiv.optionsCount--;\r\n                selectedOption.show();\r\n                srcElement.show();\r\n                newOptionContainer.remove();\r\n            }, this);\r\n\r\n            srcElement.value = '';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editVariationIdentifiers: function(editBtn, variationId)\r\n        {\r\n            $('variation_identifiers_edit_'+variationId).show();\r\n            $('variation_identifiers_'+variationId).hide();\r\n            editBtn.hide();\r\n        },\r\n\r\n        confirmVariationIdentifiers: function(editBtn, variationId)\r\n        {\r\n            var self = this,\r\n                form = $('variation_identifiers_edit_'+variationId)\r\n\r\n            if (!self.isValid(form)) {\r\n                return;\r\n            }\r\n\r\n            var data = form.serialize(true);\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_variation_product_manage/setIdentifiers'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = self.parseResponse(transport);\r\n                    if(response.success) {\r\n                        VariationsGridObj.getGridObj().reload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        cancelVariationIdentifiers: function(variationId)\r\n        {\r\n            var form = $('variation_identifiers_edit_'+variationId);\r\n            form.reset();\r\n            this.isValid(form);\r\n            form.hide();\r\n            $('variation_identifiers_'+variationId).show();\r\n            $('edit_variations_'+variationId).show();\r\n        },\r\n\r\n        isValid: function (form)\r\n        {\r\n            var upc = form.down('.M2ePro-upc'),\r\n                ean = form.down('.M2ePro-ean'),\r\n                isbn = form.down('.M2ePro-isbn'),\r\n                mpn = form.down('.M2ePro-mpn');\r\n\r\n            upc.value = trim(upc.value);\r\n            ean.value = trim(ean.value);\r\n            isbn.value = trim(isbn.value.replace('-',''));\r\n            mpn.value = trim(mpn.value);\r\n\r\n            return jQuery(form).valid();\r\n        }\r\n\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Create/General.js":"define([\r\n    'underscore',\r\n    'Magento_Ui/js/modal/alert',\r\n    'M2ePro/Ebay/Listing/Create/General/MarketplaceSynchProgress',\r\n    'M2ePro/Plugin/ProgressBar',\r\n    'M2ePro/Plugin/AreaWrapper'\r\n], function (_, alert) {\r\n\r\n    window.EbayListingCreateGeneral = Class.create();\r\n    EbayListingCreateGeneral.prototype = {\r\n\r\n        marketplaceSynchProgressObj: null,\r\n        accounts: null,\r\n        selectedAccountId: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (marketplaces) {\r\n\r\n            var self = this;\r\n\r\n            self.marketplaceSynchProgressObj = new EbayListingCreateGeneralMarketplaceSynchProgress(\r\n                new ProgressBar('progress_bar'),\r\n                new AreaWrapper('content_container')\r\n            );\r\n\r\n            CommonObj.setValidationCheckRepetitionValue(\r\n                'M2ePro-listing-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Listing. Listing Title must be unique.'),\r\n                'Listing', 'title', 'id', null, M2ePro.php.constant('Ess_M2ePro_Helper_Component_Ebay::NICK')\r\n            );\r\n\r\n            self.initAccount();\r\n            self.initMarketplace(marketplaces);\r\n        },\r\n\r\n        initAccount: function () {\r\n\r\n            var self = this;\r\n\r\n            $('add_account_button').observe('click', function() {\r\n                var win = window.open(M2ePro.url.get('ebay_account/newAction'));\r\n\r\n                var intervalId = setInterval(function() {\r\n\r\n                    if (!win.closed) {\r\n                        return;\r\n                    }\r\n\r\n                    clearInterval(intervalId);\r\n\r\n                    self.renderAccounts();\r\n\r\n                }, 1000);\r\n            });\r\n\r\n            $('account_id').observe('change', function () {\r\n                self.selectedAccountId = this.value;\r\n            });\r\n\r\n            self.renderAccounts();\r\n        },\r\n\r\n        renderAccounts: function (callback) {\r\n\r\n            var self = this;\r\n\r\n            var account_add_btn = $('add_account_button');\r\n            var account_label_el = $('account_label');\r\n            var account_select_el = $('account_id');\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/getAccounts'), {\r\n                method: 'get',\r\n                onSuccess: function(transport) {\r\n                    var accounts = transport.responseText.evalJSON();\r\n\r\n                    if (_.isNull(self.accounts)) {\r\n                        self.accounts = accounts;\r\n                    }\r\n\r\n                    if (_.isNull(self.selectedAccountId)) {\r\n                        self.selectedAccountId = $('account_id').value;\r\n                    }\r\n\r\n                    var isAccountsChanged = !self.isAccountsEqual(accounts);\r\n\r\n                    if (isAccountsChanged) {\r\n                        self.accounts = accounts;\r\n                    }\r\n\r\n                    if (accounts.length === 0) {\r\n                        account_add_btn.down('span').update(M2ePro.translator.translate('Add'));\r\n                        account_label_el.update(M2ePro.translator.translate('Account not found, please create it.'));\r\n                        account_label_el.show();\r\n                        account_select_el.hide();\r\n                        return;\r\n                    }\r\n\r\n                    account_select_el.update();\r\n                    account_select_el.appendChild(new Element('option', {style: 'display: none'}));\r\n                    accounts.each(function(account) {\r\n                        account_select_el.appendChild(new Element('option', {value: account.id})).insert(account.title);\r\n                    });\r\n\r\n                    account_add_btn.down('span').update(M2ePro.translator.translate('Add Another'));\r\n\r\n                    if (accounts.length === 1) {\r\n                        var account = _.first(accounts);\r\n\r\n                        self.selectedAccountId = account.id;\r\n\r\n                        var accountElement;\r\n\r\n                        if (M2ePro.formData.wizard) {\r\n                            accountElement = new Element('span').update(account.title);\r\n                        } else {\r\n                            var accountLink = M2ePro.url.get('ebay_account/edit', {'id': account.id, close_on_save: 1});\r\n                            accountElement = new Element('a', {\r\n                                'href': accountLink,\r\n                                'target': '_blank'\r\n                            }).update(account.title);\r\n                        }\r\n\r\n                        account_label_el.update(accountElement);\r\n\r\n                        account_label_el.show();\r\n                        account_select_el.hide();\r\n                    } else if (isAccountsChanged) {\r\n                        self.selectedAccountId = _.last(accounts).id;\r\n\r\n                        account_label_el.hide();\r\n                        account_select_el.show();\r\n                    }\r\n\r\n                    account_select_el.setValue(self.selectedAccountId);\r\n\r\n                    callback && callback();\r\n                }\r\n            });\r\n        },\r\n\r\n        initMarketplace: function (marketplaces) {\r\n\r\n            var self = this;\r\n\r\n            $$('.next_step_button').each(function(btn) { btn.observe('click',function() {\r\n                if (self.marketplaceSynchProgressObj.runningNow) {\r\n                    alert({\r\n                        content: M2ePro.translator.translate('Please wait while Synchronization is finished.')\r\n                    });\r\n                    return;\r\n                }\r\n                jQuery('#edit_form').valid() && self.synchronizeMarketplace($('marketplace_id').value);\r\n            }) });\r\n\r\n            $('marketplace_id')\r\n                .observe('click', function() {\r\n                    if (!this.value) {\r\n                        return;\r\n                    }\r\n                    var marketplace = _.findWhere(marketplaces, {value: this.value});\r\n                    $('marketplace_url_note').update(marketplace.url).show();\r\n                })\r\n                .simulate('click')\r\n            ;\r\n        },\r\n\r\n        synchronizeMarketplace: function (marketplaceId) {\r\n\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/isMarketplaceEnabled'), {\r\n                method: 'get',\r\n                parameters: { marketplace_id: marketplaceId },\r\n                onSuccess: function(transport) {\r\n\r\n                    var result = transport.responseText.evalJSON();\r\n                    if (result.status) {\r\n                        return self.marketplaceSynchProgressObj.end();\r\n                    }\r\n\r\n                    var params = {};\r\n                    params['status_' + marketplaceId] = 1;\r\n\r\n                    new Ajax.Request(M2ePro.url.get('ebay_marketplace/save'), {\r\n                        method: 'post',\r\n                        parameters: params,\r\n                        onSuccess: function() {\r\n\r\n                            var title = 'eBay ' + $('marketplace_id').down('option[value='+$('marketplace_id').value+']').innerHTML;\r\n\r\n                            $('next').disable();\r\n\r\n                            self.marketplaceSynchProgressObj.runTask(\r\n                                title,\r\n                                M2ePro.url.get('ebay_marketplace/runSynchNow', {marketplace_id: marketplaceId})\r\n                            );\r\n\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        isAccountsEqual: function (newAccounts) {\r\n            if (!newAccounts.length && !this.accounts.length) {\r\n                return true;\r\n            }\r\n\r\n            if (newAccounts.length !== this.accounts.length) {\r\n                return false;\r\n            }\r\n\r\n            return _.every(this.accounts, function (account) {\r\n                return _.where(newAccounts, account).length > 0;\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    };\r\n});","Ess_M2ePro/js/Ebay/Listing/Create/General/MarketplaceSynchProgress.js":"define([\r\n    'M2ePro/SynchProgress'\r\n], function () {\r\n    EbayListingCreateGeneralMarketplaceSynchProgress = Class.create(SynchProgress, {\r\n\r\n        // ---------------------------------------\r\n\r\n        runningNow: false,\r\n\r\n        // ---------------------------------------\r\n\r\n        start: function ($super, title, status) {\r\n            $super(title, status);\r\n            this.runningNow = true;\r\n        },\r\n\r\n        end: function ($super) {\r\n            $super();\r\n            this.runningNow = false;\r\n            this.saveClick(M2ePro.url.get('ebay_listing_create/index'), true)\r\n        },\r\n\r\n        runTask: function (title, url, callBackWhenEnd) {\r\n            title = title || '';\r\n            url = url || '';\r\n            callBackWhenEnd = callBackWhenEnd || '';\r\n\r\n            if (url == '') {\r\n                return;\r\n            }\r\n\r\n            var self = this;\r\n            new Ajax.Request(M2ePro.url.get('general/synchCheckState'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == self.stateExecuting) {\r\n\r\n                        self.start(\r\n                            M2ePro.translator.translate('Another Synchronization Is Already Running.'),\r\n                            M2ePro.translator.translate('Getting information. Please wait ...')\r\n                        );\r\n\r\n                        setTimeout(function () {\r\n                            self.startGetExecutingInfo('self.runTask(\\'' + title + '\\',\\'' + url + '\\',\"' + callBackWhenEnd + '\");');\r\n                        }, 2000);\r\n\r\n                    } else {\r\n\r\n                        self.start(title, M2ePro.translator.translate('Preparing to start. Please wait ...'));\r\n\r\n                        new Ajax.Request(url, {\r\n                            method: 'get', asynchronous: true\r\n                        });\r\n\r\n                        setTimeout(function () {\r\n                            self.startGetExecutingInfo(callBackWhenEnd);\r\n                        }, 2000);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        startGetExecutingInfo: function (callBackWhenEnd) {\r\n            callBackWhenEnd = callBackWhenEnd || '';\r\n\r\n            var self = this;\r\n            new Ajax.Request(M2ePro.url.get('general/synchGetExecutingInfo'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                onSuccess: function (transport) {\r\n\r\n                    var data = transport.responseText.evalJSON(true);\r\n\r\n                    if (data.mode == self.stateExecuting) {\r\n\r\n                        self.progressBarObj.setTitle(data.title);\r\n                        if (data.percents <= 0) {\r\n                            self.progressBarObj.setPercents(0, 0);\r\n                        } else if (data.percents >= 100) {\r\n                            self.progressBarObj.setPercents(100, 0);\r\n                        } else {\r\n                            self.progressBarObj.setPercents(data.percents, 1);\r\n                        }\r\n                        self.progressBarObj.setStatus(data.status);\r\n\r\n                        self.wrapperObj.lock();\r\n                        $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n\r\n                        setTimeout(function () {\r\n                            self.startGetExecutingInfo(callBackWhenEnd);\r\n                        }, 3000);\r\n\r\n                    } else {\r\n\r\n                        self.progressBarObj.setPercents(100, 0);\r\n\r\n                        // ---------------------------------------\r\n                        setTimeout(function () {\r\n\r\n                            if (callBackWhenEnd != '') {\r\n                                eval(callBackWhenEnd);\r\n                            } else {\r\n                                self.end();\r\n                            }\r\n\r\n                        }, 1500);\r\n                        // ---------------------------------------\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Other/Grid.js":"define([\r\n    'M2ePro/Listing/Other/Grid'\r\n], function () {\r\n    window.EbayListingOtherGrid = Class.create(ListingOtherGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function()\r\n        {\r\n            return 'ebay';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function(rowId)\r\n        {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Other\\\\AbstractGrid::LISTING_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('ebay_log_listing_other/index', params);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSelectedItemsParts: function()\r\n        {\r\n            var selectedProductsArray = this.getSelectedProductsArray();\r\n\r\n            if (this.getSelectedProductsString() == '' || selectedProductsArray.length == 0) {\r\n                return [];\r\n            }\r\n\r\n            var maxProductsInPart = this.getMaxProductsInPart();\r\n\r\n            var result = [];\r\n            for (var i=0;i<selectedProductsArray.length;i++) {\r\n                if (result.length == 0 || result[result.length-1].length == maxProductsInPart) {\r\n                    result[result.length] = [];\r\n                }\r\n                result[result.length-1][result[result.length-1].length] = selectedProductsArray[i];\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function()\r\n        {\r\n            return 10;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/PickupStore/Grid.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Listing/View/Action'\r\n], function (jQuery, Modal, MessageObj) {\r\n\r\n    window.EbayListingPickupStoreGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        popup: null,\r\n        variationPopup: null,\r\n        logPopup: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        pickupStoreStepProducts: function(listingId, callback)\r\n        {\r\n            var self = this;\r\n            this.getGridMassActionObj().unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('*/productsStep'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    id: listingId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    self.openPopUp(\r\n                        M2ePro.translator.translate('Assign Products to Stores'),\r\n                        transport.responseText\r\n                    );\r\n\r\n                    var closeBtn = $('assign_close_button');\r\n                    closeBtn.removeClassName('back');\r\n                    self.updateButtonText(closeBtn, 'Cancel');\r\n                    closeBtn.stopObserving().observe('click', function() {\r\n                        self.popup.modal('closeModal');\r\n                    });\r\n\r\n                    var continueBtn = $('assign_done_button');\r\n                    continueBtn.addClassName('forward');\r\n                    self.updateButtonText(continueBtn, 'Continue');\r\n                    continueBtn.stopObserving().observe('click', function() {\r\n                        var checkedIds = EbayListingPickupStoreStepProductsGridObj.getCheckedValues();\r\n                        if (checkedIds == '') {\r\n                            self.alert('Please select Items.');\r\n                            return;\r\n                        }\r\n\r\n                        self.pickupStoreStepStores(listingId);\r\n                    });\r\n\r\n                    callback && callback();\r\n                }\r\n            });\r\n        },\r\n\r\n        pickupStoreStepStores: function(listingId)\r\n        {\r\n            var self = this;\r\n            new Ajax.Request(M2ePro.url.get('*/storesStep'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    id: listingId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    self.openPopUp(\r\n                        M2ePro.translator.translate('Assign Products to Stores'),\r\n                        transport.responseText\r\n                    );\r\n\r\n                    var backBtn = $('assign_close_button');\r\n                    backBtn.addClassName('back');\r\n                    self.updateButtonText(backBtn, 'Back');\r\n                    backBtn.stopObserving().observe('click', function(e) {\r\n                        e.preventDefault();\r\n                        var checked = EbayListingPickupStoreStepProductsGridObj.getCheckedValues();\r\n                        self.pickupStoreStepProducts(listingId, function() {\r\n                            var gridMassAcction = EbayListingPickupStoreStepProductsGridObj.getGridMassActionObj();\r\n\r\n                            gridMassAcction.setCheckedValues(checked);\r\n                            gridMassAcction.checkCheckboxes();\r\n                        });\r\n                    });\r\n\r\n                    var completeBtn = $('assign_done_button');\r\n                    completeBtn.removeClassName('forward');\r\n                    self.updateButtonText(completeBtn, 'Complete');\r\n                    completeBtn.stopObserving().observe('click', function(e) {\r\n                        e.preventDefault();\r\n                        var productsIds = EbayListingPickupStoreStepProductsGridObj.getCheckedValues(),\r\n                            storesIds = EbayListingPickupStoreStepStoresGridObj.getCheckedValues();\r\n\r\n                        if (productsIds == '' || storesIds == '') {\r\n                            self.alert('Please select Stores.');\r\n                            return;\r\n                        }\r\n\r\n                        self.completeStep(productsIds, storesIds);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        completeStep: function (productsIds, storesIds)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('*/assign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds,\r\n                    stores_ids: storesIds\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.getGridMassActionObj().unselectAll();\r\n                    self.getGridObj().doFilter();\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function(msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1)+'Message'](msg.text);\r\n                    });\r\n\r\n                    self.popup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function(title, content)\r\n        {\r\n            var self = this;\r\n\r\n            var modalDialogMessage = $('pickup_store_popup');\r\n            if (!modalDialogMessage) {\r\n                modalDialogMessage = new Element('div', {\r\n                    id: 'pickup_store_popup'\r\n                });\r\n\r\n                this.popup = jQuery(modalDialogMessage).modal({\r\n                    title: title,\r\n                    type: 'slide',\r\n                    buttons: [{\r\n                        text: M2ePro.translator.translate('Cancel'),\r\n                        attr: {id: 'assign_close_button'},\r\n                        class: 'action-default action-dismiss',\r\n                        click: function () {}\r\n                    },{\r\n                        text: M2ePro.translator.translate('Continue'),\r\n                        attr: {id: 'assign_done_button'},\r\n                        class: 'action-primary action-accept forward',\r\n                        click: function () {}\r\n                    }],\r\n                    closed: function() {\r\n                        self.selectedProductsIds = [];\r\n                        self.selectedCategoriesData = {};\r\n                    }\r\n                });\r\n            }\r\n\r\n            this.popup.modal('openModal');\r\n\r\n            modalDialogMessage.innerHTML = '';\r\n            modalDialogMessage.insert(content);\r\n            modalDialogMessage.innerHTML.evalScripts();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openVariationPopUp: function(productId, title, pickupStoreId, filter)\r\n        {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n            M2ePro.customData.variationPopup = {\r\n                product_id: productId,\r\n                title: title,\r\n                pickup_store_id: pickupStoreId,\r\n                filter: filter\r\n            };\r\n\r\n            new Ajax.Request(M2ePro.url.get('variationProduct'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: productId,\r\n                    pickup_store_id: pickupStoreId,\r\n                    filter: filter\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var modalDialogMessage = $('pickup_store_variation_product_popup');\r\n                    if (!modalDialogMessage) {\r\n                        modalDialogMessage = new Element('div', {\r\n                            id: 'pickup_store_variation_product_popup'\r\n                        });\r\n\r\n                        this.variationPopup = jQuery(modalDialogMessage).modal({\r\n                            title: title,\r\n                            type: 'slide',\r\n                            buttons: []\r\n                        });\r\n                    }\r\n\r\n                    this.variationPopup.modal('openModal');\r\n\r\n                    modalDialogMessage.innerHTML = '';\r\n                    modalDialogMessage.insert(transport.responseText);\r\n                    modalDialogMessage.innerHTML.evalScripts();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        viewItemHelp: function(rowId, data, hideViewLog)\r\n        {\r\n            $('grid_help_icon_open_'+rowId).hide();\r\n            $('grid_help_icon_close_'+rowId).show();\r\n\r\n            if ($('grid_help_content_'+rowId) != null) {\r\n                $('grid_help_content_'+rowId).show();\r\n                return;\r\n            }\r\n\r\n            var html = this.createHelpTitleHtml(rowId);\r\n\r\n            var synchNote = $('synch_template_list_rules_note_'+rowId);\r\n            if (synchNote) {\r\n                html += this.createSynchNoteHtml(synchNote.innerHTML)\r\n            }\r\n\r\n            data = eval(base64_decode(data));\r\n            for (var i=0;i<data.length;i++) {\r\n                html += this.createHelpActionHtml(data[i]);\r\n            }\r\n\r\n            if (!hideViewLog) {\r\n                html += this.createHelpViewAllLogHtml(rowId);\r\n            }\r\n\r\n            var rows = this.getGridObj().rows;\r\n            for(var i=0;i<rows.length;i++) {\r\n                var row = rows[i];\r\n                var cels = $(row).childElements();\r\n\r\n                var checkbox = $(cels[0]).childElements();\r\n                checkbox = checkbox[0];\r\n\r\n                if (checkbox.value == rowId) {\r\n                    row.insert({\r\n                        after: '<tr id=\"grid_help_content_'+rowId+'\"><td class=\"help_line\" colspan=\"'+($(row).childElements().length)+'\">'+html+'</td></tr>'\r\n                    });\r\n                } else {\r\n                    var lastCell = cels[cels.length-1],\r\n                        hiddenElement = $(lastCell).down('#product_row_order_'+rowId);\r\n\r\n                    if (hiddenElement && hiddenElement.value == rowId) {\r\n                        row.insert({\r\n                            after: '<tr id=\"grid_help_content_'+rowId+'\"><td class=\"help_line\" colspan=\"'+($(row).childElements().length)+'\">'+html+'</td></tr>'\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            var self = this;\r\n            $('hide_item_help_' + rowId).observe('click', function() {\r\n                self.hideItemHelp(rowId);\r\n            });\r\n        },\r\n\r\n        createHelpTitleHtml: function(rowId)\r\n        {\r\n            var closeHtml = '<a href=\"javascript:void(0);\" id=\"hide_item_help_' + rowId + '\" title=\"'+M2ePro.translator.translate('Close')+\r\n                            '\"><span class=\"hl_close icon-close\"></span></a>';\r\n            return '<div class=\"hl_header\"><span class=\"hl_title\">&nbsp;</span>'+closeHtml+'</div>';\r\n        },\r\n\r\n        createHelpViewAllLogHtml: function(rowId)\r\n        {\r\n            var id = $('product_row_order_'+rowId).getAttribute('listing-product-pickup-store-state');\r\n            return '<div class=\"hl_footer\">' +\r\n                '<a href=\"#\" onclick=\"EbayListingPickupStoreGridObj.getLogGrid('+id+');\">'+\r\n                M2ePro.translator.translate('View Full Product Log')+\r\n                '</a></div>';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogGrid: function(rowId)\r\n        {\r\n            new Ajax.Request(M2ePro.url.get('*/logGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    listing_product_pickup_store_state: rowId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var modalDialogMessage = $('pickup_store_variation_log_popup');\r\n                    if (!modalDialogMessage) {\r\n                        modalDialogMessage = new Element('div', {\r\n                            id: 'pickup_store_variation_log_popup'\r\n                        });\r\n\r\n                        this.logPopup = jQuery(modalDialogMessage).modal({\r\n                            title: M2ePro.translator.translate('Log For SKU ' + rowId),\r\n                            type: 'slide',\r\n                            buttons: []\r\n                        });\r\n                    }\r\n\r\n                    modalDialogMessage.up('.modal-inner-wrap')\r\n                                      .down('.modal-title')\r\n                                      .innerHTML = M2ePro.translator.translate('Log For SKU ' + rowId);\r\n                    this.logPopup.modal('openModal');\r\n\r\n                    modalDialogMessage.innerHTML = '';\r\n                    modalDialogMessage.insert(transport.responseText);\r\n                    modalDialogMessage.innerHTML.evalScripts();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        updateButtonText: function(element, text)\r\n        {\r\n            jQuery(element).find('span').text(M2ePro.translator.translate(text));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function()\r\n        {\r\n            var self = this;\r\n\r\n            var actionHandler = new ListingViewAction(this);\r\n            actionHandler.setProgressBar('pickup_store_view_progress_bar');\r\n            actionHandler.setGridWrapper('pickup_store_view_content_container');\r\n            actionHandler.setErrorsSummaryContainer('pickup_store_container_errors_summary');\r\n\r\n            this.actions = {\r\n                unassignAction: function() {\r\n                    var selectedProductsParts = self.getSelectedItemsParts();\r\n                    if (selectedProductsParts.length == 0) {\r\n                        return;\r\n                    }\r\n\r\n                    actionHandler.startActions(\r\n                        M2ePro.translator.translate('Unassign Product(s) from Stores'),\r\n                        M2ePro.url.get('*/unassign'),\r\n                        selectedProductsParts\r\n                    );\r\n                }\r\n            };\r\n        },\r\n\r\n        getMaxProductsInPart: function ()\r\n        {\r\n            return 100;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/PickupStore/Step/Products/Grid.js":"define([\r\n    'M2ePro/Listing/View/Grid'\r\n], function () {\r\n\r\n    window.EbayListingPickupStoreStepProductsGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getCheckedValues: function()\r\n        {\r\n            return this.getGridMassActionObj().getCheckedValues();\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/PickupStore/Step/Stores/Grid.js":"define([\r\n    'M2ePro/Listing/View/Grid'\r\n], function () {\r\n\r\n    window.EbayListingPickupStoreStepStoresGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getCheckedValues: function()\r\n        {\r\n            return this.getGridMassActionObj().getCheckedValues();\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Add.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function (jQuery, modal) {\r\n    window.EbayListingProductAdd = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {\r\n            show_autoaction_popup: false,\r\n\r\n            get_selected_products: function (callback) {}\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        continue: function () {\r\n            var self = this;\r\n\r\n            self.options.get_selected_products(function (selectedProducts) {\r\n\r\n                if (!selectedProducts) {\r\n                    self.alert(M2ePro.translator.translate('Please select the Products you want to perform the Action on.'));\r\n                    return;\r\n                }\r\n\r\n                if (self.options.show_autoaction_popup) {\r\n                    return self.showAutoactionPopup();\r\n                }\r\n\r\n                self.add(selectedProducts);\r\n\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        add: function (products) {\r\n            var self = this;\r\n\r\n            self.products = products;\r\n\r\n            var parts = self.makeProductsParts();\r\n\r\n            ProgressBarObj.reset();\r\n            ProgressBarObj.setTitle('Adding Products to Listing');\r\n            ProgressBarObj.setStatus('Adding in process. Please wait...');\r\n            ProgressBarObj.show();\r\n            self.scrollPageToTop();\r\n\r\n            WrapperObj.lock();\r\n\r\n            self.sendPartsProducts(parts, parts.length);\r\n        },\r\n\r\n        makeProductsParts: function () {\r\n            var self = this;\r\n\r\n            var productsInPart = 50;\r\n            var productsArray = explode(',', self.products);\r\n            var parts = new Array();\r\n\r\n            if (productsArray.length < productsInPart) {\r\n                return parts[0] = productsArray;\r\n            }\r\n\r\n            var result = new Array();\r\n            for (var i = 0; i < productsArray.length; i++) {\r\n                if (result.length == 0 || result[result.length - 1].length == productsInPart) {\r\n                    result[result.length] = new Array();\r\n                }\r\n                result[result.length - 1][result[result.length - 1].length] = productsArray[i];\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        sendPartsProducts: function (parts, partsCount) {\r\n            var self = this;\r\n\r\n            if (parts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            var part = parts.splice(0, 1);\r\n            part = part[0];\r\n            var partString = implode(',', part);\r\n\r\n            var isLastPart = '';\r\n            if (parts.length <= 0) {\r\n                isLastPart = 'yes';\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_add/add'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    is_last_part: isLastPart,\r\n                    products: partString\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var percents = (100 / partsCount) * (partsCount - parts.length);\r\n\r\n                    if (percents <= 0) {\r\n                        ProgressBarObj.setPercents(0, 0);\r\n                    } else if (percents >= 100) {\r\n                        ProgressBarObj.setPercents(100, 0);\r\n                        ProgressBarObj.setStatus('Adding has been completed.');\r\n\r\n                        setLocation(M2ePro.url.get('ebay_listing_product_category_settings', {step: 1}));\r\n                    } else {\r\n                        ProgressBarObj.setPercents(percents, 1);\r\n                    }\r\n\r\n                    setTimeout(function () {\r\n                        self.sendPartsProducts(parts, partsCount);\r\n                    }, 500);\r\n                }\r\n            });\r\n\r\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showAutoactionPopup: function () {\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_add/setAutoActionPopupShown'), {\r\n                method: 'get',\r\n                onSuccess: function () {\r\n\r\n                    this.options.show_autoaction_popup = false;\r\n\r\n                    var modalDialogMessage = $('modal_auto_action_dialog_message');\r\n\r\n                    if (!modalDialogMessage) {\r\n                        modalDialogMessage = new Element('div', {\r\n                            id: 'modal_auto_action_dialog_message'\r\n                        });\r\n\r\n                        this.autoactionPopup = jQuery(modalDialogMessage).modal({\r\n                            title: M2ePro.translator.translate('Auto Add/Remove Rules'),\r\n                            type: 'popup',\r\n                            buttons: [\r\n                                {\r\n                                    text: M2ePro.translator.translate('Cancel'),\r\n                                    class: 'action-secondary action-dismiss',\r\n                                    click: ListingProductAddObj.cancelAutoActionPopup\r\n                                },\r\n                                {\r\n                                    text: M2ePro.translator.translate('Start Configure'),\r\n                                    class: 'action-primary action-accept',\r\n                                    click: function () {\r\n                                        ListingProductAddObj.autoactionPopup.modal('closeModal');\r\n                                        ListingAutoActionObj.loadAutoActionHtml();\r\n                                    }\r\n                                }\r\n                            ]\r\n                        });\r\n                        modalDialogMessage.insert($('autoaction_popup_content').show());\r\n                    }\r\n\r\n                    this.autoactionPopup.modal('openModal');\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        cancelAutoActionPopup: function () {\r\n            ListingProductAddObj.autoactionPopup.modal('closeModal');\r\n            ListingProductAddObj.continue();\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Add/Category/Summary/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingProductAddCategorySummaryGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeAction: this.remove.bind(this)\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        remove: function () {\r\n            var self = this;\r\n\r\n            Grid.prototype.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var url = M2ePro.url.get('ebay_listing_product_add/removeSessionProductsByCategory');\r\n                        new Ajax.Request(url, {\r\n                            parameters: {\r\n                                ids: self.getSelectedProductsString()\r\n                            },\r\n                            onSuccess: self.unselectAllAndReload.bind(self)\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function (config) {\r\n            if (config.actions && config.actions.confirm) {\r\n                config.actions.confirm();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Chooser.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common',\r\n    'M2ePro/Plugin/Magento/AttributeCreator'\r\n], function (jQuery, modal) {\r\n\r\n    window.EbayListingProductCategorySettingsChooser = Class.create();\r\n    EbayListingProductCategorySettingsChooser.prototype = Object.extend(new Common(), {\r\n\r\n        // ---------------------------------------\r\n\r\n        marketplaceId: null,\r\n        accountId: null,\r\n        divId: null,\r\n\r\n        selectedCategories: {},\r\n        categoryTitles: {},\r\n        attributes: [],\r\n\r\n        selectCallback: null,\r\n        unselectCallback: null,\r\n        doneCallback: null,\r\n        cancelCallback: null,\r\n\r\n        isShowEditLinks: true,\r\n        categoriesRequiringValidation: {},\r\n\r\n        isSingleCategoryMode: false,\r\n        singleCategoryType: null,\r\n\r\n        tempUnselectedCategory: {},\r\n        tempSelectedCategory: {},\r\n\r\n        isWizardMode: false,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (div, marketplace, account) {\r\n            this.marketplaceId = marketplace;\r\n            this.accountId = account;\r\n            this.divId = div;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setSelectCallback: function (callback) {\r\n            this.selectCallback = callback;\r\n        },\r\n\r\n        setUnselectCallback: function (callback) {\r\n            this.unselectCallback = callback;\r\n        },\r\n\r\n        getMarketplaceId: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            return self.marketplaceId;\r\n        },\r\n\r\n        getAccountId: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            return self.accountId;\r\n        },\r\n\r\n        setAttributes: function (attributes) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.attributes = attributes;\r\n        },\r\n\r\n        getAttributes: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            return self.attributes;\r\n        },\r\n\r\n        setSingleCategoryMode: function (mode) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.isSingleCategoryMode = mode;\r\n        },\r\n\r\n        setSingleCategoryType: function (type) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.singleCategoryType = type;\r\n        },\r\n\r\n        setShowEditLinks: function (mode) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.isShowEditLinks = mode;\r\n        },\r\n\r\n        setSelectedCategory: function (type, mode, value) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.selectedCategories[type] = {\r\n                mode: mode,\r\n                value: value\r\n            };\r\n        },\r\n\r\n        setSelectedCategories: function (categories) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.selectedCategories = categories;\r\n        },\r\n\r\n        getSelectedCategory: function (type) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (typeof type == 'undefined') {\r\n                return self.selectedCategories;\r\n            }\r\n\r\n            if (typeof self.selectedCategories[type] == 'undefined') {\r\n\r\n                return {mode: 0, value: ''};\r\n            }\r\n\r\n            return self.selectedCategories[type];\r\n        },\r\n\r\n        getInternalData: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (self.isSingleCategoryMode) {\r\n                return self.selectedCategories[self.singleCategoryType];\r\n            }\r\n\r\n            var internalData = {};\r\n\r\n            self.setCategoryToInternalData(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN'),\r\n                'category_main_',\r\n                internalData\r\n            );\r\n            self.setCategoryToInternalData(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_SECONDARY'),\r\n                'category_secondary_',\r\n                internalData\r\n            );\r\n            self.setCategoryToInternalData(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_MAIN'),\r\n                'store_category_main_',\r\n                internalData\r\n            );\r\n            self.setCategoryToInternalData(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_SECONDARY'),\r\n                'store_category_secondary_',\r\n                internalData\r\n            );\r\n\r\n            return internalData;\r\n        },\r\n\r\n        getInternalDataByType: function (type) {\r\n            var prefixByType = {};\r\n\r\n            prefixByType[M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN')] = 'category_main_';\r\n            prefixByType[M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_SECONDARY')] = 'category_secondary_';\r\n            prefixByType[M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_MAIN')] = 'store_category_main_';\r\n            prefixByType[M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_SECONDARY')] = 'store_category_secondary_';\r\n\r\n            var data = {};\r\n\r\n            this.setCategoryToInternalData(\r\n                type,\r\n                prefixByType[type],\r\n                data\r\n            );\r\n\r\n            return data;\r\n        },\r\n\r\n        getConvertedInternalData: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            return self.selectedCategories;\r\n        },\r\n\r\n        setCategoryToInternalData: function (type, prefix, data) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            data[prefix + 'mode'] = 0;\r\n            data[prefix + 'id'] = null;\r\n            data[prefix + 'attribute'] = null;\r\n\r\n            if (typeof self.selectedCategories[type] != 'undefined' &&\r\n                typeof self.selectedCategories[type]['mode'] != 'undefined') {\r\n\r\n                data[prefix + 'mode'] = self.selectedCategories[type].mode;\r\n\r\n                if (data[prefix + 'mode'] == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_EBAY')) {\r\n                    data[prefix + 'id'] = self.selectedCategories[type].value;\r\n                } else if (data[prefix + 'mode'] == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_ATTRIBUTE')) {\r\n                    data[prefix + 'attribute'] = self.selectedCategories[type].value;\r\n                }\r\n            }\r\n\r\n            return data;\r\n        },\r\n\r\n        getCategoryTitle: function (type) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (typeof self.categoryTitles[type] == 'undefined') {\r\n                return '';\r\n            }\r\n\r\n            return self.categoryTitles[type];\r\n        },\r\n\r\n        setCategoryTitles: function (titles) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.categoryTitles = titles;\r\n        },\r\n\r\n        setIsWizardMode: function (mode) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.isWizardMode = mode;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showEditPopUp: function (type) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n            var selected = self.getSelectedCategory(type);\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getChooserEditHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    account_id: self.accountId,\r\n                    category_type: type,\r\n                    selected_mode: selected.mode,\r\n                    selected_value: selected.value,\r\n                    selected_path: selected.path\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var title = M2ePro.translator.translate('Edit') + ' ' + self.getCategoryTitle(type);\r\n\r\n                    self.openPopUp(title, transport.responseText);\r\n                    self.renderRecent();\r\n                    self.renderAttributes();\r\n                }\r\n            });\r\n        },\r\n\r\n        openPopUp: function (title, html) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if ($('chooser_container')) {\r\n                $('chooser_container').remove();\r\n            }\r\n\r\n            $('html-body').insert({bottom: html});\r\n\r\n            var content = jQuery('#chooser_container');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                closed: function(){\r\n                    var type = $('category_type').value;\r\n\r\n                    delete self.tempSelectedCategory[type];\r\n                    delete self.tempUnselectedCategory[type];\r\n                },\r\n                buttons: [{\r\n                    text : M2ePro.translator.translate('Cancel'),\r\n                    click : function () {\r\n                        EbayListingProductCategorySettingsChooserObj.cancelPopUp();\r\n                    }\r\n                },{\r\n                    class : 'action primary',\r\n                    text : M2ePro.translator.translate('Confirm'),\r\n                    click : function () {\r\n                        EbayListingProductCategorySettingsChooserObj.confirmCategory();\r\n                    }\r\n                }]\r\n            }, content);\r\n\r\n            content.modal('openModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        cancelPopUp: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            jQuery('#chooser_container').modal('closeModal');\r\n\r\n            if (typeof self.cancelCallback == 'function') {\r\n                self.cancelCallback();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        selectCategory: function (mode, value) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var type = $('category_type').value;\r\n\r\n            self.tempSelectedCategory[type] = {\r\n                mode: mode,\r\n                value: value\r\n            };\r\n            delete self.tempUnselectedCategory[type];\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getPath'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    account_id: self.accountId,\r\n                    value: value,\r\n                    mode: mode,\r\n                    category_type: type\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('selected_category_path').innerHTML = transport.responseText;\r\n                    $('category_reset_link').show();\r\n                }\r\n            });\r\n        },\r\n\r\n        unSelectCategory: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var type = $('category_type').value;\r\n            self.tempUnselectedCategory[type] = true;\r\n            delete self.tempSelectedCategory[type];\r\n\r\n            $('selected_category_path').innerHTML = '';\r\n            $('category_reset_link').hide();\r\n            $('selected_category_path').innerHTML = '<span style=\"color: grey; font-style: italic\">' + M2ePro.translator.translate('Not Selected') + '</span>';\r\n        },\r\n\r\n        isCategoryTemporarySelected: function (type) {\r\n            return typeof this.tempSelectedCategory[type] != 'undefined'\r\n                && typeof this.tempSelectedCategory[type].mode != 'undefined'\r\n                && this.tempSelectedCategory[type].mode != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_NONE');\r\n        },\r\n\r\n        isCategoryTemporaryUnselected: function (type) {\r\n            return typeof this.tempUnselectedCategory[type] != 'undefined';\r\n        },\r\n\r\n        isCategorySelected: function (type) {\r\n            return typeof this.selectedCategories[type] != 'undefined'\r\n                && typeof this.selectedCategories[type].mode != 'undefined'\r\n                && this.selectedCategories[type].mode != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_NONE');\r\n        },\r\n\r\n        isCategoryValidationRequired: function (type) {\r\n            return typeof this.categoriesRequiringValidation[type] != 'undefined' && this.categoriesRequiringValidation[type];\r\n        },\r\n\r\n        confirmCategory: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n            var type = $('category_type').value;\r\n\r\n            $('category_validation').value = this.isCategoryTemporarySelected(type) ? 1 :\r\n                (this.isCategorySelected(type) && !this.isCategoryTemporaryUnselected(type)) ? 1 : '';\r\n\r\n            if (this.isCategoryValidationRequired(type) && !Validation.validate($('category_validation'))) {\r\n                return;\r\n            }\r\n\r\n            if (typeof self.tempSelectedCategory[type] != 'undefined') {\r\n                self.selectedCategories[type] = self.tempSelectedCategory[type];\r\n\r\n                if (type == 0 && this.selectCallback != null) {\r\n                    (this.selectCallback)(self.selectedCategories[type].mode, self.selectedCategories[type].value);\r\n                }\r\n            }\r\n\r\n            if (typeof self.tempUnselectedCategory[type] != 'undefined') {\r\n                delete self.selectedCategories[type];\r\n\r\n                if (this.unselectCallback != null) {\r\n                    (this.unselectCallback)();\r\n                }\r\n            }\r\n\r\n            delete self.tempSelectedCategory[type];\r\n            delete self.tempUnselectedCategory[type];\r\n\r\n            jQuery('#chooser_container').modal('closeModal');\r\n\r\n            self.reload();\r\n\r\n            if (typeof self.doneCallback == 'function') {\r\n                self.doneCallback();\r\n            }\r\n        },\r\n\r\n        reload: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var selectedCategories = {};\r\n            var types = [\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN'),\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_SECONDARY'),\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_MAIN'),\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_SECONDARY')\r\n            ];\r\n\r\n            types.each(function (type) {\r\n                if (typeof self.selectedCategories[type] == 'undefined') {\r\n                    selectedCategories[type] = null;\r\n                } else {\r\n                    selectedCategories[type] = self.selectedCategories[type];\r\n                }\r\n            });\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getChooserHtml'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    account_id: self.accountId,\r\n                    div_id: self.divId,\r\n                    selected_categories: Object.toJSON(selectedCategories),\r\n                    is_single_category_mode: self.isSingleCategoryMode,\r\n                    single_category_type: self.singleCategoryType,\r\n                    is_show_edit_links: self.isShowEditLinks,\r\n                    select_callback: self.selectCallback,\r\n                    unselect_callback: self.unselectCallback\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if ($(self.divId)) {\r\n                        $(self.divId).innerHTML = transport.responseText;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        reloadPopUp: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var type = $('category_type').value;\r\n            self.showEditPopUp(type);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderAttributes: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (!$('chooser_attributes_table')) {\r\n                return;\r\n            }\r\n\r\n            var handlerObj = new AttributeCreator('category_chooser_' + this.marketplaceId +'_'+ this.accountId +'_'+ this.divId);\r\n            handlerObj.setOnSuccessCallback(function(attributeParams, result) {\r\n\r\n                $$('#chooser_attributes_table tbody').first().update();\r\n\r\n                self.attributes.push({\r\n                    code:  attributeParams.code,\r\n                    label: attributeParams.store_label\r\n                });\r\n                self.renderAttributes();\r\n                self.selectCategory(M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category::CATEGORY_MODE_ATTRIBUTE'), attributeParams.code);\r\n            });\r\n\r\n            handlerObj.setOnFailedCallback(function(attributeParams, result) {\r\n                self.alert(result['error']);\r\n            });\r\n\r\n            var totalHtml = '',\r\n                rowHtml   = '',\r\n                newAttrHtml = '<td style=\"color: brown\">'+M2ePro.translator.translate('Create a New One...')+'</td>' +\r\n                    '<td style=\"padding-left: 55px\"><a href=\"javascript:void(0)\" ' +\r\n                    'onclick=\"' + handlerObj.id + '.showPopup({\\'allowed_attribute_types\\':\\'text,select\\'});\">' +\r\n                    M2ePro.translator.translate('Select') + '</a></td>';\r\n\r\n            self.attributes.each(function (attribute, index) {\r\n\r\n                rowHtml += '<td>' + attribute.label + '</td>' +\r\n                    '<td style=\"padding-left: 55px\"><a href=\"javascript:void(0)\" ' +\r\n                    'onclick=\"EbayListingProductCategorySettingsChooserObj.selectCategory(' + M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_ATTRIBUTE') + ', \\'' + attribute.code + '\\')\">' +\r\n                    M2ePro.translator.translate('Select') + '</a></td>';\r\n\r\n                if ((index + 1) == self.attributes.length && (index + 1) % 2 != 0) {\r\n                    rowHtml += newAttrHtml;\r\n                }\r\n\r\n                if (((index + 1) % 2 == 0) ||\r\n                    (index + 1) == self.attributes.length) {\r\n\r\n                    totalHtml += '<tr>' + rowHtml + '</tr>';\r\n                    rowHtml = '';\r\n                }\r\n\r\n                if ((index + 1) == self.attributes.length && (index + 1) % 2 == 0) {\r\n                    totalHtml += '<tr>' + newAttrHtml + '</tr>';\r\n                }\r\n            });\r\n\r\n            $$('#chooser_attributes_table tbody').first().insert(totalHtml);\r\n        },\r\n\r\n        renderRecent: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (!$('chooser_recent_table')) {\r\n                return;\r\n            }\r\n\r\n            var type = $('category_type').value;\r\n\r\n            var selected = null;\r\n            if (typeof self.selectedCategories[type] != \"undefined\" &&\r\n                self.selectedCategories[type].mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_EBAY')) {\r\n\r\n                selected = self.selectedCategories[type].value;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getRecent'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace: self.marketplaceId,\r\n                    account: self.accountId,\r\n                    selected_category: selected,\r\n                    category_type: type\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var categories = transport.responseText.evalJSON();\r\n                    var html = '';\r\n\r\n                    if (transport.responseText.length > 2) {\r\n                        categories.each(function (category) {\r\n                            html += '<tr><td>' + category.path + '</td>' +\r\n                                '<td><a href=\"javascript:void(0)\" ' +\r\n                                'onclick=\"EbayListingProductCategorySettingsChooserObj.selectCategory(' + M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_EBAY') + ', \\'' + category.id + '\\')\">' +\r\n                                M2ePro.translator.translate('Select') + '</a></td></tr>';\r\n                        });\r\n                    } else {\r\n                        html += '<tr><td colspan=\"2\" style=\"padding-left: 200px\"><strong>' + M2ePro.translator.translate('No recently used Categories') + '</strong></td></tr>';\r\n                    }\r\n\r\n                    $('chooser_recent_table').innerHTML = html;\r\n                }\r\n            });\r\n        },\r\n\r\n        search: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var query = $('query').value;\r\n            if (query.length < 3) {\r\n                return;\r\n            }\r\n\r\n            var type = $('category_type').value;\r\n            $('chooser_search_results').innerHTML = '';\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/search'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    account_id: self.accountId,\r\n                    query: query,\r\n                    category_type: type\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var html = '<table id=\"search_results_table\">';\r\n\r\n                    if (transport.responseText.length > 2) {\r\n                        var result = transport.responseText.evalJSON();\r\n                        result.each(function (category) {\r\n                            html += '<tr><td style=\"padding: 2px;\">';\r\n                            html += category.titles + ' (' + category.id + ')';\r\n                            html += '</td><td style=\"padding: 2px;\">';\r\n                            html += '<a href=\"javascript:void(0)\" ' +\r\n                                'onclick=\"EbayListingProductCategorySettingsChooserObj.selectCategory(' + M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_EBAY') + ', ' + category.id + ')\">' +\r\n                                M2ePro.translator.translate('Select') + '</a>';\r\n                            html += '</td>';\r\n                        });\r\n                    } else {\r\n                        html += '<tr><td colspan=\"2\" style=\"text-align: center;\"><strong>' + M2ePro.translator.translate('No results') + '</strong></td></tr>';\r\n\r\n                        var refreshMessage = '';\r\n\r\n                        if (!self.isWizardMode) {\r\n\r\n                            if ($('category_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN') ||\r\n                                $('category_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_SECONDARY')\r\n                            ) {\r\n                                refreshMessage = M2ePro.translator.translate('Try to <a href=\"javascript:void(0)\" onclick=\"EbayListingProductCategorySettingsChooserObj.refreshEbayCategories()\">update Marketplaces Data</a> and repeate the Search.');\r\n                            } else {\r\n                                refreshMessage = M2ePro.translator.translate('Try to <a href=\"javascript:void(0)\" onclick=\"EbayListingProductCategorySettingsChooserObj.refreshStoreCategories()\">refresh eBay Store Data</a> and repeate the Search.');\r\n                            }\r\n                        }\r\n\r\n                        html += '<tr><td colspan=\"2\" style=\"text-align: center;\">' + refreshMessage + '</td></tr>';\r\n                    }\r\n\r\n                    html += '</table>';\r\n\r\n                    $('chooser_search_results').innerHTML = html;\r\n                }\r\n            });\r\n        },\r\n\r\n        searchReset: function () {\r\n            $('chooser_search_results').update();\r\n            $('query').value = '';\r\n            $('query').focus();\r\n        },\r\n\r\n        refreshStoreCategories: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (self.accountId == null) {\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/refreshStoreCategories'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    account_id: self.accountId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    EbayListingProductCategorySettingsChooserTabsBrowseObj.renderTopLevelCategories('chooser_browser');\r\n\r\n                    if ($('query').value.length != 0) {\r\n                        self.search();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        refreshEbayCategories: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n            var win = window.open(M2ePro.url.get('ebay_marketplace/index'));\r\n\r\n            var intervalId = setInterval(function () {\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                EbayListingProductCategorySettingsChooserTabsBrowseObj.renderTopLevelCategories('chooser_browser');\r\n\r\n                if ($('query').value.length != 0) {\r\n                    self.search();\r\n                }\r\n            }, 1000);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validate: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n            var mainStore = false;\r\n\r\n            if ($$('#' + self.divId + ' .main-empty-advice').length <= 0) {\r\n                return true;\r\n            }\r\n\r\n            if ($$('.main-store-empty-advice').length > 0) {\r\n                mainStore = true;\r\n            }\r\n\r\n            $$('#' + self.divId + ' .main-empty-advice')[0].hide();\r\n            if (mainStore) {\r\n                $$('.main-store-empty-advice')[0].hide();\r\n            }\r\n\r\n            var typeEbayMain = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN');\r\n            if (typeof self.selectedCategories[typeEbayMain] == 'undefined' ||\r\n                typeof self.selectedCategories[typeEbayMain]['mode'] == 'undefined' ||\r\n                self.selectedCategories[typeEbayMain]['mode'] == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_NONE')) {\r\n\r\n                $$('#' + self.divId + ' .main-empty-advice')[0].show();\r\n                return false;\r\n            }\r\n\r\n            if (!mainStore) {\r\n                return true;\r\n            }\r\n\r\n            var primary = $('magento_block_ebay_listing_category_chooser_store_primary_not_selected') == null;\r\n            var secondary = $('magento_block_ebay_listing_category_chooser_store_secondary_not_selected') == null;\r\n\r\n            if (primary == false && secondary == true) {\r\n                $$('.main-store-empty-advice')[0].show();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        keyPressQuery: function (event) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (event.keyCode == 13) {\r\n                self.search();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        submitData: function (url) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (!self.validate()) {\r\n                return;\r\n            }\r\n\r\n            var categoryData = self.getInternalData();\r\n\r\n            self.postForm(url, {category_data: Object.toJSON(categoryData)});\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingProductCategorySettingsGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n\r\n                editCategoriesAction: function (id) {\r\n\r\n                    id && this.selectByRowId(id);\r\n                    this.editCategories();\r\n\r\n                }.bind(this),\r\n\r\n                editPrimaryCategoriesAction: function (id) {\r\n\r\n                    id && this.selectByRowId(id);\r\n                    this.editPrimaryCategories();\r\n\r\n                }.bind(this),\r\n\r\n                editStorePrimaryCategoriesAction: function (id) {\r\n\r\n                    id && this.selectByRowId(id);\r\n                    this.editStorePrimaryCategories();\r\n\r\n                }.bind(this)\r\n\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editPrimaryCategories: function () {\r\n            alert('abstract editPrimaryCategories');\r\n        },\r\n\r\n        editStorePrimaryCategories: function () {\r\n            alert('abstract editPrimaryCategories');\r\n        },\r\n\r\n        editCategoriesByType: function (type, validationRequired) {\r\n            validationRequired = validationRequired || false;\r\n\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/getChooserBlockHtml'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    products_ids: this.getSelectedProductsString()\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var temp = document.createElement('div');\r\n                    temp.innerHTML = transport.responseText;\r\n                    temp.innerHTML.evalScripts();\r\n\r\n                    setTimeout(function go() {\r\n                        if (typeof EbayListingProductCategorySettingsChooserObj == 'undefined') {\r\n                            setTimeout(go, 50);\r\n                        } else {\r\n                            EbayListingProductCategorySettingsChooserObj.showEditPopUp(type);\r\n\r\n                            validationRequired && (EbayListingProductCategorySettingsChooserObj.categoriesRequiringValidation[type] = true);\r\n\r\n                            EbayListingProductCategorySettingsChooserObj.doneCallback = function () {\r\n                                self.saveCategoriesData(EbayListingProductCategorySettingsChooserObj.getInternalDataByType(type));\r\n\r\n                                EbayListingProductCategorySettingsChooserObj.doneCallback = null;\r\n                                EbayListingProductCategorySettingsChooserObj.cancelCallback = null;\r\n\r\n                                validationRequired && (delete EbayListingProductCategorySettingsChooserObj.categoriesRequiringValidation[type]);\r\n                            };\r\n\r\n                            EbayListingProductCategorySettingsChooserObj.cancelCallback = function () {\r\n                                self.unselectAll();\r\n\r\n                                EbayListingProductCategorySettingsChooserObj.doneCallback = null;\r\n                                EbayListingProductCategorySettingsChooserObj.cancelCallback = null;\r\n\r\n                                validationRequired && (delete EbayListingProductCategorySettingsChooserObj.categoriesRequiringValidation[type]);\r\n                            };\r\n                        }\r\n                    }, 50);\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        saveCategoriesData: function (templateData) {\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoSaveToSession'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: this.getSelectedProductsString(),\r\n                    template_data: Object.toJSON(templateData)\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    this.unselectAll();\r\n                    this.getGridObj().doFilter();\r\n\r\n                    jQuery('#m2epro-popup').modal('closeModal');\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editCategories: function () {\r\n            alert('abstract editCategories');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function () {\r\n            return 'ebay';\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Mode.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal'\r\n], function (jQuery, modal) {\r\n\r\n    window.EbayListingProductCategorySettingsMode = Class.create();\r\n    EbayListingProductCategorySettingsMode.prototype = {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (lastModeValue) {\r\n\r\n            $$('input[name=\"mode\"]').each(function(element) {\r\n                element.observe('change', function() {\r\n                    var modeSameRememberCheckbox = $('mode_same_remember_checkbox');\r\n                    modeSameRememberCheckbox.checked = false;\r\n                    modeSameRememberCheckbox.disabled = true;\r\n                    this.value == 'same' && (modeSameRememberCheckbox.disabled = false);\r\n                })\r\n            });\r\n\r\n            var modeElement = $$('input[value=\"'+lastModeValue+'\"]').shift();\r\n\r\n            modeElement.checked = true;\r\n            modeElement.simulate('change');\r\n\r\n            $('mode_same_remember_checkbox').observe('click', function(event) {\r\n\r\n                if (!this.checked) {\r\n                    return;\r\n                }\r\n\r\n                event.preventDefault();\r\n\r\n                var content = jQuery('#mode_same_remember_pop_up_content');\r\n\r\n                modal({\r\n                    title: M2ePro.translator.translate('Apply Settings'),\r\n                    type: 'popup',\r\n                    buttons: [{\r\n                        text: M2ePro.translator.translate('Cancel'),\r\n                        class: 'action-secondary action-dismiss',\r\n                        click: function () {\r\n                            content.modal('closeModal');\r\n                        }\r\n                    },{\r\n                        text: M2ePro.translator.translate('Continue'),\r\n                        class: 'action-primary action-accept',\r\n                        click: function () {\r\n                            $('categories_mode_form').submit();\r\n                        }\r\n                    }]\r\n                }, content);\r\n\r\n                content.modal('openModal');\r\n            });\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n    };\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Specific.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.EbayListingProductCategorySettingsSpecific = Class.create();\r\n    EbayListingProductCategorySettingsSpecific.prototype = Object.extend(new Common(), {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (marketplaceId, categoryMode, categoryValue, uniqId) {\r\n            this.marketplaceId = marketplaceId;\r\n            this.categoryMode = categoryMode;\r\n            this.categoryValue = categoryValue;\r\n\r\n            this.maxSelectedSpecifics = 25;\r\n\r\n            this.valuesCounter = 0;\r\n            this.counter = 0;\r\n            this.uniqId = uniqId || '';\r\n\r\n            this.attributes = [];\r\n            this.attributeOptions = '';\r\n\r\n            this.dictionarySpecifics = [];\r\n            this.ebaySelectedSpecifics = [];\r\n            this.customSelectedSpecifics = [];\r\n\r\n            this.specificsJson = [];\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setAttributes: function (attributes) {\r\n            this.attributes = attributes;\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setDictionarySpecifics: function (specifics) {\r\n            this.dictionarySpecifics = specifics;\r\n            return this;\r\n        },\r\n\r\n        setEbaySelectedSpecifics: function (specifics) {\r\n            this.ebaySelectedSpecifics = specifics;\r\n            return this;\r\n        },\r\n\r\n        setCustomSelectedSpecifics: function (specifics) {\r\n            this.customSelectedSpecifics = specifics;\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getItemSpecifics: function () {\r\n            var self = this;\r\n\r\n            var parameters = $(self.uniqId + 'category_specific_form').serialize(true);\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getJsonSpecificsFromPost'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: parameters,\r\n                onSuccess: function (transport) {\r\n                    if (transport.responseText.length != 0) {\r\n                        self.specificsJson = transport.responseText.evalJSON();\r\n                    }\r\n                }\r\n            });\r\n\r\n            return self.specificsJson;\r\n        },\r\n\r\n        getInternalData: function () {\r\n            var self = this;\r\n\r\n            var internalData = $(self.uniqId + 'category_specific_form').serialize(true);\r\n            internalData['specifics'] = self.getItemSpecifics();\r\n\r\n            return internalData;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareAttributes: function () {\r\n            var cachedOptions = '';\r\n            this.attributes.each(function (v) {\r\n                cachedOptions += '<option value=\"' + v.code + '\">' + v.label + '</option>\\n';\r\n            });\r\n\r\n            this.attributeOptions = cachedOptions;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareBeforeRenderSpecifics: function () {\r\n            if (this.categoryMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category::CATEGORY_MODE_EBAY')) {\r\n                $(this.uniqId + 'item_specifics_tbody').innerHTML = '';\r\n\r\n                if ($$('#' + this.uniqId + 'item_specifics_tbody .not-custom').length > 0) {\r\n                    $$('#' + this.uniqId + 'item_specifics_tbody .not-custom').invoke('show');\r\n                }\r\n            } else {\r\n                $$('#' + this.uniqId + 'item_specifics_tbody .not-custom').invoke('hide');\r\n            }\r\n\r\n            $(this.uniqId + 'add_custom_container').show();\r\n\r\n            this.prepareAttributes();\r\n            this.clearSpecifics();\r\n\r\n            if ((this.dictionarySpecifics.length == 0) &&\r\n                (this.customSelectedSpecifics.length == 0)) {\r\n                $(this.uniqId + 'item_specifics_tbody').hide();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        renderSpecifics: function () {\r\n            if (!this.prepareBeforeRenderSpecifics()) {\r\n                return;\r\n            }\r\n\r\n            this.renderDictionarySpecific();\r\n            this.renderCustomSelectedSpecifics();\r\n\r\n            $(this.uniqId + 'item_specifics_tbody').show();\r\n        },\r\n\r\n        renderDictionarySpecific: function () {\r\n            var self = this;\r\n\r\n            self.dictionarySpecifics.each(function (specific) {\r\n\r\n                var counter = self.counter;\r\n                var recommendedOptionsHtml = '';\r\n\r\n                self.addDictionarySpecificRow(specific);\r\n\r\n                if (typeof specific.min_values != 'undefined') {\r\n                    for (var i = 1; i < specific.min_values; i++) {\r\n                        self.addSpecificCustomValueRow(counter);\r\n                    }\r\n                }\r\n\r\n                for (var i = 0; i < specific.values.length; i++) {\r\n                    var recommended = specific.values[i];\r\n                    recommendedOptionsHtml += '<option value=\"%value%\">%label%</option>'\r\n                        .replace(/%value%/, base64_encode(recommended.value))\r\n                        .replace(/%label%/, recommended.value);\r\n                }\r\n\r\n                $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).insert(recommendedOptionsHtml);\r\n                $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).selectedIndex = -1;\r\n\r\n                $(self.uniqId + 'item_specifics_value_custom_attribute_' + counter).insert(self.attributeOptions);\r\n\r\n                var handlerObj = new AttributeCreator(self.uniqId + 'item_specifics_value_custom_attribute_' + counter);\r\n                handlerObj.setSelectObj($(self.uniqId + 'item_specifics_value_custom_attribute_' + counter));\r\n                handlerObj.injectAddOption();\r\n\r\n                var specificValueMode = $(self.uniqId + 'item_specifics_value_mode_' + counter);\r\n\r\n                if (specific.required) {\r\n                    if (specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]').length > 0) {\r\n                        specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]')[0].remove();\r\n                    }\r\n\r\n                    specificValueMode.select('option')[0].selected = 1;\r\n                }\r\n\r\n                if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_TEXT')) {\r\n                    specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]')[0].remove();\r\n                }\r\n\r\n                if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_ONE') ||\r\n                    specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE')) {\r\n                    specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE') + '\"]')[0].remove();\r\n                }\r\n\r\n                if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE') ||\r\n                    specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE_OR_TEXT')) {\r\n                    $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).writeAttribute('multiple', 'true');\r\n                    $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).addClassName('select multiselect admin__control-multiselect');\r\n                    $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).removeClassName('admin__control-select');\r\n\r\n                    var tempOldName = $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).readAttribute('name');\r\n                    $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).writeAttribute('name', tempOldName + '[]');\r\n                }\r\n\r\n                if (specific.values.length < 1) {\r\n                    if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_ONE_OR_TEXT') ||\r\n                        specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE_OR_TEXT')) {\r\n                        specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]')[0].remove();\r\n                    }\r\n                }\r\n\r\n                self.chooseEbaySelectedSpecifics(specific, counter);\r\n\r\n                self.dictionarySpecificModeChange($(self.uniqId + 'item_specifics_value_mode_' + counter));\r\n\r\n                var length = $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr').length;\r\n\r\n                if (typeof specific.min_values != 'undefined' && typeof specific.max_values != 'undefined') {\r\n                    if (specific.max_values > length) {\r\n                        $(self.uniqId + 'add_item_specifics_custom_value_button_' + counter).show();\r\n                    } else {\r\n                        $(self.uniqId + 'add_item_specifics_custom_value_button_' + counter).hide();\r\n                    }\r\n\r\n                    if (length == 1 || specific.min_values >= length) {\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr td.btn_value_remove').invoke('hide');\r\n                    } else {\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr td.btn_value_remove').invoke('show');\r\n                    }\r\n\r\n                } else {\r\n                    if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE') ||\r\n                        specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE_OR_TEXT')) {\r\n                        $(self.uniqId + 'add_item_specifics_custom_value_button_' + counter).show();\r\n                    }\r\n\r\n                    if (length == 1) {\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr td.btn_value_remove').invoke('hide');\r\n                    } else {\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr td.btn_value_remove').invoke('show');\r\n                    }\r\n                }\r\n            });\r\n\r\n        },\r\n\r\n        renderCustomSelectedSpecifics: function () {\r\n            var self = this;\r\n\r\n            this.customSelectedSpecifics.each(function (specific) {\r\n\r\n                var counter = self.counter;\r\n\r\n                self.addCustomSpecificRow();\r\n\r\n                $$('#' + self.uniqId + 'custom_item_specifics_value_mode_' + counter + ' option[value=\"' + specific.value_mode + '\"]')[0].selected = true;\r\n                self.customSelectedSpecificChange($(self.uniqId + 'custom_item_specifics_value_mode_' + counter));\r\n\r\n                if (specific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE')) {\r\n                    $(self.uniqId + 'custom_item_specifics_label_custom_value_' + counter).value = specific.attribute_title;\r\n\r\n                    if (typeof $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' input.item-specific')[0] == 'undefined') {\r\n                        self.addSpecificCustomValueRow(counter);\r\n                    }\r\n\r\n                    $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' input.item-specific')[0]\r\n                        .setValue(specific.value_custom_value[0]);\r\n                }\r\n\r\n                if (specific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                    if ($$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + specific.value_custom_attribute + '\"]').length > 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + specific.value_custom_attribute + '\"]')[0].selected = true;\r\n                    } else {\r\n                        $(self.uniqId + 'item_specifics_value_custom_attribute_' + counter).selectedIndex = -1;\r\n                    }\r\n                }\r\n\r\n                if (specific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_LABEL_ATTRIBUTE')) {\r\n                    $(self.uniqId + 'custom_item_specifics_label_custom_label_attribute_' + counter).value = specific.attribute_title;\r\n                    if ($$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + specific.value_custom_attribute + '\"]').length > 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + specific.value_custom_attribute + '\"]')[0].selected = true;\r\n                    } else {\r\n                        $(self.uniqId + 'item_specifics_value_custom_attribute_' + counter).selectedIndex = -1;\r\n                    }\r\n                }\r\n\r\n                self.customSelectedSpecificChange($(self.uniqId + 'custom_item_specifics_value_mode_' + counter));\r\n            });\r\n        },\r\n\r\n        renderAttributesWithEmptyOption: function (id, insertTo, value, notRequiried) {\r\n            var self = this;\r\n\r\n            var className = notRequiried ? '' : ' class=\"M2ePro-required-when-visible\"';\r\n            var txt = '<select name=\"' + id + '\" id=\"' + id + '\" ' + className + '>\\n';\r\n\r\n            txt += '<option class=\"empty\"></option>\\n';\r\n            txt += self.attributeOptions;\r\n\r\n            if ($(insertTo + '_note') != null && $$('#' + insertTo + '_note').length != 0) {\r\n                $(insertTo).innerHTML = txt + $(insertTo + '_note').innerHTML;\r\n            } else {\r\n                $(insertTo).innerHTML = txt;\r\n            }\r\n\r\n            self.checkAttributesSelect(id, value);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addDictionarySpecificRow: function (specific) {\r\n            var template = $(this.uniqId + 'specific_template').innerHTML;\r\n\r\n            template = template.replace(/%i%/g, this.counter);\r\n            template = template.replace(/%attribute_title%/g, specific.title);\r\n            template = template.replace(/%required%/g, specific.required ? '&nbsp;<span class=\"required\">*</span>' : '');\r\n            template = template.replace(/%relation_mode%/, M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::MODE_ITEM_SPECIFICS'));\r\n\r\n            if (typeof specific.min_values != 'undefined' && typeof specific.max_values != 'undefined') {\r\n                template = template.replace(/%min_values%/g, specific.min_values);\r\n                template = template.replace(/%max_values%/g, specific.max_values);\r\n            } else {\r\n                template = template.replace(/%min_values%/g, specific.required ? 1 : 0);\r\n                if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE') ||\r\n                    specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE_OR_TEXT')) {\r\n                    template = template.replace(/%max_values%/g, 30);\r\n                } else {\r\n                    template = template.replace(/%max_values%/g, 1);\r\n                }\r\n            }\r\n\r\n            $(this.uniqId + 'item_specifics_tbody').insert(template);\r\n\r\n            this.addSpecificCustomValueRow(this.counter);\r\n\r\n            ++this.counter;\r\n        },\r\n\r\n        addCustomSpecificRow: function () {\r\n            var template = $(this.uniqId + 'specific_template').innerHTML;\r\n\r\n            template = template.replace(/%i%/g, this.counter);\r\n            template = template.replace(/%attribute_title%%required%/g, '');\r\n            template = template.replace(/%relation_mode%/g, M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::MODE_CUSTOM_ITEM_SPECIFICS'));\r\n\r\n            template = template.replace(/%min_values%/g, 1);\r\n            template = template.replace(/%max_values%/g, 1);\r\n\r\n            $(this.uniqId + 'item_specifics_tbody').show();\r\n            $(this.uniqId + 'item_specifics_tbody').insert(template);\r\n\r\n            this.addSpecificCustomValueRow(this.counter);\r\n\r\n            var selectId = this.uniqId + 'item_specifics_value_custom_attribute_' + this.counter;\r\n            $(selectId).insert(this.attributeOptions);\r\n\r\n            var handlerObj = new AttributeCreator(selectId);\r\n            handlerObj.setSelectObj($(selectId));\r\n            handlerObj.injectAddOption();\r\n\r\n            $(selectId).show();\r\n\r\n            $(this.uniqId + 'item_specifics_value_mode_' + this.counter).hide();\r\n            $(this.uniqId + 'attribute_title_' + this.counter).hide();\r\n            $(this.uniqId + 'custom_item_specifics_value_mode_' + this.counter).show();\r\n            $(this.uniqId + 'custom_item_specific_remove_button_' + this.counter).show();\r\n            $(this.uniqId + 'specific_' + this.counter + '_row').removeClassName('not-custom');\r\n\r\n            this.checkSpecificsCounter($(this.uniqId + 'custom_item_specifics_value_mode_' + this.counter));\r\n\r\n            ++this.counter;\r\n        },\r\n\r\n        addSpecificCustomValueRow: function (generalCounter) {\r\n            var template = $(this.uniqId + 'specific_custom_value_template').innerHTML;\r\n            template = template.replace(/%i%/g, generalCounter);\r\n            template = template.replace(/%position%/g, this.valuesCounter);\r\n\r\n            $(this.uniqId + 'item_specifics_custom_value_tbody_' + generalCounter).insert(template);\r\n\r\n            ++this.valuesCounter;\r\n        },\r\n\r\n        addItemSpecificsCustomValueRow: function (button) {\r\n            var generalCounter = parseInt(button.getAttribute('data-counter'));\r\n            var tbody = $(this.uniqId + 'item_specifics_custom_value_tbody_' + generalCounter);\r\n\r\n            this.addSpecificCustomValueRow(generalCounter);\r\n\r\n            var valuesCounter = tbody.childElements().length;\r\n\r\n            if (parseInt(tbody.getAttribute('data-max_values')) > valuesCounter) {\r\n                button.show();\r\n            } else {\r\n                button.hide();\r\n            }\r\n\r\n            if (parseInt(tbody.getAttribute('data-min_values')) >= valuesCounter) {\r\n                $$('#' + this.uniqId + 'item_specifics_custom_value_tbody_' + generalCounter + ' tr td.btn_value_remove').invoke('hide');\r\n            } else {\r\n                $$('#' + this.uniqId + 'item_specifics_custom_value_tbody_' + generalCounter + ' tr td.btn_value_remove').invoke('show');\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        chooseEbaySelectedSpecifics: function (specific, counter) {\r\n            var self = this;\r\n\r\n            self.ebaySelectedSpecifics.each(function (selectedSpecific) {\r\n\r\n                if (selectedSpecific.attribute_title != specific.title || !selectedSpecific.value_data) {\r\n                    return;\r\n                }\r\n\r\n                if (selectedSpecific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE')) {\r\n                    $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]')[0].selected = true;\r\n                }\r\n\r\n                if (selectedSpecific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED')) {\r\n                    $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]')[0].selected = true;\r\n                    $$('#' + self.uniqId + 'item_specifics_value_ebay_recommended_' + counter + ' option').each(function (tempOption) {\r\n\r\n                        for (var i = 0; i < selectedSpecific.value_data.length; i++) {\r\n                            var tempSearchValue = base64_encode(selectedSpecific.value_data[i]);\r\n                            if (tempOption.value == tempSearchValue) {\r\n                                tempOption.selected = true;\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n\r\n                if (selectedSpecific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE')) {\r\n                    $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE') + '\"]')[0].selected = true;\r\n\r\n                    var length = selectedSpecific.value_data.length;\r\n                    for (var i = 0; i < length; i++) {\r\n\r\n                        if (typeof $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' input.item-specific')[i] == 'undefined') {\r\n                            self.addSpecificCustomValueRow(counter);\r\n                        }\r\n\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' input.item-specific')[i]\r\n                            .setValue(selectedSpecific.value_data[i]);\r\n                    }\r\n                }\r\n\r\n                if (selectedSpecific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                    if ($$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + selectedSpecific.value_data + '\"]').length != 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE') + '\"]')[0].selected = true;\r\n                        $$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + selectedSpecific.value_data + '\"]')[0].selected = true;\r\n                    } else if ($$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]').length > 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]')[0].selected = true;\r\n                    } else if ($$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]').length > 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]')[0].selected = true;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        dictionarySpecificModeChange: function (select) {\r\n            var self = this;\r\n            var number = select.id.replace(self.uniqId + 'item_specifics_value_mode_', '');\r\n\r\n            $(self.uniqId + 'item_specifics_value_ebay_recommended_' + number,\r\n                self.uniqId + 'item_specifics_custom_value_' + number,\r\n                self.uniqId + 'item_specifics_value_custom_attribute_' + number,\r\n                self.uniqId + 'custom_item_specifics_label_custom_attribute_' + number\r\n            ).invoke('hide');\r\n\r\n            $(self.uniqId + 'attribute_title_' + number).show();\r\n\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED')) {\r\n                $(self.uniqId + 'item_specifics_value_ebay_recommended_' + number).show();\r\n            }\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE')) {\r\n                $(self.uniqId + 'item_specifics_custom_value_' + number).show();\r\n            }\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                $(self.uniqId + 'attribute_title_' + number).show();\r\n                $(self.uniqId + 'custom_item_specifics_label_custom_attribute_' + number).hide();\r\n                $(self.uniqId + 'item_specifics_value_custom_attribute_' + number).show();\r\n            }\r\n\r\n            this.checkSpecificsCounter(select);\r\n            select.up('td').next('td').select('.validation-advice').each(Element.hide);\r\n        },\r\n\r\n        customSelectedSpecificChange: function (select) {\r\n            var self = this;\r\n            var number = select.id.replace(self.uniqId + 'custom_item_specifics_value_mode_', '');\r\n\r\n            $(self.uniqId + 'item_specifics_custom_value_' + number,\r\n                self.uniqId + 'item_specifics_value_custom_attribute_' + number,\r\n                self.uniqId + 'item_specifics_value_ebay_recommended_' + number).invoke('hide');\r\n\r\n            $(self.uniqId + 'custom_item_specifics_label_custom_value_' + number,\r\n                self.uniqId + 'custom_item_specifics_label_custom_label_attribute_' + number,\r\n                self.uniqId + 'custom_item_specifics_label_custom_attribute_' + number).invoke('hide');\r\n\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE')) {\r\n                $(self.uniqId + 'item_specifics_custom_value_' + number).show();\r\n                $(self.uniqId + 'custom_item_specifics_label_custom_value_' + number).show();\r\n            }\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                $(self.uniqId + 'custom_item_specifics_label_custom_attribute_' + number).show();\r\n                $(self.uniqId + 'item_specifics_value_custom_attribute_' + number).show();\r\n            }\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_LABEL_ATTRIBUTE')) {\r\n                $(self.uniqId + 'custom_item_specifics_label_custom_label_attribute_' + number).show();\r\n                $(self.uniqId + 'item_specifics_value_custom_attribute_' + number).show();\r\n            }\r\n\r\n            this.checkSpecificsCounter(select);\r\n            select.up('td').next('td').select('.validation-advice').each(Element.hide);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validate: function () {\r\n            if ($$('.' + this.uniqId + 'not-none').length > this.maxSelectedSpecifics) {\r\n                $(this.uniqId + 'maximum_specifics_error').show();\r\n                return false;\r\n            }\r\n            var form = jQuery('#' + this.uniqId + 'category_specific_form');\r\n            this.initFormValidation(form);\r\n\r\n            return form.valid();\r\n        },\r\n\r\n        checkAttributesSelect: function (id, value) {\r\n            if ($(id)) {\r\n                if (typeof M2ePro.formData[id] != 'undefined') {\r\n                    $(id).value = M2ePro.formData[id];\r\n                }\r\n                if (value) {\r\n                    $(id).value = value;\r\n                }\r\n            }\r\n        },\r\n\r\n        checkSpecificsCounter: function (select) {\r\n            $(this.uniqId + 'maximum_specifics_error').hide();\r\n\r\n            if (select != null) {\r\n                if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE')) {\r\n                    select.removeClassName(this.uniqId + 'not-none');\r\n                } else {\r\n                    select.addClassName(this.uniqId + 'not-none');\r\n                }\r\n            }\r\n\r\n            if ($$('.' + this.uniqId + 'not-none').length >= this.maxSelectedSpecifics) {\r\n                $(this.uniqId + 'add_custom_container').hide();\r\n            } else {\r\n                $(this.uniqId + 'add_custom_container').show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reload: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getSpecificHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    category_mode: self.categoryMode,\r\n                    category_value: self.categoryValue,\r\n                    unique_id: self.uniqId,\r\n                    attributes: self.attributes.join(','),\r\n                    internal_data: $(self.uniqId + 'category_specific_form').serialize(true)\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('category_specific_box' + self.uniqId).innerHTML = transport.responseText;\r\n                }\r\n            });\r\n        },\r\n\r\n        submitData: function (url) {\r\n            var self = this;\r\n\r\n            if (!self.validate()) {\r\n                return;\r\n            }\r\n\r\n            var specificData = self.getInternalData();\r\n\r\n            self.postForm(url, {specific_data: Object.toJSON(specificData)});\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearSpecifics: function () {\r\n            $$('#' + self.uniqId + 'item_specifics_tbody tr').each(Element.remove);\r\n        },\r\n\r\n        removeSpecific: function (button) {\r\n            $(button).up('tr').remove();\r\n            this.checkSpecificsCounter(null);\r\n        },\r\n\r\n        removeItemSpecificsCustomValue: function (button) {\r\n            var tbody = $(button).up('tbody'),\r\n                addBtn = $(button).up('table').next('a');\r\n\r\n            $(button).up('tr').remove();\r\n\r\n            var length = tbody.childElements().length;\r\n\r\n            if (parseInt(tbody.getAttribute('data-max_values')) > length) {\r\n                addBtn.show();\r\n            } else {\r\n                addBtn.hide();\r\n            }\r\n\r\n            if (length == 1 || parseInt(tbody.getAttribute('data-min_values')) >= length) {\r\n                var btnRemove = tbody.getElementsByClassName('btn_value_remove');\r\n                for (var i = 0; i < btnRemove.length; i++) {\r\n                    btnRemove[i].hide();\r\n                }\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Chooser/Tabs/Browse.js":"define([\r\n    'M2ePro/Common'\r\n\r\n], function () {\r\n    window.EbayListingProductCategorySettingsChooserTabsBrowse = Class.create();\r\n    EbayListingProductCategorySettingsChooserTabsBrowse.prototype = Object.extend(new Common(), {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n            this.marketplaceId = null;\r\n            this.observers = {\r\n                \"leaf_selected\": [],\r\n                \"not_leaf_selected\": [],\r\n                \"any_selected\": []\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setMarketplaceId: function (marketplaceId) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n            self.marketplaceId = marketplaceId;\r\n        },\r\n\r\n        getMarketplaceId: function () {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            if (self.marketplaceId === null) {\r\n                self.alert('You must set Site');\r\n            }\r\n\r\n            return self.marketplaceId;\r\n        },\r\n\r\n        getCategoriesSelectElementId: function (categoryId) {\r\n            if (categoryId === null) categoryId = 0;\r\n            return 'category_chooser_select_' + categoryId;\r\n        },\r\n\r\n        getCategoryChildrenElementId: function (categoryId) {\r\n            if (categoryId === null) categoryId = 0;\r\n            return 'category_chooser_children_' + categoryId;\r\n        },\r\n\r\n        getSelectedCategories: function () {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            var categoryId = 0;\r\n            var selectedCategories = [];\r\n            var isLastCategory = false;\r\n\r\n            while (!isLastCategory) {\r\n                var categorySelect = $(self.getCategoriesSelectElementId(categoryId));\r\n                if (!categorySelect || categorySelect.selectedIndex == -1) {\r\n                    break;\r\n                }\r\n\r\n                categoryId = selectedCategories[selectedCategories.length]\r\n                    = categorySelect.options[categorySelect.selectedIndex].value;\r\n\r\n                if (categorySelect.options[categorySelect.selectedIndex].getAttribute('is_leaf') == 1) {\r\n                    isLastCategory = true;\r\n                }\r\n            }\r\n\r\n            return selectedCategories;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderTopLevelCategories: function (containerId) {\r\n            this.prepareDomStructure(null, $(containerId));\r\n            this.renderChildCategories(null);\r\n        },\r\n\r\n        renderChildCategories: function (parentCategoryId) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getChildCategories'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    \"parent_category_id\": parentCategoryId,\r\n                    \"marketplace_id\": self.getMarketplaceId(),\r\n                    \"account_id\": EbayListingProductCategorySettingsChooserObj.getAccountId(),\r\n                    \"category_type\": $('category_type').value\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText.length <= 2) {\r\n                        self.simulate('leaf_selected', self.getSelectedCategories());\r\n                        return;\r\n                    }\r\n\r\n                    var categories = JSON.parse(transport.responseText);\r\n                    var optionsHtml = '';\r\n                    var arrowString = '';\r\n                    categories.each(function (category) {\r\n                        if (parseInt(category.is_leaf) == 0) {\r\n                            arrowString = ' > ';\r\n                        } else {\r\n                            arrowString = '';\r\n                        }\r\n\r\n                        optionsHtml += '<option is_leaf=\"' + category.is_leaf + '\" value=\"' + category.category_id + '\">' +\r\n                            category.title + arrowString +\r\n                            '</option>';\r\n                    });\r\n\r\n                    $(self.getCategoriesSelectElementId(parentCategoryId)).innerHTML = optionsHtml;\r\n                    $(self.getCategoriesSelectElementId(parentCategoryId)).style.display = 'inline-block';\r\n                    $('chooser_browser').scrollLeft = $('chooser_browser').scrollWidth;\r\n                }\r\n            });\r\n        },\r\n\r\n        onSelectCategory: function (select) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            var parentCategoryId = select.id.replace(self.getCategoriesSelectElementId(\"\"), \"\");\r\n            var categoryId = select.options[select.selectedIndex].value;\r\n            var is_leaf = select.options[select.selectedIndex].getAttribute('is_leaf');\r\n\r\n            var selectedCategories = self.getSelectedCategories();\r\n\r\n            var parentDiv = $(self.getCategoryChildrenElementId(parentCategoryId));\r\n            parentDiv.innerHTML = '';\r\n\r\n            self.simulate('any_selected', selectedCategories);\r\n\r\n            if (is_leaf == 1) {\r\n                self.simulate('leaf_selected', selectedCategories);\r\n                return;\r\n            }\r\n\r\n            self.simulate('not_leaf_selected', selectedCategories);\r\n\r\n            self.prepareDomStructure(categoryId, parentDiv);\r\n            self.renderChildCategories(categoryId);\r\n        },\r\n\r\n        prepareDomStructure: function (categoryId, parentDiv) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            var childrenSelect = document.createElement('select');\r\n            childrenSelect.id = self.getCategoriesSelectElementId(categoryId);\r\n            childrenSelect.style.minWidth = '200px';\r\n            childrenSelect.style.maxHeight = 'none';\r\n            childrenSelect.size = 10;\r\n            childrenSelect.className = 'multiselect admin__control-multiselect';\r\n            childrenSelect.onchange = function () {\r\n                EbayListingProductCategorySettingsChooserTabsBrowseObj.onSelectCategory(this);\r\n            };\r\n            childrenSelect.style.display = 'none';\r\n            parentDiv.appendChild(childrenSelect);\r\n\r\n            var childrenDiv = document.createElement('div');\r\n            childrenDiv.id = self.getCategoryChildrenElementId(categoryId);\r\n            childrenDiv.className = 'category-children-block';\r\n            parentDiv.appendChild(childrenDiv);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        observe: function (event, observer) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            if (typeof observer != 'function') {\r\n                self.alert('Observer must be a function!');\r\n                return;\r\n            }\r\n\r\n            if (typeof self.observers[event] == 'undefined') {\r\n                self.alert('Event does not supported!');\r\n                return;\r\n            }\r\n\r\n            self.observers[event][self.observers[event].length] = observer;\r\n        },\r\n\r\n        simulate: function (event, parameters) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            parameters = parameters || null;\r\n\r\n            if (typeof self.observers[event] == 'undefined') {\r\n                self.alert('Event does not supported!');\r\n                return;\r\n            }\r\n\r\n            if (self.observers[event].length == 0) {\r\n                return;\r\n            }\r\n\r\n            self.observers[event].each(function (observer) {\r\n                if (parameters == null) {\r\n                    (observer)();\r\n                } else {\r\n                    (observer)(parameters);\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Mode/Category/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Ebay/Listing/Product/Category/Settings/Grid'\r\n], function (modal, MagentoMessageObj) {\r\n\r\n    window.EbayListingProductCategorySettingsModeCategoryGrid = Class.create(EbayListingProductCategorySettingsGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        editCategories: function () {\r\n            var url = M2ePro.url.get(\r\n                'ebay_listing_product_category_settings/getChooserBlockHtml'\r\n            );\r\n\r\n            new Ajax.Request(url, {\r\n                method: 'get',\r\n                parameters: {\r\n                    ids: this.getSelectedProductsString()\r\n                },\r\n                onSuccess: function (transport) {\r\n                    this.openPopUp(M2ePro.translator.translate('Set eBay Categories'), transport.responseText);\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editPrimaryCategories: function () {\r\n            this.editCategoriesByType(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN'),\r\n                true\r\n            )\r\n        },\r\n\r\n        editStorePrimaryCategories: function () {\r\n            this.editCategoriesByType(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_MAIN'),\r\n                false\r\n            )\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (title, content) {\r\n            var self = this;\r\n\r\n            if (!$('m2epro-popup')) {\r\n                $('html-body').insert({bottom: '<div id=\"m2epro-popup\"></div>'});\r\n            }\r\n\r\n            $('m2epro-popup').update();\r\n            $('m2epro-popup').insert(content);\r\n\r\n            var popup = jQuery('#m2epro-popup');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                closed: function(){\r\n                    $('m2epro-popup').update();\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    click: function () {\r\n                        popup.modal('closeModal');\r\n                        self.unselectAll();\r\n                    }\r\n                },{\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action primary',\r\n                    click: function () {\r\n                        if (!EbayListingProductCategorySettingsChooserObj.validate()) {\r\n                            return;\r\n                        }\r\n\r\n                        self.saveCategoriesData(EbayListingProductCategorySettingsChooserObj.getInternalData());\r\n                        popup.modal('closeModal');\r\n                    }\r\n                }]\r\n            }, popup);\r\n\r\n            popup.modal('openModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validate: function () {\r\n            MagentoMessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoModeCategoryValidate'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.validation == true) {\r\n                        setLocation(M2ePro.url.get('ebay_listing_product_category_settings'));\r\n                    } else {\r\n                        MagentoMessageObj.addErrorMessage(response.message);\r\n                    }\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function (config) {\r\n            if (config.actions && config.actions.confirm) {\r\n                config.actions.confirm();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Mode/Product/Grid.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Ebay/Listing/Product/Category/Settings/Grid'\r\n], function (jQuery, modal, MagentoMessageObj) {\r\n\r\n    window.EbayListingProductCategorySettingsModeProductGrid = Class.create(EbayListingProductCategorySettingsGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        productIdCellIndex: 1,\r\n        productTitleCellIndex: 2,\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function ($super) {\r\n            $super();\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n\r\n                getSuggestedCategoriesAction: function (id) {\r\n                    this.getSuggestedCategories(id);\r\n                }.bind(this),\r\n                resetCategoriesAction: function (id) {\r\n                    this.resetCategories(id);\r\n                }.bind(this),\r\n                removeItemAction: function (id) {\r\n                    this.removeItems(id);\r\n                }.bind(this)\r\n\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSuggestedCategories: function (id) {\r\n            var self = this,\r\n                confirmAction;\r\n\r\n            self.selectedProductsIds = id ? [id] : self.getSelectedProductsArray();\r\n            self.unselectAll();\r\n\r\n            confirmAction = function() {\r\n                EbayListingProductCategorySettingsModeProductSuggestedSearchObj.search(\r\n                    self.selectedProductsIds.join(','), function (searchResult) {\r\n                        self.getGridObj().doFilter();\r\n                        self.selectedProductsIds = [];\r\n\r\n                        MagentoMessageObj.clear();\r\n\r\n                        if (searchResult.failed > 0) {\r\n                            MagentoMessageObj.addErrorMessage(\r\n                                M2ePro.translator.translate('eBay could not assign Categories for %product_title% Products.')\r\n                                    .replace('%product_title%', searchResult.failed)\r\n                            );\r\n                        } else if (searchResult.succeeded > 0) {\r\n                            MagentoMessageObj.addSuccessMessage(\r\n                                M2ePro.translator.translate('Suggested Categories were successfully Received for %product_title% Product(s).')\r\n                                    .replace('%product_title%', searchResult.succeeded)\r\n                            );\r\n                        }\r\n                    }\r\n                );\r\n            };\r\n\r\n            if (id) {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                confirmAction();\r\n            }\r\n        },\r\n\r\n        getSuggestedCategoriesForAll: function () {\r\n            var self = this,\r\n                confirmAction,\r\n                gridIds = self.getGridMassActionObj().getGridIds().split(',');\r\n\r\n            confirmAction = function() {\r\n                self.getGridMassActionObj().selectAll();\r\n                self.getSuggestedCategories();\r\n            };\r\n\r\n            if (gridIds.length > 100) {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                confirmAction();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editPrimaryCategories: function () {\r\n            this.editCategoriesByType(M2ePro.php.constant('Ess_M2ePro_Helper_Component_Ebay_Category::TYPE_EBAY_MAIN'))\r\n        },\r\n\r\n        editStorePrimaryCategories: function () {\r\n            this.editCategoriesByType(M2ePro.php.constant('Ess_M2ePro_Helper_Component_Ebay_Category::TYPE_STORE_MAIN'))\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editCategories: function (id) {\r\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/getChooserBlockHtml'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    ids: this.selectedProductsIds.join(',')\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var title = M2ePro.translator.translate('Set eBay Category for Product(s)');\r\n\r\n                    if (this.selectedProductsIds.length == 1) {\r\n                        var productName = this.getProductNameByRowId(this.selectedProductsIds[0]);\r\n                        title += '&nbsp;\"' + productName + '\"';\r\n                    }\r\n\r\n                    this.showChooserPopup(title, transport.responseText);\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        resetCategories: function (id) {\r\n            var self = this,\r\n                confirmAction;\r\n\r\n            confirmAction = function() {\r\n                self.selectedProductsIds = id ? [id] : self.getSelectedProductsArray();\r\n\r\n                new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoSuggestedReset'), {\r\n                    method: 'post',\r\n                    asynchronous: true,\r\n                    parameters: {\r\n                        products_ids: self.selectedProductsIds.join(',')\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        MagentoMessageObj.clear();\r\n\r\n                        self.getGridObj().doFilter();\r\n                        self.unselectAll();\r\n                    }\r\n                });\r\n            };\r\n\r\n            if (id) {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                confirmAction();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showChooserPopup: function (title, content) {\r\n            var self = this;\r\n\r\n            if (!$('m2epro-popup')) {\r\n                $('html-body').insert({bottom: '<div id=\"m2epro-popup\"></div>'});\r\n            }\r\n\r\n            $('m2epro-popup').update();\r\n            $('m2epro-popup').insert(content);\r\n\r\n            var popup = jQuery('#m2epro-popup');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                closed: function(){\r\n                    self.selectedProductsIds = [];\r\n\r\n                    return true;\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    click: function () {\r\n                        popup.modal('closeModal');\r\n                        self.unselectAll();\r\n                    }\r\n                },{\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action primary',\r\n                    click: function () {\r\n                        if (!self.validate()) {\r\n                            return;\r\n                        }\r\n\r\n                        self.saveCategoriesData(EbayListingProductCategorySettingsChooserObj.getInternalData());\r\n                    }\r\n                }]\r\n            }, popup);\r\n\r\n            popup.modal('openModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        nextStep: function () {\r\n            var self = this;\r\n\r\n            MagentoMessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoModeProductValidate'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {},\r\n                onSuccess: function (transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response['validation']) {\r\n                        return setLocation(M2ePro.url.get('ebay_listing_product_category_settings'));\r\n                    }\r\n\r\n                    if (response['message']) {\r\n                        return MagentoMessageObj.addErrorMessage(response['message']);\r\n                    }\r\n\r\n                    var popup = jQuery('#next_step_warning_popup_content');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Set eBay Category'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                this.closeModal();\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Continue'),\r\n                            class: 'action-primary action-accept forward',\r\n                            id: 'save_popup_button',\r\n                            click: function () {\r\n                                this.closeModal();\r\n                                setLocation(M2ePro.url.get('ebay_listing_product_category_settings'));\r\n                            }\r\n                        }]\r\n                    }, popup);\r\n\r\n                    popup.modal('openModal');\r\n\r\n                    // $('total_count').update(response['total_count']);\r\n                    // $('failed_count').update(response['failed_count']);\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        removeItems: function (id) {\r\n            var self = this,\r\n                confirmAction;\r\n\r\n            confirmAction = function() {\r\n                self.selectedProductsIds = id ? [id] : self.getSelectedProductsArray();\r\n\r\n                var url = M2ePro.url.get('ebay_listing_product_category_settings/stepTwoDeleteProductsModeProduct');\r\n                new Ajax.Request(url, {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        products_ids: self.selectedProductsIds.join(',')\r\n                    },\r\n                    onSuccess: function () {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                });\r\n            };\r\n\r\n            if (id) {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                confirmAction();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function ($super, config) {\r\n            var action = '';\r\n\r\n            $$('select#' + this.gridId + '_massaction-select option').each(function (o) {\r\n                if (o.selected && o.value != '') {\r\n                    action = o.value;\r\n                }\r\n            });\r\n\r\n            $super(config);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validate: function () {\r\n            if ($$('.main-store-empty-advice').length <= 0) {\r\n                return true;\r\n            }\r\n\r\n            $$('.main-store-empty-advice')[0].hide();\r\n\r\n            var primary = $('magento_block_ebay_listing_category_chooser_store_primary_not_selected') == null;\r\n            var secondary = $('magento_block_ebay_listing_category_chooser_store_secondary_not_selected') == null;\r\n\r\n            if (primary == false && secondary == true) {\r\n                $$('.main-store-empty-advice')[0].show();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Mode/Product/SuggestedSearch.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.EbayListingProductCategorySettingsModeProductSuggestedSearch = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        searchResult: {\r\n            failed: 0,\r\n            succeeded: 0\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        resetSearchResult: function () {\r\n            this.searchResult = {\r\n                failed: 0,\r\n                succeeded: 0\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        search: function (products, onComplete) {\r\n            var parts = this.makeProductsParts(products);\r\n\r\n            ProgressBarObj.reset();\r\n            ProgressBarObj.setTitle('Getting Suggested Categories');\r\n            ProgressBarObj.setStatus('Getting Suggested Categories in process. Please wait...');\r\n            ProgressBarObj.show();\r\n\r\n            this.scrollPageToTop();\r\n\r\n            WrapperObj.lock();\r\n\r\n            this.resetSearchResult();\r\n            this.sendPartsProducts(parts, parts.length, onComplete);\r\n        },\r\n\r\n        makeProductsParts: function (products) {\r\n            var productsInPart = 5;\r\n            var productsArray = explode(',', products);\r\n            var parts = [];\r\n\r\n            if (productsArray.length < productsInPart) {\r\n                return parts[0] = productsArray;\r\n            }\r\n\r\n            var result = [];\r\n            for (var i = 0; i < productsArray.length; i++) {\r\n                if (result.length == 0 || result[result.length - 1].length == productsInPart) {\r\n                    result[result.length] = [];\r\n                }\r\n                result[result.length - 1][result[result.length - 1].length] = productsArray[i];\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        sendPartsProducts: function (parts, partsCount, onComplete) {\r\n            if (parts.length == 0) {\r\n                if (typeof onComplete == 'function') {\r\n                    onComplete(this.searchResult);\r\n                }\r\n\r\n                $$('.loading-mask').invoke('setStyle', {visibility: 'visible'});\r\n\r\n                this.resetSearchResult();\r\n                return;\r\n            }\r\n\r\n            var part = parts.splice(0, 1)[0];\r\n            var partString = implode(',', part);\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoGetSuggestedCategory'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    products_ids: partString\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var percents = (100 / partsCount) * (partsCount - parts.length);\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    this.searchResult.failed += response['failed'];\r\n                    this.searchResult.succeeded += response['succeeded'];\r\n\r\n                    if (percents <= 0) {\r\n                        ProgressBarObj.setPercents(0, 0);\r\n                    } else if (percents >= 100) {\r\n                        ProgressBarObj.setPercents(100, 0);\r\n                        ProgressBarObj.setStatus('Suggested Categories has been received.');\r\n                        ProgressBarObj.hide();\r\n                        ProgressBarObj.reset();\r\n\r\n                        WrapperObj.unlock();\r\n                    } else {\r\n                        ProgressBarObj.setPercents(percents, 1);\r\n                    }\r\n\r\n                    setTimeout(function () {\r\n                        this.sendPartsProducts(parts, partsCount, onComplete);\r\n                    }.bind(this), 500);\r\n                }.bind(this)\r\n            });\r\n\r\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Specific/Wrapper.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function (jQuery, modal) {\r\n\r\n    window.EbayListingProductCategorySettingsSpecificWrapper = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (currentCategory, wrapperObj) {\r\n            this.wrapperObj = wrapperObj;\r\n\r\n            this.setCurrentCategory(currentCategory);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        refreshButtons: function () {\r\n            $$('button.specifics_buttons').invoke('hide');\r\n\r\n            if (this.getNextCategory()) {\r\n\r\n                $$('button.next_category_button').invoke('show');\r\n\r\n            } else {\r\n\r\n                $$('button.continue').invoke('show');\r\n\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setCurrentCategory: function (category) {\r\n            $('categories_list').select('li').each(function (li) {\r\n                li.removeClassName('selected');\r\n            });\r\n\r\n            this.currentCategory = category;\r\n            $(category).addClassName('selected');\r\n\r\n            this.refreshButtons();\r\n        },\r\n\r\n        getCurrentCategory: function () {\r\n            return this.currentCategory;\r\n        },\r\n\r\n        getNextCategory: function () {\r\n            var nextLi = $(this.currentCategory).next('li');\r\n\r\n            if (!nextLi) {\r\n                return false;\r\n            }\r\n\r\n            return nextLi.id;\r\n        },\r\n\r\n        getPrevCategory: function () {\r\n            var prevLi = $(this.currentCategory).previous('li');\r\n\r\n            if (!prevLi) {\r\n                return false;\r\n            }\r\n\r\n            return prevLi.id;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderPrevCategory: function () {\r\n            if (!this.getPrevCategory()) {\r\n                var url = M2ePro.url.get('ebay_listing_product_category_settings');\r\n                setLocation(url);\r\n                return;\r\n            }\r\n\r\n            this.getSpecificsData(this.getPrevCategory(), function (transport) {\r\n\r\n                var response = transport.responseText.evalJSON();\r\n\r\n                try {\r\n                    $('specifics_main_container').innerHTML = response.html;\r\n                    $('specifics_main_container').innerHTML.evalScripts();\r\n                } catch (e) {\r\n                }\r\n\r\n            });\r\n        },\r\n\r\n        renderNextCategory: function () {\r\n            if (!EbayListingProductCategorySettingsSpecificObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            if (!!$('skip_optional_specifics').checked) {\r\n                this.lock();\r\n            }\r\n\r\n            if (!this.getNextCategory()) {\r\n                this.unlock();\r\n                return this.showPopup();\r\n            }\r\n\r\n            this.saveCategory(function () {\r\n                this.getSpecificsData(this.getNextCategory(), function (transport) {\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    try {\r\n                        $('specifics_main_container').innerHTML = response.html;\r\n                        $('specifics_main_container').innerHTML.evalScripts();\r\n                    } catch (e) {\r\n                    }\r\n\r\n                    if (!response.hasRequiredSpecifics && !!$('skip_optional_specifics').checked) {\r\n                        this.renderNextCategory();\r\n                    } else {\r\n                        this.unlock();\r\n                    }\r\n\r\n                })\r\n            }.bind(this));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSpecificsData: function (category, callback) {\r\n            var url = M2ePro.url.get('ebay_listing_product_category_settings/stepThreeGetCategorySpecifics');\r\n            new Ajax.Request(url, {\r\n                method: 'get',\r\n                parameters: {\r\n                    category: category\r\n                },\r\n                onSuccess: function (transport) {\r\n                    this.setCurrentCategory(category);\r\n                    callback && callback.call(this, transport);\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveCategory: function (callback) {\r\n            if (!EbayListingProductCategorySettingsSpecificObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            var url = M2ePro.url.get('ebay_listing_product_category_settings/stepThreeSaveCategorySpecificsToSession');\r\n            new Ajax.Request(url, {\r\n                method: 'post',\r\n                parameters: {\r\n                    category: this.getCurrentCategory(),\r\n                    data: Object.toJSON(EbayListingProductCategorySettingsSpecificObj.getInternalData())\r\n                },\r\n                onSuccess: function (transport) {\r\n                    callback.call(this);\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        save: function () {\r\n            if (this.getNextCategory()) {\r\n                return;\r\n            }\r\n\r\n            this.saveCategory(function () {\r\n\r\n                var url = M2ePro.url.get('ebay_listing_product_category_settings/save');\r\n\r\n                new Ajax.Request(url, {\r\n                    method: 'post',\r\n                    onSuccess: function (transport) {\r\n                        setLocation(M2ePro.url.get('ebay_listing/review'))\r\n                    }\r\n                });\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showPopup: function () {\r\n            var self = this;\r\n\r\n            this.popup = jQuery('#popup_content').modal({\r\n                title: M2ePro.translator.translate('Set Item Specifics'),\r\n                type: 'popup',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event, true);\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept forward',\r\n                    click: function () {\r\n                        self.save();\r\n                    }\r\n                }]\r\n            });\r\n\r\n            this.popup.modal('openModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        lock: function () {\r\n            $(this.wrapperObj.wrapperId).visible() || this.wrapperObj.lock();\r\n\r\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n            $(this.wrapperObj.wrapperId).update(\r\n                '<div style=\"height: 46%\"></div>' +\r\n                '<div>' + M2ePro.translator.translate('Loading. Please wait') + ' ...</div>'\r\n            );\r\n        },\r\n\r\n        unlock: function () {\r\n            this.wrapperObj.unlock();\r\n            $$('.loading-mask').invoke('setStyle', {visibility: 'visible'});\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Template/Switcher.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function(jQuery, modal) {\r\n\r\n    window.EbayListingTemplateSwitcher = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        storeId: null,\r\n        marketplaceId: null,\r\n        checkAttributesAvailability: false,\r\n        listingProductIds: '',\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function() {\r\n            jQuery.validator.addMethod('M2ePro-validate-ebay-template-title', function(value, el) {\r\n\r\n                var mode = base64_decode(value).evalJSON().mode;\r\n\r\n                return mode !== null;\r\n            }, M2ePro.translator.translate('This is a required field.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-ebay-template-title', function(value, el) {\r\n\r\n                var templateNick = el.name.substr(0, el.name.indexOf('['));\r\n\r\n                return EbayListingTemplateSwitcherObj.isTemplateTitleUnique(templateNick, value);\r\n            }, M2ePro.translator.translate('Policy with the same Title already exists.'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSwitcherNickByElementId: function(id)\r\n        {\r\n            return id.replace('template_', '');\r\n        },\r\n\r\n        getSwitcherElementId: function(templateNick)\r\n        {\r\n            return 'template_' + templateNick;\r\n        },\r\n\r\n        getSwitcher: function(templateNick)\r\n        {\r\n            return $(this.getSwitcherElementId(templateNick));\r\n        },\r\n\r\n        getSwitcherValueId: function(templateNick)\r\n        {\r\n            var switcher = this.getSwitcher(templateNick);\r\n            var switcherValue = base64_decode(switcher.value).evalJSON();\r\n\r\n            return switcherValue.id;\r\n        },\r\n\r\n        getSwitcherValueMode: function(templateNick)\r\n        {\r\n            var switcher = this.getSwitcher(templateNick);\r\n            var switcherValue = base64_decode(switcher.value).evalJSON();\r\n\r\n            return switcherValue.mode;\r\n        },\r\n\r\n        isSwitcherValueModeEmpty: function(templateNick)\r\n        {\r\n            return this.getSwitcherValueMode(templateNick) === null;\r\n        },\r\n\r\n        isSwitcherValueModeParent: function(templateNick)\r\n        {\r\n            return this.getSwitcherValueMode(templateNick) == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_PARENT');\r\n        },\r\n\r\n        isSwitcherValueModeCustom: function(templateNick)\r\n        {\r\n            return this.getSwitcherValueMode(templateNick) == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_CUSTOM');\r\n        },\r\n\r\n        isSwitcherValueModeTemplate: function(templateNick)\r\n        {\r\n            return this.getSwitcherValueMode(templateNick) == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_TEMPLATE');\r\n        },\r\n\r\n        isExistSynchronizationTab: function()\r\n        {\r\n            return typeof EbayTemplateSynchronizationHandlerObj != 'undefined';\r\n        },\r\n\r\n        isNeededSaveWatermarkImage: function(ajaxResponse)\r\n        {\r\n            var isDescriptionTemplate = false;\r\n\r\n            ajaxResponse.each(function(template) {\r\n                if (template.nick == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::TEMPLATE_DESCRIPTION')) {\r\n                    isDescriptionTemplate = true;\r\n                }\r\n            });\r\n\r\n            return isDescriptionTemplate && $('watermark_image').value != '';\r\n        },\r\n\r\n        getTemplateDataContainer: function(templateNick)\r\n        {\r\n            return $('template_' + templateNick + '_data_container');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        change: function()\r\n        {\r\n            var templateNick = EbayListingTemplateSwitcherObj.getSwitcherNickByElementId(this.id);\r\n            var templateMode = EbayListingTemplateSwitcherObj.getSwitcherValueMode(templateNick);\r\n\r\n            EbayListingTemplateSwitcherObj.clearMessages(templateNick);\r\n\r\n            switch (templateMode) {\r\n                case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_PARENT'):\r\n                    EbayListingTemplateSwitcherObj.clearContent(templateNick);\r\n                    break;\r\n\r\n                case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_CUSTOM'):\r\n                    EbayListingTemplateSwitcherObj.reloadContent(templateNick);\r\n                    break;\r\n\r\n                case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_TEMPLATE'):\r\n                    EbayListingTemplateSwitcherObj.clearContent(templateNick);\r\n                    EbayListingTemplateSwitcherObj.checkMessages(templateNick);\r\n                    break;\r\n            }\r\n\r\n            EbayListingTemplateSwitcherObj.hideEmptyOption(EbayListingTemplateSwitcherObj.getSwitcher(templateNick));\r\n\r\n            if (!EbayListingTemplateSwitcherObj.isSwitcherValueModeCustom(templateNick)) {\r\n                EbayListingTemplateSwitcherObj.updateButtonsVisibility(templateNick);\r\n                EbayListingTemplateSwitcherObj.updateEditVisibility(templateNick);\r\n                EbayListingTemplateSwitcherObj.updateTemplateLabelVisibility(templateNick);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearMessages: function(templateNick)\r\n        {\r\n            $('template_switcher_' + templateNick + '_messages').innerHTML = '';\r\n        },\r\n\r\n        checkMessages: function(templateNick)\r\n        {\r\n            if (!this.checkAttributesAvailability &&\r\n                templateNick != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::TEMPLATE_SELLING_FORMAT') &&\r\n                templateNick != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::TEMPLATE_SHIPPING')\r\n            ) {\r\n                return;\r\n            }\r\n\r\n            var // template ID\r\n                id = this.getSwitcherValueId(templateNick),\r\n            // template nick\r\n                nick = templateNick,\r\n            // template data (for custom settings only) and listing product ids (only when we edit product settings)\r\n                data = Form.serialize(this.getTemplateDataContainer(templateNick).id)\r\n                    + '&listing_product_ids=' + this.listingProductIds,\r\n            // store ID of the listing\r\n                storeId = this.storeId,\r\n            // marketplace ID of the listing\r\n                marketplaceId = this.marketplaceId,\r\n            // do we need to check attributes availability (only when we edit product settings)\r\n                checkAttributesAvailability = this.checkAttributesAvailability,\r\n            // container, where messages should be displayed\r\n                container = 'template_switcher_' + templateNick + '_messages',\r\n            // callback function, which should be called, when messages are displayed\r\n                callback = function() {\r\n                    var refresh = $(container).down('a.refresh-messages');\r\n                    if (refresh) {\r\n                        refresh.observe('click', function() {\r\n                            this.checkMessages(templateNick);\r\n                        }.bind(this))\r\n                    }\r\n                }.bind(this);\r\n\r\n            TemplateHandlerObj.checkMessages(\r\n                id,\r\n                nick,\r\n                data,\r\n                storeId,\r\n                marketplaceId,\r\n                checkAttributesAvailability,\r\n                container,\r\n                callback\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        updateEditVisibility: function(templateNick)\r\n        {\r\n            var tdEdit = $('template_' + templateNick + '_edit');\r\n\r\n            if (!tdEdit) {\r\n                return;\r\n            }\r\n\r\n            if (this.isSwitcherValueModeTemplate(templateNick)) {\r\n                tdEdit.show();\r\n            } else {\r\n                tdEdit.hide();\r\n            }\r\n        },\r\n\r\n        updateButtonsVisibility: function(templateNick)\r\n        {\r\n            var divButtonsContainer = $('template_' + templateNick + '_buttons_container');\r\n\r\n            if (!divButtonsContainer) {\r\n                return;\r\n            }\r\n\r\n            if (this.isSwitcherValueModeCustom(templateNick)) {\r\n                divButtonsContainer.show();\r\n            } else {\r\n                divButtonsContainer.hide();\r\n            }\r\n        },\r\n\r\n        updateTemplateLabelVisibility: function(templateNick)\r\n        {\r\n            var labelContainer = $('template_' + templateNick + '_nick_label');\r\n            var templateLabel = labelContainer.down('span.template');\r\n\r\n            labelContainer.hide();\r\n            templateLabel && templateLabel.hide();\r\n\r\n            if (this.isSwitcherValueModeTemplate(templateNick)) {\r\n                labelContainer.show();\r\n                templateLabel && templateLabel.show();\r\n            }\r\n\r\n            if (this.isSwitcherValueModeEmpty(templateNick)) {\r\n                labelContainer.hide();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        scrollToFirstFailedElement: function()\r\n        {\r\n            var errors = $$('label.mage-error');\r\n\r\n            // if (errors.length > 0) {\r\n            //     $('#ebayListingTemplateEditTabs').showTabContent(errors[0]);\r\n            // }\r\n\r\n            // errors[0].up('table').scrollIntoView();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveSwitchers: function(callback)\r\n        {\r\n            var validationResult = jQuery('#edit_form').valid();\r\n\r\n            if (EbayListingTemplateSwitcherObj.isExistSynchronizationTab()) {\r\n                EbayTemplateSynchronizationHandlerObj.checkVirtualTabValidation();\r\n            }\r\n\r\n            if (!validationResult) {\r\n                EbayListingTemplateSwitcherObj.scrollToFirstFailedElement();\r\n                return;\r\n            }\r\n\r\n            $('edit_form').request({\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {},\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    response.each(function(template) {\r\n                        EbayListingTemplateSwitcherObj.afterCustomSaveAsTemplate(template.nick, template.id, template.title);\r\n                    });\r\n\r\n                    var params = {};\r\n\r\n                    $$('.template-switcher').each(function(switcher) {\r\n                        params[switcher.name] = switcher.value;\r\n                    });\r\n\r\n                    if ($('ebayListingTemplateEditTabs')) {\r\n                        params['tab'] = jQuery('#ebayListingTemplateEditTabs').data().tabs.active.find('a')[0].id.split('_').pop();\r\n                    }\r\n\r\n                    if (EbayListingTemplateSwitcherObj.isNeededSaveWatermarkImage(response)) {\r\n                        EbayTemplateDescriptionObj.saveWatermarkImage(callback, params);\r\n                    } else if (typeof callback == 'function') {\r\n                        callback(params);\r\n                    }\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isTemplateTitleUnique: function(templateNick, templateTitle)\r\n        {\r\n            var unique = true;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/isTitleUnique'), {\r\n                method: 'get',\r\n                asynchronous: false,\r\n                parameters: {\r\n                    nick: templateNick,\r\n                    title: templateTitle\r\n                },\r\n                onSuccess: function(transport) {\r\n                    unique = transport.responseText.evalJSON()['unique'];\r\n                }\r\n            });\r\n\r\n            return unique;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validateCustomTemplate: function(templateNick)\r\n        {\r\n            var validationResult = $('template_' + templateNick + '_data_container').select('select, input').collect(\r\n                function (el) {\r\n                    return jQuery('#edit_form').form().validate().element(el);\r\n                }\r\n            );\r\n\r\n            if (validationResult.indexOf(false) != -1) {\r\n                EbayListingTemplateSwitcherObj.scrollToFirstFailedElement();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        customSaveAsTemplate: function(templateNick)\r\n        {\r\n            if (!this.validateCustomTemplate(templateNick)) {\r\n                return;\r\n            }\r\n\r\n            // jQuery('#edit_form').valid()\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/newTemplateHtml'), {\r\n                method: 'GET',\r\n                parameters: {\r\n                    nick: templateNick\r\n                },\r\n                onSuccess: (function(transport) {\r\n                    if ($('new_template_form_' + templateNick)) {\r\n                        $('new_template_form_' + templateNick).remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    var form = jQuery('#new_template_form_' + templateNick);\r\n\r\n                    form.form().validation();\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Save as New Policy'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                form.modal('closeModal');\r\n                                $('new_template_form_' + templateNick).remove()\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                if (!form.form().valid()) {\r\n                                    return false;\r\n                                }\r\n\r\n                                $$('input[name=\"' + templateNick + '[id]\"]')[0].value = '';\r\n                                $$('input[name=\"' + templateNick + '[is_custom_template]\"]')[0].value = 0;\r\n                                $$('input[name=\"' + templateNick + '[title]\"]')[0].value = $('template_title_' + templateNick).value;\r\n\r\n                                $('edit_form').request({\r\n                                    method: 'post',\r\n                                    asynchronous: true,\r\n                                    parameters: {\r\n                                        nick: templateNick\r\n                                    },\r\n                                    onSuccess: function(transport) {\r\n\r\n                                        var response = transport.responseText.evalJSON();\r\n\r\n                                        response.each(function(template) {\r\n                                            EbayListingTemplateSwitcherObj.addToSwitcher(template.nick, template.id, template.title);\r\n                                            EbayListingTemplateSwitcherObj.clearContent(template.nick);\r\n                                            EbayListingTemplateSwitcherObj.updateButtonsVisibility(template.nick);\r\n                                            EbayListingTemplateSwitcherObj.updateEditVisibility(template.nick);\r\n                                            EbayListingTemplateSwitcherObj.updateTemplateLabelVisibility(template.nick);\r\n                                            EbayListingTemplateSwitcherHandlerObj.checkMessages(template.nick);\r\n                                        });\r\n                                    }.bind(this)\r\n                                });\r\n\r\n                                form.modal('closeModal');\r\n                            }\r\n                        }]\r\n                    }, form);\r\n\r\n                    form.modal('openModal');\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        afterCustomSaveAsTemplate: function(templateNick, templateId, templateTitle)\r\n        {\r\n            $$('input[name=\"' + templateNick + '[id]\"]')[0].value = templateId;\r\n            $$('input[name=\"' + templateNick + '[title]\"]')[0].value = templateTitle;\r\n\r\n            var switcher = EbayListingTemplateSwitcherObj.getSwitcher(templateNick);\r\n\r\n            switcher.down('.template-switcher-custom-option').value = base64_encode(\r\n                Object.toJSON({\r\n                    mode: M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_CUSTOM'),\r\n                    nick: templateNick,\r\n                    id: templateId\r\n                })\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editTemplate: function(templateNick)\r\n        {\r\n            var templateId = this.getSwitcherValueId(templateNick);\r\n\r\n            window.open(\r\n                M2ePro.url.get('ebay_template/edit', {id: templateId, nick: templateNick, close_on_save: 1}), '_blank'\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        customizeTemplate: function(templateNick)\r\n        {\r\n            this.clearMessages(templateNick);\r\n            this.reloadContent(templateNick, function()\r\n            {\r\n                $$('input[name=\"' + templateNick + '[id]\"]')[0].value = EbayListingTemplateSwitcherObj.getSwitcherValueId(templateNick);\r\n                $$('input[name=\"' + templateNick + '[is_custom_template]\"]')[0].value = 1;\r\n                $$('input[name=\"' + templateNick + '[title]\"]')[0].value += ' [' + M2ePro.translator.translate('Customized') + ']';\r\n            });\r\n            this.getSwitcher(templateNick).selectedIndex = 0;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearContent: function(templateNick)\r\n        {\r\n            this.getTemplateDataContainer(templateNick).innerHTML = '';\r\n            this.getTemplateDataContainer(templateNick).hide();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reloadContent: function(templateNick, callback)\r\n        {\r\n            var id = this.getSwitcherValueId(templateNick);\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/getTemplateHtml'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    id: id,\r\n                    nick: templateNick\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    BlockNoticeObj.initializedBlocks = [];\r\n\r\n                    self.getTemplateDataContainer(templateNick).replace(transport.responseText);\r\n                    self.getTemplateDataContainer(templateNick).show();\r\n\r\n                    self.updateButtonsVisibility(templateNick);\r\n                    self.updateEditVisibility(templateNick);\r\n                    self.updateTemplateLabelVisibility(templateNick);\r\n\r\n                    if (typeof callback == 'function') {\r\n                        callback();\r\n                    }\r\n\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addToSwitcher: function(templateNick, templateId, templateTitle)\r\n        {\r\n            var switcher = this.getSwitcher(templateNick);\r\n            var optionGroup = this.getTemplatesGroup(templateNick);\r\n\r\n            var optionValue = {\r\n                mode: M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_TEMPLATE'),\r\n                nick: templateNick,\r\n                id: templateId\r\n            };\r\n            var option = document.createElement('option');\r\n\r\n            option.value = base64_encode(Object.toJSON(optionValue));\r\n            option.innerHTML = templateTitle;\r\n\r\n            $(optionGroup).appendChild(option);\r\n\r\n            switcher.up('td').show();\r\n            switcher.value = option.value;\r\n        },\r\n\r\n        getTemplatesGroup: function(templateNick)\r\n        {\r\n            var switcher = this.getSwitcher(templateNick);\r\n            var optionGroup = switcher.down('optgroup.templates-group');\r\n\r\n            if (typeof optionGroup != 'undefined') {\r\n                return optionGroup;\r\n            }\r\n\r\n            optionGroup = document.createElement('optgroup');\r\n            optionGroup.className = 'templates-group';\r\n            optionGroup.label = M2ePro.translator.translate('Policies');\r\n\r\n            switcher.appendChild(optionGroup);\r\n\r\n            return optionGroup;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});\r\n","Ess_M2ePro/js/Ebay/Listing/View/Action.js":"define([\r\n    'M2ePro/Listing/View/Action'\r\n], function () {\r\n\r\n    window.EbayListingViewAction = Class.create(ListingViewAction, {\r\n\r\n        // ---------------------------------------\r\n\r\n        startActions: function($super,title,url,selectedProductsParts,requestParams)\r\n        {\r\n            if (typeof requestParams == 'undefined') {\r\n                requestParams = {};\r\n            }\r\n\r\n            if (typeof requestParams['is_realtime'] == 'undefined') {\r\n                requestParams['is_realtime'] = (this.gridHandler.getSelectedProductsArray().length <= 10);\r\n            }\r\n\r\n            $super(title,url,selectedProductsParts,requestParams);\r\n        },\r\n\r\n        stopAction: function()\r\n        {\r\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts(100);\r\n            if (selectedProductsParts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            var requestParams = {'is_realtime': (this.gridHandler.getSelectedProductsArray().length <= 100)};\r\n\r\n            this.startActions(\r\n                M2ePro.translator.translate('stopping_selected_items_message'),\r\n                M2ePro.url.get('ebay_listing/runStopProducts'),\r\n                selectedProductsParts,\r\n                requestParams\r\n            );\r\n        },\r\n\r\n        stopAndRemoveAction: function()\r\n        {\r\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts(100);\r\n            if (selectedProductsParts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            var requestParams = {'is_realtime': (this.gridHandler.getSelectedProductsArray().length <= 100)};\r\n\r\n            this.startActions(\r\n                M2ePro.translator.translate('stopping_and_removing_selected_items_message'),\r\n                M2ePro.url.get('ebay_listing/runStopAndRemoveProducts'),\r\n                selectedProductsParts,\r\n                requestParams\r\n            );\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Grid.js":"define([\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Ebay/Listing/VariationProductManage',\r\n    'M2ePro/Ebay/Listing/View/Action',\r\n    'M2ePro/Ebay/Listing/View/Ebay/Bids'\r\n], function () {\r\n\r\n    window.EbayListingViewGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        selectedProductsIds: [],\r\n        selectedCategoriesData: {},\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function($super)\r\n        {\r\n            this.actionHandler = new EbayListingViewAction(this);\r\n\r\n            this.actions = {\r\n                listAction: this.actionHandler.listAction.bind(this.actionHandler),\r\n                relistAction: this.actionHandler.relistAction.bind(this.actionHandler),\r\n                reviseAction: this.actionHandler.reviseAction.bind(this.actionHandler),\r\n                stopAction: this.actionHandler.stopAction.bind(this.actionHandler),\r\n                stopAndRemoveAction: this.actionHandler.stopAndRemoveAction.bind(this.actionHandler),\r\n                previewItemsAction: this.actionHandler.previewItemsAction.bind(this.actionHandler),\r\n                startTranslateAction: this.actionHandler.startTranslateAction.bind(this.actionHandler),\r\n                stopTranslateAction: this.actionHandler.stopTranslateAction.bind(this.actionHandler)\r\n            };\r\n\r\n            this.variationProductManageHandler = new EbayListingVariationProductManage(this);\r\n            this.listingProductBidsHandler = new EbayListingViewEbayBids(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n\r\n                editCategorySettingsAction: function(id) {\r\n                    this.editCategorySettings(id);\r\n                }.bind(this)\r\n\r\n            });\r\n\r\n        },\r\n\r\n        massActionSubmitClick: function($super)\r\n        {\r\n            if (this.getSelectedProductsString() == '' || this.getSelectedProductsArray().length == 0) {\r\n                this.alert(M2ePro.translator.translate('Please select the Products you want to perform the Action on.'));\r\n                return;\r\n            }\r\n            $super();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editCategorySettings: function(id)\r\n        {\r\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getCategoryChooserHtml'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    product_ids: this.selectedProductsIds.join(',')\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    this.unselectAll();\r\n\r\n                    var title = M2ePro.translator.translate('eBay Categories');\r\n\r\n                    if (this.selectedProductsIds.length == 1) {\r\n                        var productName = this.getProductNameByRowId(this.selectedProductsIds[0]);\r\n                        title += '&nbsp;' + M2ePro.translator.translate('of Product') + '&nbsp;\"' + productName + '\"';\r\n                    }\r\n\r\n                    this.openPopUp(title, transport.responseText);\r\n\r\n                    $('cancel_button').stopObserving('click').observe('click', function() {\r\n                        this.popUp.modal('closeModal');\r\n                    }.bind(this));\r\n\r\n                    $('done_button').stopObserving('click').observe('click', function() {\r\n                        if (!EbayListingProductCategorySettingsChooserObj.validate()) {\r\n                            return;\r\n                        }\r\n\r\n                        this.selectedCategoriesData = EbayListingProductCategorySettingsChooserObj.getInternalData();\r\n                        this.editSpecificSettings();\r\n                    }.bind(this));\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editSpecificSettings: function()\r\n        {\r\n            var typeEbayMain = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN');\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getCategorySpecificHtml'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    ids: this.selectedProductsIds.join(','),\r\n                    category_mode: EbayListingProductCategorySettingsChooserObj.getSelectedCategory(typeEbayMain)['mode'],\r\n                    category_value: EbayListingProductCategorySettingsChooserObj.getSelectedCategory(typeEbayMain)['value']\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var title = M2ePro.translator.translate('Specifics');\r\n\r\n                    this.openPopUp(title, transport.responseText);\r\n\r\n                    $('cancel_button').stopObserving('click').observe('click', function() { this.popUp.modal('closeModal'); }.bind(this));\r\n                    $('done_button').stopObserving('click').observe('click', this.saveCategoryTemplate.bind(this));\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveCategoryTemplate: function()\r\n        {\r\n            if (!EbayListingProductCategorySettingsSpecificObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            var categoryTemplateData = {};\r\n            categoryTemplateData = Object.extend(categoryTemplateData, this.selectedCategoriesData);\r\n            categoryTemplateData = Object.extend(categoryTemplateData, EbayListingProductCategorySettingsSpecificObj.getInternalData());\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing/saveCategoryTemplate'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    ids: this.selectedProductsIds.join(','),\r\n                    template_category_data: Object.toJSON(categoryTemplateData)\r\n                },\r\n                onSuccess: function(transport) {\r\n                    this.popUp.modal('closeModal');\r\n                    this.getGridObj().doFilter();\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function()\r\n        {\r\n            return 'ebay';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function(title, content, params, popupId)\r\n        {\r\n            var self = this;\r\n            params = params || {};\r\n            popupId = popupId || 'modal_view_action_dialog';\r\n\r\n            var modalDialogMessage = $(popupId);\r\n\r\n            if (!modalDialogMessage) {\r\n                modalDialogMessage = new Element('div', {\r\n                    id: popupId\r\n                });\r\n            }\r\n\r\n            modalDialogMessage.innerHTML = '';\r\n\r\n            this.popUp = jQuery(modalDialogMessage).modal(Object.extend({\r\n                title: title,\r\n                type: 'slide',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    attr: {id: 'cancel_button'},\r\n                    class: 'action-dismiss',\r\n                    click: function () {}\r\n                }, {\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    attr: {id: 'done_button'},\r\n                    class: 'action-primary action-accept forward',\r\n                    click: function () {}\r\n                }],\r\n                closed: function() {\r\n                    self.selectedProductsIds = [];\r\n                    self.selectedCategoriesData = {};\r\n\r\n                    self.getGridObj().reload();\r\n\r\n                    return true;\r\n                }\r\n            }, params));\r\n\r\n            this.popUp.modal('openModal');\r\n\r\n            try {\r\n                modalDialogMessage.innerHTML = content;\r\n                modalDialogMessage.innerHTML.evalScripts();\r\n            } catch (ignored) {}\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Ebay/Bids.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function(modal, MessageObj) {\r\n\r\n    window.EbayListingViewEbayBids = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (productId, title) {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getListingProductBids'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_listing_product_bids');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_listing_product_bids\"></div>'});\r\n                    $('ebay_listing_product_bids').update(transport.responseText);\r\n\r\n                    self.listingProductBidsPopup = jQuery('#ebay_listing_product_bids');\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.listingProductBidsPopup.modal('closeModal')\r\n                            }\r\n                        }]\r\n                    }, self.listingProductBidsPopup);\r\n\r\n                    self.listingProductBidsPopup.modal('openModal');\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Ebay/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Ebay/Listing/View/Grid'\r\n], function (modal, MessageObj) {\r\n\r\n    window.EbayListingViewEbayGrid = Class.create(EbayListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function($super)\r\n        {\r\n            $super();\r\n\r\n            $(this.gridId+'_massaction-select').observe('change', function() {\r\n                if (!$('get-estimated-fee')) {\r\n                    return;\r\n                }\r\n\r\n                if (this.value == 'list') {\r\n                    $('get-estimated-fee').show();\r\n                } else {\r\n                    $('get-estimated-fee').hide();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function()\r\n        {\r\n            return 10;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function(rowId)\r\n        {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Product\\\\AbstractGrid::LISTING_PRODUCT_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('ebay_log_listing_product/index', params);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openFeePopUp: function(content, title)\r\n        {\r\n            var feePopup = $('fee_popup');\r\n\r\n            if (feePopup) {\r\n                feePopup.remove();\r\n            }\r\n\r\n            $('html-body').insert({bottom: '<div id=\"fee_popup\"></div>'});\r\n\r\n            $('fee_popup').update(content);\r\n\r\n            var popup = jQuery('#fee_popup');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'popup',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Close'),\r\n                    class: 'action-secondary',\r\n                    click: function () {\r\n                        popup.modal('closeModal');\r\n                    }\r\n                }]\r\n            }, popup);\r\n\r\n            popup.modal('openModal');\r\n        },\r\n\r\n        getEstimatedFees: function(listingProductId)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getEstimatedFees'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    listing_product_id: listingProductId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.error) {\r\n                        self.alert('Unable to receive estimated fee.');\r\n                        return;\r\n                    }\r\n\r\n                    self.openFeePopUp(response.html, response.title);\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openItemDuplicatePopUp: function(listingProductId)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_duplicate/getPopup'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    listing_product_id: listingProductId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.error) {\r\n                        self.alert(response.error);\r\n                        return;\r\n                    }\r\n\r\n                    var duplicatePopup = $('duplicate_popup');\r\n\r\n                    if (duplicatePopup) {\r\n                        duplicatePopup.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"duplicate_popup\"></div>'});\r\n\r\n                    $('duplicate_popup').update(response.html);\r\n\r\n                    var popup = jQuery('#duplicate_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Ebay Item Duplicate'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                popup.modal('closeModal');\r\n                            }\r\n                        }]\r\n                    }, popup);\r\n\r\n                    popup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        closeItemDuplicatePopUp: function(reloadGrid)\r\n        {\r\n            reloadGrid = reloadGrid || false;\r\n            reloadGrid && this.getGridObj().reload();\r\n\r\n            jQuery('#duplicate_popup').modal('closeModal')\r\n        },\r\n\r\n        solveItemDuplicateAction: function(listingProductId, isNeedStop, isNeedList)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_duplicate/solve'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    listing_product_id:   listingProductId,\r\n                    stop_duplicated_item: Number(isNeedStop),\r\n                    list_current_item:    Number(isNeedList)\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.setContainer('#ebay_listing_item_duplicate_fieldset');\r\n                    MessageObj.clear();\r\n\r\n                    if (response.message) {\r\n                        MessageObj.addErrorMessage(response.message);\r\n                    }\r\n\r\n                    if (response.result) {\r\n                        self.closeItemDuplicatePopUp(true);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showMotorsNotificationPopUp: function(message)\r\n        {\r\n            var content = '<div style=\"padding: 10px 0;\">'+message+'</div>' +\r\n                          '<div style=\"float: right;\">' +\r\n                            '<button onclick=\"Windows.getFocusedWindow().close()\">' +\r\n                              '<span>OK</span>' +\r\n                            '</button>' +\r\n                          '</div> ';\r\n            var config = {\r\n                draggable: true,\r\n                resizable: true,\r\n                closable: true,\r\n                className: \"magento\",\r\n                windowClassName: \"popup-window\",\r\n                title: M2ePro.translator.translate('Compatibility Attribute'),\r\n                top: 250,\r\n                height: 85,\r\n                width: 420,\r\n                zIndex: 100,\r\n                recenterAuto: true,\r\n                hideEffect: Element.hide,\r\n                showEffect: Element.show\r\n            };\r\n\r\n            Dialog.info(content, config);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Grid.js":"define([\r\n    'jquery',\r\n    'M2ePro/Ebay/Listing/View/Grid',\r\n    'M2ePro/Listing/Moving',\r\n    'Magento_Ui/js/modal/modal'\r\n], function (jQuery) {\r\n\r\n    window.EbayListingViewSettingsGrid = Class.create(EbayListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridId,listingId)\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-validate-ebay-template-switcher', function(value, $element) {\r\n\r\n               var mode = base64_decode(value).evalJSON().mode;\r\n\r\n               return mode !== null;\r\n            }, M2ePro.translator.translate('This is a required field.'));\r\n\r\n            $super(gridId);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function($super)\r\n        {\r\n            $super();\r\n\r\n            this.movingHandler = new ListingMoving(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n\r\n                editPrimaryCategorySettingsAction: function(id) {\r\n                    this.editCategorySettings(id);\r\n                }.bind(this),\r\n                editStorePrimaryCategorySettingsAction: function(id) {\r\n                    this.editCategorySettings(id);\r\n                }.bind(this),\r\n\r\n                editPriceQuantityFormatSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SELLING_FORMAT')\r\n                    );\r\n                }.bind(this),\r\n                editDescriptionSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_DESCRIPTION')\r\n                    );\r\n                }.bind(this),\r\n                editSynchSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SYNCHRONIZATION')\r\n                    );\r\n                }.bind(this),\r\n                editPaymentSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_PAYMENT')\r\n                    );\r\n                }.bind(this),\r\n                editShippingSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SHIPPING')\r\n                    );\r\n                }.bind(this),\r\n                editReturnSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_RETURN_POLICY')\r\n                    );\r\n                }.bind(this),\r\n\r\n                editMotorsAction: function(id) {\r\n                    this.openMotorsPopup(id);\r\n                }.bind(this),\r\n\r\n                movingAction: this.movingHandler.run.bind(this.movingHandler),\r\n\r\n                transferringAction: function(id) {\r\n                    this.transferring(id);\r\n                }.bind(this)\r\n\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editSettings: function(id, templateNick)\r\n        {\r\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/editListingProductsPolicy'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    ids: this.selectedProductsIds.join(','),\r\n                    templateNick: templateNick\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var result = transport.responseText;\r\n\r\n                    if (+result === 0) {\r\n                        return;\r\n                    }\r\n\r\n                    this.unselectAll();\r\n\r\n                    var title = this.getPopUpTitle(templateNick, this.getSelectedProductsTitles());\r\n\r\n                    if (typeof this.popUp != 'undefined') {\r\n                        var $title = this.popUp.data('modal').modal.find('.modal-title');\r\n                        $title.text(title);\r\n                    }\r\n\r\n                    this.openPopUp(\r\n                        title,\r\n                        transport.responseText,\r\n                        {\r\n                            buttons: [{\r\n                                text: M2ePro.translator.translate('Cancel'),\r\n                                class: 'action-dismiss',\r\n                                click: function () {\r\n                                    this.closeModal();\r\n                                }\r\n                            }, {\r\n                                text: M2ePro.translator.translate('Save'),\r\n                                class: 'action-primary action-accept',\r\n                                click: function () {\r\n                                    var switcher = jQuery('.template-switcher');\r\n\r\n                                    if (!switcher.length ||\r\n                                        !jQuery.validator.validateElement(switcher)) {\r\n                                        return;\r\n                                    }\r\n\r\n                                    EbayListingTemplateSwitcherObj.saveSwitchers(function (params) {\r\n                                        EbayListingViewSettingsGridObj.saveSettings(params);\r\n                                    });\r\n                                }\r\n                            }],\r\n                            closed: function() {\r\n                                self.selectedProductsIds = [];\r\n                                self.selectedCategoriesData = {};\r\n\r\n                                return true;\r\n                            }\r\n\r\n                        },\r\n                        'modal_setting_policy_action_dialog'\r\n                    );\r\n\r\n                    this.insertHelpLink('modal_setting_policy_action_dialog');\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        openMotorsPopup: function(id)\r\n        {\r\n            EbayListingViewSettingsMotorsObj.savedNotes = {};\r\n\r\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\r\n            EbayListingViewSettingsMotorsObj.openAddPopUp(this.selectedProductsIds);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveSettings: function(savedTemplates)\r\n        {\r\n            var requestParams = {};\r\n\r\n            // push information about saved templates into the request params\r\n            // ---------------------------------------\r\n            $H(savedTemplates).each(function(i) {\r\n                requestParams[i.key] = i.value;\r\n            });\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            requestParams['ids'] = this.selectedProductsIds.join(',');\r\n            // ---------------------------------------\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/saveListingProductsPolicy'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: requestParams,\r\n                onSuccess: function(transport) {\r\n                    this.popUp.modal('closeModal');\r\n                    this.getGridObj().doFilter();\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSelectedProductsTitles: function()\r\n        {\r\n            if (this.selectedProductsIds.length > 3) {\r\n                return '';\r\n            }\r\n\r\n            var title = '';\r\n\r\n            // use the names of only first three products for pop up title\r\n            for (var i = 0; i < 3; i++) {\r\n                if (typeof this.selectedProductsIds[i] == 'undefined') {\r\n                    break;\r\n                }\r\n\r\n                if (title != '') {\r\n                    title += ', ';\r\n                }\r\n\r\n                title += this.getProductNameByRowId(this.selectedProductsIds[i]);\r\n            }\r\n\r\n            return title;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getPopUpTitle: function(templateNick, productTitles)\r\n        {\r\n            var title = '',\r\n                templatesNames = {};\r\n\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_RETURN_POLICY')\r\n            ] = M2ePro.translator.translate('Edit Return Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_PAYMENT')\r\n            ] = M2ePro.translator.translate('Edit Payment Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SHIPPING')\r\n            ] = M2ePro.translator.translate('Edit Shipping Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_DESCRIPTION')\r\n            ] = M2ePro.translator.translate('Edit Description Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SELLING_FORMAT')\r\n            ] = M2ePro.translator.translate('Edit Price, Quantity and Format Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SYNCHRONIZATION')\r\n            ] = M2ePro.translator.translate('Edit Synchronization Policy Setting');\r\n\r\n            if (templatesNames[templateNick]) {\r\n                title = templatesNames[templateNick];\r\n            }\r\n\r\n            var productTitlesArray = productTitles.split(',');\r\n            if (productTitlesArray.length > 1) {\r\n                productTitles = productTitlesArray.map(function(el) { return el.trim(); }).join('\", \"');\r\n            }\r\n\r\n            if (productTitles) {\r\n                title += ' ' + M2ePro.translator.translate('for') + ' \"' + productTitles + '\"';\r\n            }\r\n\r\n            return title;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        transferring: function(id)\r\n        {\r\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\r\n            if (this.selectedProductsIds.length) {\r\n                this.unselectAll();\r\n\r\n                var productName = this.selectedProductsIds.length == 1 ?\r\n                    this.getProductNameByRowId(this.selectedProductsIds[0]) : null;\r\n\r\n                EbayListingTransferringHandlerObj.loadActionHtml(this.selectedProductsIds, null, productName);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function (config) {\r\n            if (config.actions && config.actions.confirm) {\r\n                config.actions.confirm();\r\n            }\r\n        },\r\n\r\n        insertHelpLink: function (popUpElementId)\r\n        {\r\n            var modalHeader = jQuery('#'+popUpElementId)\r\n                    .closest('.modal-inner-wrap')\r\n                    .find('h1.modal-title');\r\n\r\n            if (modalHeader.has('#popup_template_help_link')) {\r\n                modalHeader.find('#popup_template_help_link').remove();\r\n            }\r\n\r\n            var tips = jQuery('#popup_template_help_link');\r\n            modalHeader.append(tips);\r\n            tips.show();\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function(modal){\r\n\r\n    window.EbayListingViewSettingsMotors  = Class.create(Common, {\r\n\r\n        listingId: null,\r\n        motorsType: null,\r\n        saveAsGroupPopupHtml: '',\r\n        setNotePopupHtml: '',\r\n\r\n        selectedData: {\r\n            items: [],\r\n            filters: [],\r\n            groups: []\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (listingId, motorsType) {\r\n            this.listingId = listingId;\r\n            this.motorsType = motorsType;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openAddPopUp: function (listingProductsIds) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/addView'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_manage_popup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_manage_popup\"></div>'});\r\n                    $('ebay_settings_motors_manage_popup').update(transport.responseText);\r\n\r\n                    self.addPopUp = jQuery('#ebay_settings_motors_manage_popup');\r\n\r\n                    var instructions = $('add_custom_motors_record_instruction_container'),\r\n                        popupType = 'slide',\r\n                        closedAction = function () {\r\n                            EbayListingViewSettingsGridObj.unselectAllAndReload();\r\n\r\n                            self.selectedData = {\r\n                                items: [],\r\n                                filters: [],\r\n                                groups: []\r\n                            };\r\n                        },\r\n                        buttons = [];\r\n\r\n                    if (instructions) {\r\n                        popupType = 'popup';\r\n                        closedAction = '';\r\n                        buttons.push({\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                self.closeInstruction(listingProductsIds);\r\n                            }\r\n                        })\r\n                    }\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Add Compatible Vehicles'),\r\n                        type: popupType,\r\n                        buttons: buttons,\r\n                        closed: closedAction\r\n                    }, self.addPopUp);\r\n\r\n                    self.addPopUp.modal('openModal');\r\n\r\n                    self.addPopUp.listingProductsIds = listingProductsIds;\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        openViewItemPopup: function (entityId, grid) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/viewItem'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    entity_id: entityId,\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_view_item');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_view_item\"></div>'});\r\n                    $('ebay_settings_motors_view_item').update(transport.responseText);\r\n\r\n                    self.viewItemPopup = jQuery('#ebay_settings_motors_view_item');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('View Items'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewItemPopup.modal('closeModal')\r\n                            }\r\n                        }],\r\n                        closed: function () {\r\n                            grid.unselectAllAndReload();\r\n                        }\r\n                    }, self.viewItemPopup);\r\n\r\n                    self.viewItemPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        openViewFilterPopup: function (entityId, grid) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/viewFilter'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    entity_id: entityId,\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_view_filter');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_view_filter\"></div>'});\r\n                    $('ebay_settings_motors_view_filter').update(transport.responseText);\r\n\r\n                    self.viewFilterPopup = jQuery('#ebay_settings_motors_view_filter');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('View Filters'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewFilterPopup.modal('closeModal')\r\n                            }\r\n                        }],\r\n                        closed: function () {\r\n                            grid.unselectAllAndReload();\r\n                        }\r\n                    }, self.viewFilterPopup);\r\n\r\n                    self.viewFilterPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        openViewGroupPopup: function (entityId, grid) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/viewGroup'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    entity_id: entityId,\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_view_group');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_view_group\"></div>'});\r\n                    $('ebay_settings_motors_view_group').update(transport.responseText);\r\n\r\n                    self.viewGroupPopup = jQuery('#ebay_settings_motors_view_group');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('View Groups'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewGroupPopup.modal('closeModal')\r\n                            }\r\n                        }],\r\n                        closed: function () {\r\n                            grid.unselectAllAndReload();\r\n                        }\r\n                    }, self.viewGroupPopup);\r\n\r\n                    self.viewGroupPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        updateSelectedData: function () {\r\n            var self = this,\r\n                emptyText = $('motors_empty_text'),\r\n                addbtn = $('motors_add'),\r\n                overrideBtn = $('motors_override'),\r\n                dataEl = $('selected_motors_data');\r\n\r\n            addbtn.addClassName('disabled');\r\n            overrideBtn.addClassName('disabled');\r\n            emptyText.show();\r\n\r\n            dataEl.down('.items').hide();\r\n            if (self.selectedData.items.length > 0) {\r\n                emptyText.hide();\r\n                addbtn.removeClassName('disabled');\r\n                overrideBtn.removeClassName('disabled');\r\n\r\n                dataEl.down('.items').show();\r\n                dataEl.down('.items .count').innerHTML = self.selectedData.items.length;\r\n            }\r\n\r\n            dataEl.down('.filters').hide();\r\n            if (self.selectedData.filters.length > 0) {\r\n                emptyText.hide();\r\n                addbtn.removeClassName('disabled');\r\n                overrideBtn.removeClassName('disabled');\r\n\r\n                dataEl.down('.filters').show();\r\n                dataEl.down('.filters .count').innerHTML = self.selectedData.filters.length;\r\n            }\r\n\r\n            dataEl.down('.groups').hide();\r\n            if (self.selectedData.groups.length > 0) {\r\n                emptyText.hide();\r\n                addbtn.removeClassName('disabled');\r\n                overrideBtn.removeClassName('disabled');\r\n\r\n                dataEl.down('.groups').show();\r\n                dataEl.down('.groups .count').innerHTML = self.selectedData.groups.length;\r\n            }\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        viewSelectedItemPopup: function () {\r\n            var self = this;\r\n\r\n            var containerEl = $('selected_items_popup');\r\n\r\n            if (containerEl) {\r\n                containerEl.remove();\r\n            }\r\n\r\n            $('html-body').insert({\r\n                bottom: '<div id=\"selected_items_popup\"></div>'\r\n            });\r\n\r\n            self.viewSelectedItemsPopup = jQuery('#selected_items_popup');\r\n\r\n            modal({\r\n                title: M2ePro.translator.translate('Selected Items'),\r\n                type: 'popup',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Close'),\r\n                    class: 'action-secondary',\r\n                    click: function () {\r\n                        self.viewSelectedItemsPopup.modal('closeModal');\r\n                    }\r\n                }]\r\n            }, self.viewSelectedItemsPopup);\r\n\r\n            self.viewSelectedItemsPopup.modal('openModal');\r\n\r\n            var table = new Element('table', {\r\n                cellspacing: '0',\r\n                cellpadding: '0',\r\n                class: 'data-grid data-grid-not-hovered'\r\n            });\r\n\r\n            table.update(\r\n                '<thead> ' +\r\n                    '<tr class=\"headings\">' +\r\n                        '<th class=\"data-grid-th\" style=\"width: 75px; font-weight: bold;\">' +\r\n                            M2ePro.translator.translate('Motor Item') +\r\n                        '</th>' +\r\n                        '<th class=\"data-grid-th\" style=\"font-weight: bold;\">' +\r\n                            M2ePro.translator.translate('Note') +\r\n                        '</th>' +\r\n                        '<th class=\"data-grid-th type-butt last\" style=\"width: 20px;\"></th>' +\r\n                    '</tr>' +\r\n                '</thead>' +\r\n                '<tbody></tbody>'\r\n            );\r\n\r\n            var tbody = table.down('tbody');\r\n\r\n            self.selectedData.items.each(function (item) {\r\n                var tr = new Element('tr'),\r\n                    tdItem = new Element('td', {\r\n                        style: 'text-align: center'\r\n                    }),\r\n                    tdNote = new Element('td', {}),\r\n                    tdRemove = new Element('td', {});\r\n\r\n                tdItem.innerHTML = item;\r\n                if (EbayListingViewSettingsMotorsAddItemGridObj.savedNotes[item]) {\r\n                    tdNote.innerHTML = EbayListingViewSettingsMotorsAddItemGridObj.savedNotes[item];\r\n                }\r\n\r\n                var removeLink = new Element('a', {\r\n                    title: M2ePro.translator.translate('Remove'),\r\n                    href: 'javascript:void(0)',\r\n                    class: 'ebay-listing-view-icon ebay-listing-view-remove'\r\n                });\r\n\r\n                removeLink.observe('click', function () {\r\n                    tr.remove();\r\n\r\n                    var index = self.selectedData.items.indexOf(item);\r\n                    self.selectedData.items.splice(index, 1);\r\n\r\n                    EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n                    if (self.selectedData.items.length == 0) {\r\n                        self.viewSelectedItemsPopup.modal('closeModal');\r\n                    }\r\n                }, self);\r\n\r\n                tdRemove.insert({bottom: removeLink});\r\n\r\n                tr.insert({bottom: tdItem});\r\n                tr.insert({bottom: tdNote});\r\n                tr.insert({bottom: tdRemove});\r\n\r\n                tbody.insert({bottom: tr});\r\n            });\r\n\r\n            var dialogContent = $('selected_items_popup');\r\n\r\n            dialogContent.insert({\r\n                bottom: new Element('div', {\r\n                    class: 'admin__data-grid-wrap admin__data-grid-wrap-static'\r\n                }).insert({bottom: table})\r\n            });\r\n        },\r\n\r\n        viewSelectedFilterPopup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/modelGetAll'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    model: 'Ebay_Motor_Filter',\r\n                    id_field: 'id',\r\n                    data_field: 'title'\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var filters = transport.responseText.evalJSON();\r\n\r\n                    var containerEl = $('selected_filters_popup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({\r\n                        bottom: '<div id=\"selected_filters_popup\"></div>'\r\n                    });\r\n\r\n                    self.viewSelectedFiltersPopup = jQuery('#selected_filters_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Selected Filters'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewSelectedFiltersPopup.modal('closeModal')\r\n                            }\r\n                        }]\r\n                    }, self.viewSelectedFiltersPopup);\r\n\r\n                    self.viewSelectedFiltersPopup.modal('openModal');\r\n\r\n                    var table = new Element('table', {\r\n                        cellspacing: '0',\r\n                        cellpadding: '0',\r\n                        class: 'data-grid data-grid-not-hovered'\r\n                    });\r\n\r\n                    table.update(\r\n                        '<thead> ' +\r\n                            '<tr class=\"headings\">' +\r\n                                '<th class=\"data-grid-th\" style=\"font-weight: bold;\">' +\r\n                                    M2ePro.translator.translate('Filter') +\r\n                                '</th>' +\r\n                                '<th class=\"data-grid-th type-butt last\" style=\"width: 20px;\"></th>' +\r\n                            '</tr>' +\r\n                        '</thead>' +\r\n                        '<tbody></tbody>'\r\n                    );\r\n\r\n                    var tbody = table.down('tbody');\r\n\r\n                    filters.each(function (filter) {\r\n                        if (self.selectedData.filters.indexOf(filter.id) == -1) {\r\n                            return;\r\n                        }\r\n\r\n                        var tr = new Element('tr'),\r\n                            tdTitle = new Element('td', {}),\r\n                            tdRemove = new Element('td', {});\r\n\r\n                        tdTitle.innerHTML = filter.title;\r\n\r\n                        var removeLink = new Element('a', {\r\n                            title: M2ePro.translator.translate('Remove'),\r\n                            href: 'javascript:void(0)',\r\n                            class: 'ebay-listing-view-icon ebay-listing-view-remove'\r\n                        });\r\n\r\n                        removeLink.observe('click', function () {\r\n                            tr.remove();\r\n\r\n                            var index = self.selectedData.filters.indexOf(filter.id);\r\n                            self.selectedData.filters.splice(index, 1);\r\n\r\n                            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n                            if (self.selectedData.filters.length == 0) {\r\n                                self.viewSelectedFiltersPopup.modal('closeModal');\r\n                            }\r\n                        }, self);\r\n\r\n                        tdRemove.insert({bottom: removeLink});\r\n\r\n                        tr.insert({bottom: tdTitle});\r\n                        tr.insert({bottom: tdRemove});\r\n\r\n                        tbody.insert({bottom: tr});\r\n                    });\r\n\r\n                    var dialogContent = $('selected_filters_popup');\r\n\r\n                    dialogContent.insert({\r\n                        bottom: new Element('div', {\r\n                            class: 'admin__data-grid-wrap admin__data-grid-wrap-static'\r\n                        }).insert({bottom: table})\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        viewSelectedGroupPopup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/modelGetAll'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    model: 'Ebay_Motor_Group',\r\n                    id_field: 'id',\r\n                    data_field: 'title'\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var groups = transport.responseText.evalJSON();\r\n\r\n                    var containerEl = $('selected_groups_popup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({\r\n                        bottom: '<div id=\"selected_groups_popup\"></div>'\r\n                    });\r\n\r\n                    self.viewSelectedGroupsPopup = jQuery('#selected_groups_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Selected Groups'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewSelectedGroupsPopup.modal('closeModal')\r\n                            }\r\n                        }]\r\n                    }, self.viewSelectedGroupsPopup);\r\n\r\n                    self.viewSelectedGroupsPopup.modal('openModal');\r\n\r\n                    var table = new Element('table', {\r\n                        cellspacing: '0',\r\n                        cellpadding: '0',\r\n                        class: 'data-grid data-grid-not-hovered'\r\n                    });\r\n\r\n                    table.update(\r\n                        '<thead> ' +\r\n                            '<tr class=\"headings\">' +\r\n                                '<th class=\"data-grid-th\" style=\"font-weight: bold;\">' +\r\n                                    M2ePro.translator.translate('Filter') +\r\n                                '</th>' +\r\n                                '<th class=\"data-grid-th type-butt last\" style=\"width: 20px;\"></th>' +\r\n                            '</tr>' +\r\n                        '</thead>' +\r\n                        '<tbody></tbody>'\r\n                    );\r\n\r\n                    var tbody = table.down('tbody');\r\n\r\n                    groups.each(function (group) {\r\n                        if (self.selectedData.groups.indexOf(group.id) == -1) {\r\n                            return;\r\n                        }\r\n\r\n                        var tr = new Element('tr'),\r\n                            tdTitle = new Element('td', {}),\r\n                            tdRemove = new Element('td', {});\r\n\r\n                        tdTitle.innerHTML = group.title;\r\n\r\n                        var removeLink = new Element('a', {\r\n                            title: M2ePro.translator.translate('Remove'),\r\n                            href: 'javascript:void(0)',\r\n                            class: 'ebay-listing-view-icon ebay-listing-view-remove'\r\n                        });\r\n\r\n                        removeLink.observe('click', function () {\r\n                            tr.remove();\r\n\r\n                            var index = self.selectedData.groups.indexOf(group.id);\r\n                            self.selectedData.groups.splice(index, 1);\r\n\r\n                            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n                            if (self.selectedData.groups.length == 0) {\r\n                                self.viewSelectedGroupsPopup.modal('closeModal');\r\n                            }\r\n                        }, self);\r\n\r\n                        tdRemove.insert({bottom: removeLink});\r\n\r\n                        tr.insert({bottom: tdTitle});\r\n                        tr.insert({bottom: tdRemove});\r\n\r\n                        tbody.insert({bottom: tr});\r\n                    });\r\n\r\n                    var dialogContent = $('selected_groups_popup');\r\n\r\n                    dialogContent.insert({\r\n                        bottom: new Element('div', {\r\n                            class: 'admin__data-grid-wrap admin__data-grid-wrap-static'\r\n                        }).insert({bottom: table})\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        updateMotorsData: function (override) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var items = {};\r\n                        self.selectedData.items.each(function (item) {\r\n                            items[item] = EbayListingViewSettingsMotorsAddItemGridObj.savedNotes[item];\r\n                        });\r\n\r\n                        new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/updateMotorsData'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                listing_id: self.listingId,\r\n                                'listing_products_ids[]': self.addPopUp.listingProductsIds,\r\n                                motors_type: self.motorsType,\r\n                                overwrite: override,\r\n                                items: Object.toQueryString(items),\r\n                                filters_ids: implode(',', self.selectedData.filters),\r\n                                groups_ids: implode(',', self.selectedData.groups)\r\n                            },\r\n                            onSuccess: function (transport) {\r\n\r\n                                if (transport.responseText == '0') {\r\n                                    self.addPopUp.modal('closeModal');\r\n                                }\r\n                            }\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        openAddRecordPopup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getAddCustomItemForm'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_custom_item_form');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_custom_item_form\"></div>'});\r\n                    $('ebay_settings_motors_custom_item_form').update(transport.responseText);\r\n\r\n                    self.addRecordPopUp = jQuery('#ebay_settings_motors_custom_item_form');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Add Custom Compatible Vehicle'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.addRecordPopUp.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!jQuery('#motors_custom_item').valid()) {\r\n                                    return;\r\n                                }\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/saveCustomItem'), {\r\n                                    method: 'post',\r\n                                    parameters: $$('#ebay_settings_motors_custom_item_form form').first().serialize(true),\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        var result = transport.responseText.evalJSON();\r\n\r\n                                        if (!result.result) {\r\n                                            return self.alert(result.message);\r\n                                        }\r\n\r\n                                        self.addRecordPopUp.modal('closeModal');\r\n                                        EbayListingViewSettingsMotorsAddItemGridObj.unselectAllAndReload();\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.addRecordPopUp);\r\n\r\n                    self.addRecordPopUp.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_custom_item');\r\n                }\r\n            });\r\n        },\r\n\r\n        removeCustomMotorsRecord: function (motorsType, keyId) {\r\n            var self = this;\r\n\r\n            var index = self.selectedData.items.indexOf('' + keyId);\r\n\r\n            if (index > -1) {\r\n                self.selectedData.items.splice(index, 1);\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeCustomItem'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    motors_type: motorsType,\r\n                    key_id: keyId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var result = transport.responseText.evalJSON();\r\n\r\n                    if (!result.result) {\r\n                        return alert(result.message);\r\n                    }\r\n\r\n                    self.updateSelectedData();\r\n                    EbayListingViewSettingsMotorsAddItemGridObj.unselectAllAndReload();\r\n                    EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        closeInstruction: function (listingProductsIds) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/closeInstruction'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n                    self.addPopUp.modal('closeModal');\r\n                    self.openAddPopUp(listingProductsIds);\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/Add/Filter/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Grid'\r\n], function (modal) {\r\n\r\n    window.EbayListingViewSettingsMotorsAddFilterGrid = Class.create(Grid, {\r\n\r\n        filtersConditions: {},\r\n\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId) {\r\n            $super(gridId);\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                selectAction: this.selectFilters.bind(this),\r\n                setNoteAction: this.setNote.bind(this),\r\n                resetNoteAction: this.resetNote.bind(this),\r\n                saveAsGroupAction: this.saveAsGroup.bind(this),\r\n                removeFilterAction: this.removeFilter.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        selectFilters: function () {\r\n            var self = this,\r\n                filters = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            filters.each(function (filter) {\r\n\r\n                for (var i = 0; i < EbayListingViewSettingsMotorsObj.selectedData.filters.length; i++) {\r\n                    if (EbayListingViewSettingsMotorsObj.selectedData.filters[i] == filter) {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                EbayListingViewSettingsMotorsObj.selectedData.filters.push(filter);\r\n            });\r\n\r\n            self.unselectAll();\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        setNote: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getNoteForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_note_form');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_note_form\"></div>'});\r\n                    $('ebay_settings_motors_note_form').insert({bottom: transport.responseText});\r\n\r\n                    self.notePopup = jQuery('#ebay_settings_motors_note_form');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Set Note'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.notePopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_note')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var data = $('motors_note').serialize(true);\r\n                                data['filters_ids'] = self.getGridMassActionObj().checkedString;\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/setNoteToFilters'), {\r\n                                    method: 'post',\r\n                                    parameters: data,\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        if (transport.responseText == '0') {\r\n                                            self.unselectAllAndReload();\r\n                                        }\r\n\r\n                                        self.notePopup.modal('closeModal');\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.notePopup);\r\n\r\n                    self.notePopup.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_note');\r\n                }\r\n            });\r\n        },\r\n\r\n        resetNote: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/setNoteToFilters'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    filters_ids: self.getGridMassActionObj().checkedString,\r\n                    note: ''\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n\r\n                    self.notePopup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        saveAsGroup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getSaveAsGroupForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_save_group');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_save_group\"></div>'});\r\n                    $('ebay_settings_motors_save_group').insert({bottom: transport.responseText});\r\n\r\n                    self.groupPopup = jQuery('#ebay_settings_motors_save_group');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Save as Group'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.groupPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_group')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var data = $('motors_group').serialize(true);\r\n                                data.items = self.getGridMassActionObj().checkedString;\r\n                                data.type = EbayListingViewSettingsMotorsObj.motorsType;\r\n                                data.mode = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Motor_Group::MODE_FILTER');\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/saveAsGroup'), {\r\n                                    method: 'post',\r\n                                    parameters: data,\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        if (transport.responseText == '0') {\r\n                                            self.unselectAll();\r\n                                            $(self.getGridMassActionObj().select).value = '';\r\n\r\n                                            EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                                        }\r\n\r\n                                        self.groupPopup.modal('closeModal');\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.groupPopup);\r\n\r\n                    self.groupPopup.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_group');\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        removeFilter: function () {\r\n            var self = this,\r\n                filters = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            filters.each(function (filter) {\r\n\r\n                var index = EbayListingViewSettingsMotorsObj.selectedData.filters.indexOf(filter);\r\n\r\n                if (index > -1) {\r\n                    EbayListingViewSettingsMotorsObj.selectedData.filters.splice(index, 1);\r\n                }\r\n            });\r\n\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeFilter'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    filters_ids: self.getGridMassActionObj().checkedString\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                        EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n        showFilterResult: function (filterId) {\r\n            jQuery('#ebayMotorAddTabs').tabs({\r\n                active: 0\r\n            });\r\n            EbayListingViewSettingsMotorsAddItemGridObj.showFilterResult(this.filtersConditions[filterId]);\r\n        },\r\n\r\n        //##################################\r\n\r\n        validatePopupForm: function (formId) {\r\n\r\n            return jQuery('#' + formId).valid();\r\n\r\n        },\r\n\r\n        //##################################\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/Add/Group/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Grid'\r\n], function (modal) {\r\n\r\n    window.EbayListingViewSettingsMotorsAddGroupGrid = Class.create(Grid, {\r\n\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId) {\r\n            $super(gridId);\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                selectAction: this.selectGroups.bind(this),\r\n                removeGroupAction: this.removeGroup.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        selectGroups: function () {\r\n            var self = this,\r\n                groups = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            groups.each(function (group) {\r\n\r\n                for (var i = 0; i < EbayListingViewSettingsMotorsObj.selectedData.groups.length; i++) {\r\n                    if (EbayListingViewSettingsMotorsObj.selectedData.groups[i] == group) {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                EbayListingViewSettingsMotorsObj.selectedData.groups.push(group);\r\n            });\r\n\r\n            self.unselectAll();\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        removeGroup: function () {\r\n            var self = this,\r\n                groups = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            groups.each(function (group) {\r\n                var index = EbayListingViewSettingsMotorsObj.selectedData.groups.indexOf(group);\r\n\r\n                if (index > -1) {\r\n                    EbayListingViewSettingsMotorsObj.selectedData.groups.splice(index, 1);\r\n                }\r\n            });\r\n\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeGroup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    groups_ids: self.getGridMassActionObj().checkedString\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n        viewGroupContentPopup: function (groupId, title) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getGroupContentView'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    group_id: groupId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_group_content');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_group_content\"></div>'});\r\n                    $('ebay_settings_motors_group_content').insert({bottom: transport.responseText});\r\n\r\n                    self.goupContentPopup = jQuery('#ebay_settings_motors_group_content');\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.goupContentPopup.modal('closeModal');\r\n                            }\r\n                        }],\r\n                        closed: function() {\r\n                            EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                        }\r\n                    }, self.goupContentPopup);\r\n\r\n                    self.goupContentPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        removeItemFromGroup: function (el, itemId, groupId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeItemFromGroup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    items_ids: itemId,\r\n                    group_id: groupId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        if ($(el).up('tbody').select('tr').length == 1) {\r\n                            var index = EbayListingViewSettingsMotorsObj.selectedData.groups.indexOf('' + groupId);\r\n\r\n                            if (index > -1) {\r\n                                EbayListingViewSettingsMotorsObj.selectedData.groups.splice(index, 1);\r\n                                EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n                            }\r\n\r\n                            self.goupContentPopup.modal('closeModal');\r\n                            return;\r\n                        }\r\n\r\n                        $(el).up('tr').remove();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        removeFilterFromGroup: function (el, filterId, groupId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeFilterFromGroup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    filters_ids: filterId,\r\n                    group_id: groupId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        if ($(el).up('tbody').select('tr').length == 1) {\r\n                            var index = EbayListingViewSettingsMotorsObj.selectedData.groups.indexOf('' + groupId);\r\n\r\n                            if (index > -1) {\r\n                                EbayListingViewSettingsMotorsObj.selectedData.groups.splice(index, 1);\r\n                                EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n                            }\r\n\r\n                            self.goupContentPopup.modal('closeModal');\r\n                            return;\r\n                        }\r\n\r\n                        $(el).up('tr').remove();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        //##################################\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/Add/Item/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Grid'\r\n], function (modal) {\r\n\r\n    window.EbayListingViewSettingsMotorsAddItemGrid = Class.create(Grid, {\r\n\r\n        savedNotes: {},\r\n\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId) {\r\n            $super(gridId);\r\n\r\n            this.savedNotes = {};\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                selectAction: this.selectItems.bind(this),\r\n                setNoteAction: this.setNote.bind(this),\r\n                resetNoteAction: this.resetNote.bind(this),\r\n                saveAsGroupAction: this.saveAsGroup.bind(this)\r\n            };\r\n        },\r\n\r\n        afterInitPage: function () {\r\n            var self = this;\r\n\r\n            Grid.prototype.afterInitPage.call(this);\r\n\r\n            $(self.gridId).down('.data-grid-filters').on('change', function (e) {\r\n\r\n                self.checkFilterValues();\r\n\r\n            });\r\n\r\n            $(self.gridId).down('.data-grid-filters').on('keyup', function (e) {\r\n\r\n                self.checkFilterValues();\r\n\r\n            });\r\n\r\n            self.checkFilterValues();\r\n\r\n            $H(self.savedNotes).each(function (note) {\r\n\r\n                var noteEl = $('note_' + note.key);\r\n\r\n                if (noteEl && note.value != '') {\r\n                    noteEl.show();\r\n                    noteEl.down('.note-view').innerHTML = note.value;\r\n                }\r\n            });\r\n\r\n            var select = $(self.getGridMassActionObj().containerId + '-mass-select');\r\n            self.bindEventAtFirstPosition(select, 'change',  self.massactionOnChange.bind(self));\r\n        },\r\n\r\n        checkFilterValues: function () {\r\n            var self = this;\r\n\r\n            $('save_filter_btn').addClassName('disabled');\r\n\r\n            $(self.gridId).down('.data-grid-filters').select('select', 'input').each(function (el) {\r\n                if (el.name == 'massaction') {\r\n                    return;\r\n                }\r\n\r\n                if (el.value != '') {\r\n                    $('save_filter_btn').removeClassName('disabled');\r\n                    throw $break;\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n        selectItems: function () {\r\n            var self = this,\r\n                items = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            items.each(function (item) {\r\n\r\n                for (var i = 0; i < EbayListingViewSettingsMotorsObj.selectedData.items.length; i++) {\r\n                    if (EbayListingViewSettingsMotorsObj.selectedData.items[i] == item) {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                EbayListingViewSettingsMotorsObj.selectedData.items.push(item);\r\n            });\r\n\r\n            self.unselectAll();\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        setNote: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getNoteForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_note_form');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_note_form\"></div>'});\r\n                    $('ebay_settings_motors_note_form').insert({bottom: transport.responseText});\r\n\r\n                    self.notePopup = jQuery('#ebay_settings_motors_note_form');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Set Note'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.notePopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_note')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var note = $('motors_note').down('[name=note]').value;\r\n\r\n                                note = note.trim();\r\n\r\n                                self.getGridMassActionObj().getCheckedValues().split(',').each(function (id) {\r\n\r\n                                    self.savedNotes[id] = note;\r\n\r\n                                    var noteEl = $('note_' + id);\r\n\r\n                                    if (noteEl) {\r\n                                        noteEl.hide();\r\n\r\n                                        if (note != '') {\r\n                                            noteEl.show();\r\n                                            noteEl.down('.note-view').innerHTML = note;\r\n                                        }\r\n                                    }\r\n                                });\r\n\r\n                                $(self.getGridMassActionObj().select).value = '';\r\n                                self.notePopup.modal('closeModal');\r\n                            }\r\n                        }]\r\n                    }, self.notePopup);\r\n\r\n                    self.notePopup.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_note');\r\n                }\r\n            });\r\n        },\r\n\r\n        resetNote: function () {\r\n            var self = this;\r\n\r\n            self.getGridMassActionObj().getCheckedValues().split(',').each(function (id) {\r\n\r\n                self.savedNotes[id] = '';\r\n\r\n                var noteEl = $('note_' + id);\r\n\r\n                if (noteEl) {\r\n                    noteEl.hide();\r\n                    noteEl.down('.note-view').innerHTML = '';\r\n                }\r\n            });\r\n\r\n            $(self.getGridMassActionObj().select).value = '';\r\n            self.unselectAll();\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        saveAsGroup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getSaveAsGroupForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_save_group');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_save_group\"></div>'});\r\n                    $('ebay_settings_motors_save_group').insert({bottom: transport.responseText});\r\n\r\n                    self.groupPopup = jQuery('#ebay_settings_motors_save_group');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Save as Group'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.groupPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_group')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var data = $('motors_group').serialize(true);\r\n                                data.items = self.getGridMassActionObj().checkedString.split(',');\r\n                                data.type = EbayListingViewSettingsMotorsObj.motorsType;\r\n                                data.mode = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Motor_Group::MODE_ITEM');\r\n\r\n                                var items = {};\r\n                                data.items.each(function (item) {\r\n                                    items[item] = self.savedNotes[item];\r\n                                });\r\n\r\n                                data.items = Object.toQueryString(items);\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/saveAsGroup'), {\r\n                                    method: 'post',\r\n                                    parameters: data,\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        if (transport.responseText == '0') {\r\n                                            self.unselectAll();\r\n                                            $(self.getGridMassActionObj().select).value = '';\r\n\r\n                                            EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                                        }\r\n\r\n                                        self.groupPopup.modal('closeModal');\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.groupPopup);\r\n\r\n                    self.groupPopup.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_group');\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n        saveFilter: function () {\r\n            var self = this;\r\n\r\n            if ($('save_filter_btn').hasClassName('disabled')) {\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getSaveFilterForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_save_filter');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_save_filter\"></div>'});\r\n                    $('ebay_settings_motors_save_filter').insert({bottom: transport.responseText});\r\n\r\n                    self.filterPopup = jQuery('#ebay_settings_motors_save_filter');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Save Filter'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.filterPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_filter')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var data = $('motors_filter').serialize(true);\r\n                                data.conditions = Form.serialize($(self.gridId).down('.data-grid-filters'));\r\n                                data.type = EbayListingViewSettingsMotorsObj.motorsType;\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/saveFilter'), {\r\n                                    method: 'post',\r\n                                    parameters: data,\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        if (transport.responseText == '0') {\r\n                                            $(self.getGridMassActionObj().select).value = '';\r\n\r\n                                            EbayListingViewSettingsMotorsAddFilterGridObj.unselectAllAndReload();\r\n                                        }\r\n\r\n                                        self.filterPopup.modal('closeModal');\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.filterPopup);\r\n\r\n                    self.filterPopup.modal('openModal');\r\n\r\n                    var conditionsEl = $('ebay_settings_motors_save_filter').down('.filter_conditions');\r\n                    var conditionsData = {};\r\n                    $(self.gridId).down('.data-grid-filters').select('select', 'input').each(function (el) {\r\n\r\n                        if (el.name == 'massaction') {\r\n                            return;\r\n                        }\r\n\r\n                        if (el.value != '') {\r\n                            var li = new Element('li'),\r\n                                valueText = '',\r\n                                valueName = el.name.capitalize().replace('_', ' ');\r\n\r\n                            if (el.name == 'product_type') {\r\n                                valueText = el[el.selectedIndex].text;\r\n                                valueName = M2ePro.translator.translate('Type');\r\n                            } else {\r\n                                valueText = el.value;\r\n                            }\r\n\r\n                            if (el.name == 'epid') {\r\n                                valueName = M2ePro.translator.translate('ePID');\r\n                            }\r\n\r\n                            if (el.name == 'ktype') {\r\n                                valueName = M2ePro.translator.translate('kType');\r\n                            }\r\n\r\n                            if (el.name == 'body_style') {\r\n                                valueName = M2ePro.translator.translate('Body Style');\r\n                            }\r\n\r\n                            if (el.name == 'year[from]') {\r\n                                valueName = M2ePro.translator.translate('Year From');\r\n                            }\r\n\r\n                            if (el.name == 'year[to]') {\r\n                                valueName = M2ePro.translator.translate('Year To');\r\n                            }\r\n\r\n                            li.update('<b>' + valueName + '</b>: ' + valueText);\r\n\r\n                            conditionsData[el.name] = el.value;\r\n\r\n                            conditionsEl.insert({bottom: li});\r\n                        }\r\n                    });\r\n\r\n                    self.initFormValidation('#motors_filter');\r\n                }\r\n            });\r\n        },\r\n\r\n        validatePopupForm: function (formId) {\r\n\r\n            return jQuery('#' + formId).valid();\r\n\r\n        },\r\n\r\n        //##################################\r\n\r\n        showFilterResult: function (comnditions) {\r\n            var self = this;\r\n\r\n            $(self.gridId).down('.data-grid-filters').select('input', 'select').each(function (el) {\r\n                el.value = '';\r\n            });\r\n\r\n            $H(comnditions).each(function (item) {\r\n                $(self.gridId).down('.data-grid-filters').select('[name^=' + item.key + ']').each(function (el) {\r\n                    if (item.key != 'year') {\r\n                        el.value = item.value;\r\n                        return null;\r\n                    }\r\n\r\n                    if (typeof item.value == 'string') {\r\n                        el.value = item.value;\r\n                        return null;\r\n                    }\r\n\r\n                    $(self.gridId).down('.data-grid-filters').down('[name=year[from]]').value = item.value.from;\r\n                    $(self.gridId).down('.data-grid-filters').down('[name=year[to]]').value = item.value.to;\r\n\r\n                });\r\n            });\r\n\r\n            self.getGridObj().doFilter();\r\n        },\r\n\r\n        //##################################\r\n\r\n        massactionOnChange: function(event)\r\n        {\r\n            if (event.target.value != 'selectAll'){\r\n                return true;\r\n            }\r\n\r\n            var gridIds = this.getGridMassActionObj().getGridIds().split(',');\r\n            if (gridIds.length < M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Motors::MAX_ITEMS_COUNT_FOR_ATTRIBUTE')) {\r\n                return true;\r\n            }\r\n\r\n            this.alert(M2ePro.translator.translate('It is impossible to select all the items.'));\r\n\r\n            event.stopImmediatePropagation();\r\n            event.target.value = '';\r\n        }\r\n\r\n        //##################################\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/View/Filter/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingViewSettingsMotorsViewFilterGrid = Class.create(Grid, {\r\n\r\n        entityId: '',\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId, entityId) {\r\n            $super(gridId);\r\n\r\n            this.entityId = entityId;\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeFilterAction: this.removeFilter.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        removeFilter: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeFilterFromProduct'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    filters_ids: self.getGridMassActionObj().checkedString,\r\n                    entity_id: self.entityId,\r\n                    motors_type: EbayListingViewSettingsMotorsObj.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/View/Group/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingViewSettingsMotorsViewGroupGrid = Class.create(Grid, {\r\n\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId, entityId) {\r\n            $super(gridId);\r\n\r\n            this.entityId = entityId;\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeGroupAction: this.removeGroup.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        removeGroup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeGroupFromListingProduct'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    groups_ids: self.getGridMassActionObj().checkedString,\r\n                    entity_id: self.entityId,\r\n                    motors_type: EbayListingViewSettingsMotorsObj.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/View/Item/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingViewSettingsMotorsViewItemGrid = Class.create(Grid, {\r\n\r\n        entityId: '',\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId, entityId) {\r\n            $super(gridId);\r\n\r\n            this.entityId = entityId;\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeItemAction: this.removeItem.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        removeItem: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeItemFromProduct'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    items_ids: self.getGridMassActionObj().checkedString,\r\n                    entity_id: self.entityId,\r\n                    motors_type: EbayListingViewSettingsMotorsObj.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Settings/Motors.js":"\r\ndefine([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function(modal){\r\n\r\n    window.EbaySettingsMotors = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n        },\r\n\r\n        // Manage Compatibility Dictionary\r\n        // ---------------------------------------\r\n\r\n        manageMotorsRecords: function (motorsType, title) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_settings_motors/getManagePopup'), {\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_manage_popup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.managePupup = jQuery('#ebay_settings_motors_manage_popup');\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.managePupup.modal('closeModal')\r\n                            }\r\n                        }]\r\n                    }, self.managePupup);\r\n\r\n                    self.managePupup.modal('openModal');\r\n\r\n                    $('motors_type').value = motorsType;\r\n\r\n                    var spanStatEpids = $('database-custom-count');\r\n\r\n                    if (motorsType == M2ePro.php.constant('Ess_M2ePro_Helper_Component_Ebay_Motors::TYPE_EPID_MOTOR')) {\r\n                        spanStatEpids.innerHTML = $('epids_motor_custom_count').innerHTML;\r\n                    } else if (motorsType == M2ePro.php.constant('Ess_M2ePro_Helper_Component_Ebay_Motors::TYPE_EPID_UK')) {\r\n                        spanStatEpids.innerHTML = $('epids_uk_custom_count').innerHTML;\r\n                    } else if (motorsType == M2ePro.php.constant('Ess_M2ePro_Helper_Component_Ebay_Motors::TYPE_EPID_DE')) {\r\n                        spanStatEpids.innerHTML = $('epids_de_custom_count').innerHTML;\r\n                    } else {\r\n                        spanStatEpids.innerHTML = $('ktypes_custom_count').innerHTML;\r\n                    }\r\n\r\n                    self.initFormValidation('#ebay_settings_motors_form');\r\n                }\r\n            });\r\n        },\r\n\r\n        importMotorsRecords: function () {\r\n            if (!jQuery('#ebay_settings_motors_form').valid()) {\r\n                return false;\r\n            }\r\n\r\n            $('ebay_settings_motors_form').submit();\r\n        },\r\n\r\n        clearAddedMotorsRecords: function () {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var url = M2ePro.url.get('ebay_settings_motors/clearAddedMotorsData');\r\n                        self.postForm(url, {motors_type: $('motors_type').value});\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Template/Description.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common',\r\n    'mage/adminhtml/wysiwyg/tiny_mce/setup'\r\n], function () {\r\n\r\n    window.EbayTemplateDescription = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-validate-description-template', function(value, el) {\r\n\r\n                if ($('description_mode').value != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::DESCRIPTION_MODE_CUSTOM')) {\r\n                    return true;\r\n                }\r\n\r\n                return Validation.get('required-entry').test(value,el);\r\n            }, M2ePro.translator.translate('This is a required field.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-condition-note-length', function(value) {\r\n\r\n                if ($('condition_note_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_NOTE_MODE_NONE')) {\r\n                    return true;\r\n                }\r\n\r\n                return value.length <= 1000;\r\n            }, M2ePro.translator.translate('Seller Notes must be less then 1000 symbols.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-magento-product-id', function(value) {\r\n\r\n                var isValidMagentoProductId = false;\r\n\r\n                new Ajax.Request(M2ePro.url.get('ebay_template_description/checkMagentoProductId'), {\r\n                    method: 'post',\r\n                    asynchronous: false,\r\n                    parameters: {\r\n                        product_id: value\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        var response = transport.responseText.evalJSON();\r\n                        isValidMagentoProductId = response.result;\r\n                    }\r\n                });\r\n\r\n                return isValidMagentoProductId;\r\n            }, M2ePro.translator.translate('Please enter a valid Magento product ID.'));\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            $('title_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.title_mode_change)\r\n                .simulate('change');\r\n\r\n            $('subtitle_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.subtitle_mode_change)\r\n                .simulate('change');\r\n\r\n            $('item_condition')\r\n                .observe('change', EbayTemplateDescriptionObj.item_condition_change)\r\n                .simulate('change');\r\n\r\n            $('condition_note_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.condition_note_mode_change)\r\n                .simulate('change');\r\n\r\n            $('watermark_scale')\r\n                .observe('change', EbayTemplateDescriptionObj.watermark_scale_mode_change)\r\n                .simulate('change');\r\n\r\n            $('watermark_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.watermark_mode_change)\r\n                .simulate('change');\r\n\r\n            $('description_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.description_mode_change)\r\n                .simulate('change');\r\n\r\n            $('description_template_show_hide_wysiwyg')\r\n                .observe('click', wysiwygdescription_template.toggle.bind(wysiwygdescription_template))\r\n                .observe('click', EbayTemplateDescriptionObj.showHideWYSIWYG);\r\n\r\n            $('image_main')\r\n                .observe('change', EbayTemplateDescriptionObj.image_main_change)\r\n                .simulate('change');\r\n\r\n            $('gallery_images')\r\n                .observe('change', EbayTemplateDescriptionObj.gallery_images_change)\r\n                .simulate('change');\r\n\r\n            $('variation_images')\r\n                .observe('change', EbayTemplateDescriptionObj.variation_images_change)\r\n                .simulate('change');\r\n\r\n            $('product_details_ean',\r\n                'product_details_upc',\r\n                'product_details_epid',\r\n                'product_details_isbn'\r\n            ).each(function(element) {\r\n                element.observe('change', EbayTemplateDescriptionObj.product_details_specification_visibility_change)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $('product_details_brand')\r\n                .observe('change', EbayTemplateDescriptionObj.product_details_brand_change)\r\n                .simulate('change');\r\n\r\n            $('product_details_mpn')\r\n                .observe('change', EbayTemplateDescriptionObj.product_details_mpn_change);\r\n\r\n            $('custom_inserts_open_popup')\r\n                .observe('click', EbayTemplateDescriptionObj.customInsertsOpenPopup);\r\n\r\n            this.initCustomInsertsPopup();\r\n            this.initPreviewPopup();\r\n        },\r\n\r\n        initWYSIWYG: function ()\r\n        {\r\n            tinymce.dom.Event._pageInit();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function(headId, chapter_when_duplicate_text, templateNick)\r\n        {\r\n            var watermarkImageContainer = $('watermark_uploaded_image_container');\r\n\r\n            if (watermarkImageContainer) {\r\n                watermarkImageContainer.remove();\r\n                $('watermark_image').addClassName('M2ePro-required-when-visible');\r\n                $('watermark_image_container').addClassName('_required');\r\n            }\r\n\r\n            EbayTemplateEditObj.duplicateClick(headId, chapter_when_duplicate_text, templateNick);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        title_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n            self.setTextVisibilityMode(this, 'custom_title_tr');\r\n        },\r\n\r\n        subtitle_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n            self.setTextVisibilityMode(this, 'custom_subtitle_tr');\r\n        },\r\n\r\n        description_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            var viewEditCustomDescription = $('view_edit_custom_description');\r\n\r\n            if (viewEditCustomDescription) {\r\n                viewEditCustomDescription.hide();\r\n            }\r\n\r\n            $$('.c-custom_description_tr').invoke('hide');\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::DESCRIPTION_MODE_CUSTOM')) {\r\n                if (viewEditCustomDescription) {\r\n                    viewEditCustomDescription.show();\r\n                    $$('.c-custom_description_tr').invoke('hide');\r\n                    return;\r\n                }\r\n\r\n                if (typeof wysiwygdescription_template !== 'undefined' && $('description_editor_type').value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::EDITOR_TYPE_SIMPLE')) {\r\n                    wysiwygdescription_template.turnOff();\r\n                }\r\n\r\n                $$('.c-custom_description_tr').invoke('show');\r\n            } else {\r\n                if (viewEditCustomDescription) {\r\n                    viewEditCustomDescription.remove();\r\n                }\r\n            }\r\n        },\r\n\r\n        view_edit_custom_change: function()\r\n        {\r\n            if (typeof wysiwygdescription_template !== 'undefined' && $('description_editor_type').value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::EDITOR_TYPE_SIMPLE')) {\r\n                wysiwygdescription_template.turnOff();\r\n            }\r\n\r\n            $$('.c-custom_description_tr').invoke('show');\r\n            $('view_edit_custom_description').hide();\r\n        },\r\n\r\n        item_condition_change: function()\r\n        {\r\n            $('condition_note_tr').show();\r\n            $('condition_note_mode').simulate('change');\r\n\r\n            var self = EbayTemplateDescriptionObj,\r\n                isConditionNoteNeeded = true,\r\n\r\n                conditionValue = $('condition_value'),\r\n                conditionAttribute = $('condition_attribute');\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_MODE_NONE')) {\r\n                isConditionNoteNeeded = false;\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_MODE_EBAY')) {\r\n                self.updateHiddenValue(this, conditionValue);\r\n                conditionAttribute.value = '';\r\n                isConditionNoteNeeded = conditionValue.value != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_EBAY_NEW');\r\n            } else {\r\n                self.updateHiddenValue(this, conditionAttribute);\r\n                conditionValue.value = '';\r\n            }\r\n\r\n            if (!isConditionNoteNeeded) {\r\n\r\n                $('condition_note_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_NOTE_MODE_NONE');\r\n                $('condition_note_mode').simulate('change');\r\n\r\n                $('condition_note_tr').hide();\r\n                $('custom_condition_note_tr').hide();\r\n            }\r\n        },\r\n\r\n        condition_note_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_NOTE_MODE_NONE')) {\r\n                $('condition_note_template').update('');\r\n            }\r\n\r\n            self.setTextVisibilityMode(this, 'custom_condition_note_tr');\r\n            self.setTextVisibilityMode(this, 'custom_condition_note_attributes_tr');\r\n        },\r\n\r\n        watermark_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n            self.setTextVisibilityMode(this, 'watermark_image_container');\r\n            if ($('watermark_uploaded_image_container')) {\r\n                self.setTextVisibilityMode(this, 'watermark_uploaded_image_container');\r\n            }\r\n\r\n            if ($('watermark_scale').value != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::WATERMARK_SCALE_MODE_STRETCH')) {\r\n                self.setTextVisibilityMode(this, 'watermark_position_container');\r\n            }\r\n\r\n            self.setTextVisibilityMode(this, 'watermark_scale_container');\r\n            self.setTextVisibilityMode(this, 'watermark_transparent_container');\r\n        },\r\n\r\n        watermark_scale_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            $('watermark_position_container').show();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::WATERMARK_SCALE_MODE_STRETCH')) {\r\n                $('watermark_position_container').hide();\r\n            }\r\n        },\r\n\r\n        setTextVisibilityMode: function(obj, elementName)\r\n        {\r\n            var elementObj = $(elementName);\r\n\r\n            if (!elementObj) {\r\n                return;\r\n            }\r\n\r\n            elementObj.hide();\r\n\r\n            if (obj.value == 1) {\r\n                elementObj.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        image_main_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            $('gallery_images_mode_tr', 'variation_images_mode_tr', 'use_supersize_images_tr',\r\n              'default_image_url_tr', 'watermark_block').invoke('show');\r\n\r\n            if ($$('#variation_configurable_images option').length > 1) {\r\n                $('variation_configurable_images_container').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::IMAGE_MAIN_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('image_main_attribute'));\r\n            } else {\r\n                $('image_main_attribute').value = '';\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::IMAGE_MAIN_MODE_NONE')) {\r\n                $('gallery_images_mode_tr', 'variation_images_mode_tr', 'variation_configurable_images_container',\r\n                  'use_supersize_images_tr', 'default_image_url_tr').invoke('hide');\r\n\r\n                $('use_supersize_images').value = 0;\r\n\r\n                $('gallery_images').value = 0;\r\n                $('gallery_images').simulate('change');\r\n\r\n                $('variation_configurable_images').value = '';\r\n\r\n                $('variation_images').value = 1;\r\n                $('variation_images_limit').value = 1;\r\n                $('variation_images').simulate('change');\r\n\r\n                $('default_image_url').value = '';\r\n\r\n                $('watermark_block').hide();\r\n\r\n                var watermarkMode = $('watermark_mode');\r\n\r\n                if (watermarkMode.selectedIndex != 0) {\r\n                    watermarkMode.selectedIndex = 0;\r\n                    watermarkMode.simulate('change');\r\n                }\r\n            }\r\n        },\r\n\r\n        gallery_images_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            $('gallery_images_limit').value = '';\r\n            $('gallery_images_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::GALLERY_IMAGES_MODE_PRODUCT')) {\r\n                self.updateHiddenValue(this, $('gallery_images_limit'));\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::GALLERY_IMAGES_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('gallery_images_attribute'));\r\n            }\r\n        },\r\n\r\n        variation_images_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            $('variation_images_limit').value = '';\r\n            $('variation_images_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::VARIATION_IMAGES_MODE_PRODUCT')) {\r\n                self.updateHiddenValue(this, $('variation_images_limit'));\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::VARIATION_IMAGES_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('variation_images_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        image_width_mode_change: function()\r\n        {\r\n            $('image_width_span')[this.value == 1 ? 'show' : 'hide']();\r\n        },\r\n\r\n        image_height_mode_change: function()\r\n        {\r\n            $('image_height_span')[this.value == 1 ? 'show' : 'hide']();\r\n        },\r\n\r\n        image_margin_mode_change: function()\r\n        {\r\n            $('image_margin_span')[this.value == 1 ? 'show' : 'hide']();\r\n        },\r\n\r\n        select_attributes_image_change: function()\r\n        {\r\n            $$('.all-products-images').invoke(this.value == 'media_gallery' ? 'show' : 'hide');\r\n            $$('.all-products-image').invoke(this.value == 'image' ? 'show' : 'hide');\r\n            if (this.value == 'image') {\r\n                $('display_products_images').value = 'custom_settings';\r\n            }\r\n            $('display_products_images').simulate('change');\r\n        },\r\n\r\n        display_products_images_change: function()\r\n        {\r\n            $$('.products-images-custom-settings').invoke('hide');\r\n            $$('.products-images-gallery-view').invoke('hide');\r\n\r\n            if (this.value == 'gallery_view') {\r\n                $$('.products-images-gallery-view').invoke('show');\r\n            } else {\r\n                $$('.products-images-custom-settings').invoke('show');\r\n            }\r\n\r\n            jQuery('.products-images-mode-change-label').each(function (index, elem) {\r\n                jQuery(elem).find('.label span').text(jQuery(elem).find('.' + this.value).text());\r\n            }.bind(this));\r\n        },\r\n\r\n        product_details_specification_visibility_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj,\r\n                modeNone = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_NONE'),\r\n                modeDoesNotApply = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_DOES_NOT_APPLY');\r\n\r\n            var isNotAttributeMode = function(element) {\r\n                return element.value == modeNone || element.value == modeDoesNotApply;\r\n            };\r\n\r\n            if ($('product_details_ean', 'product_details_upc', 'product_details_isbn', 'product_details_brand')\r\n                    .every(isNotAttributeMode) && $('product_details_epid').value == modeNone\r\n            ) {\r\n                $('product_details_specification_separator').hide();\r\n                $$('.product-details-specification').each(function(element) {\r\n                    element.hide();\r\n                    element.down('.select').down().selectedIndex = 1;\r\n                });\r\n            } else {\r\n                $('product_details_specification_separator').show();\r\n                var hiddenElement = $(this.id+'_attribute');\r\n                if (!hiddenElement) {\r\n                    return;\r\n                }\r\n                $$('.product-details-specification').invoke('show');\r\n                self.updateHiddenValue(this, hiddenElement);\r\n            }\r\n        },\r\n\r\n        product_details_brand_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_NONE') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_DOES_NOT_APPLY')) {\r\n                $('product_details_mpn_tr').hide();\r\n                $('product_details_mpn').selectedIndex = 0;\r\n            } else {\r\n                $('product_details_mpn_tr').show();\r\n                $$('.product-details-specification').invoke('show');\r\n                self.updateHiddenValue(this, $(this.id+'_attribute'));\r\n            }\r\n\r\n            self.product_details_specification_visibility_change();\r\n        },\r\n\r\n        product_details_mpn_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $(this.id+'_attribute'));\r\n            }\r\n        },\r\n\r\n        showHideWYSIWYG: function ()\r\n        {\r\n            var label;\r\n            if ($('description_template').visible()) {\r\n                label = M2ePro.translator.translate('Show Editor');\r\n                $('description_editor_type').value = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::EDITOR_TYPE_SIMPLE');\r\n            } else {\r\n                label = M2ePro.translator.translate('Hide Editor');\r\n                $('description_editor_type').value = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::EDITOR_TYPE_TINYMCE');\r\n            }\r\n            this.select('span').first().update(label);\r\n        },\r\n\r\n        initCustomInsertsPopup: function ()\r\n        {\r\n            var popup = jQuery('#custom_inserts_popup');\r\n            if (!popup.find('form').length) {\r\n                popup.wrapInner('<form id=\"description_custom_inserts_form\"></form>');\r\n                CommonObj.initFormValidation('#description_custom_inserts_form');\r\n            }\r\n\r\n            popup.modal({\r\n                title: M2ePro.translator.translate('Custom Insertions'),\r\n                type: 'slide',\r\n                buttons: [],\r\n                closed: function () {\r\n                    EbayTemplateDescriptionObj.customInsertsOnClosePopup();\r\n                }\r\n            });\r\n        },\r\n\r\n        customInsertsOpenPopup: function ()\r\n        {\r\n            jQuery('#custom_inserts_popup').modal('openModal');\r\n\r\n            EbayTemplateDescriptionObj.observeImageAttributes();\r\n        },\r\n\r\n        customInsertsOnClosePopup: function ()\r\n        {\r\n            jQuery('#description_custom_inserts_form').trigger('reset').validate().resetForm();\r\n            EbayTemplateDescriptionObj.stopObservingImageAttributes();\r\n        },\r\n\r\n        customInsertsClosePopup: function (callback)\r\n        {\r\n            jQuery('#custom_inserts_popup').modal({\r\n                closed: function () {\r\n                    callback && callback();\r\n\r\n                    // prevent callback closure\r\n                    callback = undefined;\r\n\r\n                    EbayTemplateDescriptionObj.customInsertsOnClosePopup();\r\n                }\r\n            }).modal('closeModal');\r\n        },\r\n\r\n        insertProductAttribute: function ()\r\n        {\r\n            this.customInsertsClosePopup(function () {\r\n                AttributeObj.appendToTextarea('#' + $('custom_inserts_product_attribute').value + '#');\r\n            });\r\n        },\r\n\r\n        insertM2eProAttribute: function ()\r\n        {\r\n            this.customInsertsClosePopup(function () {\r\n                AttributeObj.appendToTextarea('#value[' + $('custom_inserts_m2epro_attribute').value + ']#');\r\n            });\r\n        },\r\n\r\n        insertGallery: function()\r\n        {\r\n            if (!jQuery('#description_custom_inserts_form').valid()) {\r\n                return;\r\n            }\r\n\r\n            var template = '#' + $('select_attributes_image').value;\r\n\r\n            if ($('image_width_mode').value == '1') {\r\n                template += '[' + $('image_width').value + ',';\r\n            } else {\r\n                template += '[,';\r\n            }\r\n\r\n            if ($('image_height_mode').value == '1') {\r\n                template += '' + $('image_height').value + ',';\r\n            } else {\r\n                template += ',';\r\n            }\r\n\r\n            if ($('image_margin_mode').value == '1') {\r\n                template += '' + $('image_margin').value + ',';\r\n            } else {\r\n                template += ',';\r\n            }\r\n\r\n            if ($('select_attributes_image').value == 'media_gallery' && $('display_products_images').value == 'gallery_view')  {\r\n                template += '2';\r\n            } else if ($('image_linked_mode').value == '1') {\r\n                template += '1';\r\n            } else {\r\n                template += \"0\";\r\n            }\r\n\r\n            if ($('select_attributes_image').value == 'media_gallery') {\r\n                template += ',' + $('select_attributes_image_layout').value + ',' + $('select_attributes_image_count').value;\r\n            }\r\n\r\n            if ($('select_attributes_image').value == 'media_gallery' && $('display_products_images').value == 'gallery_view') {\r\n                template += ',\"' + $('gallery_hint_text').value + '\"';\r\n            } else if ($('select_attributes_image').value == 'media_gallery') {\r\n                // media_gallery with empty gallery hint\r\n                template += ',\"\"';\r\n            }\r\n\r\n            if ($('image_insertion_watermark_mode').value == '1') {\r\n                template += ',1';\r\n            } else {\r\n                template += ',';\r\n            }\r\n\r\n            if ($('select_attributes_image').value == 'image') {\r\n                template += ',' + $('select_attributes_image_order_position').value;\r\n            }\r\n\r\n            template += ']#';\r\n\r\n            this.customInsertsClosePopup(function () {\r\n                AttributeObj.appendToTextarea(template);\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        observeImageAttributes: function()\r\n        {\r\n            $('image_width_mode').observe('change', EbayTemplateDescriptionObj.image_width_mode_change).simulate('change');\r\n            $('image_height_mode').observe('change', EbayTemplateDescriptionObj.image_height_mode_change).simulate('change');\r\n            $('image_margin_mode').observe('change', EbayTemplateDescriptionObj.image_margin_mode_change).simulate('change');\r\n\r\n            $('select_attributes_image')\r\n                    .observe('change', EbayTemplateDescriptionObj.select_attributes_image_change)\r\n                    .simulate('change');\r\n\r\n            $('display_products_images')\r\n                    .observe('change', EbayTemplateDescriptionObj.display_products_images_change)\r\n                    .simulate('change');\r\n\r\n            if($('watermark_mode').value == 1) {\r\n                this.setTextVisibilityMode($('watermark_mode'), 'products_images_watermark_mode');\r\n                $('image_insertion_watermark_mode').selectedIndex = 1;\r\n            } else {\r\n                this.setTextVisibilityMode($('watermark_mode'), 'products_images_watermark_mode');\r\n                $('image_insertion_watermark_mode').selectedIndex = 0;\r\n            }\r\n        },\r\n\r\n        stopObservingImageAttributes: function()\r\n        {\r\n            $('image_width_mode').stopObserving();\r\n            $('image_height_mode').stopObserving();\r\n            $('image_margin_mode').stopObserving();\r\n\r\n            $('select_attributes_image').stopObserving();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveWatermarkImage: function(callback, params)\r\n        {\r\n            var form  = $('edit_form');\r\n\r\n            form.action = M2ePro.url.get('ebay_template_description/saveWatermarkImage');\r\n            form.target = 'watermark_image_frame';\r\n\r\n            if ($('watermark_image_frame') === null) {\r\n                document.body.appendChild(new Element('iframe', {\r\n                    id: 'watermark_image_frame',\r\n                    name: 'watermark_image_frame',\r\n                    style: 'display: none'\r\n                }));\r\n            }\r\n\r\n            $('watermark_image_frame').observe('load', function() {\r\n                if (typeof callback == 'function') {\r\n                    callback(params);\r\n                }\r\n            });\r\n\r\n            form.submit();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initPreviewPopup: function ()\r\n        {\r\n            var popup = jQuery('#description_preview_popup');\r\n            if (!popup.find('form').length) {\r\n                popup.wrapInner(new Element('form', {\r\n                    id: 'description_preview_form',\r\n                    method: 'post',\r\n                    target: '_blank',\r\n                    action: M2ePro.url.get('ebay_template_description/preview')\r\n                }));\r\n                this.initFormValidation('#description_preview_form');\r\n            }\r\n\r\n            popup.modal({\r\n                title: M2ePro.translator.translate('Description Preview'),\r\n                type: 'popup',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event);\r\n                    }\r\n                },{\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    click: function (event) {\r\n                        if (!jQuery('#description_preview_form').valid()) {\r\n                            return;\r\n                        }\r\n\r\n                        $('description_preview_description_mode').value = $('description_mode').value;\r\n                        $('description_preview_description_template').value = $('description_template').value;\r\n                        $('description_preview_watermark_mode').value = $('watermark_mode').value;\r\n\r\n                        $('description_preview_form').submit();\r\n\r\n                        this.closeModal(event);\r\n                    }\r\n                }],\r\n                closed: function () {\r\n                    jQuery('#description_preview_form').trigger('reset').validate().resetForm();\r\n                }\r\n            });\r\n        },\r\n\r\n        openPreviewPopup: function ()\r\n        {\r\n            if ($('description_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::DESCRIPTION_MODE_CUSTOM') && !$('description_template').value.length) {\r\n                this.alert(M2ePro.translator.translate('Please enter Description Value.'));\r\n                return;\r\n            }\r\n\r\n            jQuery('#description_preview_popup').modal('openModal');\r\n        },\r\n\r\n        selectProductIdRandomly: function ()\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template_description/getRandomMagentoProductId'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    store_id: $('description_preview_store_id').value\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.success) {\r\n                        $('description_preview_magento_product_id').value = response.product_id;\r\n                    } else {\r\n                        self.alert(response.message);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Template/Payment.js":"define([\r\n    'jquery',\r\n    'M2ePro/Common'\r\n], function (jQuery) {\r\n    window.EbayTemplatePayment = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-validate-payment-methods', function(value) {\r\n\r\n                if ($('pay_pal_mode').checked) {\r\n                    return true;\r\n                }\r\n\r\n                return $$('input[name=\"payment[services][]\"]').any(function(o) {\r\n                    return o.checked;\r\n                });\r\n            }, M2ePro.translator.translate('Payment method should be specified.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-ebay-payment-email', function(value, el) {\r\n\r\n                var advice = Validation.getAdvice('M2ePro-validate-ebay-payment-email',el);\r\n                advice && advice.remove();\r\n\r\n                if (!Validation.get('M2ePro-required-when-visible').test(value,el)) {\r\n                    this.error = Validation.get('M2ePro-required-when-visible').error;\r\n                    return false;\r\n                }\r\n\r\n                this.error = Validation.get('validate-email').error;\r\n                return Validation.get('validate-email').test(value,el);\r\n            }, M2ePro.translator.translate('Email is not valid.'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initObservers: function()\r\n        {\r\n            jQuery('#pay_pal_mode')\r\n                .on('change', EbayTemplatePaymentObj.payPalModeChange)\r\n                .trigger('change');\r\n            jQuery('#pay_pal_immediate_payment')\r\n                .on('change', EbayTemplatePaymentObj.immediatePaymentChange)\r\n                .trigger('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        payPalModeChange: function()\r\n        {\r\n            if (this.checked) {\r\n                $('pay_pal_email_address_container').show();\r\n                $('pay_pal_immediate_payment_container').show();\r\n            } else {\r\n                $('pay_pal_email_address').setValue('');\r\n                $('pay_pal_email_address_container').hide();\r\n                $('pay_pal_immediate_payment_container').hide();\r\n                $('pay_pal_immediate_payment').checked = false;\r\n                jQuery('#pay_pal_immediate_payment').trigger('change');\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        immediatePaymentChange: function()\r\n        {\r\n            var wrapper = $('magento_block_ebay_template_payment_form_data_additional_service');\r\n            if (this.checked) {\r\n                wrapper.hide();\r\n\r\n                $$('input.additional-payment-service').each(function(payment) {\r\n                    payment.checked = false;\r\n                });\r\n            } else {\r\n                wrapper && wrapper.show();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Template/ReturnPolicy.js":"define([\r\n    'knockout',\r\n    'jquery',\r\n    'M2ePro/Common'\r\n], function (ko, jquery) {\r\n    window.EbayTemplateReturnPolicy = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function() {},\r\n\r\n        // ---------------------------------------\r\n\r\n        initObservers: function() {\r\n            jquery('#return_accepted').off('change');\r\n            jquery('#return_accepted').on('change', this.acceptedChange).change();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        acceptedChange: function()\r\n        {\r\n            var columns = [\r\n                'return_option',\r\n                'return_within',\r\n                'return_shipping_cost',\r\n                'return_restocking_fee'\r\n            ];\r\n\r\n            if (this.value == 'ReturnsAccepted') {\r\n                columns.forEach(function(value) {\r\n                    var el = $$('.field-'+value).first();\r\n                    el && el[$(value).options.length ? 'show' : 'hide']();\r\n                });\r\n                $$('.field-return_description').invoke('show');\r\n\r\n                if ($$('.field-return_holiday_mode').length) {\r\n                    $$('.field-return_holiday_mode').invoke('show');\r\n                }\r\n            } else {\r\n                columns.forEach(function(value) {\r\n                    var el = $$('.field-'+value).first();\r\n                    el && el.hide();\r\n                });\r\n\r\n                $$('.field-return_description').invoke('hide');\r\n                $$('.field-return_holiday').invoke('hide');\r\n\r\n                //$('return_holiday_mode').selectedIndex = 0;\r\n                //jquery('#return_holiday_mode').trigger('change');\r\n                $$('.field-return_holiday_mode').invoke('hide');\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Template/SellingFormat.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function (modal) {\r\n\r\n    window.EbayTemplateSellingFormat = Class.create(Common, {\r\n\r\n        charityIndex: 0,\r\n        charityTpl: '',\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ()\r\n        {\r\n            var self = this;\r\n            jQuery.validator.addMethod('M2ePro-validate-price-coefficient', function (value, el) {\r\n\r\n                var tempEl = el;\r\n\r\n                if (self.isElementHiddenFromPage(el)) {\r\n                    return true;\r\n                }\r\n\r\n                var coefficient = el.up().next().down('input');\r\n\r\n                coefficient.removeClassName('price_unvalidated');\r\n\r\n                if (!coefficient.up('div').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                if (coefficient.value == '') {\r\n                    return false;\r\n                }\r\n\r\n                var floatValidator = Validation.get('M2ePro-validation-float');\r\n                if (floatValidator.test($F(coefficient), coefficient) && parseFloat(coefficient.value) <= 0) {\r\n                    coefficient.addClassName('price_unvalidated');\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Price Change is not valid.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-qty', function (value, el) {\r\n\r\n                if (self.isElementHiddenFromPage(el)) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.match(/[^\\d]+/g) || value <= 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Wrong value. Only integer numbers.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-vat', function (value) {\r\n\r\n                if (!value) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.length > 6) {\r\n                    return false;\r\n                }\r\n\r\n                if (value < 0) {\r\n                    return false;\r\n                }\r\n\r\n                value = Math.ceil(value);\r\n\r\n                return value >= 0 && value <= 30;\r\n            }, M2ePro.translator.translate('wrong_value_more_than_30'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validation-charity-percentage', function (value, element) {\r\n\r\n                if (value == 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Please select a percentage of donation'));\r\n\r\n            if ($('charity_row_template')) {\r\n                this.charityTpl = $('charity_row_template').down('tbody').innerHTML;\r\n                $('charity_row_template').remove();\r\n            }\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            $('listing_type')\r\n                .observe('change', EbayTemplateSellingFormatObj.listing_type_change)\r\n                .simulate('change');\r\n\r\n            $('duration_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.duration_mode_change)\r\n                .simulate('change');\r\n\r\n            $('duration_attribute')\r\n                .observe('change', EbayTemplateSellingFormatObj.duration_attribute_change)\r\n                .simulate('change');\r\n\r\n            $('qty_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.qty_mode_change)\r\n                .simulate('change');\r\n\r\n            $('qty_modification_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.qtyPostedMode_change)\r\n                .simulate('change');\r\n\r\n            if ($('tax_category_mode')) {\r\n                $('tax_category_mode')\r\n                    .observe('change', EbayTemplateSellingFormatObj.taxCategoryChange)\r\n                    .simulate('change');\r\n            }\r\n\r\n            $('fixed_price_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.fixed_price_mode_change)\r\n                .simulate('change');\r\n\r\n            $('start_price_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.start_price_mode_change)\r\n                .simulate('change');\r\n\r\n            $('reserve_price_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.reserve_price_mode_change)\r\n                .simulate('change');\r\n\r\n            $('buyitnow_price_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.buyitnow_price_mode_change)\r\n                .simulate('change');\r\n\r\n            $('price_discount_stp_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.price_discount_stp_mode_change)\r\n                .simulate('change');\r\n\r\n            $('price_discount_map_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.price_discount_map_mode_change)\r\n                .simulate('change');\r\n\r\n            $$('.price_coefficient_mode').each(function(element){\r\n                element.observe('change', EbayTemplateSellingFormatObj.price_coefficient_mode_change)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $('best_offer_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.best_offer_mode_change)\r\n                .simulate('change');\r\n\r\n            $('best_offer_accept_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.best_offer_accept_mode_change)\r\n                .simulate('change');\r\n\r\n            $('best_offer_reject_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.best_offer_reject_mode_change)\r\n                .simulate('change');\r\n\r\n            EbayTemplateSellingFormatObj.checkPriceMessages();\r\n            $(\r\n                'fixed_price_mode',\r\n                'start_price_mode',\r\n                'reserve_price_mode',\r\n                'buyitnow_price_mode',\r\n                'price_discount_stp_mode',\r\n                'price_discount_map_mode'\r\n            )\r\n                .invoke('observe', 'change', function() {\r\n                    EbayTemplateSellingFormatObj.checkPriceMessages();\r\n                }\r\n            );\r\n\r\n            EbayTemplateSellingFormatObj.checkBestOfferMessages();\r\n            $(\r\n                'best_offer_accept_mode',\r\n                'best_offer_reject_mode'\r\n            )\r\n                .invoke('observe', 'change', function () {\r\n                    EbayTemplateSellingFormatObj.checkBestOfferMessages();\r\n                }\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isStpAvailable: function () {\r\n            return M2ePro.formData.isStpEnabled;\r\n        },\r\n\r\n        isMapAvailable: function () {\r\n            return M2ePro.formData.isMapEnabled;\r\n        },\r\n\r\n        isStpAdvancedAvailable: function () {\r\n            return M2ePro.formData.isStpAdvancedEnabled;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        listing_type_change: function (event) {\r\n            var self = EbayTemplateSellingFormatObj,\r\n\r\n                bestOfferBlock = $('magento_block_ebay_template_selling_format_edit_form_best_offer-wrapper'),\r\n                bestOfferMode = $('best_offer_mode'),\r\n                attributeElement = $('listing_type_attribute');\r\n\r\n            $('fixed_price_tr', 'start_price_tr', 'reserve_price_tr', 'buyitnow_price_tr').invoke('show');\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_FIXED')) {\r\n                $('start_price_tr', 'reserve_price_tr', 'buyitnow_price_tr').invoke('hide');\r\n                $$('#variation_price_tr .value').invoke('show');\r\n            }\r\n\r\n            attributeElement.innerHTML = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n\r\n            bestOfferBlock.show();\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                $('fixed_price_tr').hide();\r\n                bestOfferBlock.hide();\r\n                bestOfferMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_MODE_NO');\r\n                bestOfferMode.simulate('change');\r\n            }\r\n\r\n            self.updateQtyMode();\r\n            self.updateQtyPercentage();\r\n            self.updateIgnoreVariations();\r\n            self.updateListingDuration();\r\n            self.updateFixedPrice();\r\n            self.updatePriceDiscountStpVisibility();\r\n            self.updatePriceDiscountMapVisibility();\r\n            self.updateVariationPriceTrVisibility();\r\n        },\r\n\r\n        duration_mode_change: function () {\r\n            var outOfStockControlTr = $('out_of_stock_control_tr'),\r\n                outOfStockControlMode = $('out_of_stock_control_mode');\r\n\r\n            outOfStockControlTr.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay::LISTING_DURATION_GTC')) {\r\n                outOfStockControlTr.show();\r\n                outOfStockControlMode.value = M2ePro.formData.outOfStockControl;\r\n            } else {\r\n                outOfStockControlMode.value = 0;\r\n            }\r\n        },\r\n\r\n        duration_attribute_change: function () {\r\n            EbayTemplateSellingFormatObj.updateHiddenValue(this, $('listing_duration_attribute_value'));\r\n        },\r\n\r\n        updateQtyMode: function () {\r\n            var qtyMode = $('qty_mode'),\r\n                qtyModeTr = $('qty_mode_tr');\r\n\r\n            qtyModeTr.show();\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                qtyMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_SINGLE');\r\n                qtyMode.simulate('change');\r\n                qtyModeTr.hide();\r\n            }\r\n        },\r\n\r\n        updateQtyPercentage: function () {\r\n            var qtyPercentageTr = $('qty_percentage_tr');\r\n\r\n            qtyPercentageTr.hide();\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                return;\r\n            }\r\n\r\n            var qtyMode = $('qty_mode').value;\r\n\r\n            if (qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_SINGLE') ||\r\n                qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_NUMBER')) {\r\n                return;\r\n            }\r\n\r\n            qtyPercentageTr.show();\r\n        },\r\n\r\n        updateIgnoreVariations: function () {\r\n            var ignoreVariationsValueTr = $('ignore_variations_value_tr'),\r\n                ignoreVariationsValue = $('ignore_variations_value');\r\n\r\n            ignoreVariationsValueTr.hide();\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                ignoreVariationsValue.value = 0;\r\n            } else {\r\n                ignoreVariationsValueTr.show();\r\n            }\r\n        },\r\n\r\n        updateListingDuration: function () {\r\n            var durationMode = $('duration_mode_container'),\r\n                durationModeValue = $('duration_mode'),\r\n                durationAttribute = $('duration_attribute_container'),\r\n                durationAttributeNote = $('duration_attribute_note');\r\n\r\n            var outOfStockControlTr = $('out_of_stock_control_tr'),\r\n                outOfStockControlMode = $('out_of_stock_control_mode');\r\n\r\n            $('durationId1', 'durationId30', 'durationId100').invoke('show');\r\n\r\n            durationMode.show();\r\n            durationAttribute.hide();\r\n            durationAttributeNote.hide();\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_FIXED')) {\r\n\r\n                durationModeValue.value = 3;\r\n\r\n                $('durationId1').hide();\r\n                if (M2ePro.formData.duration_mode && M2ePro.formData.duration_mode != 1) {\r\n                    durationModeValue.value = M2ePro.formData.duration_mode;\r\n                }\r\n\r\n                durationModeValue.simulate('change');\r\n            }\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n\r\n                durationModeValue.value = 3;\r\n\r\n                $('durationId30', 'durationId100').invoke('hide');\r\n                if (M2ePro.formData.duration_mode && M2ePro.formData.duration_mode != 30 && M2ePro.formData.duration_mode != 100) {\r\n                    durationModeValue.value = M2ePro.formData.duration_mode;\r\n                }\r\n\r\n                outOfStockControlTr.hide();\r\n                outOfStockControlMode.value = 0;\r\n            }\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_ATTRIBUTE')) {\r\n                durationMode.hide();\r\n                durationAttribute.show();\r\n                durationAttributeNote.show();\r\n                outOfStockControlTr.hide();\r\n                outOfStockControlMode.value = 0;\r\n            }\r\n        },\r\n\r\n        updateVariationPriceTrVisibility: function () {\r\n            var removeBottomBorderTds = $$('#fixed_price_tr td.remove_bottom_border'),\r\n                addRowspanTds = $$('#fixed_price_tr td.add_rowspan'),\r\n                priceModeSelect = $('fixed_price_mode'),\r\n                variationPriceTr = $('variation_price_tr');\r\n\r\n            variationPriceTr.hide();\r\n            removeBottomBorderTds.invoke('removeClassName', 'bottom_border_disabled');\r\n            addRowspanTds.invoke('removeAttribute', 'rowspan');\r\n\r\n            if ($('listing_type').value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                variationPriceTr.show();\r\n                addRowspanTds.invoke('setAttribute', 'rowspan', '2');\r\n                if (priceModeSelect.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                    removeBottomBorderTds.invoke('addClassName', 'bottom_border_disabled');\r\n                }\r\n            }\r\n        },\r\n\r\n        updateFixedPrice: function () {\r\n            var priceLabel = $('fixed_price_label'),\r\n                bestOfferAcceptPercentageOption = $('best_offer_accept_percentage_option'),\r\n                bestOfferRejectPercentageOption = $('best_offer_reject_percentage_option');\r\n\r\n            priceLabel.innerHTML = M2ePro.translator.translate('Fixed Price') + ': ';\r\n            bestOfferAcceptPercentageOption.innerHTML = M2ePro.translator.translate('% of Fixed Price');\r\n            bestOfferRejectPercentageOption.innerHTML = M2ePro.translator.translate('% of Fixed Price');\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_FIXED')) {\r\n                priceLabel.innerHTML = M2ePro.translator.translate('Price') + ': ';\r\n                bestOfferAcceptPercentageOption.innerHTML = M2ePro.translator.translate('% of Price');\r\n                bestOfferRejectPercentageOption.innerHTML = M2ePro.translator.translate('% of Price');\r\n            }\r\n        },\r\n\r\n        updatePriceDiscountStpVisibility: function () {\r\n            var priceDiscTrStp = $('price_discount_stp_tr'),\r\n                priceDiscStpMode = $('price_discount_stp_mode');\r\n\r\n            priceDiscTrStp.hide();\r\n            if (EbayTemplateSellingFormatObj.isStpAvailable()) {\r\n                priceDiscTrStp.show();\r\n            }\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                priceDiscTrStp.hide();\r\n                priceDiscStpMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE');\r\n                priceDiscStpMode.simulate('change');\r\n            }\r\n        },\r\n\r\n        updatePriceDiscountMapVisibility: function () {\r\n            var priceDiscTrMap = $('price_discount_map_tr'),\r\n                priceDiscMapMode = $('price_discount_map_mode');\r\n\r\n            priceDiscTrMap.hide();\r\n            if (EbayTemplateSellingFormatObj.isMapAvailable()) {\r\n                priceDiscTrMap.show();\r\n            }\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                priceDiscTrMap.hide();\r\n                priceDiscMapMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE');\r\n                priceDiscMapMode.simulate('change');\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        qty_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n\r\n                customValueTr = $('qty_mode_cv_tr'),\r\n                attributeElement = $('qty_custom_attribute'),\r\n\r\n                maxPostedValueTr = $('qty_modification_mode_tr'),\r\n                maxPostedValueMode = $('qty_modification_mode');\r\n\r\n            customValueTr.hide();\r\n            attributeElement.value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_NUMBER')) {\r\n                customValueTr.show();\r\n            } else if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n\r\n            maxPostedValueTr.hide();\r\n            maxPostedValueMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::QTY_MODIFICATION_MODE_OFF');\r\n\r\n            if (self.isMaxPostedQtyAvailable(this.value)) {\r\n\r\n                maxPostedValueTr.show();\r\n                maxPostedValueMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::QTY_MODIFICATION_MODE_ON');\r\n\r\n                if (self.isMaxPostedQtyAvailable(M2ePro.formData.qty_mode)) {\r\n                    maxPostedValueMode.value = M2ePro.formData.qty_modification_mode;\r\n                }\r\n            }\r\n\r\n            maxPostedValueMode.simulate('change');\r\n\r\n            self.updateQtyPercentage();\r\n        },\r\n\r\n        isMaxPostedQtyAvailable: function (qtyMode) {\r\n            return qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_PRODUCT') ||\r\n                qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_ATTRIBUTE') ||\r\n                qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_PRODUCT_FIXED');\r\n        },\r\n\r\n        qtyPostedMode_change: function () {\r\n            var minPosterValueTr = $('qty_min_posted_value_tr'),\r\n                maxPosterValueTr = $('qty_max_posted_value_tr');\r\n\r\n            minPosterValueTr.hide();\r\n            maxPosterValueTr.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::QTY_MODIFICATION_MODE_ON')) {\r\n                minPosterValueTr.show();\r\n                maxPosterValueTr.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        taxCategoryChange: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                valueEl = $('tax_category_value'),\r\n                attributeEl = $('tax_category_attribute');\r\n\r\n            valueEl.value = '';\r\n            attributeEl.value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::TAX_CATEGORY_MODE_VALUE')) {\r\n                self.updateHiddenValue(this, valueEl);\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::TAX_CATEGORY_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, attributeEl);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        fixed_price_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                listingType = $('listing_type'),\r\n                currencyTd = $('fixed_price_currency_td'),\r\n                attributeElement = $('fixed_price_custom_attribute'),\r\n                priceChangeTd = $('fixed_price_change_td'),\r\n                priceChangeTds = $$('#fixed_price_tr td.remove_bottom_border'),\r\n                variationPriceSelect = $$('#variation_price_tr .value');\r\n\r\n            variationPriceSelect.invoke('hide');\r\n            priceChangeTds.invoke('removeClassName', 'bottom_border_disabled');\r\n            priceChangeTd.hide();\r\n            currencyTd && currencyTd.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                priceChangeTd.show();\r\n                currencyTd && currencyTd.show();\r\n                variationPriceSelect.invoke('show');\r\n                if (listingType.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                    priceChangeTds.invoke('addClassName', 'bottom_border_disabled');\r\n                }\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        start_price_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                attributeElement = $('start_price_custom_attribute');\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        reserve_price_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                attributeElement = $('reserve_price_custom_attribute'),\r\n                priceChangeTd = $('reserve_price_change_td'),\r\n                currencyTd = $('reserve_price_currency_td');\r\n\r\n            priceChangeTd.hide();\r\n            currencyTd && currencyTd.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                priceChangeTd.show();\r\n                currencyTd && currencyTd.show();\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        buyitnow_price_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                attributeElement = $('buyitnow_price_custom_attribute'),\r\n                priceChangeTd = $('buyitnow_price_change_td'),\r\n                currencyTd = $('buyitnow_price_currency_td');\r\n\r\n            priceChangeTd.hide();\r\n            currencyTd && currencyTd.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                priceChangeTd.show();\r\n                currencyTd && currencyTd.show();\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        price_coefficient_mode_change: function () {\r\n            var coefficientInputDiv = $(this.id.replace('mode', '') + 'input_div'),\r\n                signSpan = $(this.id.replace('mode', '') + 'sign_span'),\r\n                percentSpan = $(this.id.replace('mode', '') + 'percent_span'),\r\n                examplesContainer = $(this.id.replace('coefficient_mode', '') + 'example_container');\r\n\r\n            // ---------------------------------------\r\n\r\n            coefficientInputDiv.show();\r\n            examplesContainer.show();\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_NONE')) {\r\n                coefficientInputDiv.hide();\r\n                examplesContainer.hide();\r\n            }\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            signSpan.innerHTML = '';\r\n            percentSpan.innerHTML = '';\r\n            $$('.' + this.id.replace('coefficient_mode', '') + 'example').invoke('hide');\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_ABSOLUTE_INCREASE')) {\r\n                signSpan.innerHTML = '+';\r\n\r\n                if (typeof M2ePro.formData.currency != 'undefined') {\r\n                    percentSpan.innerHTML = M2ePro.formData.currency;\r\n                }\r\n\r\n                $(this.id.replace('coefficient_mode', '') + 'example_absolute_increase').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_ABSOLUTE_DECREASE')) {\r\n                signSpan.innerHTML = '-';\r\n\r\n                if (typeof M2ePro.formData.currency != 'undefined') {\r\n                    percentSpan.innerHTML = M2ePro.formData.currency;\r\n                }\r\n\r\n                $(this.id.replace('coefficient_mode', '') + 'example_absolute_decrease').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_PERCENTAGE_INCREASE')) {\r\n                signSpan.innerHTML = '+';\r\n                percentSpan.innerHTML = '%';\r\n\r\n                $(this.id.replace('coefficient_mode', '') + 'example_percentage_increase').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_PERCENTAGE_DECREASE')) {\r\n                signSpan.innerHTML = '-';\r\n                percentSpan.innerHTML = '%';\r\n\r\n                $(this.id.replace('coefficient_mode', '') + 'example_percentage_decrease').show();\r\n            }\r\n            // ---------------------------------------\r\n        },\r\n\r\n        price_discount_stp_mode_change: function () {\r\n            var attributeElement = $('price_discount_stp_attribute'),\r\n                priceDiscountStpTds = $$('#price_discount_stp_tr td.remove_bottom_border'),\r\n                priceDiscountStpReasonTr = $('price_discount_stp_reason_tr'),\r\n                currencyTd = $('price_discount_stp_currency_td');\r\n\r\n            priceDiscountStpReasonTr.hide();\r\n            currencyTd && currencyTd.hide();\r\n            priceDiscountStpTds.invoke('removeClassName', 'bottom_border_disabled');\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                currencyTd && currencyTd.show();\r\n\r\n                if (EbayTemplateSellingFormatObj.isStpAdvancedAvailable()) {\r\n                    priceDiscountStpReasonTr.show();\r\n                    priceDiscountStpTds.invoke('addClassName', 'bottom_border_disabled');\r\n                }\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                EbayTemplateSellingFormatObj.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        price_discount_map_mode_change: function () {\r\n            var attributeElement = $('price_discount_map_attribute'),\r\n                priceDiscountMapExposureTr = $('price_discount_map_exposure_tr'),\r\n                currencyTd = $('price_discount_map_currency_td');\r\n\r\n            priceDiscountMapExposureTr.hide();\r\n            currencyTd && currencyTd.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                currencyTd && currencyTd.show();\r\n\r\n                if (EbayTemplateSellingFormatObj.isMapAvailable()) {\r\n                    priceDiscountMapExposureTr.show();\r\n                }\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                EbayTemplateSellingFormatObj.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        best_offer_mode_change: function () {\r\n            var bestOfferRespondTable = $$('.best_offer_respond_table_container');\r\n\r\n            bestOfferRespondTable.invoke('hide');\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_MODE_YES')) {\r\n                bestOfferRespondTable.invoke('show');\r\n                $('best_offer_reject_mode', 'best_offer_accept_mode').invoke('simulate', 'change');\r\n            } else {\r\n                $('template_selling_format_messages_best_offer').innerHTML = '';\r\n            }\r\n        },\r\n\r\n        best_offer_accept_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n\r\n                bestOfferAcceptValueTr = $('best_offer_accept_value_tr'),\r\n                attributeElement = $('best_offer_accept_custom_attribute');\r\n\r\n            bestOfferAcceptValueTr.hide();\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_ACCEPT_MODE_PERCENTAGE')) {\r\n                bestOfferAcceptValueTr.show();\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_ACCEPT_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        best_offer_reject_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                bestOfferRejectValueTr = $('best_offer_reject_value_tr'),\r\n                attributeElement = $('best_offer_reject_custom_attribute');\r\n\r\n            bestOfferRejectValueTr.hide();\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_REJECT_MODE_PERCENTAGE')) {\r\n                bestOfferRejectValueTr.show();\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_REJECT_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        selectMagentoAttribute: function (elementSelect, elementAttribute) {\r\n            var attributeCode = elementSelect.options[elementSelect.selectedIndex].getAttribute('attribute_code');\r\n            elementAttribute.value = attributeCode;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        checkBestOfferMessages: function ()\r\n        {\r\n            var formElements = $(\r\n                \"best_offer_mode\",\r\n                \"best_offer_accept_mode\",\r\n                \"best_offer_accept_custom_attribute\",\r\n                \"best_offer_reject_mode\",\r\n                \"best_offer_reject_custom_attribute\"\r\n            );\r\n\r\n            var isVisible = $$('.best_offer_respond_table_container').first().visible();\r\n            if (!isVisible) {\r\n                return false;\r\n            }\r\n\r\n            this.checkMessages(Form.serializeElements(formElements), 'template_selling_format_messages_best_offer')\r\n        },\r\n\r\n        checkPriceMessages: function ()\r\n        {\r\n\r\n            var formElements = Form.getElements('template_selling_format_data_container'),\r\n                excludedElements = $(\r\n                    \"best_offer_mode\",\r\n                    \"best_offer_accept_mode\",\r\n                    \"best_offer_accept_custom_attribute\",\r\n                    \"best_offer_reject_mode\",\r\n                    \"best_offer_reject_custom_attribute\"\r\n                );\r\n\r\n            formElements = formElements.filter(function (element) {\r\n                return excludedElements.indexOf(element) < 0;\r\n            });\r\n\r\n            if (formElements.length === 0) {\r\n                return false;\r\n            }\r\n\r\n            this.checkMessages(Form.serializeElements(formElements), 'template_selling_format_messages');\r\n        },\r\n\r\n        checkMessages: function (data, container)\r\n        {\r\n            if (typeof EbayListingTemplateSwitcherObj == 'undefined') {\r\n                // not inside template switcher\r\n                return;\r\n            }\r\n\r\n            var id = '',\r\n                nick = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::TEMPLATE_SELLING_FORMAT'),\r\n                storeId = EbayListingTemplateSwitcherObj.storeId,\r\n                marketplaceId = EbayListingTemplateSwitcherObj.marketplaceId,\r\n                checkAttributesAvailability = EbayListingTemplateSwitcherObj.checkAttributesAvailability,\r\n                callback = function () {\r\n                    var refresh = $(container).down('a.refresh-messages');\r\n                    if (refresh) {\r\n                        refresh.observe('click', function () {\r\n                            this.checkMessages(data, container);\r\n                        }.bind(this))\r\n                    }\r\n                }.bind(this);\r\n\r\n            TemplateHandlerObj.checkMessages(\r\n                id,\r\n                nick,\r\n                data,\r\n                storeId,\r\n                marketplaceId,\r\n                checkAttributesAvailability,\r\n                container,\r\n                callback\r\n            );\r\n        },\r\n\r\n        // eBay Charity\r\n        // ---------------------------------------\r\n\r\n        renderCharities: function (data) {\r\n            var self = this;\r\n\r\n            $H(data).each(function (charity) {\r\n                self.addCharityRow(charity.value);\r\n            });\r\n        },\r\n\r\n        addCharityRow: function (charityData) {\r\n            var self = this;\r\n\r\n            $('charity_not_set_table').hide();\r\n            $('charity_table').show();\r\n\r\n            charityData = charityData || {};\r\n            this.charityIndex++;\r\n\r\n            var tpl = this.charityTpl;\r\n            tpl = tpl.replace(/%i%/g, this.charityIndex);\r\n            $('charity_table_tbody').insert(tpl);\r\n\r\n            var row = $('charity_row_' + this.charityIndex + '_tr');\r\n            row.show();\r\n\r\n            var marketplaceEl = row.down('.charity-marketplace_id');\r\n\r\n            if ($('charity_table_tbody').select('tr').length === (marketplaceEl.select('option').length - 1)) {\r\n                $$('.add_charity_button').each(function(el) {\r\n                    el.hide();\r\n                });\r\n            }\r\n\r\n            if (charityData.marketplace_id) {\r\n                marketplaceEl.value = charityData.marketplace_id;\r\n                self.charityMarketplaceChange.call(self, marketplaceEl, charityData);\r\n            } else {\r\n                self.hideSelectedMarketplaceOptions();\r\n            }\r\n        },\r\n\r\n        removeCharityRow: function (el) {\r\n            el.up('.charity-row').remove();\r\n\r\n            if ($('charity_table_tbody').select('tr').length == 0) {\r\n                $('charity_not_set_table').show();\r\n                $('charity_table').hide();\r\n            }\r\n\r\n            $$('.add_charity_button').each(function(el){\r\n                el.show();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        charityMarketplaceChange: function(marketplaceEl, charityData) {\r\n            var self = this,\r\n                organizationEl = marketplaceEl.up('.charity-row').down('.charity-organization'),\r\n                percentageEl = organizationEl.up('.charity-row').down('.charity-percentage');\r\n\r\n            charityData = charityData || {};\r\n\r\n            self.hideSelectedMarketplaceOptions();\r\n\r\n            percentageEl.value = '';\r\n\r\n            if (marketplaceEl.value == '') {\r\n                organizationEl.value = '';\r\n                organizationEl.simulate('change');\r\n                organizationEl.disable().hide();\r\n\r\n                return;\r\n            }\r\n            organizationEl.update().enable().show();\r\n\r\n            var option = new Element('option', {\r\n                class: 'empty',\r\n                value: ''\r\n            });\r\n            organizationEl.insert({bottom: option});\r\n\r\n            option = new Element('option', {\r\n                class: 'searchNewCharity',\r\n                value: ''\r\n            });\r\n            option.innerHTML = M2ePro.translator.translate('Search for Charity Organization');\r\n            organizationEl.insert({bottom: option});\r\n\r\n            if (charityData.organization_id && charityData.organization_custom == 0) {\r\n\r\n                charityData.organization_custom = 1;\r\n\r\n                self.charityDictionary[marketplaceEl.value].charities.each(function (charity) {\r\n                    if (charityData.organization_id == charity.id) {\r\n                        charityData.organization_custom = 0;\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (charityData.organization_custom) {\r\n                var customOptgroup = new Element('optgroup', {\r\n                    label: 'Custom',\r\n                    class: 'customCharity'\r\n                }).insert({\r\n                    bottom: new Element('option', {\r\n                        value: charityData.organization_id,\r\n                        class: 'newCharity'\r\n                    }).update(charityData.organization_name)\r\n                });\r\n\r\n                organizationEl.insert(customOptgroup);\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = charityData.organization_custom;\r\n            }\r\n\r\n            if (self.charityDictionary[marketplaceEl.value].charities.length > 0) {\r\n                var optgroup = new Element('optgroup', {\r\n                    label: 'Featured',\r\n                    class: 'featuredCharity'\r\n                });\r\n\r\n                self.charityDictionary[marketplaceEl.value].charities.each(function (charity) {\r\n                    var option = new Element('option', {\r\n                        value: charity.id\r\n                    });\r\n\r\n                    option.innerHTML = charity.name;\r\n                    optgroup.insert(option);\r\n                });\r\n                organizationEl.insert(optgroup);\r\n            }\r\n\r\n            if (charityData.organization_id) {\r\n                organizationEl.value = charityData.organization_id;\r\n                self.charityOrganizationChange.call(self, organizationEl, charityData);\r\n            }\r\n        },\r\n\r\n        charityOrganizationChange: function (organizationEl, charityData) {\r\n            var self = this,\r\n                percentageEl = organizationEl.up('.charity-row').down('.charity-percentage'),\r\n                marketplaceEl = organizationEl.up('.charity-row').down('.charity-marketplace_id');\r\n\r\n            if (organizationEl[organizationEl.selectedIndex].hasClassName('searchNewCharity')) {\r\n                self.openPopUpCharity(organizationEl, marketplaceEl.value);\r\n\r\n                if (typeof self.charitySelectedHistory != 'undefined') {\r\n                    organizationEl.selectedIndex = self.charitySelectedHistory;\r\n                }\r\n\r\n                return;\r\n            }\r\n\r\n            var optgroup = organizationEl[organizationEl.selectedIndex].up('optgroup')\r\n\r\n            if (optgroup && optgroup.hasClassName('customCharity')) {\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 1;\r\n            } else {\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 0;\r\n            }\r\n\r\n            self.charitySelectedHistory = organizationEl.selectedIndex;\r\n\r\n            organizationEl.up('.charity-row').select('input.organization_name')[0].value = organizationEl[organizationEl.selectedIndex].innerHTML;\r\n\r\n            charityData = charityData || {};\r\n\r\n            if (organizationEl.value == '') {\r\n                percentageEl.value = '';\r\n                percentageEl.simulate('change');\r\n                percentageEl.disable().hide();\r\n\r\n                return;\r\n            }\r\n            percentageEl.update().enable().show();\r\n\r\n            var option = new Element('option', {\r\n                class: 'empty',\r\n                value: ''\r\n            });\r\n            percentageEl.insert({bottom: option});\r\n\r\n            if (marketplaceEl.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay::MARKETPLACE_MOTORS')) {\r\n                option = new Element('option', {\r\n                    value: 1\r\n                });\r\n                option.innerHTML = '1%';\r\n                percentageEl.insert({bottom: option});\r\n                option = new Element('option', {\r\n                    value: 5\r\n                });\r\n                option.innerHTML = '5%';\r\n                percentageEl.insert({bottom: option});\r\n            }\r\n\r\n            for (var i = 2; i < 21; i++) {\r\n                option = new Element('option', {\r\n                    value: i*5\r\n                });\r\n                option.innerHTML = i*5+'%';\r\n                percentageEl.insert({bottom: option});\r\n            }\r\n\r\n            if (charityData.percentage) {\r\n                percentageEl.value = charityData.percentage;\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        charityOrganizationCustomModeChange: function (organizationEl, charityData) {\r\n            var self = this,\r\n                percentageEl = organizationEl.up('.charity-row').down('.charity-percentage'),\r\n                marketplaceEl = organizationEl.up('.charity-row').down('.charity-marketplace_id');\r\n\r\n            if (organizationEl[organizationEl.selectedIndex].hasClassName('searchNewCharity')) {\r\n                self.openPopUpCharity(organizationEl, marketplaceEl.value);\r\n\r\n                if (typeof self.charitySelectedHistory != 'undefined') {\r\n                    organizationEl.selectedIndex = self.charitySelectedHistory;\r\n                }\r\n\r\n                return;\r\n            }\r\n\r\n            var optgroup = organizationEl[organizationEl.selectedIndex].up('optgroup')\r\n\r\n            if (optgroup && optgroup.hasClassName('customCharity')) {\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 1;\r\n            } else {\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 0;\r\n            }\r\n\r\n            self.charitySelectedHistory = organizationEl.selectedIndex;\r\n\r\n            organizationEl.up('.charity-row').select('input.organization_name')[0].value = organizationEl[organizationEl.selectedIndex].innerHTML;\r\n\r\n            if (organizationEl.value == '') {\r\n                $('charity_percentage').hide();\r\n            } else {\r\n                $('charity_percentage').show();\r\n            }\r\n            percentageEl.value = '';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        hideSelectedMarketplaceOptions: function()\r\n        {\r\n            var charityTBody =  $('charity_table_tbody');\r\n\r\n            charityTBody.select('select.charity-marketplace_id option').each(function(option){\r\n                option.show();\r\n            });\r\n\r\n            charityTBody.select('select.charity-marketplace_id').each(function(select){\r\n                charityTBody.select('select.charity-marketplace_id option[value=\"' + select.value + '\"]').each(function(option){\r\n                    option.hide();\r\n                });\r\n\r\n                select[select.selectedIndex].show();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUpCharity: function (organizationEl, marketplaceId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template_sellingFormat/getSearchCharityPopUpHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: marketplaceId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var container = $('charitySearch_pop_up_content');\r\n\r\n                    if (container) {\r\n                        container.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({\r\n                        bottom: transport.responseText\r\n                    });\r\n\r\n                    self.charitySearchPopup = jQuery('#charitySearch_pop_up_content');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Search For Charities'),\r\n                        type: 'slide',\r\n                        buttons: []\r\n                    }, self.charitySearchPopup);\r\n\r\n                    self.charitySearchPopup.modal('openModal');\r\n\r\n                    self.charitySearchPopup.organizationEl = organizationEl;\r\n\r\n                    $('query').observe('keypress', function (event) {\r\n                        event.keyCode == Event.KEY_RETURN && self.searchCharity();\r\n                    });\r\n\r\n                    $('searchCharity_reset').observe('click', function (event) {\r\n                        $('query').value = '';\r\n                        $('selectCharitySearch').selectedIndex = '';\r\n                        $('searchCharity_grid').hide();\r\n                        $('searchCharity_warning_block').hide();\r\n                    })\r\n                }\r\n            });\r\n\r\n        },\r\n\r\n        searchCharity: function () {\r\n            var query = $('query').value;\r\n            var destination = $('selectCharitySearch').value;\r\n            var marketplaceId = $('charitySearch_marketplace_id').value;\r\n\r\n            if (query == '') {\r\n                $('query').focus();\r\n                this.alert(M2ePro.translator.translate('Please, enter the organization name or ID.'));\r\n                return;\r\n            }\r\n\r\n            $('searchCharity_grid').hide();\r\n            $('searchCharity_error_block').hide();\r\n            $('searchCharity_warning_block').hide();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template_sellingFormat/searchCharity'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    query: query,\r\n                    destination: destination,\r\n                    marketplace_id: marketplaceId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    transport = transport.responseText.evalJSON();\r\n\r\n                    if (transport.result == 'success') {\r\n                        $('searchCharity_grid')\r\n                            .update(transport.html)\r\n                            .show();\r\n\r\n                        if (transport.count) {\r\n                            $('searchCharity_warning_block').show();\r\n                        }\r\n                    } else {\r\n                        $('searchCharity_error_block').update(transport.html);\r\n                        $('searchCharity_error_block').show();\r\n                    }\r\n                }\r\n            })\r\n        },\r\n\r\n        selectNewCharity: function (id, name) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var customCharities = self.charitySearchPopup.organizationEl.select('option.newCharity');\r\n\r\n                        if (customCharities.length > 0) {\r\n                            customCharities[0].update(name);\r\n                            customCharities[0].value = id;\r\n                        } else {\r\n                            var optgroups = self.charitySearchPopup.organizationEl.select('optgroup.customCharity');\r\n\r\n                            if (optgroups.length > 0) {\r\n                                optgroups[0].insert({\r\n                                    bottom: new Element('option', {\r\n                                        value: id,\r\n                                        class: 'newCharity'\r\n                                    }).update(name)\r\n                                });\r\n                            } else {\r\n                                var optgroup = new Element('optgroup', {\r\n                                    label: 'Custom',\r\n                                    class: 'customCharity'\r\n                                }).insert({\r\n                                    bottom: new Element('option', {\r\n                                        value: id,\r\n                                        class: 'newCharity'\r\n                                    }).update(name)\r\n                                });\r\n\r\n                                var featuresGroups = self.charitySearchPopup.organizationEl.select('optgroup.featuredCharity');\r\n                                if (featuresGroups.length > 0) {\r\n                                    featuresGroups[0].insert({\r\n                                        before: optgroup\r\n                                    });\r\n                                } else {\r\n                                    self.charitySearchPopup.organizationEl.insert(optgroup);\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        self.charitySearchPopup.organizationEl.value = id;\r\n                        self.charitySearchPopup.organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 1;\r\n                        self.charitySearchPopup.organizationEl.simulate('change');\r\n                        self.charitySearchPopup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});"}
}});
